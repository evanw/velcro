{"version":3,"sources":["lib/typeAcquisition.ts","../../bundler/dist/dist-module/index.js","../../resolver-host-compound/dist/dist-module/index.js","lib/error.ts","lib/ResolverHostMonaco.ts","../../resolver-host-unpkg/dist/dist-module/index.js","lib/ResolverHostWithCache.ts","lib/EditorManager.ts","components/Editor.tsx","lib/CallSite.ts","lib/hooks.ts","components/Preview.tsx","components/Sidebar.tsx","components/App.tsx","serviceWorker.ts","index.tsx","../../resolver/dist/dist-module/index.js"],"names":["PackageEntryKind","HAS_D_TS_EXTENSION","getTypingsModuleSpec","pkgJson","typingsName","name","charAt","slice","replace","typingsRange","version","major","split","range","TypeAcquirer","resolver","resolveBareModule","_onTypeFile","Emitter","typingsFiles","parentPath","moduleRoot","util","join","this","_listFiles","then","files","imported","promises","normalizedMain","resolve","main","pathname","test","push","host","readFileContent","nameSpec","spec","buf","contents","decoder","decode","filePath","fire","content","e","console","warn","length","Promise","all","undefined","typingsModuleSpec","_import","dependencies","getCanonicalUrl","unresolvedUrl","resolvedUrl","entries","queue","next","shift","listEntries","entriesAtPath","entry","type","ResolvedEntryKind","Directory","url","path","href","File","pkgJsonPathname","bareModuleUrl","readParentPackageJson","resolvedPkgJson","Error","pkgJsonText","JSON","stringify","packageJson","resolvedName","_importAdjacentTypings","indexOf","_importTypingsFromDefinitelyTyped","error","specs","Object","keys","map","importTypesForSpec","importResults","reduce","result","event","object","enumerableOnly","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","apply","target","i","arguments","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","RELATE_PATH_RX","SPEC_RX","Deferred","_this","internalState","promise","promiseResolve","promiseReject","value","reason","get","isBareModuleSpecifier","parseBareModuleSpec","parsed","matches","match","maybeParseBareModuleSpec","concat","getSourceMappingUrl","str","re","lastMatch","exec","traverse","ast","ctx","_ref","visit","node","parent","enter","leave","prop","index","_shouldSkip","shouldSkip","call","context","skipped","childKeys","Array","isArray","j","skip","isArrowFunctionExpression","isFunctionDeclaration","isFunctionExpression","isIdentifier","isMemberExpression","isNodeWithStartAndEnd","start","end","isStringLiteral","isLiteral","parseFile","uri","magicString","code","options","unboundSymbols","Map","locals","nodeEnv","replacements","requires","requireResolves","Set","original","onComment","_isBlock","_test","remove","onToken","token","addSourcemapLocation","allowReturnOutsideFunction","sourceType","scopingAndRequiresVisitor","collectGlobalsVisitor","err","message","requireDependencies","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","done","callee","return","requireResolveDependencies","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_node","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","_ref4","_ref3","symbolName","symbolNodes","set","has","_parent","isVariableDeclaration","nextParent","kind","isScope","isBlockScope","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","declarations","declarePattern","id","_parent2","_nextParent2","_locals","declareFunction","isFunction","_locals2","isClassDeclaration","_parent3","_nextParent3","_locals3","isTryStatement","handler","_locals4","param","visitAndCaptureScoping","isIfStatement","isBinaryExpression","l","r","operator","left","right","memberExpressionMatches","replacement","alternate","add","consequent","visitAndSkipBranches","isCallExpression","firstArg","property","_firstArg","visitRequires","isPropertyOfMemberExpression","isProperty","isKeyOfProperty","isBindingIdentifier","foundBinding","declaresArguments","isThisExpression","_foundBinding","_nextParent","declaresThis","_unboundSymbols","params","isObjectPattern","properties","isArrayPattern","elements","isRestElement","argument","isAssignmentPattern","isProgram","isBlockStatement","pattern","memberParts","DependencyKind","Asset","rootHref","unresolvedDependencies","deps","filename","indentExclusionRanges","sourceMappingUrl","asset","endsWith","parse","_uri","prepend","getParserForAsset","json","_asset$dependencies","setCode","NODE_CORE_SHIMS","shims","coreLibName","assign","resolveBareModuleToUnpkgWithDetails","_ref5","mark","_callee","parentHref","_ref6","parsedSpec","details","resolvedSpecRoot","unresolvedHref","parentUrl","parentPackageInfo","consolidatedDependencies","builtIn","parsedBuiltInSpec","stableUrl","stableRootUrl","resolveResult","packageInfo","_args","wrap","_context","prev","bareModule","URL","t0","sent","peerDependencies","devDependencies","versionSpec","isBuiltIn","ignored","rootUrl","abrupt","stop","_x","_x2","_x3","createRuntime","Velcro","aliasesSymbol","for","modulesSymbol","registrySymbol","rootSymbol","Runtime","create","toStringTag","self","configurable","root","Module","runtime","exports","dependents","prototype","alias","import","reject","require","register","factory","module","seen","removalQueue","moduleToRemove","dirname","basename","bind","ResolveDetailsKind","Bundler","_Error","ExtendableError","_this2","constructor","captureStackTrace","stack","_ExtendableError","InvariantViolation","_ExtendableError2","ResolveError","fromHref","_this3","EMPTY_MODULE_URL","DEFAULT_SHIM_GLOBALS","Buffer","export","global","process","assetsByHref","pendingResolves","onAssetAddedEmitter","onAssetRemovedEmitter","dispose","clear","resolveDetails","resolvedHref","_generateBundleCode","_callee3","entrypoints","tokenSource","disposable","pendingOperations","assets","dfd","dependenciesToAliases","entrypointsToAssets","enqueueUnresolvedAsset","_loop4","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_loop5","_iterator8","_step8","bundle","_iteratorNormalCompletion9","_didIteratorError9","_iteratorError9","_iterator9","_step9","_asset","_iteratorNormalCompletion12","_didIteratorError12","_iteratorError12","_iterator12","_step12","dependency","_iteratorNormalCompletion10","_didIteratorError10","_iteratorError10","_iterator10","_step10","_ref12","_ref11","_name","_asset2","_iteratorNormalCompletion11","_didIteratorError11","_iteratorError11","_iterator11","_step11","bundleCode","sourceMapSuffix","sourceMap","combinedMap","_this4","_args3","_context3","onCancellationRequested","cancel","_ref7","_callee2","fromSpec","resolvedSpec","_asset$dependencies2","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_loop","_iterator5","_step5","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_loop2","_iterator6","_step6","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_loop3","_iterator7","_step7","_ref9","_context2","onEnqueueAsset","resolveWithDetails","getOrCreateAsset","readCode","dependencyAsset","Require","finish","RequireResolve","t1","_ref8","references","shim","InjectedGlobal","exportName","t2","splice","onCompleteAsset","t3","_x5","_x6","_","entrypoint","separator","clone","trim","overwrite","append","addSource","toString","t4","requireEntrypoints","values","t5","generateMap","includeContent","hires","file","remapping","encode","_x4","_invalidate","_callee4","_ref13","combinedUri","_args4","_context4","removeAsset","_x7","delete","_readCode","_callee5","_ref14","_context5","_x8","_x9","_resolveWithDetails","_callee6","fromUri","_ref15","resolved","bareModuleResolveResult","resolvedUri","_resolvedHref","_context6","BareModule","stableHref","stableRootHref","Relative","_x10","_x11","_x12","freeze","base64","CancellationToken","CancellationTokenSource","CanceledError","globalThis","_AbstractResolverHost","ResolverHostCompound","hosts","prefix","_ref2","child","startsWith","getResolveRoot","InvariantError","TimeoutError","TranspileError","diagnostics","ResolverHostMonaco","rootUri","Monaco","_resolver","getModels","model","modelHref","seenDirs","nestedPath","nextDirIdx","getModel","encoder","TextEncoder","getTranspiledValue","output","getModeId","tryLoadFromWorker","a","typescript","getTypeScriptWorker","workerFactory","workerClient","getEmitOutput","getSyntacticDiagnostics","emitOutput","syntacticDiagnostics","emitSkipped","fsPath","diagnostic","startPosition","getPositionAt","endPosition","flattenDiagnosticMessageText","messageText","lineNumber","column","outputFiles","text","attempt","timeoutMs","race","timeout","Math","pow","getValue","AbstractResolverHost","diag","newLine","indent","EntryNotFoundError","isValidEntry","isValidDirectory","isValidFile","every","UNPKG_SPEC_RX","parseUnpkgUrl","signalFromCancellationToken","AbortControllerConstructor","abortController","isCancellationRequested","abort","signal","ResolverHostUnpkg","contentCache","byteLength","max","inflightContentRequests","packageLock","packageEntriesCache","packageJsonCache","fetch","TypeError","AbortController","input","init","_getCanonicalUrl","unresolvedSpec","protocol","hostname","readPackageJsonWithCache","_getResolveRoot","_args2","_listEntries","parentEntry","traversalSegments","readPackageEntriesWithCache","Boolean","segment","find","_readFileContent","cached","inflight","redirect","res","ok","status","arrayBuffer","catch","_readPackageEntriesWithCache","lockKey","lock","packageEntriesCacheForModule","exactMatch","_packageEntries","packageEntries","_args5","readPackageEntries","_readPackageJsonWithCache","packageJsonCacheForModule","_packageJson","_args6","readPackageJson","_readPackageJson","_callee7","manifest","_args7","_context7","parseBufferAsPackageJson","_x13","_readPackageEntries","_callee8","_args8","_context8","_x14","ResolverHostWithCache","idbTimeout","hostTimeout","idbPromise","openDB","schemaVersion","upgrade","db","oldVersion","newVersion","transaction","log","createObjectStore","objectStore","inflightGetCanonicalUrl","inflightGetResolveRoot","inflightListEntries","inflightReadFileContent","loadFn","inflightMap","storeName","serialize","deserialize","withTimeout","idb","put","withCache","duration","EditorManager","bundler","Resolver","extensions","packageMain","editor","disposableStore","DisposableStore","initialPath","typeAcquirer","viewState","WeakMap","onWillFocusModelEmitter","onDidChangeEmitter","typescriptDefaults","setEagerModelSync","setMaximumWorkerIdleTime","setCompilerOptions","allowJs","allowNonTsExtensions","allowSyntheticDefaultImports","baseUrl","checkJs","esModuleInterop","experimentalDecorators","inlineSourceMap","inlineSources","isolatedModules","jsx","JsxEmit","React","jsxFactory","lib","ModuleKind","CommonJS","moduleResolution","ModuleResolutionKind","NodeJs","noEmit","outDir","resolveJsonModule","rootDir","ScriptTarget","ES2015","typeRoots","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","createModel","onDidCreateModel","onDidChangePackageJson","typescriptVersion","importTypesForSpecs","throttler","ThrottledDelayer","trigger","onDidChangeContent","onTypeFile","addExtraLib","language","inferLanguage","setModel","focus","focusModel","el","automaticLayout","showUnused","scrollBeyondLastLine","theme","onDidDispose","onDidChangeModel","newModelUrl","restoreViewState","onDidBlurEditorText","saveViewState","focusPath","EditorManagerContext","createContext","Editor","className","useRef","editorManager","useContext","useEffect","current","mount","ref","EntryKind","CallSite","columnNumber","evalOrigin","methodName","functionName","fileName","typeName","isConstructor","isEval","isInternal","isNative","isToplevel","fileLocation","getFileName","getEvalOrigin","getLineNumber","getColumnNumber","line","getFunctionName","addSuffix","getTypeName","getMethodName","frame","PreviewProgress","props","total","round","completed","PreviewIframeWrap","PreviewWrap","PreviewMessageError","PreviewMessageErrorText","PreviewMessages","PreviewMessageLine","PreviewMessage","lines","Preview","invalidations","previewWrapRef","previewIframeRef","useState","messages","setMessages","buildProgress","setBuildProgress","delayer","Delayer","Throttler","queueRefreshPreview","uris","refreshPreview","toInvalidate","from","building","invalidate","unresolvedEntrypointHref","resolvedEntrypoint","resolvedEntrypointHref","generateBundleCode","errorWatcher","bundleFile","markup","createObjectURL","htmlUrl","iframe","document","createElement","style","display","src","appendChild","onload","onerror","onWillDisposeModel","onMessage","data","payload","readCache","read","toLowerCase","readSource","sourceMapText","mappings","frames","frameOptions","Number","isInteger","with","mapping","sourceFileIndex","sourceFile","sources","sourceLine","sourceColumn","trace","prepareStackTrace","window","addEventListener","removeEventListener","idx","_msg","lineNo","columnNo","String","getIsConstructor","getIsEval","getIsNative","getIsToplevel","getOwnPropertyNames","postMessage","Entry","modelFocused","color","cursor","backgroundColor","CreateEntry","SidebarFileDelete","SidebarFile","activeModel","workbench","setActiveModel","trackEditor","onDidFocusEditorText","hasTextFocus","onDidCreateEditor","useActiveModel","onClick","Sidebar","sortEntries","models","sort","b","initialEntries","modelUri","setEntries","findIndex","useDirectory","prompt","onClickCreate","App","project","Provider","location","react","AppWrap","ReactDOM","render","getElementById","navigator","serviceWorker","ready","registration","unregister","ownKeys","_objectSpread","hasInvalidOptionalStringField","field","hasInvalidDependenciesField","CHAR_DOT","CHAR_FORWARD_SLASH","TRAILING_SLASH_RX","ensureTrailingSlash","browser","hasInvalidBrowserField","isValidPackageJson","parseTextAsPackageJson","getFirstPathSegmentAfterPrefix","childHref","parentOffset","validateString","ext","matchedSlash","extIdx","firstNonSlashEnd","charCodeAt","isPathSeparator","extname","startDot","startPart","preDotState","len","rootEnd","offset","last","resolvedPath","resolvedAbsolute","allowAboveRoot","lastSegmentLength","lastSlash","dots","lastSlashIndex","lastIndexOf","normalizeString","__proto__","initialSegment","Decoder","TextDecoder","TRAILING_SLASH_RX$1","defaultExtensions","_resolve","optionsWithDefaults","canonicalUrlPromise","canonicalUrl","rootHrefWithoutTrailingSlash","canonicalHref","ignoreBrowserOverrides","resolveAsDirectory","resolveAsFile","_resolveAsDirectory","mainPathname","packageJsonEntry","packageJsonContent","mainUrl","_resolveAsFile","parentPackageJson","browserOverrides","browserMap","packageJsonDir","impliedUrl","targetSpec","containingUrl","entryDirectoryMap","entryFileMap","_entry","childFilename","_childFilename","_match","includes","_readParentPackageJson","hostRootUrl","hostRootHref","containingDirUrl","readPackageJsonOrRecurse","dir","parentPackageJsonContent","parentDir"],"mappings":"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","file":"static/js/main.ef1a6451.chunk.js","sourcesContent":["import { util, Resolver, PackageJson, ResolvedEntryKind, ResolverHost } from '@velcro/resolver';\n\nimport { Emitter, Event } from 'ts-primitives';\nimport { BareModuleSpec } from '@velcro/resolver-host-unpkg';\n\nconst HAS_D_TS_EXTENSION = /\\.d\\.ts$/;\n\nenum PackageEntryKind {\n  Directory = 'directory',\n  File = 'file',\n}\n\ninterface PackageDirectoryEntry {\n  type: PackageEntryKind.Directory;\n  path: string;\n  files: PackageEntry[];\n}\n\ninterface PackageFileEntry {\n  type: PackageEntryKind.File;\n  path: string;\n}\n\ninterface TypingsFiles {\n  [fileName: string]: string;\n}\n\ntype PackageEntry = PackageDirectoryEntry | PackageFileEntry;\n\nfunction getTypingsModuleSpec(pkgJson: { name: string; version?: string }): { name: string; range: string } {\n  const typingsName = pkgJson.name.charAt(0) === '@' ? pkgJson.name.slice(1).replace('/', '__') : pkgJson.name;\n\n  let typingsRange = '*';\n\n  if (pkgJson.version) {\n    const major = pkgJson.version.split('.')[0];\n    typingsRange = `${major}.x`;\n  }\n\n  return {\n    name: `@types/${typingsName}`,\n    range: typingsRange,\n  };\n}\n\ninterface TypeFile {\n  pathname: string;\n  content: string;\n}\n\nexport class TypeAcquirer {\n  private _onTypeFile = new Emitter<TypeFile>();\n\n  constructor(\n    private readonly resolver: Resolver,\n    private readonly resolveBareModule: (resolver: ResolverHost, spec: BareModuleSpec) => URL\n  ) {}\n\n  private _importAdjacentTypings(\n    typingsFiles: TypingsFiles,\n    pkgJson: PackageJson,\n    parentPath: string\n  ): Promise<boolean> {\n    // console.log('_importAdjacentTypings', pkgJson.name, pkgJson.version, parentPath);\n    const moduleRoot = util.join(parentPath, `node_modules/${pkgJson.name}/`);\n\n    if (!pkgJson.name) {\n      return Promise.resolve(false);\n    }\n\n    return this._listFiles(pkgJson.name, pkgJson.version).then(files => {\n      let imported = false;\n      const promises: Promise<void>[] = [];\n      const normalizedMain = util.resolve('/', pkgJson.main || 'index.js');\n\n      for (const pathname in files) {\n        if (!(normalizedMain === pathname || HAS_D_TS_EXTENSION.test(pathname))) {\n          continue;\n        }\n\n        promises.push(\n          this.resolver.host\n            .readFileContent(\n              this.resolver,\n              this.resolveBareModule(this.resolver.host, {\n                name: pkgJson.name!,\n                nameSpec: `${pkgJson.name}@${pkgJson.version}`,\n                pathname,\n                spec: pkgJson.version!,\n              })\n            )\n            .then(\n              // eslint-disable-next-line no-loop-func\n              buf => {\n                const contents = this.resolver.decoder.decode(buf);\n                const filePath = util.join(moduleRoot, pathname);\n                typingsFiles[filePath] = contents;\n\n                this._onTypeFile.fire({\n                  pathname: filePath,\n                  content: contents,\n                });\n\n                if (normalizedMain !== pathname) {\n                  imported = true;\n                }\n              },\n              e => {\n                console.warn(e);\n              }\n            )\n        );\n      }\n\n      if (!promises.length) {\n        return imported;\n      }\n\n      return Promise.all(promises).then(() => imported);\n    });\n  }\n\n  // private async _importEmbeddedTypings(\n  //   typingsFiles: TypingsFiles,\n  //   pkgJson: PackageJsonWithTypings,\n  //   parentPath: string\n  // ) {\n  //   let filesPromise: Promise<{ [fileName: string]: PackageFileEntry }> | undefined;\n  //   const readFiles = () => {\n  //     if (!filesPromise) {\n  //       filesPromise = this._listFiles(pkgJson.name, pkgJson.version);\n  //     }\n  //     return filesPromise;\n  //   };\n  //   const visitTypingsFile = async (fileName: string) => {\n  //     if (seen.has(fileName)) return;\n  //     seen.add(fileName);\n  //     console.log('visiting', fileName);\n  //     // Load the contents and add it to the known models\n  //     const sourceText = await this._readUnpkgFile(pkgJson.name, pkgJson.version, pkgJson.typings);\n  //     console.log('addExtraLib', sourceText, fileName);\n  //     typingsFiles[join(parentPath, fileName)] = sourceText;\n  //     const sourceFile = typescript.createSourceFile(fileName, sourceText, typescript.ScriptTarget.Latest, true);\n  //     const children: string[] = [];\n  //     typescript.forEachChild(sourceFile, child => {\n  //       if (typescript.isImportDeclaration(child) && typescript.isStringLiteral(child.moduleSpecifier)) {\n  //         children.push(child.moduleSpecifier.text);\n  //       } else if (\n  //         typescript.isExportDeclaration(child) &&\n  //         child.moduleSpecifier &&\n  //         child.moduleSpecifier &&\n  //         typescript.isStringLiteral(child.moduleSpecifier)\n  //       ) {\n  //         children.push(child.moduleSpecifier.text);\n  //       }\n  //     });\n  //     // We will figure out dependencies outside this module by building the optimized npm\n  //     // dependency tree\n  //     const relativeChildren = children.filter(ref => ref.charAt(0) === '.');\n  //     if (relativeChildren.length) {\n  //       const currentDir = dirname(fileName);\n  //       const files = await readFiles();\n  //       await Promise.all(\n  //         relativeChildren.map(ref => {\n  //           const childPathReference = resolve(currentDir, ref);\n  //           const childPath = resolveImportPath(files, childPathReference);\n  //           if (childPath) {\n  //             return visitTypingsFile(childPath);\n  //           }\n  //         })\n  //       );\n  //     }\n  //   };\n  //   const seen = new Set<string>();\n  //   const typescript = await import('typescript');\n  //   await visitTypingsFile(pkgJson.typings);\n  // }\n\n  private async _importTypingsFromDefinitelyTyped(\n    files: TypingsFiles,\n    pkgJson: PackageJson,\n    parentPath: string\n  ): Promise<void> {\n    // console.log('_importTypingsFromDefinitelyTyped', pkgJson.name, pkgJson.version, parentPath);\n    if (!pkgJson.name) {\n      return undefined;\n    }\n\n    const typingsModuleSpec = getTypingsModuleSpec({ name: pkgJson.name, version: pkgJson.version });\n\n    try {\n      const pkgJson = await this._import(files, typingsModuleSpec.name, typingsModuleSpec.range, parentPath);\n\n      if (pkgJson.dependencies) {\n        for (const name in pkgJson.dependencies) {\n          await this._import(files, name, pkgJson.dependencies[name], parentPath);\n        }\n      }\n    } catch (e) {\n      return undefined;\n    }\n  }\n\n  private async _listFiles(\n    name: string,\n    version: string = 'latest'\n  ): Promise<{ [pathname: string]: PackageFileEntry }> {\n    const unresolvedUrl = await this.resolver.host.getCanonicalUrl(\n      this.resolver,\n      this.resolveBareModule(this.resolver.host, {\n        name,\n        spec: version,\n        nameSpec: `${name}@${version}`,\n        pathname: '/',\n      })\n    );\n    const resolvedUrl = await this.resolver.host.getCanonicalUrl(this.resolver, unresolvedUrl);\n    const entries: { [pathname: string]: PackageFileEntry } = {};\n    const queue = [resolvedUrl];\n\n    while (queue.length) {\n      const next = queue.shift()!;\n      const entriesAtPath = await this.resolver.host.listEntries(this.resolver, next);\n\n      for (const entry of entriesAtPath) {\n        if (entry.type === ResolvedEntryKind.Directory) {\n          queue.push(entry.url);\n        } else {\n          const path = entry.url.href.slice(resolvedUrl.href.length - 1);\n          entries[path] = { type: PackageEntryKind.File, path };\n        }\n      }\n    }\n\n    return entries;\n  }\n\n  private async _import(\n    files: TypingsFiles,\n    name: string,\n    range: string,\n    parentPath: string = ''\n  ): Promise<PackageJson> {\n    // console.log('_import', name, range, parentPath);\n\n    const pkgJsonPathname = util.join(parentPath, 'node_modules', name, 'package.json');\n    const bareModuleUrl = this.resolveBareModule(this.resolver.host, {\n      name,\n      spec: range,\n      nameSpec: `${name}@${range}`,\n      pathname: '/package.json',\n    });\n    const resolvedPkgJson = await this.resolver.readParentPackageJson(bareModuleUrl);\n\n    if (!resolvedPkgJson) {\n      throw new Error(`Unable to load package.json for ${name}@${range}`);\n    }\n\n    const pkgJsonText = JSON.stringify(resolvedPkgJson.packageJson);\n    const resolvedName = resolvedPkgJson.packageJson.name || name;\n\n    files[pkgJsonPathname] = pkgJsonText;\n\n    this._onTypeFile.fire({\n      pathname: pkgJsonPathname,\n      content: pkgJsonText,\n    });\n\n    // if (isPackageJsonWithTypings(pkgJson)) {\n    //   await this._importEmbeddedTypings(files, pkgJson, parentPath);\n    // } else {\n    try {\n      const hasAdjacentTypings = await this._importAdjacentTypings(files, resolvedPkgJson.packageJson!, parentPath);\n\n      // console.log('hasAdjacentTypings', hasAdjacentTypings);\n\n      if (!hasAdjacentTypings && resolvedName.indexOf('@types/') !== 0) {\n        await this._importTypingsFromDefinitelyTyped(files, resolvedPkgJson.packageJson, parentPath);\n      }\n    } catch (err) {\n      console.error('error', err);\n    }\n    // }\n\n    return resolvedPkgJson.packageJson;\n  }\n\n  get onTypeFile(): Event<TypeFile> {\n    return this._onTypeFile.event;\n  }\n\n  async importTypesForSpec(name: string, range: string = 'latest', parentPath: string = ''): Promise<TypingsFiles> {\n    const files: TypingsFiles = {};\n\n    try {\n      await this._import(files, name, range, parentPath);\n    } catch (err) {\n      console.warn(err, `Type acquisition failed for ${name}@${range}`);\n    }\n\n    return files;\n  }\n\n  async importTypesForSpecs(specs: { [name: string]: string }, parentPath: string = ''): Promise<TypingsFiles> {\n    const promises = Object.keys(specs).map(name => this.importTypesForSpec(name, specs[name], parentPath));\n    const importResults = promises.length ? await Promise.all(promises) : [];\n\n    return importResults.reduce((files, result) => ({ ...files, ...result }), {} as TypingsFiles);\n  }\n}\n","import _possibleConstructorReturn from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _wrapNativeSuper from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper\";\nimport _regeneratorRuntime from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Emitter, CancellationToken, CancellationTokenSource as CancellationTokenSource$1, CanceledError } from 'ts-primitives';\nexport { CanceledError, CancellationToken, CancellationTokenSource } from 'ts-primitives';\nimport MagicString, { Bundle } from 'magic-string';\nimport { parse as parse$1 } from 'acorn';\nimport remapping from '@ampproject/remapping';\nimport { CancellationTokenSource, EntryNotFoundError } from '@velcro/resolver';\nimport { Base64 } from 'js-base64';\nvar RELATE_PATH_RX = /^[./]|^[a-z_-]+:/;\nvar SPEC_RX = /^((@[^/]+\\/[^/@]+|[^./@][^/@]*)(?:@([^/]+))?)(.*)?$/;\n\nvar Deferred =\n/*#__PURE__*/\nfunction () {\n  function Deferred() {\n    var _this = this;\n\n    _classCallCheck(this, Deferred);\n\n    this.internalState = 'pending';\n    this.promise = new Promise(function (promiseResolve, promiseReject) {\n      _this.promiseResolve = promiseResolve;\n      _this.promiseReject = promiseReject;\n    });\n  }\n\n  _createClass(Deferred, [{\n    key: \"resolve\",\n    value: function resolve(value) {\n      this.internalState = 'resolved';\n      this.promiseResolve(value);\n    }\n  }, {\n    key: \"reject\",\n    value: function reject(reason) {\n      this.internalState = 'rejected';\n      this.promiseReject(reason);\n    }\n  }, {\n    key: \"isSettled\",\n    get: function get() {\n      return this.internalState !== 'pending';\n    }\n  }, {\n    key: \"state\",\n    get: function get() {\n      return this.internalState;\n    }\n  }]);\n\n  return Deferred;\n}();\n\nfunction isBareModuleSpecifier(spec) {\n  return !RELATE_PATH_RX.test(spec);\n}\n\nfunction maybeParseBareModuleSpec(spec) {\n  /**\r\n   * 1: scope + name + version\r\n   * 2: scope + name\r\n   * 3: version?\r\n   * 4: pathname\r\n   */\n  var matches = spec.match(SPEC_RX);\n\n  if (!matches) {\n    return undefined;\n  }\n\n  return {\n    nameSpec: matches[1],\n    name: matches[2],\n    spec: matches[3] || '',\n    pathname: matches[4] || ''\n  };\n}\n\nfunction parseBareModuleSpec(spec) {\n  var parsed = maybeParseBareModuleSpec(spec);\n\n  if (!parsed) {\n    throw new Error(\"Unable to parse unexpected unpkg url: '\".concat(spec, \"'\"));\n  }\n\n  return parsed;\n} // this looks ridiculous, but it prevents sourcemap tooling from mistaking\n// this for an actual sourceMappingURL\n\n\nfunction getSourceMappingUrl(str) {\n  var re = /(?:\\/\\/[@#][\\s]*(?:source)MappingURL=([^\\s'\"]+)[\\s]*$)|(?:\\/\\*[@#][\\s]*(?:source)MappingURL=([^\\s*'\"]+)[\\s]*(?:\\*\\/)[\\s]*$)/gm; // Keep executing the search to find the *last* sourceMappingURL to avoid\n  // picking up sourceMappingURLs from comments, strings, etc.\n\n  var lastMatch = null;\n  var match;\n\n  while (match = re.exec(str)) {\n    lastMatch = match;\n  }\n\n  if (!lastMatch) return undefined;\n  return lastMatch[1];\n}\n\nfunction traverse(ast, ctx, _ref) {\n  var enter = _ref.enter,\n      leave = _ref.leave;\n  visit(ast, null, ctx, enter, leave);\n}\n\nvar shouldSkip = false;\nvar context = {\n  skip: function skip() {\n    return shouldSkip = true;\n  }\n};\nvar childKeys = {};\n\nfunction visit(node, parent, ctx, enter, leave, prop, index) {\n  if (!node) return;\n  node.parent = parent;\n\n  if (enter) {\n    var _shouldSkip = shouldSkip;\n    shouldSkip = false;\n    enter.call(context, node, parent, ctx, prop, index);\n    var skipped = shouldSkip;\n    shouldSkip = _shouldSkip;\n    if (skipped) return;\n  }\n\n  var keys = childKeys[node.type] || (childKeys[node.type] = Object.keys(node).filter(function (key) {\n    return key !== 'parent' && typeof node[key] === 'object';\n  }));\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = node[key];\n\n    if (Array.isArray(value)) {\n      for (var j = 0; j < value.length; j++) {\n        visit(value[j], node, ctx, enter, leave, key, j);\n      }\n    } else if (value && value.type) {\n      visit(value, node, ctx, enter, leave, key);\n    }\n  }\n\n  if (leave) {\n    leave(node, parent, ctx, prop, index);\n  }\n}\n\nfunction isArrowFunctionExpression(node) {\n  return node.type === 'ArrowFunctionExpression';\n}\n\nfunction isArrayPattern(node) {\n  return node.type === 'ArrayPattern';\n}\n\nfunction isAssignmentPattern(node) {\n  return node.type === 'AssignmentPattern';\n}\n\nfunction isBinaryExpression(node) {\n  return node.type === 'BinaryExpression';\n}\n\nfunction isBlockStatement(node) {\n  return node.type === 'BlockStatement';\n}\n\nfunction isCallExpression(node) {\n  return node.type === 'CallExpression';\n}\n\nfunction isClassDeclaration(node) {\n  return node.type === 'ClassDeclaration';\n}\n\nfunction isFunctionDeclaration(node) {\n  return node.type === 'FunctionDeclaration';\n}\n\nfunction isFunctionExpression(node) {\n  return node.type === 'FunctionExpression';\n}\n\nfunction isIdentifier(node) {\n  return node.type === 'Identifier';\n}\n\nfunction isIfStatement(node) {\n  return node.type === 'IfStatement';\n}\n\nfunction isLiteral(node) {\n  return node.type === 'Literal';\n}\n\nfunction isMemberExpression(node) {\n  return node.type === 'MemberExpression';\n}\n\nfunction isNodeWithStartAndEnd(node) {\n  return typeof node.start === 'number' && typeof node.end === 'number';\n}\n\nfunction isObjectPattern(node) {\n  return node.type === 'ObjectPattern';\n}\n\nfunction isProperty(node) {\n  return node.type === 'Property';\n}\n\nfunction isRestElement(node) {\n  return node.type === 'RestElement';\n}\n\nfunction isProgram(node) {\n  return node.type === 'Program';\n}\n\nfunction isThisExpression(node) {\n  return node.type === 'ThisExpression';\n}\n\nfunction isTryStatement(node) {\n  return node.type === 'TryStatement';\n}\n\nfunction isVariableDeclaration(node) {\n  return node.type === 'VariableDeclaration';\n} // Refinements or groups\n\n\nfunction isFunction(node) {\n  return isFunctionDeclaration(node) || isFunctionExpression(node) || isArrowFunctionExpression(node);\n}\n\nfunction isStringLiteral(node) {\n  return isLiteral(node) && typeof node.value === 'string';\n}\n\nfunction parse(code, options) {\n  return parse$1(code, _objectSpread({}, options, {\n    allowReturnOutsideFunction: true,\n    sourceType: 'script'\n  }));\n}\n\nfunction parseFile(uri, magicString) {\n  var ctx = {\n    unboundSymbols: new Map(),\n    locals: new Map(),\n    nodeEnv: 'development',\n    replacements: [],\n    requires: [],\n    requireResolves: [],\n    skip: new Set()\n  };\n\n  try {\n    // let lastToken: acorn.Token | undefined = undefined;\n    var ast = parse(magicString.original, {\n      onComment: function onComment(_isBlock, _test, start, end) {\n        magicString.remove(start, end);\n      },\n      onToken: function onToken(token) {\n        magicString.addSourcemapLocation(token.start); // const wsStart = lastToken ? lastToken.end : 0;\n        // if (wsStart < token.start - 1) {\n        //   const between = magicString.original.substring(wsStart, token.start);\n        //   if (whitespaceRx.test(between)) {\n        //     magicString.overwrite(wsStart, token.start - 1, ' ');\n        //   }\n        // }\n        // lastToken = token;\n      }\n    });\n    traverse(ast, ctx, scopingAndRequiresVisitor);\n    traverse(ast, ctx, collectGlobalsVisitor);\n  } catch (err) {\n    throw new Error(\"Error parsing \".concat(uri, \": \").concat(err.message));\n  }\n\n  var requireDependencies = [];\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    for (var _iterator = ctx.requires[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      var node = _step.value;\n      requireDependencies.push({\n        callee: _objectSpread({}, node.callee),\n        spec: _objectSpread({}, node.spec)\n      });\n    }\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator.return != null) {\n        _iterator.return();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n\n  var requireResolveDependencies = [];\n  var _iteratorNormalCompletion2 = true;\n  var _didIteratorError2 = false;\n  var _iteratorError2 = undefined;\n\n  try {\n    for (var _iterator2 = ctx.requireResolves[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n      var _node = _step2.value;\n      requireResolveDependencies.push({\n        callee: _objectSpread({}, _node.callee),\n        spec: _objectSpread({}, _node.spec)\n      });\n    }\n  } catch (err) {\n    _didIteratorError2 = true;\n    _iteratorError2 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n        _iterator2.return();\n      }\n    } finally {\n      if (_didIteratorError2) {\n        throw _iteratorError2;\n      }\n    }\n  }\n\n  var unboundSymbols = new Map();\n  var _iteratorNormalCompletion3 = true;\n  var _didIteratorError3 = false;\n  var _iteratorError3 = undefined;\n\n  try {\n    for (var _iterator3 = ctx.unboundSymbols[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n      var _ref4 = _step3.value;\n\n      var _ref3 = _slicedToArray(_ref4, 2);\n\n      var symbolName = _ref3[0];\n      var symbolNodes = _ref3[1];\n      unboundSymbols.set(symbolName, symbolNodes.map(function (node) {\n        return {\n          start: node.start,\n          end: node.end\n        };\n      }));\n    }\n  } catch (err) {\n    _didIteratorError3 = true;\n    _iteratorError3 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n        _iterator3.return();\n      }\n    } finally {\n      if (_didIteratorError3) {\n        throw _iteratorError3;\n      }\n    }\n  }\n\n  return {\n    requireDependencies: requireDependencies,\n    requireResolveDependencies: requireResolveDependencies,\n    unboundSymbols: unboundSymbols\n  };\n}\n\nvar scopingAndRequiresVisitor = {\n  enter: function enter(node, parent, ctx) {\n    if (ctx.skip.has(node)) {\n      return this.skip();\n    }\n\n    visitAndCaptureScoping(node, parent, ctx);\n    visitAndSkipBranches(node, parent, ctx);\n    visitRequires(node, parent, ctx);\n  }\n};\nvar collectGlobalsVisitor = {\n  enter: function enter(node, _parent, ctx) {\n    if (isBindingIdentifier(node) && isIdentifier(node)) {\n      var name = node.name;\n      if (name === 'undefined') return;\n      var foundBinding = false;\n      var nextParent = node.parent;\n\n      while (nextParent) {\n        if (name === 'arguments' && declaresArguments(nextParent)) {\n          foundBinding = true;\n          break;\n        }\n\n        var locals = ctx.locals.get(nextParent);\n\n        if (locals && locals[name]) {\n          foundBinding = true;\n          break;\n        }\n\n        nextParent = nextParent.parent;\n      }\n\n      if (!foundBinding && isNodeWithStartAndEnd(node)) {\n        var unboundSymbols = ctx.unboundSymbols.get(name);\n\n        if (!unboundSymbols) {\n          unboundSymbols = [];\n          ctx.unboundSymbols.set(name, unboundSymbols);\n        }\n\n        unboundSymbols.push(node);\n      }\n    } else if (isThisExpression(node)) {\n      var _foundBinding = false;\n      var _nextParent = node.parent;\n\n      while (_nextParent) {\n        if (declaresThis(_nextParent)) {\n          _foundBinding = true;\n          break;\n        }\n\n        _nextParent = _nextParent.parent;\n      }\n\n      if (!_foundBinding && isNodeWithStartAndEnd(node)) {\n        var _unboundSymbols = ctx.unboundSymbols.get('this');\n\n        if (!_unboundSymbols) {\n          _unboundSymbols = [];\n          ctx.unboundSymbols.set('this', _unboundSymbols);\n        }\n\n        _unboundSymbols.push(node);\n      }\n    }\n  }\n};\n\nfunction visitAndCaptureScoping(node, _parent, ctx) {\n  if (isVariableDeclaration(node)) {\n    var parent;\n    var nextParent = node.parent;\n\n    while (nextParent) {\n      if (node.kind === 'var' ? isScope(nextParent) : isBlockScope(nextParent)) {\n        parent = nextParent;\n        break;\n      }\n\n      nextParent = nextParent.parent;\n    }\n\n    if (!parent) {\n      throw new Error(\"Invariant violation: Failed to find a parent\");\n    }\n\n    var locals = ctx.locals.get(parent);\n\n    if (!locals) {\n      locals = {};\n      ctx.locals.set(parent, locals);\n    }\n\n    var _iteratorNormalCompletion4 = true;\n    var _didIteratorError4 = false;\n    var _iteratorError4 = undefined;\n\n    try {\n      for (var _iterator4 = node.declarations[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n        var declaration = _step4.value;\n        declarePattern(declaration.id, locals);\n      }\n    } catch (err) {\n      _didIteratorError4 = true;\n      _iteratorError4 = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion4 && _iterator4.return != null) {\n          _iterator4.return();\n        }\n      } finally {\n        if (_didIteratorError4) {\n          throw _iteratorError4;\n        }\n      }\n    }\n  } else if (isFunctionDeclaration(node)) {\n    var _parent2;\n\n    var _nextParent2 = node.parent;\n\n    if (_nextParent2 && _nextParent2.parent) {\n      _nextParent2 = _nextParent2.parent;\n    }\n\n    while (_nextParent2) {\n      if (isScope(_nextParent2)) {\n        _parent2 = _nextParent2;\n        break;\n      }\n\n      _nextParent2 = _nextParent2.parent;\n    }\n\n    if (!_parent2) {\n      throw new Error(\"Invariant violation: Failed to find a parent\");\n    }\n\n    var _locals = ctx.locals.get(_parent2);\n\n    if (!_locals) {\n      _locals = {};\n      ctx.locals.set(_parent2, _locals);\n    }\n\n    declareFunction(node, _locals);\n  } else if (isFunction(node)) {\n    var _locals2 = ctx.locals.get(node);\n\n    if (!_locals2) {\n      _locals2 = {};\n      ctx.locals.set(node, _locals2);\n    }\n\n    declareFunction(node, _locals2);\n  } else if (isClassDeclaration(node) && node.id) {\n    var _parent3;\n\n    var _nextParent3 = node.parent;\n\n    if (_nextParent3 && _nextParent3.parent) {\n      _nextParent3 = _nextParent3.parent;\n    }\n\n    while (_nextParent3) {\n      if (isScope(_nextParent3)) {\n        _parent3 = _nextParent3;\n        break;\n      }\n\n      _nextParent3 = _nextParent3.parent;\n    }\n\n    if (!_parent3) {\n      throw new Error(\"Invariant violation: Failed to find a parent\");\n    }\n\n    var _locals3 = ctx.locals.get(_parent3);\n\n    if (!_locals3) {\n      _locals3 = {};\n      ctx.locals.set(_parent3, _locals3);\n    }\n\n    _locals3[node.id.name] = true;\n  } else if (isTryStatement(node)) {\n    if (node.handler) {\n      var _locals4 = ctx.locals.get(node.handler);\n\n      if (!_locals4) {\n        _locals4 = {};\n        ctx.locals.set(node.handler, _locals4);\n      }\n\n      declarePattern(node.handler.param, _locals4);\n    }\n  }\n}\n\nfunction visitAndSkipBranches(node, _parent, ctx) {\n  if (isIfStatement(node) && isBinaryExpression(node.test)) {\n    var tests = {\n      '!=': function _(l, r) {\n        return l != r;\n      },\n      '!==': function _(l, r) {\n        return l !== r;\n      },\n      '==': function _(l, r) {\n        return l == r;\n      },\n      '===': function _(l, r) {\n        return l === r;\n      }\n    };\n    var test = tests[node.test.operator];\n\n    if (test) {\n      if (isStringLiteral(node.test.left) && isMemberExpression(node.test.right) && memberExpressionMatches(node.test.right, 'process.env.NODE_ENV')) {\n        // if ('development' === process.env.NODE_ENV) {}\n        ctx.replacements.push({\n          start: node.test.right.start,\n          end: node.test.right.end,\n          replacement: JSON.stringify(ctx.nodeEnv)\n        });\n\n        if (!test(node.test.left.value, ctx.nodeEnv)) {\n          ctx.skip.add(node.consequent);\n        } else if (node.alternate) {\n          ctx.skip.add(node.alternate);\n        }\n      } else if (isStringLiteral(node.test.right) && isMemberExpression(node.test.left) && memberExpressionMatches(node.test.left, 'process.env.NODE_ENV')) {\n        // if (process.env.NODE_ENV === 'development') {}\n        ctx.replacements.push({\n          start: node.test.left.start,\n          end: node.test.left.end,\n          replacement: JSON.stringify(ctx.nodeEnv)\n        });\n\n        if (!test(node.test.right.value, ctx.nodeEnv)) {\n          ctx.skip.add(node.consequent);\n        } else if (node.alternate) {\n          ctx.skip.add(node.alternate);\n        }\n      }\n    }\n  }\n}\n\nfunction visitRequires(node, _parent, ctx) {\n  if (isCallExpression(node) && isNodeWithStartAndEnd(node.callee)) {\n    var callee = node.callee;\n\n    if (isIdentifier(callee) && isNodeWithStartAndEnd(callee) && callee.name === 'require') {\n      var firstArg = node.arguments[0];\n\n      if (isStringLiteral(firstArg) && isNodeWithStartAndEnd(firstArg)) {\n        ctx.requires.push({\n          spec: {\n            start: firstArg.start,\n            end: firstArg.end,\n            value: firstArg.value\n          },\n          callee: {\n            start: callee.start,\n            end: callee.end\n          }\n        });\n      } else {\n        console.warn('Non string-literal first arg to require', firstArg);\n      }\n    } else if (isMemberExpression(callee) && isIdentifier(callee.object) && callee.object.name === 'require' && isIdentifier(callee.property) && callee.property.name === 'resolve') {\n      var _firstArg = node.arguments[0];\n\n      if (isStringLiteral(_firstArg) && isNodeWithStartAndEnd(_firstArg)) {\n        ctx.requireResolves.push({\n          spec: {\n            start: _firstArg.start,\n            end: _firstArg.end,\n            value: _firstArg.value\n          },\n          callee: {\n            start: callee.start,\n            end: callee.end\n          }\n        });\n      } else {\n        console.warn('Non string-literal first arg to require.resolve', _firstArg);\n      }\n    }\n  }\n}\n\nfunction declareFunction(node, locals) {\n  node.params.forEach(function (node) {\n    declarePattern(node, locals);\n  });\n\n  if (node.id) {\n    locals[node.id.name] = true;\n  }\n}\n\nfunction declarePattern(node, locals) {\n  if (isIdentifier(node)) {\n    locals[node.name] = true;\n  } else if (isObjectPattern(node)) {\n    node.properties.forEach(function (node) {\n      return declarePattern(node.value, locals);\n    });\n  } else if (isArrayPattern(node)) {\n    node.elements.forEach(function (node) {\n      return node && declarePattern(node, locals);\n    });\n  } else if (isRestElement(node)) {\n    declarePattern(node.argument, locals);\n  } else if (isAssignmentPattern(node)) {\n    declarePattern(node.left, locals);\n  } else {\n    throw new Error(\"Invariant violation: Unexpected pattern type: \".concat(node.type));\n  }\n}\n\nfunction isBindingIdentifier(node) {\n  return isIdentifier(node) && !isPropertyOfMemberExpression(node) && !isKeyOfProperty(node);\n}\n\nfunction isKeyOfProperty(node) {\n  return node.parent && isProperty(node.parent) && node.parent.key === node;\n}\n\nfunction isPropertyOfMemberExpression(node) {\n  return node.parent && isMemberExpression(node.parent) && node.parent.object !== node;\n}\n\nfunction isScope(node) {\n  return isFunctionDeclaration(node) || isFunctionExpression(node) || isArrowFunctionExpression(node) || isProgram(node);\n}\n\nfunction isBlockScope(node) {\n  return isBlockStatement(node) || isScope(node);\n}\n\nfunction declaresArguments(node) {\n  return isFunctionDeclaration(node) || isFunctionExpression(node);\n}\n\nfunction declaresThis(node) {\n  return isFunctionDeclaration(node) || isFunctionExpression(node);\n}\n\nfunction memberExpressionMatches(node, pattern) {\n  var memberParts = pattern.split('.');\n\n  if (memberParts.length < 2) {\n    return false;\n  }\n\n  var object = memberParts.shift();\n  var property = memberParts.shift();\n\n  for (var i = memberParts.length - 1; i >= 0; i--) {\n    if (!isIdentifier(node.property) || node.property.name !== memberParts[i]) {\n      return false;\n    }\n\n    if (!isMemberExpression(node.object)) {\n      return false;\n    }\n\n    node = node.object;\n  }\n\n  if (!isIdentifier(node.object) || !isIdentifier(node.property)) {\n    return false;\n  }\n\n  return node.object.name === object && node.property.name === property;\n}\n\nvar Asset =\n/*#__PURE__*/\nfunction () {\n  function Asset(href, rootHref) {\n    _classCallCheck(this, Asset);\n\n    this.href = href;\n    this.rootHref = rootHref;\n    this.dependencies = [];\n    this.unresolvedDependencies = {};\n    this.deps = new Map();\n  }\n\n  _createClass(Asset, [{\n    key: \"setCode\",\n    value: function setCode(code) {\n      this.magicString = new MagicString(code, {\n        filename: this.href,\n        indentExclusionRanges: []\n      });\n      this.sourceMappingUrl = getSourceMappingUrl(code);\n      var parser = getParserForAsset(this);\n      var dependencies = parser.parse(this.href, this.magicString);\n      this.unresolvedDependencies.requireDependencies = dependencies.requireDependencies;\n      this.unresolvedDependencies.requireResolveDependencies = dependencies.requireResolveDependencies;\n      this.unresolvedDependencies.unboundSymbols = dependencies.unboundSymbols;\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        href: this.href,\n        rootHref: this.rootHref,\n        dependencies: this.dependencies,\n        sourceMappingUrl: this.sourceMappingUrl,\n        code: this.magicString ? this.magicString.original : ''\n      };\n    }\n  }], [{\n    key: \"fromJSON\",\n    value: function fromJSON(json) {\n      var _asset$dependencies;\n\n      var asset = new Asset(json.href, json.rootHref);\n\n      (_asset$dependencies = asset.dependencies).push.apply(_asset$dependencies, _toConsumableArray(json.dependencies));\n\n      asset.sourceMappingUrl = json.sourceMappingUrl;\n      asset.setCode(json.code);\n      return asset;\n    }\n  }]);\n\n  return Asset;\n}();\n\n(function (Asset) {\n  var DependencyKind;\n\n  (function (DependencyKind) {\n    DependencyKind[\"Require\"] = \"require\";\n    DependencyKind[\"RequireResolve\"] = \"require.resolve\";\n    DependencyKind[\"InjectedGlobal\"] = \"injected_global\";\n  })(DependencyKind = Asset.DependencyKind || (Asset.DependencyKind = {}));\n})(Asset || (Asset = {}));\n\nfunction getParserForAsset(asset) {\n  if (asset.href.endsWith('.json')) {\n    return {\n      parse: function parse(_uri, magicString) {\n        magicString.prepend('module.exports = ');\n        return {\n          requireDependencies: [],\n          requireResolveDependencies: [],\n          unboundSymbols: new Map()\n        };\n      }\n    };\n  }\n\n  return {\n    parse: parseFile\n  };\n}\n\nvar version = \"0.18.0\";\nvar BARE_MODULE_PREFIX = 'https://unpkg.com/'; // const DEFAULT_SHIM_GLOBALS: { [key: string]: { spec: string; export?: string } } = {\n//   Buffer: {\n//     spec: `@velcro/node-libs@${nodeLibsVersion}/lib/buffer.js`,\n//     export: 'Buffer',\n//   },\n//   global: {\n//     spec: `@velcro/node-libs@${nodeLibsVersion}/lib/global.js`,\n//   },\n//   process: {\n//     spec: `@velcro/node-libs@${nodeLibsVersion}/lib/process.js`,\n//   },\n// };\n\nvar NODE_CORE_SHIMS = ['assert', 'buffer', 'constants', 'crypto', 'events', 'fs', 'http', 'https', 'net', 'os', 'path', 'process', 'querystring', 'stream', 'tls', 'url', 'util', 'vm', 'zlib'].reduce(function (shims, coreLibName) {\n  return Object.assign(shims, _defineProperty({}, coreLibName, \"@velcro/node-libs@\".concat(version, \"/lib/\").concat(coreLibName, \".js\")));\n}, {});\nNODE_CORE_SHIMS['string_decoder'] = 'string_decoder@1.2.0';\nNODE_CORE_SHIMS['punycode'] = 'punycode@2.1.1';\n\nvar resolveBareModuleToUnpkgWithDetails =\n/*#__PURE__*/\nfunction () {\n  var _ref5 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(resolver, href, parentHref) {\n    var _ref6,\n        token,\n        parsedSpec,\n        details,\n        resolvedSpecRoot,\n        unresolvedHref,\n        parentUrl,\n        parentPackageInfo,\n        consolidatedDependencies,\n        builtIn,\n        parsedBuiltInSpec,\n        stableUrl,\n        stableRootUrl,\n        resolveResult,\n        packageInfo,\n        _args = arguments;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _ref6 = _args.length > 3 && _args[3] !== undefined ? _args[3] : {}, token = _ref6.token;\n            parsedSpec = parseBareModuleSpec(href);\n            details = {\n              bareModule: {},\n              resolvedUrl: undefined\n            }; // let resolvedSpec: string | undefined = undefined;\n\n            resolvedSpecRoot = undefined;\n            unresolvedHref = undefined;\n\n            if (!parsedSpec.spec) {\n              _context.next = 9;\n              break;\n            }\n\n            // A manually-specified spec means we should use that instead of looking for a parent package.json\n            resolvedSpecRoot = parsedSpec.nameSpec;\n            _context.next = 21;\n            break;\n\n          case 9:\n            if (!parentHref) {\n              _context.next = 21;\n              break;\n            }\n\n            _context.prev = 10;\n            parentUrl = new URL(parentHref);\n            _context.next = 17;\n            break;\n\n          case 14:\n            _context.prev = 14;\n            _context.t0 = _context[\"catch\"](10);\n            throw new Error(\"Error loading bare module \".concat(href, \" because the parent module \").concat(parentHref, \" could not be resolved to a URL\"));\n\n          case 17:\n            _context.next = 19;\n            return resolver.readParentPackageJson(parentUrl, {\n              token: token\n            });\n\n          case 19:\n            parentPackageInfo = _context.sent;\n\n            if (parentPackageInfo) {\n              consolidatedDependencies = _objectSpread({}, parentPackageInfo.packageJson.peerDependencies || {}, {}, parentPackageInfo.packageJson.devDependencies || {}, {}, parentPackageInfo.packageJson.dependencies || {});\n              details.bareModule.versionSpec = consolidatedDependencies[parsedSpec.name];\n\n              if (details.bareModule.versionSpec) {\n                resolvedSpecRoot = \"\".concat(parsedSpec.name, \"@\").concat(details.bareModule.versionSpec);\n              }\n            }\n\n          case 21:\n            if (resolvedSpecRoot) {\n              // The name + spec was hard-coded or could be derived from a parent package.json. We just\n              // need to prepend the staic prefix and then append the requested pathname.\n              resolvedSpecRoot = \"\".concat(BARE_MODULE_PREFIX).concat(resolvedSpecRoot);\n              unresolvedHref = \"\".concat(resolvedSpecRoot).concat(parsedSpec.pathname);\n            } else {\n              if (!parentHref) {\n                // There was no parent href from which to derive version constraints so we will take\n                // the provided 'namespec' and prefix it with the static prefix. That will be the root\n                // and the href can be determined by adding the requested pathname.\n                resolvedSpecRoot = \"\".concat(BARE_MODULE_PREFIX).concat(parsedSpec.nameSpec);\n                unresolvedHref = \"\".concat(resolvedSpecRoot).concat(parsedSpec.pathname);\n              } else {\n                builtIn = NODE_CORE_SHIMS[href];\n\n                if (builtIn) {\n                  parsedBuiltInSpec = parseBareModuleSpec(builtIn);\n                  resolvedSpecRoot = \"\".concat(BARE_MODULE_PREFIX).concat(parsedBuiltInSpec.nameSpec);\n                  unresolvedHref = \"\".concat(resolvedSpecRoot).concat(parsedBuiltInSpec.pathname);\n                  details.bareModule.isBuiltIn = true;\n                }\n              }\n            }\n\n            if (!(unresolvedHref && resolvedSpecRoot)) {\n              _context.next = 33;\n              break;\n            }\n\n            stableUrl = new URL(unresolvedHref);\n            stableRootUrl = new URL(resolvedSpecRoot);\n            _context.next = 27;\n            return resolver.resolve(stableUrl, {\n              token: token\n            });\n\n          case 27:\n            resolveResult = _context.sent;\n            details.ignored = resolveResult.ignored;\n            details.stableRootUrl = stableRootUrl;\n            details.stableUrl = stableUrl;\n\n            if (resolveResult.resolvedUrl) {\n              details.resolvedUrl = resolveResult.resolvedUrl;\n            }\n\n            details.rootUrl = resolveResult.rootUrl;\n\n          case 33:\n            if (!details.resolvedUrl) {\n              _context.next = 38;\n              break;\n            }\n\n            _context.next = 36;\n            return resolver.readParentPackageJson(details.resolvedUrl, {\n              token: token\n            });\n\n          case 36:\n            packageInfo = _context.sent;\n\n            if (packageInfo) {\n              details.bareModule.version = packageInfo.packageJson.version;\n            }\n\n          case 38:\n            return _context.abrupt(\"return\", details);\n\n          case 39:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[10, 14]]);\n  }));\n\n  return function resolveBareModuleToUnpkgWithDetails(_x, _x2, _x3) {\n    return _ref5.apply(this, arguments);\n  };\n}();\n/**\n *\n * @param {typeof import('.')} Velcro\n * @returns {import('./runtime').IRuntime}\n */\n\n\nfunction createRuntime(Velcro) {\n  var aliasesSymbol = Symbol.for('velcro.aliases');\n  var modulesSymbol = Symbol.for('velcro.modules');\n  var registrySymbol = Symbol.for('velcro.registry');\n  var rootSymbol = Symbol.for('velcro.root');\n\n  function Runtime() {\n    this[aliasesSymbol] = Object.create(null);\n    this[modulesSymbol] = Object.create(null);\n    this[registrySymbol] = Object.create(null);\n    this[Symbol.toStringTag] = 'Module';\n    var self = this;\n    Object.defineProperty(this, 'root', {\n      configurable: false,\n      enumerable: true,\n      get: function get() {\n        var root = self[rootSymbol];\n\n        if (!root) {\n          root = new Module('velcro://root', self);\n          self[rootSymbol] = root;\n        }\n\n        return root;\n      }\n    });\n  }\n\n  Runtime.prototype.alias = function (name, id) {\n    this[aliasesSymbol][name] = id;\n  };\n\n  Runtime.prototype.import = function (name) {\n    return new Promise(function (resolve, reject) {\n      try {\n        return resolve(Velcro.runtime.require(name));\n      } catch (err) {\n        return reject(err);\n      }\n    });\n  };\n  /**\n   * @param {string} id\n   * @param {ModuleFactory} factory\n   */\n\n\n  Runtime.prototype.register = function (id, factory) {\n    if (this[registrySymbol][id]) {\n      throw new Error(\"A module factory is already registered for \".concat(id));\n    }\n\n    this[registrySymbol][id] = factory;\n  };\n\n  Runtime.prototype.remove = function (id) {\n    id = this[aliasesSymbol][id] || id;\n    var module = this[modulesSymbol][id];\n\n    if (!module) {\n      return false;\n    }\n\n    var seen = new Set();\n    var removalQueue = [module];\n\n    while (removalQueue.length) {\n      var moduleToRemove = removalQueue.shift();\n\n      if (seen.has(moduleToRemove)) {\n        continue;\n      }\n\n      seen.add(moduleToRemove);\n      removalQueue.push.apply(removalQueue, _toConsumableArray(moduleToRemove.dependents));\n      delete this[modulesSymbol][moduleToRemove.id];\n    }\n\n    return true;\n  };\n\n  Runtime.prototype.require = function (id) {\n    return this.root.require(this[aliasesSymbol][id] || id);\n  };\n\n  function Module(id, runtime) {\n    this.exports = {};\n    this.dependents = new Set();\n    this.id = id;\n    this.runtime = runtime;\n  }\n\n  Module.prototype.require = function (id) {\n    id = this.runtime[aliasesSymbol][id] || id;\n    var module = this.runtime[modulesSymbol][id];\n\n    if (!module) {\n      var factory = this.runtime[registrySymbol][id];\n\n      if (!factory) {\n        console.error();\n        throw new Error(\"Factory missing for \".concat(id));\n      }\n\n      module = new Module(id, this.runtime);\n      this.runtime[modulesSymbol][id] = module;\n      var dirname = id;\n      var filename = id;\n      var util = Velcro.util;\n\n      if (util && util.dirname) {\n        dirname = util.dirname(id);\n      }\n\n      if (util && util.basename) {\n        filename = util.basename(id);\n      }\n\n      factory.call(module.exports, module, module.exports, module.require.bind(module), dirname, filename);\n    }\n\n    module.dependents.add(this);\n    return module.exports;\n  };\n\n  var runtime = Velcro.runtime;\n\n  if (!runtime) {\n    runtime = new Runtime();\n    Velcro.runtime = runtime;\n  }\n\n  return Runtime;\n}\n\nvar ExtendableError =\n/*#__PURE__*/\nfunction (_Error) {\n  _inherits(ExtendableError, _Error);\n\n  function ExtendableError(message) {\n    var _this2;\n\n    _classCallCheck(this, ExtendableError);\n\n    _this2 = _possibleConstructorReturn(this, _getPrototypeOf(ExtendableError).call(this, message));\n    _this2.name = _this2.constructor.name;\n\n    if (typeof Error.captureStackTrace === 'function') {\n      Error.captureStackTrace(_assertThisInitialized(_this2), _this2.constructor);\n    } else {\n      _this2.stack = new Error(message).stack;\n    }\n\n    return _this2;\n  }\n\n  return ExtendableError;\n}(_wrapNativeSuper(Error));\n\nvar InvariantViolation =\n/*#__PURE__*/\nfunction (_ExtendableError) {\n  _inherits(InvariantViolation, _ExtendableError);\n\n  function InvariantViolation() {\n    _classCallCheck(this, InvariantViolation);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(InvariantViolation).apply(this, arguments));\n  }\n\n  return InvariantViolation;\n}(ExtendableError);\n\nvar ResolveError =\n/*#__PURE__*/\nfunction (_ExtendableError2) {\n  _inherits(ResolveError, _ExtendableError2);\n\n  function ResolveError(href, fromHref) {\n    var _this3;\n\n    _classCallCheck(this, ResolveError);\n\n    _this3 = _possibleConstructorReturn(this, _getPrototypeOf(ResolveError).call(this, \"Unable to resolve '\".concat(href, \"'\").concat(fromHref ? \" from '\".concat(fromHref, \"'\") : '')));\n    _this3.href = href;\n    _this3.fromHref = fromHref;\n    return _this3;\n  }\n\n  return ResolveError;\n}(ExtendableError);\n\nvar EMPTY_MODULE_URL = new URL('velcro://@empty');\nvar EMPTY_MODULE_CODE = 'module.exports = function(){};';\nvar DEFAULT_SHIM_GLOBALS = {\n  Buffer: {\n    spec: \"@velcro/node-libs@\".concat(version, \"/lib/buffer.js\"),\n    export: 'Buffer'\n  },\n  global: {\n    spec: \"@velcro/node-libs@\".concat(version, \"/lib/global.js\")\n  },\n  process: {\n    spec: \"@velcro/node-libs@\".concat(version, \"/lib/process.js\")\n  }\n};\n\nvar Bundler =\n/*#__PURE__*/\nfunction () {\n  function Bundler(options) {\n    _classCallCheck(this, Bundler);\n\n    this.assetsByHref = new Map(); // private readonly assetsByRootHref = new Map<string, Set<Asset>>();\n\n    this.pendingResolves = new Map();\n    this.onAssetAddedEmitter = new Emitter();\n    this.onAssetRemovedEmitter = new Emitter();\n    this.resolver = options.resolver;\n  }\n\n  _createClass(Bundler, [{\n    key: \"dispose\",\n    value: function dispose() {\n      this.onAssetAddedEmitter.dispose();\n      this.onAssetRemovedEmitter.dispose();\n      this.assetsByHref.clear(); // this.assetsByRootHref.clear();\n\n      this.pendingResolves.clear();\n    }\n  }, {\n    key: \"getOrCreateAsset\",\n    value: function getOrCreateAsset(resolveDetails) {\n      var asset = this.assetsByHref.get(resolveDetails.resolvedHref);\n\n      if (!asset) {\n        asset = new Asset(resolveDetails.resolvedHref, resolveDetails.rootHref);\n        this.assetsByHref.set(resolveDetails.resolvedHref, asset);\n        this.onAssetAddedEmitter.fire(asset);\n      }\n\n      return asset;\n    }\n  }, {\n    key: \"generateBundleCode\",\n    value: function () {\n      var _generateBundleCode = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(entrypoints) {\n        var _this4 = this;\n\n        var options,\n            tokenSource,\n            token,\n            disposable,\n            pendingOperations,\n            assets,\n            dfd,\n            dependenciesToAliases,\n            entrypointsToAssets,\n            enqueueUnresolvedAsset,\n            _loop4,\n            name,\n            _iteratorNormalCompletion8,\n            _didIteratorError8,\n            _iteratorError8,\n            _loop5,\n            _iterator8,\n            _step8,\n            bundle,\n            _iteratorNormalCompletion9,\n            _didIteratorError9,\n            _iteratorError9,\n            _iterator9,\n            _step9,\n            _asset,\n            magicString,\n            _iteratorNormalCompletion12,\n            _didIteratorError12,\n            _iteratorError12,\n            _iterator12,\n            _step12,\n            dependency,\n            _iteratorNormalCompletion10,\n            _didIteratorError10,\n            _iteratorError10,\n            _iterator10,\n            _step10,\n            _ref12,\n            _ref11,\n            _name,\n            _asset2,\n            _iteratorNormalCompletion11,\n            _didIteratorError11,\n            _iteratorError11,\n            _iterator11,\n            _step11,\n            asset,\n            bundleCode,\n            sourceMapSuffix,\n            sourceMap,\n            seen,\n            combinedMap,\n            _args3 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                options = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : {};\n\n                if (!(!Array.isArray(entrypoints) || !entrypoints.length)) {\n                  _context3.next = 3;\n                  break;\n                }\n\n                throw new Error('Generating a bundle requires passing in an array of entrypoints');\n\n              case 3:\n                tokenSource = new CancellationTokenSource();\n                token = tokenSource.token;\n\n                if (options.token) {\n                  disposable = options.token.onCancellationRequested(function () {\n                    tokenSource.cancel();\n                    disposable.dispose();\n                  });\n                }\n\n                pendingOperations = 0;\n                assets = new Set();\n                dfd = new Deferred();\n                dependenciesToAliases = new Map();\n                entrypointsToAssets = new Map();\n\n                enqueueUnresolvedAsset =\n                /*#__PURE__*/\n                function () {\n                  var _ref7 = _asyncToGenerator(\n                  /*#__PURE__*/\n                  _regeneratorRuntime.mark(function _callee2(spec, fromSpec) {\n                    var resolvedSpec, href, asset, _asset$dependencies2, code, promises, _iteratorNormalCompletion5, _didIteratorError5, _iteratorError5, _loop, _iterator5, _step5, _iteratorNormalCompletion6, _didIteratorError6, _iteratorError6, _loop2, _iterator6, _step6, _iteratorNormalCompletion7, _didIteratorError7, _iteratorError7, _loop3, _iterator7, _step7, _ref9, dependencies;\n\n                    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                      while (1) {\n                        switch (_context2.prev = _context2.next) {\n                          case 0:\n                            _context2.prev = 0;\n                            pendingOperations++;\n\n                            if (options.onEnqueueAsset) {\n                              options.onEnqueueAsset();\n                            }\n\n                            _context2.next = 5;\n                            return _this4.resolveWithDetails(spec, fromSpec, {\n                              token: token\n                            });\n\n                          case 5:\n                            resolvedSpec = _context2.sent;\n                            href = resolvedSpec.resolvedHref;\n                            asset = _this4.getOrCreateAsset(resolvedSpec); // No need to re-process the same asset during the same operation\n\n                            if (assets.has(asset)) {\n                              _context2.next = 80;\n                              break;\n                            }\n\n                            assets.add(asset);\n\n                            if (asset.magicString) {\n                              _context2.next = 15;\n                              break;\n                            }\n\n                            _context2.next = 13;\n                            return _this4.readCode(asset, {\n                              token: token\n                            });\n\n                          case 13:\n                            code = _context2.sent;\n                            asset.setCode(code);\n\n                          case 15:\n                            promises = [];\n                            _iteratorNormalCompletion5 = true;\n                            _didIteratorError5 = false;\n                            _iteratorError5 = undefined;\n                            _context2.prev = 19;\n\n                            _loop = function _loop() {\n                              var dependency = _step5.value;\n                              promises.push(enqueueUnresolvedAsset(dependency.spec.value, href).then(function (dependencyAsset) {\n                                return {\n                                  type: Asset.DependencyKind.Require,\n                                  href: dependencyAsset.href,\n                                  rootHref: dependencyAsset.rootHref,\n                                  callee: dependency.callee,\n                                  spec: dependency.spec,\n                                  value: dependency.spec.value\n                                };\n                              }));\n                            };\n\n                            for (_iterator5 = asset.unresolvedDependencies.requireDependencies[Symbol.iterator](); !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n                              _loop();\n                            }\n\n                            _context2.next = 28;\n                            break;\n\n                          case 24:\n                            _context2.prev = 24;\n                            _context2.t0 = _context2[\"catch\"](19);\n                            _didIteratorError5 = true;\n                            _iteratorError5 = _context2.t0;\n\n                          case 28:\n                            _context2.prev = 28;\n                            _context2.prev = 29;\n\n                            if (!_iteratorNormalCompletion5 && _iterator5.return != null) {\n                              _iterator5.return();\n                            }\n\n                          case 31:\n                            _context2.prev = 31;\n\n                            if (!_didIteratorError5) {\n                              _context2.next = 34;\n                              break;\n                            }\n\n                            throw _iteratorError5;\n\n                          case 34:\n                            return _context2.finish(31);\n\n                          case 35:\n                            return _context2.finish(28);\n\n                          case 36:\n                            _iteratorNormalCompletion6 = true;\n                            _didIteratorError6 = false;\n                            _iteratorError6 = undefined;\n                            _context2.prev = 39;\n\n                            _loop2 = function _loop2() {\n                              var dependency = _step6.value;\n                              promises.push(enqueueUnresolvedAsset(dependency.spec.value, href).then(function (dependencyAsset) {\n                                return {\n                                  type: Asset.DependencyKind.RequireResolve,\n                                  href: dependencyAsset.href,\n                                  rootHref: dependencyAsset.rootHref,\n                                  callee: dependency.callee,\n                                  spec: dependency.spec,\n                                  value: dependency.spec.value\n                                };\n                              }));\n                            };\n\n                            for (_iterator6 = asset.unresolvedDependencies.requireResolveDependencies[Symbol.iterator](); !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {\n                              _loop2();\n                            }\n\n                            _context2.next = 48;\n                            break;\n\n                          case 44:\n                            _context2.prev = 44;\n                            _context2.t1 = _context2[\"catch\"](39);\n                            _didIteratorError6 = true;\n                            _iteratorError6 = _context2.t1;\n\n                          case 48:\n                            _context2.prev = 48;\n                            _context2.prev = 49;\n\n                            if (!_iteratorNormalCompletion6 && _iterator6.return != null) {\n                              _iterator6.return();\n                            }\n\n                          case 51:\n                            _context2.prev = 51;\n\n                            if (!_didIteratorError6) {\n                              _context2.next = 54;\n                              break;\n                            }\n\n                            throw _iteratorError6;\n\n                          case 54:\n                            return _context2.finish(51);\n\n                          case 55:\n                            return _context2.finish(48);\n\n                          case 56:\n                            _iteratorNormalCompletion7 = true;\n                            _didIteratorError7 = false;\n                            _iteratorError7 = undefined;\n                            _context2.prev = 59;\n\n                            _loop3 = function _loop3() {\n                              var _ref8 = _step7.value;\n                              _ref9 = _slicedToArray(_ref8, 2);\n                              var symbolName = _ref9[0];\n                              var references = _ref9[1];\n                              var shim = DEFAULT_SHIM_GLOBALS[symbolName];\n\n                              if (shim) {\n                                promises.push(enqueueUnresolvedAsset(shim.spec, href).then(function (dependencyAsset) {\n                                  return {\n                                    type: Asset.DependencyKind.InjectedGlobal,\n                                    href: dependencyAsset.href,\n                                    rootHref: dependencyAsset.rootHref,\n                                    references: references,\n                                    exportName: shim.export,\n                                    symbolName: symbolName,\n                                    value: \"\".concat(shim.spec).concat(shim.export ? \"[\".concat(JSON.stringify(shim.export), \"]\") : '')\n                                  };\n                                }));\n                              }\n                            };\n\n                            for (_iterator7 = asset.unresolvedDependencies.unboundSymbols[Symbol.iterator](); !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {\n                              _loop3();\n                            }\n\n                            _context2.next = 68;\n                            break;\n\n                          case 64:\n                            _context2.prev = 64;\n                            _context2.t2 = _context2[\"catch\"](59);\n                            _didIteratorError7 = true;\n                            _iteratorError7 = _context2.t2;\n\n                          case 68:\n                            _context2.prev = 68;\n                            _context2.prev = 69;\n\n                            if (!_iteratorNormalCompletion7 && _iterator7.return != null) {\n                              _iterator7.return();\n                            }\n\n                          case 71:\n                            _context2.prev = 71;\n\n                            if (!_didIteratorError7) {\n                              _context2.next = 74;\n                              break;\n                            }\n\n                            throw _iteratorError7;\n\n                          case 74:\n                            return _context2.finish(71);\n\n                          case 75:\n                            return _context2.finish(68);\n\n                          case 76:\n                            _context2.next = 78;\n                            return Promise.all(promises);\n\n                          case 78:\n                            dependencies = _context2.sent;\n\n                            (_asset$dependencies2 = asset.dependencies).splice.apply(_asset$dependencies2, [0, asset.dependencies.length].concat(_toConsumableArray(dependencies)));\n\n                          case 80:\n                            pendingOperations--;\n\n                            if (options.onCompleteAsset) {\n                              options.onCompleteAsset();\n                            }\n\n                            if (!(pendingOperations < 0)) {\n                              _context2.next = 84;\n                              break;\n                            }\n\n                            throw new InvariantViolation('Pending operations fell below zero');\n\n                          case 84:\n                            if (pendingOperations === 0) {\n                              // Let's make sure this happens 'later'.\n                              Promise.resolve().then(function () {\n                                return dfd.resolve();\n                              });\n                            }\n\n                            return _context2.abrupt(\"return\", asset);\n\n                          case 88:\n                            _context2.prev = 88;\n                            _context2.t3 = _context2[\"catch\"](0);\n\n                            if (options.onCompleteAsset) {\n                              options.onCompleteAsset();\n                            } // Let's make sure this happens 'later'.\n\n\n                            Promise.resolve().then(function () {\n                              return dfd.reject(_context2.t3);\n                            });\n                            throw _context2.t3;\n\n                          case 93:\n                          case \"end\":\n                            return _context2.stop();\n                        }\n                      }\n                    }, _callee2, null, [[0, 88], [19, 24, 28, 36], [29,, 31, 35], [39, 44, 48, 56], [49,, 51, 55], [59, 64, 68, 76], [69,, 71, 75]]);\n                  }));\n\n                  return function enqueueUnresolvedAsset(_x5, _x6) {\n                    return _ref7.apply(this, arguments);\n                  };\n                }();\n\n                if (options.dependencies) {\n                  _loop4 = function _loop4(name) {\n                    enqueueUnresolvedAsset(\"\".concat(name, \"@\").concat(options.dependencies[name])).then(function (asset) {\n                      return dependenciesToAliases.set(name, asset);\n                    }, function (_) {\n                      return undefined;\n                    });\n                  };\n\n                  for (name in options.dependencies) {\n                    _loop4(name);\n                  }\n                }\n\n                _iteratorNormalCompletion8 = true;\n                _didIteratorError8 = false;\n                _iteratorError8 = undefined;\n                _context3.prev = 16;\n\n                _loop5 = function _loop5() {\n                  var entrypoint = _step8.value;\n                  // We need to add a catch handler because we might not catch all thrown exceptions,\n                  // only the first, via the dfd.promise.\n                  enqueueUnresolvedAsset(entrypoint).then(function (asset) {\n                    return entrypointsToAssets.set(entrypoint, asset);\n                  }, function (_) {\n                    return undefined;\n                  });\n                };\n\n                for (_iterator8 = entrypoints[Symbol.iterator](); !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {\n                  _loop5();\n                }\n\n                _context3.next = 25;\n                break;\n\n              case 21:\n                _context3.prev = 21;\n                _context3.t0 = _context3[\"catch\"](16);\n                _didIteratorError8 = true;\n                _iteratorError8 = _context3.t0;\n\n              case 25:\n                _context3.prev = 25;\n                _context3.prev = 26;\n\n                if (!_iteratorNormalCompletion8 && _iterator8.return != null) {\n                  _iterator8.return();\n                }\n\n              case 28:\n                _context3.prev = 28;\n\n                if (!_didIteratorError8) {\n                  _context3.next = 31;\n                  break;\n                }\n\n                throw _iteratorError8;\n\n              case 31:\n                return _context3.finish(28);\n\n              case 32:\n                return _context3.finish(25);\n\n              case 33:\n                _context3.next = 35;\n                return dfd.promise;\n\n              case 35:\n                // Now all assets should be fully loaded\n                bundle = new Bundle({\n                  separator: '\\n'\n                });\n                _iteratorNormalCompletion9 = true;\n                _didIteratorError9 = false;\n                _iteratorError9 = undefined;\n                _context3.prev = 39;\n                _iterator9 = assets[Symbol.iterator]();\n\n              case 41:\n                if (_iteratorNormalCompletion9 = (_step9 = _iterator9.next()).done) {\n                  _context3.next = 88;\n                  break;\n                }\n\n                _asset = _step9.value;\n\n                if (_asset.magicString) {\n                  _context3.next = 45;\n                  break;\n                }\n\n                throw new Error(\"Invariant violation: asset is not loaded '\".concat(_asset.href, \"'\"));\n\n              case 45:\n                magicString = _asset.magicString.clone();\n                magicString.trim(); // We'll replace each dependency string with the resolved stable href. The stable href doesn't require any\n                // information about where it is being resolved from, so it is useful as a long-term pointer whose target\n                // can change over time\n\n                _iteratorNormalCompletion12 = true;\n                _didIteratorError12 = false;\n                _iteratorError12 = undefined;\n                _context3.prev = 50;\n                _iterator12 = _asset.dependencies[Symbol.iterator]();\n\n              case 52:\n                if (_iteratorNormalCompletion12 = (_step12 = _iterator12.next()).done) {\n                  _context3.next = 67;\n                  break;\n                }\n\n                dependency = _step12.value;\n                _context3.t1 = dependency.type;\n                _context3.next = _context3.t1 === Asset.DependencyKind.Require ? 57 : _context3.t1 === Asset.DependencyKind.RequireResolve ? 59 : _context3.t1 === Asset.DependencyKind.InjectedGlobal ? 61 : 63;\n                break;\n\n              case 57:\n                magicString.overwrite(dependency.spec.start, dependency.spec.end, JSON.stringify(dependency.href)); // magicString.overwrite(dependency.callee.start, dependency.callee.end, '__velcro_require');\n\n                return _context3.abrupt(\"break\", 64);\n\n              case 59:\n                magicString.overwrite(dependency.spec.start, dependency.spec.end, JSON.stringify(dependency.href)); // magicString.overwrite(dependency.callee.start, dependency.callee.end, '__velcro_require_resolve');\n\n                return _context3.abrupt(\"break\", 64);\n\n              case 61:\n                magicString.prepend(\"const \".concat(dependency.symbolName, \" = require(\").concat(JSON.stringify(dependency.href), \")\").concat(dependency.exportName ? \".\".concat(dependency.exportName) : '', \";\\n\"));\n                return _context3.abrupt(\"break\", 64);\n\n              case 63:\n                throw new Error(\"Invariant violation: Encountered unexpected dependency kind '\".concat(dependency.type, \"'\"));\n\n              case 64:\n                _iteratorNormalCompletion12 = true;\n                _context3.next = 52;\n                break;\n\n              case 67:\n                _context3.next = 73;\n                break;\n\n              case 69:\n                _context3.prev = 69;\n                _context3.t2 = _context3[\"catch\"](50);\n                _didIteratorError12 = true;\n                _iteratorError12 = _context3.t2;\n\n              case 73:\n                _context3.prev = 73;\n                _context3.prev = 74;\n\n                if (!_iteratorNormalCompletion12 && _iterator12.return != null) {\n                  _iterator12.return();\n                }\n\n              case 76:\n                _context3.prev = 76;\n\n                if (!_didIteratorError12) {\n                  _context3.next = 79;\n                  break;\n                }\n\n                throw _iteratorError12;\n\n              case 79:\n                return _context3.finish(76);\n\n              case 80:\n                return _context3.finish(73);\n\n              case 81:\n                magicString.trim();\n                magicString.prepend(\"Velcro.runtime.register(\".concat(JSON.stringify(_asset.href), \", function(module, exports, require, __dirname, __filename){\\n\"));\n                magicString.append('\\n});');\n                bundle.addSource(magicString);\n\n              case 85:\n                _iteratorNormalCompletion9 = true;\n                _context3.next = 41;\n                break;\n\n              case 88:\n                _context3.next = 94;\n                break;\n\n              case 90:\n                _context3.prev = 90;\n                _context3.t3 = _context3[\"catch\"](39);\n                _didIteratorError9 = true;\n                _iteratorError9 = _context3.t3;\n\n              case 94:\n                _context3.prev = 94;\n                _context3.prev = 95;\n\n                if (!_iteratorNormalCompletion9 && _iterator9.return != null) {\n                  _iterator9.return();\n                }\n\n              case 97:\n                _context3.prev = 97;\n\n                if (!_didIteratorError9) {\n                  _context3.next = 100;\n                  break;\n                }\n\n                throw _iteratorError9;\n\n              case 100:\n                return _context3.finish(97);\n\n              case 101:\n                return _context3.finish(94);\n\n              case 102:\n                bundle.prepend(\"(\".concat(createRuntime.toString(), \")(typeof globalThis === 'object' ? (globalThis.Velcro || (globalThis.Velcro = {})) : (this.Velcro || (this.Velcro = {})));\\n\"));\n                _iteratorNormalCompletion10 = true;\n                _didIteratorError10 = false;\n                _iteratorError10 = undefined;\n                _context3.prev = 106;\n\n                for (_iterator10 = dependenciesToAliases[Symbol.iterator](); !(_iteratorNormalCompletion10 = (_step10 = _iterator10.next()).done); _iteratorNormalCompletion10 = true) {\n                  _ref12 = _step10.value;\n                  _ref11 = _slicedToArray(_ref12, 2);\n                  _name = _ref11[0];\n                  _asset2 = _ref11[1];\n                  bundle.append(\"Velcro.runtime.alias(\".concat(JSON.stringify(_name), \", \").concat(JSON.stringify(_asset2.href), \");\\n\"));\n                }\n\n                _context3.next = 114;\n                break;\n\n              case 110:\n                _context3.prev = 110;\n                _context3.t4 = _context3[\"catch\"](106);\n                _didIteratorError10 = true;\n                _iteratorError10 = _context3.t4;\n\n              case 114:\n                _context3.prev = 114;\n                _context3.prev = 115;\n\n                if (!_iteratorNormalCompletion10 && _iterator10.return != null) {\n                  _iterator10.return();\n                }\n\n              case 117:\n                _context3.prev = 117;\n\n                if (!_didIteratorError10) {\n                  _context3.next = 120;\n                  break;\n                }\n\n                throw _iteratorError10;\n\n              case 120:\n                return _context3.finish(117);\n\n              case 121:\n                return _context3.finish(114);\n\n              case 122:\n                if (!options.requireEntrypoints) {\n                  _context3.next = 142;\n                  break;\n                }\n\n                _iteratorNormalCompletion11 = true;\n                _didIteratorError11 = false;\n                _iteratorError11 = undefined;\n                _context3.prev = 126;\n\n                for (_iterator11 = entrypointsToAssets.values()[Symbol.iterator](); !(_iteratorNormalCompletion11 = (_step11 = _iterator11.next()).done); _iteratorNormalCompletion11 = true) {\n                  asset = _step11.value;\n                  bundle.append(\"Velcro.runtime.require(\".concat(JSON.stringify(asset.href), \");\\n\"));\n                }\n\n                _context3.next = 134;\n                break;\n\n              case 130:\n                _context3.prev = 130;\n                _context3.t5 = _context3[\"catch\"](126);\n                _didIteratorError11 = true;\n                _iteratorError11 = _context3.t5;\n\n              case 134:\n                _context3.prev = 134;\n                _context3.prev = 135;\n\n                if (!_iteratorNormalCompletion11 && _iterator11.return != null) {\n                  _iterator11.return();\n                }\n\n              case 137:\n                _context3.prev = 137;\n\n                if (!_didIteratorError11) {\n                  _context3.next = 140;\n                  break;\n                }\n\n                throw _iteratorError11;\n\n              case 140:\n                return _context3.finish(137);\n\n              case 141:\n                return _context3.finish(134);\n\n              case 142:\n                bundleCode = bundle.toString();\n                sourceMapSuffix = '';\n\n                if (options.sourceMap) {\n                  sourceMap = bundle.generateMap({\n                    includeContent: false,\n                    hires: false\n                  });\n                  sourceMap.file = \"velcro://bundle.js\"; // In case a source map seems to be self-referential, avoid crashing\n\n                  seen = new Set();\n                  combinedMap = remapping(sourceMap.toString(), function (uri) {\n                    var asset = _this4.assetsByHref.get(uri);\n\n                    if (asset && asset.sourceMappingUrl) {\n                      if (seen.has(asset)) {\n                        return null;\n                      }\n\n                      seen.add(asset);\n                      var match = asset.sourceMappingUrl.match(/^data:application\\/json;(?:charset=([^;]+);)?base64,(.*)$/);\n\n                      if (match) {\n                        if (match[1] && match[1] !== 'utf-8') {\n                          return null;\n                        }\n\n                        try {\n                          var decoded = JSON.parse(Base64.decode(match[2]));\n                          return decoded;\n                        } catch (err) {\n                          return null;\n                        }\n                      }\n                    }\n\n                    return null;\n                  }, false);\n                  sourceMapSuffix = \"\\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(Base64.encode(JSON.stringify(combinedMap)));\n                }\n\n                return _context3.abrupt(\"return\", \"\".concat(bundleCode).concat(sourceMapSuffix));\n\n              case 146:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[16, 21, 25, 33], [26,, 28, 32], [39, 90, 94, 102], [50, 69, 73, 81], [74,, 76, 80], [95,, 97, 101], [106, 110, 114, 122], [115,, 117, 121], [126, 130, 134, 142], [135,, 137, 141]]);\n      }));\n\n      function generateBundleCode(_x4) {\n        return _generateBundleCode.apply(this, arguments);\n      }\n\n      return generateBundleCode;\n    }()\n  }, {\n    key: \"invalidate\",\n    value: function () {\n      var _invalidate = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(spec) {\n        var _ref13,\n            token,\n            asset,\n            resolveResult,\n            combinedUri,\n            _args4 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _ref13 = _args4.length > 1 && _args4[1] !== undefined ? _args4[1] : {}, token = _ref13.token;\n                asset = this.assetsByHref.get(spec);\n\n                if (asset) {\n                  _context4.next = 25;\n                  break;\n                }\n\n                // We can't use Bundler::resolveWithDetails() because that will throw\n                // when a module isn't found. We just want to attempt to resolve and\n                // return true / false accordingly.\n                resolveResult = undefined;\n                _context4.prev = 4;\n\n                if (!isBareModuleSpecifier(spec)) {\n                  _context4.next = 11;\n                  break;\n                }\n\n                _context4.next = 8;\n                return resolveBareModuleToUnpkgWithDetails(this.resolver, spec, undefined, {\n                  token: token\n                });\n\n              case 8:\n                resolveResult = _context4.sent;\n                _context4.next = 15;\n                break;\n\n              case 11:\n                combinedUri = new URL(spec);\n                _context4.next = 14;\n                return this.resolver.resolve(combinedUri, {\n                  token: token\n                });\n\n              case 14:\n                resolveResult = _context4.sent;\n\n              case 15:\n                _context4.next = 22;\n                break;\n\n              case 17:\n                _context4.prev = 17;\n                _context4.t0 = _context4[\"catch\"](4);\n\n                if (!(_context4.t0 instanceof EntryNotFoundError)) {\n                  _context4.next = 21;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\", false);\n\n              case 21:\n                throw _context4.t0;\n\n              case 22:\n                if (!(!resolveResult || !resolveResult.resolvedUrl)) {\n                  _context4.next = 24;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\", false);\n\n              case 24:\n                asset = this.assetsByHref.get(resolveResult.resolvedUrl.href);\n\n              case 25:\n                if (!asset) {\n                  _context4.next = 28;\n                  break;\n                }\n\n                this.removeAsset(asset);\n                return _context4.abrupt(\"return\", true);\n\n              case 28:\n                return _context4.abrupt(\"return\", false);\n\n              case 29:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[4, 17]]);\n      }));\n\n      function invalidate(_x7) {\n        return _invalidate.apply(this, arguments);\n      }\n\n      return invalidate;\n    }()\n  }, {\n    key: \"removeAsset\",\n    value: function removeAsset(asset) {\n      var hadAsset = this.assetsByHref.delete(asset.href);\n\n      if (hadAsset) {\n        this.onAssetRemovedEmitter.fire(asset);\n      }\n    }\n  }, {\n    key: \"readCode\",\n    value: function () {\n      var _readCode = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee5(asset, _ref14) {\n        var token, buf, code;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                token = _ref14.token;\n\n                if (!(asset.href === EMPTY_MODULE_URL.href)) {\n                  _context5.next = 3;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\", EMPTY_MODULE_CODE);\n\n              case 3:\n                _context5.next = 5;\n                return this.resolver.host.readFileContent(this.resolver, new URL(asset.href), {\n                  token: token\n                });\n\n              case 5:\n                buf = _context5.sent;\n                code = this.resolver.decoder.decode(buf);\n                return _context5.abrupt(\"return\", code);\n\n              case 8:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function readCode(_x8, _x9) {\n        return _readCode.apply(this, arguments);\n      }\n\n      return readCode;\n    }()\n  }, {\n    key: \"resolveWithDetails\",\n    value: function () {\n      var _resolveWithDetails = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee6(uri, fromUri, _ref15) {\n        var token, resolved, bareModuleResolveResult, resolvedHref, combinedUri, resolveResult, resolvedUri, _resolvedHref, rootHref;\n\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                token = _ref15.token;\n\n                if (!isBareModuleSpecifier(uri)) {\n                  _context6.next = 13;\n                  break;\n                }\n\n                _context6.next = 4;\n                return resolveBareModuleToUnpkgWithDetails(this.resolver, uri, fromUri, {\n                  token: token\n                });\n\n              case 4:\n                bareModuleResolveResult = _context6.sent;\n\n                if (bareModuleResolveResult.stableUrl) {\n                  _context6.next = 7;\n                  break;\n                }\n\n                throw new Error(\"Failed to resolve bare module '\".concat(uri, \"' from '\").concat(fromUri || '@root', \"' to a stable url\"));\n\n              case 7:\n                if (bareModuleResolveResult.stableRootUrl) {\n                  _context6.next = 9;\n                  break;\n                }\n\n                throw new Error(\"Failed to resolve bare module '\".concat(uri, \"' from '\").concat(fromUri || '@root', \"' to a stable root url\"));\n\n              case 9:\n                resolvedHref = bareModuleResolveResult.resolvedUrl ? bareModuleResolveResult.resolvedUrl.href : EMPTY_MODULE_URL.href;\n                resolved = {\n                  type: Bundler.ResolveDetailsKind.BareModule,\n                  bareModule: {\n                    isBuiltIn: bareModuleResolveResult.bareModule.isBuiltIn,\n                    version: bareModuleResolveResult.bareModule.version,\n                    versionSpec: bareModuleResolveResult.bareModule.versionSpec\n                  },\n                  ignored: bareModuleResolveResult.ignored,\n                  resolvedHref: resolvedHref,\n                  rootHref: bareModuleResolveResult.rootUrl.href,\n                  stableHref: bareModuleResolveResult.stableUrl.href,\n                  stableRootHref: bareModuleResolveResult.stableRootUrl.href\n                };\n                _context6.next = 21;\n                break;\n\n              case 13:\n                combinedUri = new URL(uri, fromUri);\n                _context6.next = 16;\n                return this.resolver.resolve(combinedUri);\n\n              case 16:\n                resolveResult = _context6.sent;\n\n                if (!resolveResult.resolvedUrl) {\n                  resolvedUri = EMPTY_MODULE_URL;\n                } else {\n                  resolvedUri = resolveResult.resolvedUrl;\n                }\n\n                _resolvedHref = resolvedUri.href;\n                rootHref = resolveResult.rootUrl.href;\n                resolved = {\n                  type: Bundler.ResolveDetailsKind.Relative,\n                  ignored: resolveResult.ignored,\n                  resolvedHref: _resolvedHref,\n                  rootHref: rootHref,\n                  stableHref: _resolvedHref,\n                  stableRootHref: rootHref\n                };\n\n              case 21:\n                return _context6.abrupt(\"return\", resolved);\n\n              case 22:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function resolveWithDetails(_x10, _x11, _x12) {\n        return _resolveWithDetails.apply(this, arguments);\n      }\n\n      return resolveWithDetails;\n    }()\n  }, {\n    key: \"onAssetAdded\",\n    get: function get() {\n      return this.onAssetAddedEmitter.event;\n    }\n  }, {\n    key: \"onAssetRemoved\",\n    get: function get() {\n      return this.onAssetRemovedEmitter.event;\n    }\n  }]);\n\n  return Bundler;\n}();\n\n(function (Bundler) {\n  var ResolveDetailsKind;\n\n  (function (ResolveDetailsKind) {\n    ResolveDetailsKind[\"BareModule\"] = \"bare_module\";\n    ResolveDetailsKind[\"Relative\"] = \"relative\";\n  })(ResolveDetailsKind = Bundler.ResolveDetailsKind || (Bundler.ResolveDetailsKind = {}));\n})(Bundler || (Bundler = {})); // export * from '@velcro/resolver';\n\n\nvar base64 = {\n  decode: Base64.decode,\n  encode: Base64.encode\n};\nvar Velcro =\n/*#__PURE__*/\nObject.freeze({\n  base64: base64,\n  CancellationToken: CancellationToken,\n  CancellationTokenSource: CancellationTokenSource$1,\n  getSourceMappingUrl: getSourceMappingUrl,\n\n  get Asset() {\n    return Asset;\n  },\n\n  get Bundler() {\n    return Bundler;\n  },\n\n  InvariantViolation: InvariantViolation,\n  ResolveError: ResolveError,\n  CanceledError: CanceledError\n});\nvar Runtime = createRuntime(globalThis['Velcro'] || (globalThis['Velcro'] = _objectSpread({}, Velcro)));\nvar runtime = new Runtime();\nexport { Asset, Bundler, InvariantViolation, ResolveError, base64, getSourceMappingUrl, runtime };","import _slicedToArray from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _classCallCheck from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport { AbstractResolverHost } from '@velcro/resolver';\n\nvar ResolverHostCompound =\n/*#__PURE__*/\nfunction (_AbstractResolverHost) {\n  _inherits(ResolverHostCompound, _AbstractResolverHost);\n\n  function ResolverHostCompound(hosts) {\n    var _this;\n\n    _classCallCheck(this, ResolverHostCompound);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ResolverHostCompound).call(this));\n    _this.hosts = new Map();\n\n    for (var prefix in hosts) {\n      _this.hosts.set(prefix, hosts[prefix]);\n    }\n\n    return _this;\n  }\n\n  _createClass(ResolverHostCompound, [{\n    key: \"getCanonicalUrl\",\n    value: function getCanonicalUrl(resolver, url) {\n      var href = url.href; // TODO: Decide whether a more efficient solution is needed\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.hosts[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var _ref3 = _step.value;\n\n          var _ref2 = _slicedToArray(_ref3, 2);\n\n          var prefix = _ref2[0];\n          var child = _ref2[1];\n\n          if (href.startsWith(prefix)) {\n            if (typeof child.getCanonicalUrl === 'function') {\n              // console.error(`getCanonicalUrl(%s): %s`, url.href, prefix);\n              return child.getCanonicalUrl(resolver, url);\n            }\n\n            break;\n          }\n        } // If the resolved child doesn't have this method, treat it as an identity function\n\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return Promise.resolve(url);\n    }\n  }, {\n    key: \"getResolveRoot\",\n    value: function getResolveRoot(resolver, url) {\n      var href = url.href; // TODO: Decide whether a more efficient solution is needed\n\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = this.hosts[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var _ref6 = _step2.value;\n\n          var _ref5 = _slicedToArray(_ref6, 2);\n\n          var prefix = _ref5[0];\n          var child = _ref5[1];\n\n          if (href.startsWith(prefix)) {\n            // console.error(`getResolveRoot(%s): %s`, url.href, prefix);\n            return child.getResolveRoot(resolver, url);\n          }\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      return Promise.reject(new Error(\"No suitable host found for url \".concat(href)));\n    }\n  }, {\n    key: \"listEntries\",\n    value: function listEntries(resolver, url) {\n      var href = url.href; // TODO: Decide whether a more efficient solution is needed\n\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = this.hosts[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var _ref9 = _step3.value;\n\n          var _ref8 = _slicedToArray(_ref9, 2);\n\n          var prefix = _ref8[0];\n          var child = _ref8[1];\n\n          if (href.startsWith(prefix)) {\n            // console.error(`listEntries(%s): %s`, url.href, prefix);\n            return child.listEntries(resolver, url);\n          }\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n\n      return Promise.reject(new Error(\"No suitable host found for url \".concat(href)));\n    }\n  }, {\n    key: \"readFileContent\",\n    value: function readFileContent(resolver, url) {\n      var href = url.href; // TODO: Decide whether a more efficient solution is needed\n\n      var _iteratorNormalCompletion4 = true;\n      var _didIteratorError4 = false;\n      var _iteratorError4 = undefined;\n\n      try {\n        for (var _iterator4 = this.hosts[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n          var _ref12 = _step4.value;\n\n          var _ref11 = _slicedToArray(_ref12, 2);\n\n          var prefix = _ref11[0];\n          var child = _ref11[1];\n\n          if (href.startsWith(prefix)) {\n            // console.error(`readFileContent(%s): %s`, url.href, prefix);\n            return child.readFileContent(resolver, url);\n          }\n        }\n      } catch (err) {\n        _didIteratorError4 = true;\n        _iteratorError4 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion4 && _iterator4.return != null) {\n            _iterator4.return();\n          }\n        } finally {\n          if (_didIteratorError4) {\n            throw _iteratorError4;\n          }\n        }\n      }\n\n      return Promise.reject(new Error(\"No suitable host found for url \".concat(href)));\n    }\n  }]);\n\n  return ResolverHostCompound;\n}(AbstractResolverHost);\n\nexport { ResolverHostCompound };","export interface Diagnostic {\n  message: string;\n  start?: { lineNumber: number; column: number };\n  end?: { lineNumber: number; column: number };\n  href?: string;\n}\n\nexport class ExtendableError extends Error {\n  constructor(message?: string) {\n    super(message);\n\n    this.name = this.constructor.name;\n  }\n}\n\nexport class InvariantError extends ExtendableError {}\n\nexport class TimeoutError extends ExtendableError {}\n\nexport class TranspileError extends ExtendableError {\n  constructor(message: string, readonly diagnostics: Diagnostic[]) {\n    super(message);\n  }\n}\n","import { Resolver, ResolvedEntryKind, AbstractResolverHost, ResolvedEntry } from '@velcro/resolver';\nimport * as Monaco from 'monaco-editor';\nimport { timeout } from 'ts-primitives';\n\nimport { InvariantError, TimeoutError, TranspileError, Diagnostic } from './error';\n\nconst LANGUAGE_TYPESCRIPT = 'typescript';\nconst MAX_TRANSPILE_ATTEMPTS = 3;\nconst TRANSPILE_TIMEOUT = 2000;\nconst TRANSPILE_TIMEOUT_BACKOFF = 500;\n\ntype Model = Monaco.editor.ITextModel;\n\nexport class ResolverHostMonaco extends AbstractResolverHost {\n  constructor(private readonly rootUri: Monaco.Uri = Monaco.Uri.file('/')) {\n    super();\n  }\n\n  get rootHref() {\n    return this.rootUri.toString(true);\n  }\n\n  async getResolveRoot() {\n    return new URL(this.rootUri.toString(true));\n  }\n\n  async listEntries(_resolver: Resolver, url: URL) {\n    const href = url.href.replace(/\\/?$/, '/');\n    const rootHref = this.rootUri.toString(true);\n\n    if (!href.startsWith(rootHref)) {\n      return [];\n    }\n\n    return Monaco.editor.getModels().reduce(\n      (entries, model) => {\n        const modelHref = model.uri.toString(true);\n        const seenDirs = new Set<string>();\n\n        if (modelHref.startsWith(href)) {\n          const nestedPath = modelHref.slice(href.length);\n          const nextDirIdx = nestedPath.indexOf('/');\n\n          if (nextDirIdx === 0) {\n            throw new Error('Invariant error: WAT?');\n          }\n\n          if (nextDirIdx > 0) {\n            // This is an intermediate directory\n            const url = new URL(nestedPath.slice(0, nextDirIdx + 1), href);\n\n            if (!seenDirs.has(url.href)) {\n              entries.push({\n                type: ResolvedEntryKind.Directory,\n                url,\n              });\n            }\n          } else {\n            entries.push({\n              type: ResolvedEntryKind.File,\n              url: new URL(modelHref),\n            });\n          }\n        }\n\n        return entries;\n      },\n      [] as ResolvedEntry[]\n    );\n  }\n\n  async readFileContent(_resolver: Resolver, url: URL) {\n    const href = url.href;\n\n    if (!href.startsWith(this.rootHref)) {\n      throw new InvariantError(\n        `Attempting to read file content for a model at '${href}' outside of this host's root '${this.rootHref}'`\n      );\n    }\n\n    const pathname = href.slice(this.rootHref.length);\n    const model = Monaco.editor.getModel(Monaco.Uri.file(pathname));\n\n    if (!model) {\n      throw new InvariantError(`Attempting to read file content for a model that doesn't exist at '${href}'`);\n    }\n\n    const encoder = new TextEncoder();\n    const output = await this.getTranspiledValue(model);\n\n    return encoder.encode(output);\n  }\n\n  private async getTranspiledValue(model: Monaco.editor.ITextModel) {\n    if (model.getModeId() === LANGUAGE_TYPESCRIPT) {\n      const href = model.uri.toString(true);\n      const tryLoadFromWorker = async () => {\n        const workerFactory = await Monaco.languages.typescript.getTypeScriptWorker();\n        const workerClient = await workerFactory(model.uri);\n        const [emitOutput, syntacticDiagnostics] = (await Promise.all([\n          workerClient.getEmitOutput(href),\n          workerClient.getSyntacticDiagnostics(href),\n        ])) as [import('typescript').EmitOutput, import('typescript').Diagnostic[]];\n\n        if (emitOutput.emitSkipped) {\n          throw new InvariantError(`Emit skipped when trying to read '${model.uri.fsPath}'`);\n        }\n\n        if (syntacticDiagnostics.length) {\n          const diagnostics: Diagnostic[] = syntacticDiagnostics.map(diagnostic => {\n            const startPosition =\n              typeof diagnostic.start === 'number' ? model.getPositionAt(diagnostic.start) : undefined;\n            const endPosition =\n              typeof diagnostic.start === 'number' && typeof diagnostic.length === 'number'\n                ? model.getPositionAt(diagnostic.start + diagnostic.length)\n                : undefined;\n\n            return {\n              message: flattenDiagnosticMessageText(diagnostic.messageText),\n              start: startPosition ? { lineNumber: startPosition.lineNumber, column: startPosition.column } : undefined,\n              end: endPosition ? { lineNumber: endPosition.lineNumber, column: endPosition.column } : undefined,\n              href: diagnostic.source,\n            };\n          });\n          throw new TranspileError(`${syntacticDiagnostics[0].messageText} at ${model.uri.fsPath}`, diagnostics);\n        }\n\n        return emitOutput.outputFiles[0].text;\n      };\n\n      let attempt = 0;\n\n      while (attempt++ < MAX_TRANSPILE_ATTEMPTS) {\n        try {\n          const code = await raceTimeout(tryLoadFromWorker(), TRANSPILE_TIMEOUT);\n\n          return code;\n        } catch (err) {\n          if (err instanceof TimeoutError) {\n            await timeout(TRANSPILE_TIMEOUT_BACKOFF * Math.pow(2, attempt));\n            continue;\n          }\n\n          throw err;\n        }\n      }\n\n      throw new TimeoutError(`Timed out while trying to transpile '${href}'`);\n    }\n\n    return model.getValue();\n  }\n}\n\nexport function flattenDiagnosticMessageText(\n  diag: string | import('typescript').DiagnosticMessageChain | undefined,\n  newLine: string = '\\n',\n  indent = 0\n): string {\n  if (typeof diag === 'string') {\n    return diag;\n  } else if (diag === undefined) {\n    return '';\n  }\n  let result = '';\n  if (indent) {\n    result += newLine;\n\n    for (let i = 0; i < indent; i++) {\n      result += '  ';\n    }\n  }\n  result += diag.messageText;\n  indent++;\n  if (diag.next) {\n    for (const kid of diag.next) {\n      result += flattenDiagnosticMessageText(kid, newLine, indent);\n    }\n  }\n  return result;\n}\n\nfunction raceTimeout<T>(promise: Promise<T>, timeoutMs: number): Promise<T> {\n  return Promise.race([\n    promise,\n    timeout(timeoutMs).then(() => {\n      return Promise.reject(new TimeoutError());\n    }),\n  ]);\n}\n","import _slicedToArray from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _createClass from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _classCallCheck from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _wrapNativeSuper from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper\";\nimport { ResolvedEntryKind, AbstractResolverHost, CanceledError, Resolver, util } from '@velcro/resolver';\nimport LRU from 'lru-cache';\nimport { validRange, satisfies } from 'semver';\n\nvar ExtendableError =\n/*#__PURE__*/\nfunction (_Error) {\n  _inherits(ExtendableError, _Error);\n\n  function ExtendableError(message) {\n    var _this;\n\n    _classCallCheck(this, ExtendableError);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ExtendableError).call(this, message));\n    _this.name = _this.constructor.name;\n\n    if (typeof Error.captureStackTrace === 'function') {\n      Error.captureStackTrace(_assertThisInitialized(_this), _this.constructor);\n    } else {\n      _this.stack = new Error(message).stack;\n    }\n\n    return _this;\n  }\n\n  return ExtendableError;\n}(_wrapNativeSuper(Error));\n\nvar EntryNotFoundError =\n/*#__PURE__*/\nfunction (_ExtendableError) {\n  _inherits(EntryNotFoundError, _ExtendableError);\n\n  function EntryNotFoundError(url) {\n    _classCallCheck(this, EntryNotFoundError);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(EntryNotFoundError).call(this, \"Not found \".concat(url.href)));\n  }\n\n  return EntryNotFoundError;\n}(ExtendableError);\n\nfunction isValidEntry(entry) {\n  if (!entry || typeof entry !== 'object') return false;\n  if (entry.type === ResolvedEntryKind.Directory) return isValidDirectory(entry);\n  if (entry.type === ResolvedEntryKind.File) return isValidFile(entry);\n  return false;\n}\n\nfunction isValidDirectory(entry) {\n  return typeof entry === 'object' && entry && entry.type === ResolvedEntryKind.Directory && typeof entry.path === 'string' && entry.path && (typeof entry.files === 'undefined' || Array.isArray(entry.files) && entry.files.every(isValidEntry));\n}\n\nfunction isValidFile(entry) {\n  return typeof entry === 'object' && entry && entry.type === ResolvedEntryKind.File && typeof entry.path === 'string' && entry.path;\n}\n\nvar UNPKG_SPEC_RX = /^\\/((@[^/]+\\/[^/@]+|[^/@]+)(?:@([^/]+))?)(.*)?$/;\n\nfunction parseUnpkgUrl(url) {\n  if (url instanceof URL) {\n    url = url.pathname;\n  }\n  /**\r\n   * 1: scope + name + version\r\n   * 2: scope + name\r\n   * 3: version?\r\n   * 4: pathname\r\n   */\n\n\n  var matches = url.match(UNPKG_SPEC_RX);\n\n  if (!matches) {\n    throw new Error(\"Unable to parse unexpected unpkg url: \".concat(url));\n  }\n\n  return {\n    spec: matches[1],\n    name: matches[2],\n    version: matches[3] || '',\n    pathname: matches[4] || ''\n  };\n}\n\nfunction signalFromCancellationToken(token, AbortControllerConstructor) {\n  if (!token || !AbortControllerConstructor) {\n    return;\n  }\n\n  var abortController = new AbortControllerConstructor();\n\n  if (token.isCancellationRequested) {\n    abortController.abort();\n  } else {\n    token.onCancellationRequested(function () {\n      return abortController.abort();\n    });\n  }\n\n  return abortController.signal;\n}\n\nvar UNPKG_PROTOCOL = 'https:';\nvar UNPKG_HOST = 'unpkg.com';\n\nvar ResolverHostUnpkg =\n/*#__PURE__*/\nfunction (_AbstractResolverHost) {\n  _inherits(ResolverHostUnpkg, _AbstractResolverHost);\n\n  function ResolverHostUnpkg() {\n    var _this2;\n\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, ResolverHostUnpkg);\n\n    _this2 = _possibleConstructorReturn(this, _getPrototypeOf(ResolverHostUnpkg).call(this));\n    _this2.contentCache = new LRU({\n      length: function length(buf) {\n        return buf.byteLength;\n      },\n      max: 1024 * 1024 * 5\n    });\n    _this2.inflightContentRequests = new Map();\n    _this2.packageLock = new Map();\n    _this2.packageEntriesCache = new Map();\n    _this2.packageJsonCache = new Map();\n\n    if (!options.fetch && typeof fetch !== 'function') {\n      throw new TypeError(\"A fetch function must be provided to the \".concat(_this2.constructor.name, \" if the environment doesn't provide one\"));\n    }\n\n    _this2.AbortController = options.AbortController;\n\n    _this2.fetch = options.fetch || function (input, init) {\n      return fetch(input, init);\n    };\n\n    return _this2;\n  }\n\n  _createClass(ResolverHostUnpkg, [{\n    key: \"getCanonicalUrl\",\n    value: function () {\n      var _getCanonicalUrl = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(resolver, url) {\n        var _ref,\n            token,\n            unresolvedSpec,\n            packageJson,\n            _args = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _ref = _args.length > 2 && _args[2] !== undefined ? _args[2] : {}, token = _ref.token;\n\n                if (!(url.protocol !== UNPKG_PROTOCOL || url.hostname !== UNPKG_HOST)) {\n                  _context.next = 3;\n                  break;\n                }\n\n                throw new Error(\"Unable to list non-unpkg entries for \".concat(url.href));\n\n              case 3:\n                unresolvedSpec = parseUnpkgUrl(url);\n                _context.next = 6;\n                return this.readPackageJsonWithCache(resolver, unresolvedSpec, {\n                  token: token\n                });\n\n              case 6:\n                packageJson = _context.sent;\n                return _context.abrupt(\"return\", new URL(\"\".concat(UNPKG_PROTOCOL, \"//\").concat(UNPKG_HOST, \"/\").concat(packageJson.name, \"@\").concat(packageJson.version).concat(unresolvedSpec.pathname)));\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getCanonicalUrl(_x, _x2) {\n        return _getCanonicalUrl.apply(this, arguments);\n      }\n\n      return getCanonicalUrl;\n    }()\n  }, {\n    key: \"getResolveRoot\",\n    value: function () {\n      var _getResolveRoot = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(resolver, url) {\n        var _ref2,\n            token,\n            unresolvedSpec,\n            packageJson,\n            _args2 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _ref2 = _args2.length > 2 && _args2[2] !== undefined ? _args2[2] : {}, token = _ref2.token;\n\n                if (!(url.protocol !== UNPKG_PROTOCOL || url.hostname !== UNPKG_HOST)) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                throw new Error(\"Unable to list non-unpkg entries for \".concat(url.href));\n\n              case 3:\n                unresolvedSpec = parseUnpkgUrl(url);\n                _context2.next = 6;\n                return this.readPackageJsonWithCache(resolver, unresolvedSpec, {\n                  token: token\n                });\n\n              case 6:\n                packageJson = _context2.sent;\n                return _context2.abrupt(\"return\", new URL(\"\".concat(UNPKG_PROTOCOL, \"//\").concat(UNPKG_HOST, \"/\").concat(packageJson.name, \"@\").concat(packageJson.version, \"/\")));\n\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getResolveRoot(_x3, _x4) {\n        return _getResolveRoot.apply(this, arguments);\n      }\n\n      return getResolveRoot;\n    }()\n  }, {\n    key: \"listEntries\",\n    value: function () {\n      var _listEntries = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(resolver, url) {\n        var _ref3,\n            token,\n            rootUrl,\n            unresolvedSpec,\n            packageJson,\n            parentEntry,\n            traversalSegments,\n            _loop,\n            _args3 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _ref3 = _args3.length > 2 && _args3[2] !== undefined ? _args3[2] : {}, token = _ref3.token;\n\n                if (!(url.protocol !== UNPKG_PROTOCOL || url.hostname !== UNPKG_HOST)) {\n                  _context3.next = 3;\n                  break;\n                }\n\n                throw new Error(\"Unable to list non-unpkg entries for \".concat(url.href));\n\n              case 3:\n                _context3.next = 5;\n                return resolver.host.getResolveRoot(resolver, url, {\n                  token: token\n                });\n\n              case 5:\n                rootUrl = _context3.sent;\n                unresolvedSpec = parseUnpkgUrl(url);\n                _context3.next = 9;\n                return this.readPackageJsonWithCache(resolver, unresolvedSpec, {\n                  token: token\n                });\n\n              case 9:\n                packageJson = _context3.sent;\n                url.pathname = \"/\".concat(packageJson.name, \"@\").concat(packageJson.version).concat(unresolvedSpec.pathname);\n                _context3.next = 13;\n                return this.readPackageEntriesWithCache(parseUnpkgUrl(url), {\n                  token: token\n                });\n\n              case 13:\n                parentEntry = _context3.sent;\n\n                if (!(token && token.isCancellationRequested)) {\n                  _context3.next = 16;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 16:\n                traversalSegments = unresolvedSpec.pathname.split('/').filter(Boolean);\n\n                _loop = function _loop() {\n                  var segment = traversalSegments.shift();\n\n                  if (parentEntry.type !== ResolvedEntryKind.Directory || !parentEntry.files) {\n                    throw new EntryNotFoundError(url);\n                  }\n\n                  parentEntry = parentEntry.files.find(function (file) {\n                    return file.type === ResolvedEntryKind.Directory && Resolver.path.basename(file.path) === segment;\n                  });\n                };\n\n                while (parentEntry && traversalSegments.length) {\n                  _loop();\n                }\n\n                if (parentEntry) {\n                  _context3.next = 21;\n                  break;\n                }\n\n                throw new EntryNotFoundError(url);\n\n              case 21:\n                if (parentEntry.files) {\n                  _context3.next = 23;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", []);\n\n              case 23:\n                return _context3.abrupt(\"return\", parentEntry.files.map(function (entry) {\n                  return {\n                    type: entry.type,\n                    url: new URL(\".\".concat(entry.path), rootUrl)\n                  };\n                }));\n\n              case 24:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function listEntries(_x5, _x6) {\n        return _listEntries.apply(this, arguments);\n      }\n\n      return listEntries;\n    }()\n  }, {\n    key: \"readFileContent\",\n    value: function () {\n      var _readFileContent = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(_, url) {\n        var _ref4,\n            token,\n            href,\n            cached,\n            inflight,\n            signal,\n            fetch,\n            promise,\n            buf,\n            _args4 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _ref4 = _args4.length > 2 && _args4[2] !== undefined ? _args4[2] : {}, token = _ref4.token;\n\n                if (!(url.protocol !== UNPKG_PROTOCOL || url.hostname !== UNPKG_HOST)) {\n                  _context4.next = 3;\n                  break;\n                }\n\n                throw new Error(\"Unable to read file contents for non-unpkg entries for \".concat(url.href));\n\n              case 3:\n                href = url.href;\n                cached = this.contentCache.get(href);\n\n                if (!cached) {\n                  _context4.next = 7;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\", cached);\n\n              case 7:\n                inflight = this.inflightContentRequests.get(href);\n\n                if (!inflight) {\n                  _context4.next = 10;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\", inflight);\n\n              case 10:\n                // console.log('[MISS] readFileContent(%s)', href);\n                signal = signalFromCancellationToken(token, this.AbortController);\n                fetch = this.fetch;\n                promise = fetch(href, {\n                  redirect: 'follow',\n                  signal: signal\n                }).then(function (res) {\n                  if (!res.ok) {\n                    throw new Error(\"Error reading file content for \".concat(href, \": \").concat(res.status));\n                  }\n\n                  return res.arrayBuffer();\n                }).catch(function (err) {\n                  if (err.name === 'AbortError') {\n                    throw new CanceledError('Canceled');\n                  }\n\n                  throw err;\n                });\n                this.inflightContentRequests.set(href, promise);\n                _context4.prev = 14;\n                _context4.next = 17;\n                return promise;\n\n              case 17:\n                buf = _context4.sent;\n                this.contentCache.set(href, buf);\n                return _context4.abrupt(\"return\", buf);\n\n              case 20:\n                _context4.prev = 20;\n                this.inflightContentRequests.delete(href);\n                return _context4.finish(20);\n\n              case 23:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[14,, 20, 23]]);\n      }));\n\n      function readFileContent(_x7, _x8) {\n        return _readFileContent.apply(this, arguments);\n      }\n\n      return readFileContent;\n    }()\n  }, {\n    key: \"readPackageEntriesWithCache\",\n    value: function () {\n      var _readPackageEntriesWithCache = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee5(spec) {\n        var _ref5,\n            token,\n            lockKey,\n            lock,\n            range,\n            packageEntriesCacheForModule,\n            exactMatch,\n            _iteratorNormalCompletion,\n            _didIteratorError,\n            _iteratorError,\n            _iterator,\n            _step,\n            _ref8,\n            _ref7,\n            version,\n            _packageEntries,\n            promise,\n            packageEntries,\n            _args5 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _ref5 = _args5.length > 1 && _args5[1] !== undefined ? _args5[1] : {}, token = _ref5.token;\n                lockKey = \"entries:\".concat(spec.name);\n                lock = this.packageLock.get(lockKey);\n\n                if (!lock) {\n                  _context5.next = 6;\n                  break;\n                }\n\n                _context5.next = 6;\n                return lock;\n\n              case 6:\n                range = validRange(spec.version);\n\n                if (range) {\n                  _context5.next = 9;\n                  break;\n                }\n\n                throw new Error(\"Invalid SemVer range for spec \".concat(spec.spec));\n\n              case 9:\n                packageEntriesCacheForModule = this.packageEntriesCache.get(spec.name);\n\n                if (!packageEntriesCacheForModule) {\n                  _context5.next = 45;\n                  break;\n                }\n\n                exactMatch = packageEntriesCacheForModule.get(spec.version);\n\n                if (!exactMatch) {\n                  _context5.next = 14;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\", exactMatch);\n\n              case 14:\n                _iteratorNormalCompletion = true;\n                _didIteratorError = false;\n                _iteratorError = undefined;\n                _context5.prev = 17;\n                _iterator = packageEntriesCacheForModule[Symbol.iterator]();\n\n              case 19:\n                if (_iteratorNormalCompletion = (_step = _iterator.next()).done) {\n                  _context5.next = 29;\n                  break;\n                }\n\n                _ref8 = _step.value;\n                _ref7 = _slicedToArray(_ref8, 2);\n                version = _ref7[0];\n                _packageEntries = _ref7[1];\n\n                if (!satisfies(version, range)) {\n                  _context5.next = 26;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\", _packageEntries);\n\n              case 26:\n                _iteratorNormalCompletion = true;\n                _context5.next = 19;\n                break;\n\n              case 29:\n                _context5.next = 35;\n                break;\n\n              case 31:\n                _context5.prev = 31;\n                _context5.t0 = _context5[\"catch\"](17);\n                _didIteratorError = true;\n                _iteratorError = _context5.t0;\n\n              case 35:\n                _context5.prev = 35;\n                _context5.prev = 36;\n\n                if (!_iteratorNormalCompletion && _iterator.return != null) {\n                  _iterator.return();\n                }\n\n              case 38:\n                _context5.prev = 38;\n\n                if (!_didIteratorError) {\n                  _context5.next = 41;\n                  break;\n                }\n\n                throw _iteratorError;\n\n              case 41:\n                return _context5.finish(38);\n\n              case 42:\n                return _context5.finish(35);\n\n              case 43:\n                _context5.next = 47;\n                break;\n\n              case 45:\n                packageEntriesCacheForModule = new Map();\n                this.packageEntriesCache.set(spec.name, packageEntriesCacheForModule);\n\n              case 47:\n                // console.log('[MISS] readPackageEntriesWithCache(%s)', spec.spec);\n                promise = this.readPackageEntries(spec.spec, {\n                  token: token\n                });\n                this.packageLock.set(lockKey, promise);\n                _context5.next = 51;\n                return promise;\n\n              case 51:\n                packageEntries = _context5.sent;\n                this.packageLock.delete(lockKey);\n                packageEntriesCacheForModule.set(spec.version, packageEntries);\n                return _context5.abrupt(\"return\", packageEntries);\n\n              case 55:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this, [[17, 31, 35, 43], [36,, 38, 42]]);\n      }));\n\n      function readPackageEntriesWithCache(_x9) {\n        return _readPackageEntriesWithCache.apply(this, arguments);\n      }\n\n      return readPackageEntriesWithCache;\n    }()\n  }, {\n    key: \"readPackageJsonWithCache\",\n    value: function () {\n      var _readPackageJsonWithCache = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee6(resolver, spec) {\n        var _ref9,\n            token,\n            lockKey,\n            lock,\n            packageJsonCacheForModule,\n            exactMatch,\n            range,\n            _iteratorNormalCompletion2,\n            _didIteratorError2,\n            _iteratorError2,\n            _iterator2,\n            _step2,\n            _ref12,\n            _ref11,\n            version,\n            _packageJson,\n            promise,\n            packageJson,\n            _args6 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _ref9 = _args6.length > 2 && _args6[2] !== undefined ? _args6[2] : {}, token = _ref9.token;\n                lockKey = \"packageJson:\".concat(spec.spec);\n                lock = this.packageLock.get(lockKey);\n\n                if (!lock) {\n                  _context6.next = 6;\n                  break;\n                }\n\n                _context6.next = 6;\n                return lock;\n\n              case 6:\n                packageJsonCacheForModule = this.packageJsonCache.get(spec.name);\n\n                if (!packageJsonCacheForModule) {\n                  _context6.next = 44;\n                  break;\n                }\n\n                exactMatch = packageJsonCacheForModule.get(spec.version);\n\n                if (!exactMatch) {\n                  _context6.next = 11;\n                  break;\n                }\n\n                return _context6.abrupt(\"return\", exactMatch);\n\n              case 11:\n                range = validRange(spec.version);\n\n                if (!range) {\n                  _context6.next = 42;\n                  break;\n                }\n\n                _iteratorNormalCompletion2 = true;\n                _didIteratorError2 = false;\n                _iteratorError2 = undefined;\n                _context6.prev = 16;\n                _iterator2 = packageJsonCacheForModule[Symbol.iterator]();\n\n              case 18:\n                if (_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done) {\n                  _context6.next = 28;\n                  break;\n                }\n\n                _ref12 = _step2.value;\n                _ref11 = _slicedToArray(_ref12, 2);\n                version = _ref11[0];\n                _packageJson = _ref11[1];\n\n                if (!satisfies(version, range)) {\n                  _context6.next = 25;\n                  break;\n                }\n\n                return _context6.abrupt(\"return\", _packageJson);\n\n              case 25:\n                _iteratorNormalCompletion2 = true;\n                _context6.next = 18;\n                break;\n\n              case 28:\n                _context6.next = 34;\n                break;\n\n              case 30:\n                _context6.prev = 30;\n                _context6.t0 = _context6[\"catch\"](16);\n                _didIteratorError2 = true;\n                _iteratorError2 = _context6.t0;\n\n              case 34:\n                _context6.prev = 34;\n                _context6.prev = 35;\n\n                if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n                  _iterator2.return();\n                }\n\n              case 37:\n                _context6.prev = 37;\n\n                if (!_didIteratorError2) {\n                  _context6.next = 40;\n                  break;\n                }\n\n                throw _iteratorError2;\n\n              case 40:\n                return _context6.finish(37);\n\n              case 41:\n                return _context6.finish(34);\n\n              case 42:\n                _context6.next = 46;\n                break;\n\n              case 44:\n                packageJsonCacheForModule = new Map();\n                this.packageJsonCache.set(spec.name, packageJsonCacheForModule);\n\n              case 46:\n                // console.log('[MISS] readPackageJsonWithCache(%s)', spec.spec);\n                promise = this.readPackageJson(resolver, spec.spec, {\n                  token: token\n                });\n                this.packageLock.set(lockKey, promise);\n                _context6.next = 50;\n                return promise;\n\n              case 50:\n                packageJson = _context6.sent;\n                this.packageLock.delete(lockKey);\n\n                if (packageJson.version) {\n                  _context6.next = 54;\n                  break;\n                }\n\n                throw new Error(\"Manifest missing a version identifier for \".concat(spec));\n\n              case 54:\n                packageJsonCacheForModule.set(packageJson.version, packageJson);\n                return _context6.abrupt(\"return\", packageJson);\n\n              case 56:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[16, 30, 34, 42], [35,, 37, 41]]);\n      }));\n\n      function readPackageJsonWithCache(_x10, _x11) {\n        return _readPackageJsonWithCache.apply(this, arguments);\n      }\n\n      return readPackageJsonWithCache;\n    }()\n  }, {\n    key: \"readPackageJson\",\n    value: function () {\n      var _readPackageJson = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee7(resolver, spec) {\n        var _ref13,\n            token,\n            href,\n            content,\n            manifest,\n            _args7 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _ref13 = _args7.length > 2 && _args7[2] !== undefined ? _args7[2] : {}, token = _ref13.token;\n                // console.log('readPackageJson(%s)', spec);\n                href = \"\".concat(UNPKG_PROTOCOL, \"//\").concat(UNPKG_HOST, \"/\").concat(spec, \"/package.json\");\n                _context7.next = 4;\n                return this.readFileContent(resolver, new URL(href), {\n                  token: token\n                });\n\n              case 4:\n                content = _context7.sent;\n                _context7.prev = 5;\n                manifest = util.parseBufferAsPackageJson(resolver.decoder, content, spec);\n                _context7.next = 12;\n                break;\n\n              case 9:\n                _context7.prev = 9;\n                _context7.t0 = _context7[\"catch\"](5);\n                throw new Error(\"Error parsing manifest as json for package \".concat(spec, \": \").concat(_context7.t0.message));\n\n              case 12:\n                return _context7.abrupt(\"return\", manifest);\n\n              case 13:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this, [[5, 9]]);\n      }));\n\n      function readPackageJson(_x12, _x13) {\n        return _readPackageJson.apply(this, arguments);\n      }\n\n      return readPackageJson;\n    }()\n  }, {\n    key: \"readPackageEntries\",\n    value: function () {\n      var _readPackageEntries = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee8(spec) {\n        var _ref14,\n            token,\n            href,\n            signal,\n            fetch,\n            res,\n            json,\n            _args8 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _ref14 = _args8.length > 1 && _args8[1] !== undefined ? _args8[1] : {}, token = _ref14.token;\n                // console.log('readPackageEntries(%s)', spec);\n                href = \"\".concat(UNPKG_PROTOCOL, \"//\").concat(UNPKG_HOST, \"/\").concat(spec, \"/?meta\");\n                signal = signalFromCancellationToken(token, this.AbortController);\n                fetch = this.fetch;\n                _context8.next = 6;\n                return fetch(href, {\n                  signal: signal\n                }).catch(function (err) {\n                  if (err.name === 'AbortError') {\n                    throw new CanceledError('Canceled');\n                  }\n\n                  throw err;\n                });\n\n              case 6:\n                res = _context8.sent;\n\n                if (res.ok) {\n                  _context8.next = 9;\n                  break;\n                }\n\n                throw new Error(\"Error listing package contents for \".concat(spec, \": \").concat(res.status));\n\n              case 9:\n                _context8.next = 11;\n                return res.json();\n\n              case 11:\n                json = _context8.sent;\n\n                if (isValidDirectory(json)) {\n                  _context8.next = 14;\n                  break;\n                }\n\n                throw new Error(\"Unexpected response payload while listing package contents for \".concat(spec));\n\n              case 14:\n                return _context8.abrupt(\"return\", json);\n\n              case 15:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function readPackageEntries(_x14) {\n        return _readPackageEntries.apply(this, arguments);\n      }\n\n      return readPackageEntries;\n    }()\n  }], [{\n    key: \"resolveBareModule\",\n    value: function resolveBareModule(_, spec) {\n      return new URL(\"\".concat(UNPKG_PROTOCOL, \"//\").concat(UNPKG_HOST, \"/\").concat(spec.name, \"@\").concat(spec.spec).concat(spec.pathname));\n    }\n  }]);\n\n  return ResolverHostUnpkg;\n}(AbstractResolverHost);\n\nexport { ResolverHostUnpkg, isValidDirectory, isValidEntry, isValidFile };","import { Bundler } from '@velcro/bundler';\nimport { Resolver, AbstractResolverHost, ResolverHost } from '@velcro/resolver';\nimport { openDB } from 'idb';\nimport { timeout } from 'ts-primitives';\nimport { TimeoutError } from './error';\n\nexport class ResolverHostWithCache extends AbstractResolverHost {\n  private readonly idbPromise = openDB('velcro', Bundler.schemaVersion, {\n    async upgrade(db, oldVersion, newVersion, transaction) {\n      console.log('Upgrading cache from version %s to %s', oldVersion, newVersion);\n\n      if (!oldVersion) {\n        db.createObjectStore('getCanonicalUrl');\n        db.createObjectStore('getResolveRoot');\n        db.createObjectStore('listEntries');\n        db.createObjectStore('readFileContent');\n      }\n\n      await transaction.objectStore('getCanonicalUrl').clear();\n      await transaction.objectStore('getResolveRoot').clear();\n      await transaction.objectStore('listEntries').clear();\n      await transaction.objectStore('readFileContent').clear();\n    },\n  }).catch(err => {\n    console.error(err, 'error opening IndexedDB');\n\n    return null;\n  });\n\n  private readonly hostTimeout: number;\n  private readonly idbTimeout: number;\n\n  private readonly inflightGetCanonicalUrl = new Map<string, ReturnType<ResolverHost['getCanonicalUrl']>>();\n  private readonly inflightGetResolveRoot = new Map<string, ReturnType<ResolverHost['getResolveRoot']>>();\n  private readonly inflightListEntries = new Map<string, ReturnType<ResolverHost['listEntries']>>();\n  private readonly inflightReadFileContent = new Map<string, ReturnType<ResolverHost['readFileContent']>>();\n\n  constructor(readonly host: ResolverHost, { idbTimeout = 1000, hostTimeout = 10000 } = {}) {\n    super();\n\n    this.hostTimeout = hostTimeout;\n    this.idbTimeout = idbTimeout;\n  }\n\n  private async withCache<T, C = unknown>(\n    href: string,\n    loadFn: () => Promise<T>,\n    inflightMap: Map<string, Promise<T>>,\n    storeName: string,\n    serialize?: (result: T) => C,\n    deserialize?: (cached: C) => T\n  ): Promise<T> {\n    const idb = await withTimeout(this.idbTimeout, this.idbPromise, `this.idbPromise`).catch(_ => undefined);\n\n    if (idb) {\n      const cached = await withTimeout(\n        this.idbTimeout,\n        idb.get(storeName, href),\n        `idb.get(${storeName}, ${href})`\n      ).catch(_ => undefined);\n\n      if (cached) {\n        return deserialize ? deserialize(cached) : cached;\n      }\n    }\n\n    let inflight = inflightMap.get(href);\n\n    if (!inflight) {\n      inflight = withTimeout(this.hostTimeout, loadFn(), `Timed out on operation '${storeName}' for '${href}'`);\n      inflightMap.set(href, inflight);\n\n      // Make sure we don't get an uncaught rejection\n      inflight\n        .then(result => {\n          if (idb) {\n            idb.put(storeName, serialize ? serialize(result) : result, href).catch(_ => undefined);\n          }\n        })\n        .catch(_ => undefined)\n        .then(() => {\n          inflightMap.delete(href);\n        });\n    }\n\n    return inflight;\n  }\n\n  async getCanonicalUrl(resolver: Resolver, url: URL) {\n    const result = await this.withCache(\n      url.href,\n      () => this.host.getCanonicalUrl(resolver, url),\n      this.inflightGetCanonicalUrl,\n      'getCanonicalUrl',\n      url => url.href,\n      href => new URL(href)\n    );\n\n    return result;\n  }\n\n  async getResolveRoot(resolver: Resolver, url: URL) {\n    const result = await this.withCache(\n      url.href,\n      () => this.host.getResolveRoot(resolver, url),\n      this.inflightGetResolveRoot,\n      'getResolveRoot',\n      url => url.href,\n      href => new URL(href)\n    );\n\n    return result;\n  }\n\n  async listEntries(resolver: Resolver, url: URL) {\n    const result = await this.withCache(\n      url.href,\n      () => this.host.listEntries(resolver, url),\n      this.inflightListEntries,\n      'listEntries',\n      entries =>\n        entries.map(entry => ({\n          type: entry.type,\n          href: entry.url.href,\n        })),\n      cached =>\n        cached.map(entry => ({\n          type: entry.type,\n          url: new URL(entry.href),\n        }))\n    );\n\n    return result;\n  }\n\n  async readFileContent(resolver: Resolver, url: URL) {\n    try {\n      const result = await this.withCache(\n        url.href,\n        () => this.host.readFileContent(resolver, url),\n        this.inflightReadFileContent,\n        'readFileContent'\n      );\n\n      return result;\n    } catch (err) {\n      throw err;\n    }\n  }\n}\n\nfunction withTimeout<T>(duration: number, promise: Promise<T>, message: string) {\n  return Promise.race([\n    promise,\n    timeout(duration).then(() => {\n      return Promise.reject(new TimeoutError(message));\n    }),\n  ]);\n}\n","import * as Monaco from 'monaco-editor';\nimport { Emitter, IDisposable, DisposableStore, ThrottledDelayer } from 'ts-primitives';\nimport { useState, useEffect, useContext, createContext } from 'react';\nimport { TypeAcquirer } from './typeAcquisition';\nimport { Bundler } from '@velcro/bundler';\nimport { Resolver } from '@velcro/resolver';\nimport { ResolverHostCompound } from '@velcro/resolver-host-compound';\nimport { ResolverHostMonaco } from '../lib/ResolverHostMonaco';\nimport { ResolverHostUnpkg } from '@velcro/resolver-host-unpkg';\nimport { ResolverHostWithCache } from '../lib/ResolverHostWithCache';\n\nconst rootUri = Monaco.Uri.file('/');\n\nexport class EditorManager implements IDisposable {\n  readonly bundler = new Bundler({\n    resolver: new Resolver(\n      new ResolverHostCompound({\n        'https://unpkg.com/': new ResolverHostWithCache(new ResolverHostUnpkg()),\n        [rootUri.toString(true)]: new ResolverHostMonaco(rootUri),\n      }),\n      {\n        extensions: ['.js', '.jsx', '.ts', '.tsx'],\n        packageMain: ['browser', 'main'],\n      }\n    ),\n  });\n\n  editor: Monaco.editor.IStandaloneCodeEditor | null = null;\n\n  private readonly disposableStore = new DisposableStore();\n  private readonly initialPath: string | undefined;\n\n  private readonly typeAcquirer = new TypeAcquirer(this.bundler.resolver, ResolverHostUnpkg.resolveBareModule);\n  private readonly viewState = new WeakMap<Monaco.editor.ITextModel, Monaco.editor.ICodeEditorViewState>();\n\n  private readonly onWillFocusModelEmitter = new Emitter<Monaco.editor.ITextModel>();\n  private readonly onDidChangeEmitter = new Emitter<{ model: Monaco.editor.ITextModel }>();\n\n  constructor(options: { files?: Record<string, string>; initialPath?: string } = {}) {\n    this.disposableStore.add(this.onWillFocusModelEmitter);\n    this.disposableStore.add(this.onDidChangeEmitter);\n\n    Monaco.languages.typescript.typescriptDefaults.setEagerModelSync(true);\n    Monaco.languages.typescript.typescriptDefaults.setMaximumWorkerIdleTime(0);\n\n    Monaco.languages.typescript.typescriptDefaults.setCompilerOptions({\n      allowJs: true,\n      allowNonTsExtensions: true,\n      allowSyntheticDefaultImports: true,\n      baseUrl: '.',\n      checkJs: true,\n      esModuleInterop: true,\n      experimentalDecorators: true,\n      inlineSourceMap: true,\n      inlineSources: true,\n      isolatedModules: false,\n      jsx: Monaco.languages.typescript.JsxEmit.React,\n      jsxFactory: 'React.createElement',\n      lib: ['dom'],\n      module: Monaco.languages.typescript.ModuleKind.CommonJS,\n      moduleResolution: Monaco.languages.typescript.ModuleResolutionKind.NodeJs,\n      noEmit: false,\n      outDir: `dist`,\n      resolveJsonModule: true,\n      rootDir: '/',\n      sourceMap: true,\n      target: Monaco.languages.typescript.ScriptTarget.ES2015,\n      typeRoots: ['node_modules/@types'],\n    });\n\n    Monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({\n      noSemanticValidation: true,\n      noSyntaxValidation: false,\n    });\n\n    if (options.files) {\n      for (const pathname in options.files) {\n        const content = options.files[pathname];\n\n        this.createModel(pathname, content);\n      }\n    }\n\n    Monaco.editor.onDidCreateModel(model => {\n      const onDidChangePackageJson = async () => {\n        const value = model.getValue();\n\n        let dependencies = {\n          typescript: Monaco.languages.typescript.typescriptVersion,\n        };\n\n        try {\n          const pkgJson = JSON.parse(value);\n\n          if (pkgJson.dependencies) {\n            dependencies = { ...dependencies, ...pkgJson.dependencies };\n          }\n        } catch (_) {\n          // Ignore\n        }\n\n        Monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({ noSemanticValidation: true });\n        await this.typeAcquirer.importTypesForSpecs(dependencies);\n        Monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({ noSemanticValidation: false });\n      };\n\n      if (model.uri.toString(true) === `${rootUri.toString(true)}package.json`) {\n        const throttler = new ThrottledDelayer(1500);\n        throttler.trigger(onDidChangePackageJson);\n\n        this.disposableStore.add(model.onDidChangeContent(() => throttler.trigger(onDidChangePackageJson)));\n        this.disposableStore.add(throttler);\n      }\n    });\n\n    this.disposableStore.add(\n      this.typeAcquirer.onTypeFile(file => {\n        this.disposableStore.add(\n          Monaco.languages.typescript.typescriptDefaults.addExtraLib(\n            file.content,\n            Monaco.Uri.file(file.pathname).toString(true)\n          )\n        );\n      })\n    );\n\n    this.initialPath = options.initialPath;\n  }\n\n  get dispose() {\n    console.log('EditorManager::dispose()');\n    return this.disposableStore.dispose;\n  }\n\n  get onDidChange() {\n    return this.onDidChangeEmitter.event;\n  }\n\n  get onWillFocusModel() {\n    return this.onWillFocusModelEmitter.event;\n  }\n\n  createModel(pathname: string, content = '') {\n    const language = this.inferLanguage(pathname);\n\n    let uri: Monaco.Uri;\n\n    try {\n      uri = Monaco.Uri.file(pathname);\n    } catch (err) {\n      throw new Error(`Invalid path '${pathname}': ${err && err.message}`);\n    }\n\n    if (Monaco.editor.getModel(uri)) {\n      throw new Error(`Cannot create file because it exists '${pathname}'`);\n    }\n\n    return Monaco.editor.createModel(content, language, uri);\n  }\n\n  focusModel(model: Monaco.editor.ITextModel) {\n    if (this.editor) {\n      this.editor.setModel(model);\n      this.editor.focus();\n    }\n  }\n\n  focusPath(path: string) {\n    if (this.editor) {\n      const model = Monaco.editor.getModel(Monaco.Uri.file(path));\n\n      if (model) {\n        this.focusModel(model);\n      }\n    }\n  }\n\n  mount(el: HTMLElement) {\n    if (this.editor) {\n      throw new Error('Invariant violation: Editor already mounted');\n    }\n\n    this.editor = Monaco.editor.create(el, {\n      model: null,\n      automaticLayout: true,\n      showUnused: true,\n      scrollBeyondLastLine: false,\n      theme: 'vs',\n    });\n\n    this.editor.onDidDispose(() => {\n      this.editor = null;\n    });\n\n    this.editor.onDidChangeModel(e => {\n      if (e.newModelUrl && this.editor) {\n        const model = Monaco.editor.getModel(e.newModelUrl)!;\n        const viewState = this.viewState.get(model);\n\n        if (viewState) {\n          this.editor.restoreViewState(viewState);\n        }\n      }\n    });\n\n    this.editor.onDidBlurEditorText(() => {\n      if (this.editor) {\n        const model = this.editor.getModel();\n        const viewState = this.editor.saveViewState();\n\n        if (model && viewState) {\n          this.viewState.set(model, viewState);\n        }\n      }\n    });\n\n    this.disposableStore.add(this.editor);\n\n    if (this.initialPath) {\n      this.focusPath(this.initialPath);\n    }\n\n    return this.editor;\n  }\n\n  inferLanguage(pathname: string) {\n    return pathname.match(/\\.(?:tsx?|jsx?)$/) ? 'typescript' : undefined;\n  }\n}\n\nexport const EditorManagerContext = createContext(new EditorManager());\n\nexport function useActiveModel() {\n  const workbench = useContext(EditorManagerContext);\n  const [activeModel, setActiveModel] = useState<Monaco.editor.ITextModel | null>(\n    workbench.editor ? workbench.editor.getModel() : null\n  );\n\n  useEffect(() => {\n    const disposable = new DisposableStore();\n\n    const trackEditor = (editor: Monaco.editor.ICodeEditor) => {\n      editor.onDidChangeModel(e => {\n        const model = e.newModelUrl ? Monaco.editor.getModel(e.newModelUrl) : null;\n\n        setActiveModel(model);\n      });\n\n      disposable.add(\n        editor.onDidBlurEditorText(() => {\n          setActiveModel(null);\n        })\n      );\n\n      disposable.add(\n        editor.onDidFocusEditorText(() => {\n          setActiveModel(editor.getModel());\n        })\n      );\n\n      if (editor.hasTextFocus()) {\n        setActiveModel(editor.getModel());\n      }\n    };\n\n    disposable.add(Monaco.editor.onDidCreateEditor(trackEditor));\n    if (workbench.editor) {\n      trackEditor(workbench.editor);\n    }\n\n    return () => disposable.dispose();\n  }, [workbench.editor, activeModel]);\n\n  return activeModel;\n}\n","import styled from '@emotion/styled/macro';\nimport React, { useRef, useEffect, useContext } from 'react';\nimport { EditorManagerContext } from '../lib/EditorManager';\n\nconst Editor: React.FC<{\n  className?: string;\n}> = ({ className }) => {\n  const el = useRef<HTMLDivElement | null>(null);\n  const editorManager = useContext(EditorManagerContext);\n\n  useEffect(() => {\n    if (!el.current) {\n      return;\n    }\n\n    const editor = editorManager.mount(el.current);\n\n    return () => {\n      editor.dispose();\n    };\n  }, [editorManager, el]);\n\n  return (\n    <div className={className} ref={el}>\n      <div></div>\n    </div>\n  );\n};\n\nexport default styled(Editor)``;\n","export interface CallSiteOptions {\n  columnNumber?: number;\n  evalOrigin?: string;\n  fileName?: string;\n  functionName?: string;\n  isConstructor: boolean;\n  isEval: boolean;\n  isInternal?: boolean;\n  isNative: boolean;\n  isToplevel: boolean;\n  methodName?: string;\n  lineNumber?: number;\n  typeName?: string;\n}\n\nexport class CallSite {\n  constructor(private readonly options: CallSiteOptions) {}\n\n  getColumnNumber() {\n    return this.options.columnNumber;\n  }\n\n  getEvalOrigin() {\n    return this.options.evalOrigin || '(EVALORIGIN)';\n  }\n\n  getMethodName() {\n    return this.options.methodName;\n  }\n\n  getFunctionName() {\n    return this.options.functionName;\n  }\n\n  getLineNumber() {\n    return this.options.lineNumber;\n  }\n\n  getFileName() {\n    return this.options.fileName;\n  }\n\n  getTypeName() {\n    return this.options.typeName;\n  }\n\n  isConstructor() {\n    return this.options.isConstructor;\n  }\n\n  isEval() {\n    return this.options.isEval;\n  }\n\n  isInternal() {\n    return !!this.options.isInternal;\n  }\n\n  isNative() {\n    return this.options.isNative;\n  }\n\n  isToplevel() {\n    return this.options.isToplevel;\n  }\n\n  // This is copied almost verbatim from the V8 source code at\n  // https://code.google.com/p/v8/source/browse/trunk/src/messages.js. The\n  // implementation of wrapCallSite() used to just forward to the actual source\n  // code of CallSite.prototype.toString but unfortunately a new release of V8\n  // did something to the prototype chain and broke the shim. The only fix I\n  // could find was copy/paste.\n  toString() {\n    let fileName: string | undefined = undefined;\n    let fileLocation = '';\n    if (this.isNative()) {\n      fileLocation = 'native';\n    } else {\n      fileName = this.getFileName();\n      if (!fileName && this.isEval()) {\n        fileLocation = this.getEvalOrigin();\n        fileLocation += ', '; // Expecting source position to follow.\n      }\n\n      if (fileName) {\n        fileLocation += fileName;\n      } else {\n        // Source code does not originate from a file and is not native, but we\n        // can still get the source position inside the source string, e.g. in\n        // an eval string.\n        fileLocation += '<anonymous>';\n      }\n      const lineNumber = this.getLineNumber();\n      if (lineNumber !== undefined) {\n        fileLocation += ':' + lineNumber;\n        const columnNumber = this.getColumnNumber();\n        if (columnNumber !== undefined) {\n          fileLocation += ':' + columnNumber;\n        }\n      }\n    }\n\n    let line = '';\n    const functionName = this.getFunctionName();\n    let addSuffix = true;\n    const isConstructor = this.isConstructor();\n    const isMethodCall = !(this.isToplevel() || isConstructor);\n\n    if (isMethodCall) {\n      let typeName = this.getTypeName();\n      // Fixes shim to be backward compatable with Node v0 to v4\n      if (typeName === '[object Object]') {\n        typeName = 'null';\n      }\n      const methodName = this.getMethodName();\n      if (functionName) {\n        if (typeName && functionName.indexOf(typeName) !== 0) {\n          line += typeName + '.';\n        }\n        line += functionName;\n        if (methodName && functionName.indexOf('.' + methodName) !== functionName.length - methodName.length - 1) {\n          line += ' [as ' + methodName + ']';\n        }\n      } else {\n        line += typeName + '.' + (methodName || '<anonymous>');\n      }\n    } else if (isConstructor) {\n      line += 'new ' + (functionName || '<anonymous>');\n    } else if (functionName) {\n      line += functionName;\n    } else {\n      line += fileLocation;\n      addSuffix = false;\n    }\n    if (addSuffix) {\n      line += ' (' + fileLocation + ')';\n    }\n\n    return line;\n  }\n\n  with(options: Partial<CallSiteOptions>) {\n    return new CallSite({\n      ...this.options,\n      ...options,\n    });\n  }\n\n  // This function is part of the V8 stack trace API, for more info see:\n  // https://v8.dev/docs/stack-trace-api\n  static prepareStackTrace<T extends Error>(error: T, stack: CallSite[]) {\n    const name = error.name || 'Error';\n    const message = error.message || '';\n    const errorString = name + ': ' + message;\n\n    return [\n      { isInternal: false, text: errorString },\n      ...stack.map(frame => ({ isInternal: frame.isInternal(), text: `    at ${frame.toString()}` })),\n    ];\n  }\n}\n","import * as Monaco from 'monaco-editor';\nimport { useEffect, useState } from 'react';\nimport { DisposableStore } from 'ts-primitives';\n\n// import { EditorContext } from './context';\n\nexport enum EntryKind {\n  Directory = 'directory',\n  File = 'file',\n}\n\nexport interface IDirectory {\n  type: EntryKind.Directory;\n  uri: Monaco.Uri;\n}\nexport interface IFile {\n  type: EntryKind.File;\n  uri: Monaco.Uri;\n  model: Monaco.editor.ITextModel;\n}\n\nexport type DirectoryEntry = IDirectory | IFile;\n\nexport function useDirectory(uri: Monaco.Uri) {\n  // Make sure the URI always ends with a trailing slash\n  const prefix = uri.toString(true).replace(/\\/?$/, '/');\n  const sortEntries = (models: (DirectoryEntry)[]) => {\n    return [...models].sort((a, b) => (a.uri.fsPath > b.uri.fsPath ? 1 : -1));\n  };\n\n  const initialEntries = sortEntries(\n    Monaco.editor.getModels().reduce(\n      (entries, model) => {\n        const modelUri = model.uri.toString(true);\n\n        if (modelUri.startsWith(prefix)) {\n          const nestedPath = modelUri.slice(prefix.length);\n          const nextDirIdx = nestedPath.indexOf('/');\n\n          if (nextDirIdx === 0) {\n            throw new Error('Invariant error: WAT?');\n          }\n\n          if (nextDirIdx > 0) {\n            // This is an intermediate directory\n            const uri = Monaco.Uri.parse(`${prefix}${nestedPath.slice(0, nextDirIdx + 1)}`);\n\n            entries.push({\n              type: EntryKind.Directory,\n              uri,\n            });\n          } else {\n            entries.push({\n              type: EntryKind.File,\n              uri: model.uri,\n              model,\n            });\n          }\n        }\n\n        return entries;\n      },\n      [] as DirectoryEntry[]\n    )\n  );\n  const [entries, setEntries] = useState(initialEntries);\n\n  useEffect(() => {\n    const disposable = new DisposableStore();\n    const prefix = uri.toString(true).replace(/\\/?$/, '/');\n\n    disposable.add(\n      Monaco.editor.onDidCreateModel((model: Monaco.editor.ITextModel) => {\n        const modelUri = model.uri.toString(true);\n\n        if (modelUri.startsWith(prefix)) {\n          const nestedPath = modelUri.slice(prefix.length);\n          const nextDirIdx = nestedPath.indexOf('/');\n\n          if (nextDirIdx === 0) {\n            throw new Error('Invariant error: WAT?');\n          }\n\n          if (nextDirIdx > 0) {\n            // This is an intermediate directory\n            const uri = Monaco.Uri.parse(`${prefix}${nestedPath.slice(0, nextDirIdx)}`);\n\n            // It is possible that we already have this directory\n            const entry = entries.find(entry => entry.uri.toString(true) === uri.toString(true));\n\n            if (entry) {\n              if (entry.type !== EntryKind.Directory) {\n                throw new Error(\n                  `Invariant violation: A file in '${prefix}' conflicts with the path of the new file '${modelUri}'`\n                );\n              }\n\n              return;\n            }\n\n            entries.push({ type: EntryKind.Directory, uri });\n\n            return setEntries(sortEntries(entries));\n          }\n\n          if (\n            !entries.find(\n              entry => entry.type === EntryKind.File && entry.uri.toString(true) === model.uri.toString(true)\n            )\n          ) {\n            entries.push({ type: EntryKind.File, uri: model.uri, model });\n\n            setEntries(sortEntries(entries));\n          }\n        }\n      })\n    );\n\n    disposable.add(\n      Monaco.editor.onWillDisposeModel(model => {\n        const idx = entries.findIndex(entry => entry.type === EntryKind.File && entry.model === model);\n\n        if (idx === -1) {\n          throw new Error(`Invariant violation: Removing an untracked model: '${model.uri.fsPath}'`);\n        }\n\n        entries.splice(idx, 1);\n\n        setEntries(sortEntries(entries));\n      })\n    );\n\n    return () => disposable.dispose();\n  }, [entries, uri]);\n\n  return entries;\n}\n","import styled from '@emotion/styled/macro';\nimport { base64, getSourceMappingUrl, runtime } from '@velcro/bundler';\nimport * as Monaco from 'monaco-editor';\nimport React, { useEffect, useRef, useContext, useState } from 'react';\nimport { decode, SourceMapMappings } from 'sourcemap-codec';\nimport { Delayer, Throttler, DisposableStore, CancellationTokenSource } from 'ts-primitives';\nimport { EditorManagerContext } from '../lib/EditorManager';\nimport { CallSite, CallSiteOptions } from '../lib/CallSite';\n\ninterface MessageLine {\n  isInternal: boolean;\n  text: string;\n}\ninterface Message {\n  lines: MessageLine[];\n}\n\nconst PreviewProgress = styled.div<{ completed: number; total: number }>`\n  z-index: 1;\n  position: absolute;\n  top: 0;\n  width: ${props => (props.total ? `${Math.round((100 * props.completed) / props.total)}%` : 0)};\n  left: 0;\n  height: ${props => (props.total ? '2px' : '0')};\n  background-color: #008cba;\n  transition: width 0.5s 0s cubic-bezier(0.455, 0.03, 0.515, 0.955);\n`;\nconst PreviewIframeWrap = styled.div`\n  position: relative;\n  overflow: hidden;\n\n  & > iframe {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    border: none;\n  }\n`;\nconst PreviewWrap = styled.div`\n  position: relative;\n  ${PreviewIframeWrap} {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n  }\n`;\nconst PreviewMessageError = styled.ul`\n  margin: 0;\n  padding: 1em 2em;\n  font-family: monospace;\n  font-size: 16px;\n  background-color: rgba(255, 0, 0, 0.5);\n  backdrop-filter: brightness(50%);\n  color: white;\n  list-style: none;\n`;\nconst PreviewMessageErrorText = styled.li<{ isInternal: boolean }>`\n  white-space: pre-wrap;\n  opacity: ${props => (props.isInternal ? 0.7 : 1.0)};\n`;\nconst PreviewMessages = styled.div`\n  z-index: 1;\n  position: absolute;\n  bottom: 0;\n  right: 0;\n  left: 0;\n  display: flex;\n  flex-direction: column-reverse;\n`;\nconst PreviewMessageLine: React.FC<{ line: MessageLine }> = ({ line }) => {\n  return <PreviewMessageErrorText isInternal={line.isInternal}>{line.text}</PreviewMessageErrorText>;\n};\nconst PreviewMessage: React.FC<{ message: Message }> = ({ message }) => {\n  return message.lines.length ? (\n    <PreviewMessageError>\n      {message.lines.map((line, i) => (\n        <PreviewMessageLine key={i} line={line}></PreviewMessageLine>\n      ))}\n    </PreviewMessageError>\n  ) : null;\n};\n\nconst Preview: React.FC<{ className?: string }> = props => {\n  const invalidations = useRef(new Set<string>());\n  const previewWrapRef = useRef<HTMLDivElement | null>(null);\n  const previewIframeRef = useRef<HTMLIFrameElement | null>(null);\n  const editorManager = useContext(EditorManagerContext);\n  const [messages, setMessages] = useState([] as Message[]);\n  const [buildProgress, setBuildProgress] = useState({ completed: 0, total: 0 });\n\n  useEffect(() => {\n    const disposable = new DisposableStore();\n    const delayer = new Delayer(500);\n    const throttler = new Throttler();\n\n    let tokenSource = new CancellationTokenSource();\n\n    const queueRefreshPreview = (uris: string[]) => {\n      tokenSource.cancel();\n      tokenSource.dispose();\n\n      tokenSource = new CancellationTokenSource();\n\n      for (const uri of uris) {\n        invalidations.current.add(uri);\n      }\n\n      delayer.trigger(() => throttler.queue(() => refreshPreview(tokenSource.token)));\n    };\n\n    const refreshPreview = async (token: Monaco.CancellationToken) => {\n      const toInvalidate = Array.from(invalidations.current);\n\n      setMessages([]);\n\n      invalidations.current.clear();\n\n      setBuildProgress({ completed: 0, total: 0 });\n\n      let building = true;\n\n      try {\n        await Promise.all(\n          toInvalidate.map(spec => {\n            return editorManager.bundler.invalidate(spec, { token });\n          })\n        );\n\n        const unresolvedEntrypointHref = Monaco.Uri.file('/').toString(true);\n        const resolvedEntrypoint = await editorManager.bundler.resolver.resolve(unresolvedEntrypointHref);\n\n        if (!resolvedEntrypoint.resolvedUrl) {\n          throw new Error(`Unable to determine the entrypoing to your code`);\n        }\n\n        const resolvedEntrypointHref = resolvedEntrypoint.resolvedUrl.href;\n\n        const bundle = await editorManager.bundler.generateBundleCode([resolvedEntrypointHref], {\n          dependencies: {\n            'error-stack-parser': '^2.0.4',\n          },\n          onCompleteAsset: () => {\n            if (building) {\n              setBuildProgress(buildProgress => {\n                return {\n                  completed: buildProgress.completed + 1,\n                  total: buildProgress.total,\n                };\n              });\n            }\n          },\n          onEnqueueAsset: () => {\n            if (building) {\n              setBuildProgress(buildProgress => {\n                return {\n                  completed: buildProgress.completed,\n                  total: buildProgress.total + 1,\n                };\n              });\n            }\n          },\n          sourceMap: true,\n          requireEntrypoints: true,\n          token,\n        });\n\n        const errorWatcher = new File([`(${createRuntime.toString()})();`], 'watcher.js', {\n          type: 'text/javascript',\n        });\n        const bundleFile = new File([bundle], resolvedEntrypointHref, {\n          type: 'text/javascript',\n        });\n        const markup = new File(\n          [\n            `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n<title>Document</title>\n<script src=\"${URL.createObjectURL(errorWatcher)}\"></script>\n</head>\n<body>\n<div id=\"root\"></div>\n<script src=\"${URL.createObjectURL(bundleFile)}\"></script>\n</body>\n</html>`,\n          ],\n          Monaco.Uri.file('/index.html').toString(true),\n          {\n            type: 'text/html',\n          }\n        );\n        const htmlUrl = URL.createObjectURL(markup);\n        const iframe = document.createElement('iframe');\n        iframe.style.display = 'none';\n        iframe.src = htmlUrl;\n\n        if (previewWrapRef.current) {\n          previewWrapRef.current.appendChild(iframe);\n        }\n\n        try {\n          await new Promise((resolve, reject) => {\n            iframe.onload = () => resolve();\n            iframe.onerror = reject;\n          });\n\n          if (previewIframeRef.current) {\n            previewIframeRef.current.remove();\n          }\n\n          iframe.style.display = '';\n\n          previewIframeRef.current = iframe;\n        } catch (err) {\n          iframe.remove();\n\n          throw err;\n        }\n      } catch (err) {\n        if (err && err.name !== 'CanceledError') {\n          setMessages(messages => [...messages, { lines: [{ isInternal: false, text: err.message }] }]);\n        }\n      } finally {\n        if (tokenSource) {\n          tokenSource.cancel();\n          tokenSource.dispose();\n        }\n\n        building = false;\n\n        setBuildProgress({ completed: 0, total: 0 });\n      }\n    };\n\n    disposable.add(delayer);\n\n    for (const model of Monaco.editor.getModels()) {\n      disposable.add(\n        model.onDidChangeContent(() => {\n          queueRefreshPreview([model.uri.toString(true)]);\n        })\n      );\n    }\n\n    disposable.add(\n      Monaco.editor.onDidCreateModel(model => {\n        queueRefreshPreview([model.uri.toString(true)]);\n\n        disposable.add(\n          model.onDidChangeContent(() => {\n            queueRefreshPreview([model.uri.toString(true)]);\n          })\n        );\n      })\n    );\n\n    disposable.add(\n      Monaco.editor.onWillDisposeModel(model => {\n        queueRefreshPreview([model.uri.toString(true)]);\n      })\n    );\n\n    disposable.add(\n      (() => {\n        const onMessage = async (e: MessageEvent) => {\n          console.log('message event', e.data);\n          if (e.data && e.data.type === 'error' && e.data.payload) {\n            const readCache = new Map<string, { code: string; sourceMap?: any }>();\n\n            const read = async (href: string): Promise<string> => {\n              let code: string;\n\n              if (href.startsWith('blob:')) {\n                code = await fetch(href).then(res => res.text());\n              } else if (href.startsWith('data:')) {\n                const match = href.match(/^data:[^;]+;(?:charset=([^;]+);)?(?:(base64),)?(.*)$/);\n\n                if (!match) {\n                  throw new Error(`Unexpected data URI: '${href}'`);\n                }\n\n                code = match[3];\n\n                if (match[2].toLowerCase() === 'base64') {\n                  code = base64.decode(code);\n                }\n              } else {\n                const buf = await editorManager.bundler.resolver.host.readFileContent(\n                  editorManager.bundler.resolver,\n                  new URL(href)\n                );\n                code = editorManager.bundler.resolver.decoder.decode(buf);\n              }\n\n              return code;\n            };\n\n            const readSource = async (href: string): Promise<{ code: string; sourceMap?: MappedSourceMap }> => {\n              if (readCache.has(href)) {\n                return readCache.get(href) as { code: string; sourceMap?: MappedSourceMap };\n              }\n\n              const code = await read(href);\n              const sourceMappingUrl = getSourceMappingUrl(code);\n              let sourceMap: any = undefined;\n\n              if (sourceMappingUrl) {\n                const sourceMapText = await read(sourceMappingUrl);\n                sourceMap = JSON.parse(sourceMapText);\n\n                if (sourceMap.mappings) {\n                  sourceMap.mappings = decode(sourceMap.mappings);\n                }\n              }\n\n              const result = { code, sourceMap };\n\n              readCache.set(href, result);\n\n              return result;\n            };\n\n            let frames = [] as CallSite[];\n\n            if (Array.isArray(e.data.payload.frames)) {\n              try {\n                frames = await Promise.all(\n                  e.data.payload.frames.map(async (frameOptions: CallSiteOptions) => {\n                    let frame = new CallSite(frameOptions);\n                    const href = frame.getFileName();\n                    const line = frame.getLineNumber();\n                    const column = frame.getColumnNumber();\n\n                    if (href && line && Number.isInteger(line) && column && Number.isInteger(column)) {\n                      const result = await readSource(href);\n\n                      if (!result.sourceMap) {\n                        return frame.with({\n                          isInternal: true,\n                        });\n                      }\n\n                      const mappings = result.sourceMap.mappings[line - 1];\n\n                      if (!mappings || !mappings.length) {\n                        return frame.with({\n                          isInternal: true,\n                        });\n                      }\n\n                      let mapping = mappings[0];\n\n                      for (let i = 1; i < mappings.length; i++) {\n                        const sourceColumn = mappings[i][0];\n\n                        if (sourceColumn > column) {\n                          break;\n                        }\n\n                        mapping = mappings[i];\n                      }\n\n                      // We should now have the 'right' mapping\n\n                      // [ generatedCodeColumn, sourceIndex, sourceCodeLine, sourceCodeColumn, nameIndex ]\n                      const sourceFileIndex = mapping[1];\n                      const sourceFile =\n                        sourceFileIndex !== undefined ? result.sourceMap.sources[sourceFileIndex] : undefined;\n                      const sourceLine = mapping[2];\n                      const sourceColumn = mapping[3];\n\n                      if (sourceLine === undefined || sourceFile === undefined) {\n                        return frame.with({\n                          isInternal: true,\n                        });\n                      }\n\n                      return frame.with({\n                        isInternal: false,\n                        columnNumber: sourceColumn,\n                        lineNumber: sourceLine + 1, // the mappings are 0-indexed\n                        fileName: sourceFile.replace(/^file:\\/\\/\\//, ''),\n                      });\n                    }\n\n                    return frame;\n                  })\n                );\n              } catch (err) {\n                console.warn({ err, trace: e.data.payload.frames }, 'Error resolving source locations for stack trace');\n              }\n\n              console.log('frames', frames);\n              console.log('stack', frames.map(frame => frame.toString()).join('\\n'));\n            }\n\n            setMessages(messages => [...messages, { lines: CallSite.prepareStackTrace(e.data.payload, frames) }]);\n          }\n        };\n\n        window.addEventListener('message', onMessage);\n        return {\n          dispose() {\n            window.removeEventListener('message', onMessage);\n          },\n        };\n      })()\n    );\n\n    queueRefreshPreview([]);\n\n    return () => disposable.dispose();\n  }, [editorManager.bundler, invalidations]);\n\n  return (\n    <PreviewWrap className={props.className}>\n      <PreviewProgress completed={buildProgress.completed} total={buildProgress.total}></PreviewProgress>\n      {previewIframeRef.current ? null : 'Building the preview...'}\n      <PreviewIframeWrap ref={previewWrapRef}></PreviewIframeWrap>\n      <PreviewMessages>\n        {messages.map((message, idx) => (\n          <PreviewMessage key={idx} message={message}></PreviewMessage>\n        ))}\n      </PreviewMessages>\n    </PreviewWrap>\n  );\n};\n\nexport default styled(Preview)``;\n\ndeclare var Velcro: { runtime: typeof runtime };\n\nfunction createRuntime() {\n  window.onerror = function(_msg, url, lineNo, columnNo, err) {\n    if (!(err instanceof Error)) {\n      err = Object.assign(new Error(String(err) || 'Unknown error'), { name: 'UnknownError' });\n    }\n\n    let frames: CallSiteOptions[] | undefined = undefined;\n\n    try {\n      const parser = Velcro.runtime.require('error-stack-parser') as typeof import('error-stack-parser');\n\n      frames = parser.parse(err).map(frame => {\n        const callsite: CallSiteOptions = {\n          columnNumber: frame.getColumnNumber(),\n          functionName: frame.getFunctionName(),\n          fileName: frame.getFileName(),\n          isConstructor: frame.getIsConstructor(),\n          isEval: frame.getIsEval(),\n          isNative: frame.getIsNative(),\n          isToplevel: frame.getIsToplevel(),\n          lineNumber: frame.getLineNumber(),\n        };\n\n        return callsite;\n      });\n    } catch (_) {\n      // Swallow this\n    }\n\n    const payload = { frames, url, lineNo, columnNo, name: err.name } as Record<\n      string,\n      string | CallSiteOptions[] | number\n    >;\n\n    for (const key of Object.getOwnPropertyNames(err)) {\n      payload[key] = (err as any)[key];\n    }\n\n    window.parent.postMessage({ type: 'error', payload }, '*');\n  };\n}\n\ninterface MappedSourceMap {\n  file?: string;\n  mappings: SourceMapMappings;\n  names: string[];\n  sources: string[];\n  sourcesContent: string[];\n  version: 3;\n}\n","import styled from '@emotion/styled/macro';\nimport * as Monaco from 'monaco-editor';\nimport React, { useContext, useRef } from 'react';\nimport { useDirectory, EntryKind } from '../lib/hooks';\nimport { useActiveModel, EditorManagerContext } from '../lib/EditorManager';\n\nconst Entry = styled.div<{ modelFocused: boolean }>`\n  background-color: ${props => (props.modelFocused ? '#008cba' : 'inherit')};\n  text-decoration: none;\n  color: ${props => (props.modelFocused ? '#fff' : '#262626')};\n\n  height: 25px;\n  padding: 0 0 0 8px;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n\n  & > span {\n    flex: 1;\n  }\n\n  & > button {\n    display: none;\n  }\n\n  &:hover > button {\n    display: block;\n  }\n\n  ${props =>\n    props.modelFocused\n      ? {\n          ':hover': {\n            color: '#f5f5f5',\n            cursor: 'pointer',\n          },\n        }\n      : {\n          ':hover': {\n            backgroundColor: '#eee',\n            color: '#262626',\n            cursor: 'pointer',\n          },\n        }}\n`;\n\nconst CreateEntry = styled.div`\n  text-decoration: none;\n  color: '#262626';\n\n  height: 25px;\n  padding: 0 0 0 8px;\n  display: flex;\n  align-items: center;\n\n  :hover {\n    background-color: #eee;\n    cursor: pointer;\n  }\n`;\n\nconst SidebarFileDelete = styled.button`\n  border: none;\n  background: none;\n`;\n\nconst SidebarFile: React.FC<{ className?: string; model: Monaco.editor.ITextModel }> = ({ className, model }) => {\n  const activeModel = useActiveModel();\n  const editorManager = useContext(EditorManagerContext);\n\n  const onClickDelete = () => {\n    model.dispose();\n  };\n\n  return (\n    <Entry className={className} modelFocused={model === activeModel}>\n      <span onClick={() => editorManager.focusModel(model)}>{model.uri.fsPath.slice(1)}</span>\n      <SidebarFileDelete onClick={() => onClickDelete()}>❌</SidebarFileDelete>\n    </Entry>\n  );\n};\n\nconst Sidebar: React.FC<{ className?: string }> = props => {\n  const rootDir = useRef(Monaco.Uri.file('/'));\n  const entries = useDirectory(rootDir.current);\n  const editorManager = useContext(EditorManagerContext);\n\n  const onClickCreate = () => {\n    const filename = prompt('Filename?');\n\n    if (filename) {\n      editorManager.createModel(filename);\n    }\n  };\n\n  return (\n    <div className={props.className}>\n      {entries.map(entry =>\n        entry.type === EntryKind.Directory ? (\n          <div>{entry.uri.fsPath.slice(1)}</div>\n        ) : (\n          <SidebarFile key={entry.uri.toString(true)} model={entry.model}></SidebarFile>\n        )\n      )}\n      <CreateEntry onClick={() => onClickCreate()}>Create...</CreateEntry>\n    </div>\n  );\n};\n\nexport default styled(Sidebar)`\n  display: flex;\n  flex-direction: column;\n`;\n","import styled from '@emotion/styled/macro';\nimport React from 'react';\n\nimport Editor from './Editor';\nimport Preview from './Preview';\nimport Sidebar from './Sidebar';\nimport { EditorManager, EditorManagerContext } from '../lib/EditorManager';\n\nconst App: React.FC<{ className?: string; initialPath: string; project: Record<string, string> }> = ({\n  className,\n  initialPath,\n  project,\n}) => {\n  const editorManager = new EditorManager({ files: project, initialPath: initialPath });\n\n  return (\n    <div className={className}>\n      <EditorManagerContext.Provider value={editorManager}>\n        <Sidebar></Sidebar>\n        <Editor></Editor>\n        <Preview></Preview>\n      </EditorManagerContext.Provider>\n    </div>\n  );\n};\n\nexport default styled(App)`\n  display: flex;\n  flex-direction: row;\n\n  font-family: Open Sans, Helvetica Neue, Helvetica, Arial, sans-serif;\n  font-size: 14px;\n  line-height: 1.4;\n  color: #222;\n\n  ${Sidebar} {\n    flex: 1 1 200px;\n    min-width: 150px;\n    max-width: 400px;\n    border-right: 1px solid #ccc;\n  }\n\n  ${Editor} {\n    border-right: 1px solid #ccc;\n  }\n\n  ${Editor}, ${Preview} {\n    flex: 10;\n  }\n`;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n// import 'modern-css-reset';\n\nimport App from './components/App';\nimport * as serviceWorker from './serviceWorker';\nimport styled from '@emotion/styled';\n\nconst project = {\n  'package.json':\n    JSON.stringify(\n      {\n        dependencies: {\n          '@emotion/styled': '^10.0.17',\n          react: '^16.9.0',\n          'react-dom': '^16.9.0',\n        },\n      },\n      null,\n      2\n    ) + '\\n',\n  'index.jsx':\n    `\nimport React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\nimport styled from '@emotion/styled';\n\nimport { name } from './name';\n\nconst Red = styled.div\\`\n  color: green;\n\\`;\n\nclass Hello extends Component {\n  render() {\n    return <Red>Hello {this.props.toWhat}</Red>;\n  }\n}\n\nReactDOM.render(\n  <Hello toWhat={ name } />,\n  document.getElementById('root')\n);\n      `.trim() + '\\n',\n  'name.js':\n    `\nexport const name = 'World';\n\nthrow new Error('Test');\n    `.trim() + '\\n',\n};\n\nconst AppWrap = styled.div`\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n\n  background: #333;\n\n  ${App} {\n    flex: 0 0 80vh;\n    width: 80vw;\n    background: white;\n    box-shadow: 0 19px 38px rgba(0, 0, 0, 0.3), 0 15px 12px rgba(0, 0, 0, 0.22);\n    max-height: 90vh;\n  }\n`;\n\nReactDOM.render(\n  <AppWrap>\n    <App initialPath=\"index.jsx\" project={project} />\n  </AppWrap>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","import _defineProperty from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/regenerator\";\nimport _slicedToArray from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _asyncToGenerator from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _possibleConstructorReturn from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _wrapNativeSuper from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper\";\nimport _classCallCheck from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { CancellationTokenSource, CanceledError } from 'ts-primitives';\nexport { CanceledError, CancellationToken, CancellationTokenSource } from 'ts-primitives';\nvar ResolvedEntryKind;\n\n(function (ResolvedEntryKind) {\n  ResolvedEntryKind[\"Directory\"] = \"directory\";\n  ResolvedEntryKind[\"File\"] = \"file\";\n})(ResolvedEntryKind || (ResolvedEntryKind = {}));\n\nfunction isValidPackageJson(json) {\n  return typeof json === 'object' && json !== null && !hasInvalidOptionalStringField(json, 'name') && !hasInvalidOptionalStringField(json, 'version') && !hasInvalidBrowserField(json) && !hasInvalidOptionalStringField(json, 'main') && !hasInvalidOptionalStringField(json, 'module') && !hasInvalidOptionalStringField(json, 'jsnext:main') && !hasInvalidOptionalStringField(json, 'unpkg') && !hasInvalidDependenciesField(json, 'dependencies') && !hasInvalidDependenciesField(json, 'devDependencies') && !hasInvalidDependenciesField(json, 'peerDependencies');\n}\n\nfunction hasInvalidBrowserField(json) {\n  var error = '';\n  var browser = json.browser;\n\n  if (browser) {\n    if (typeof browser === 'object') {\n      for (var key in browser) {\n        if (typeof key !== 'string') {\n          error = \"The key \".concat(key, \" of .browser must be a string\");\n          break;\n        }\n\n        if (typeof browser[key] !== 'string' && browser[key] !== false) {\n          error = \"The value \".concat(key, \" of .browser must be a string or false\");\n          break;\n        }\n      }\n    }\n  }\n\n  return error;\n}\n\nfunction hasInvalidOptionalStringField(json, field) {\n  return json[field] !== undefined && typeof json[field] !== 'string';\n}\n\nfunction hasInvalidDependenciesField(json, field) {\n  return json[field] !== undefined && typeof json[field] === 'object' && json[field] !== null && !Object.keys(json[field]).every(function (key) {\n    return typeof key === 'string' && typeof json[field][key] === 'string';\n  });\n}\n\nvar CHAR_DOT = 46;\n/* . */\n\nvar CHAR_FORWARD_SLASH = 47;\n/* / */\n\nvar TRAILING_SLASH_RX = /\\/?$/;\n\nfunction ensureTrailingSlash(pathname) {\n  return pathname.replace(TRAILING_SLASH_RX, '/');\n}\n\nfunction parseBufferAsPackageJson(decoder, content, spec) {\n  try {\n    var text = decoder.decode(content);\n    return parseTextAsPackageJson(text, spec);\n  } catch (err) {\n    throw new Error(\"Error decoding manifest buffer for package \".concat(spec, \": \").concat(err.message));\n  }\n}\n\nfunction parseTextAsPackageJson(text, spec) {\n  var json;\n\n  try {\n    json = JSON.parse(text);\n  } catch (err) {\n    throw new Error(\"Error parsing manifest as json for package \".concat(spec, \": \").concat(err.message));\n  }\n\n  if (!isValidPackageJson(json)) {\n    throw new Error(\"Invalid manifest for the package \".concat(spec));\n  }\n\n  return json;\n}\n\nfunction getFirstPathSegmentAfterPrefix(child, parent) {\n  var childHref = child.pathname;\n  var parentHref = parent.pathname;\n  var parentOffset = parentHref.charAt(parentHref.length - 1) === '/' ? -1 : 0;\n\n  for (var i = 0; i <= childHref.length; i++) {\n    if (i < parentHref.length) {\n      if (childHref.charAt(i) !== parentHref.charAt(i)) {\n        throw new Error(\"The child entry \".concat(child.href, \" does not have the pathname of \").concat(parent.href, \" as a prefix\"));\n      }\n    } else if (i === parentHref.length + parentOffset) {\n      if (childHref.charAt(i) !== '/') {\n        throw new Error(\"The child entry \".concat(child.href, \" does not have the pathname of \").concat(parent.href, \" as a prefix\"));\n      }\n    } else if (childHref.charAt(i) === '/') {\n      return childHref.slice(parentHref.length + 1 + parentOffset, i);\n    }\n  }\n\n  return childHref.slice(parentHref.length + 1 + parentOffset);\n}\n\nfunction validateString(value, name) {\n  if (typeof value !== 'string') {\n    throw new TypeError(\"The '\".concat(name, \"' argument must be of type string but got \").concat(typeof value));\n  }\n}\n\nfunction basename(path, ext) {\n  if (ext !== undefined) {\n    validateString(ext, 'ext');\n  }\n\n  validateString(path, 'path');\n  var start = 0;\n  var end = -1;\n  var matchedSlash = true;\n  var i;\n\n  if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {\n    if (ext.length === path.length && ext === path) {\n      return '';\n    }\n\n    var extIdx = ext.length - 1;\n    var firstNonSlashEnd = -1;\n\n    for (i = path.length - 1; i >= start; --i) {\n      var code = path.charCodeAt(i);\n\n      if (isPathSeparator(code)) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          start = i + 1;\n          break;\n        }\n      } else {\n        if (firstNonSlashEnd === -1) {\n          // We saw the first non-path separator, remember this index in case\n          // we need it if the extension ends up not matching\n          matchedSlash = false;\n          firstNonSlashEnd = i + 1;\n        }\n\n        if (extIdx >= 0) {\n          // Try to match the explicit extension\n          if (code === ext.charCodeAt(extIdx)) {\n            if (--extIdx === -1) {\n              // We matched the extension, so mark this as the end of our path\n              // component\n              end = i;\n            }\n          } else {\n            // Extension does not match, so our result is the entire path\n            // component\n            extIdx = -1;\n            end = firstNonSlashEnd;\n          }\n        }\n      }\n    }\n\n    if (start === end) {\n      end = firstNonSlashEnd;\n    } else if (end === -1) {\n      end = path.length;\n    }\n\n    return path.slice(start, end);\n  } else {\n    for (i = path.length - 1; i >= start; --i) {\n      if (isPathSeparator(path.charCodeAt(i))) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          start = i + 1;\n          break;\n        }\n      } else if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // path component\n        matchedSlash = false;\n        end = i + 1;\n      }\n    }\n\n    if (end === -1) {\n      return '';\n    }\n\n    return path.slice(start, end);\n  }\n}\n\nfunction extname(path) {\n  validateString(path, 'path');\n  var start = 0;\n  var startDot = -1;\n  var startPart = 0;\n  var end = -1;\n  var matchedSlash = true; // Track the state of characters (if any) we see before our first dot and\n  // after any path separator we find\n\n  var preDotState = 0;\n\n  for (var i = path.length - 1; i >= start; --i) {\n    var code = path.charCodeAt(i);\n\n    if (isPathSeparator(code)) {\n      // If we reached a path separator that was not part of a set of path\n      // separators at the end of the string, stop now\n      if (!matchedSlash) {\n        startPart = i + 1;\n        break;\n      }\n\n      continue;\n    }\n\n    if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // extension\n      matchedSlash = false;\n      end = i + 1;\n    }\n\n    if (code === CHAR_DOT) {\n      // If this is our first dot, mark it as the start of our extension\n      if (startDot === -1) {\n        startDot = i;\n      } else if (preDotState !== 1) {\n        preDotState = 1;\n      }\n    } else if (startDot !== -1) {\n      // We saw a non-dot and non-path separator before our dot, so we should\n      // have a good chance at having a non-empty extension\n      preDotState = -1;\n    }\n  }\n\n  if (startDot === -1 || end === -1 || // We saw a non-dot character immediately before the dot\n  preDotState === 0 || // The (right-most) trimmed path component is exactly '..'\n  preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {\n    return '';\n  }\n\n  return path.slice(startDot, end);\n}\n\nfunction dirname(path) {\n  validateString(path, 'path');\n  var len = path.length;\n\n  if (len === 0) {\n    return '.';\n  }\n\n  var rootEnd = -1;\n  var end = -1;\n  var matchedSlash = true;\n  var offset = 0;\n  var code = path.charCodeAt(0); // Try to match a root\n\n  if (len > 1) {\n    if (isPathSeparator(code)) {\n      // Possible UNC root\n      rootEnd = offset = 1;\n\n      if (isPathSeparator(path.charCodeAt(1))) {\n        // Matched double path separator at beginning\n        var j = 2;\n        var last = j; // Match 1 or more non-path separators\n\n        for (; j < len; ++j) {\n          if (isPathSeparator(path.charCodeAt(j))) {\n            break;\n          }\n        }\n\n        if (j < len && j !== last) {\n          // Matched!\n          last = j; // Match 1 or more path separators\n\n          for (; j < len; ++j) {\n            if (!isPathSeparator(path.charCodeAt(j))) {\n              break;\n            }\n          }\n\n          if (j < len && j !== last) {\n            // Matched!\n            last = j; // Match 1 or more non-path separators\n\n            for (; j < len; ++j) {\n              if (isPathSeparator(path.charCodeAt(j))) {\n                break;\n              }\n            }\n\n            if (j === len) {\n              // We matched a UNC root only\n              return path;\n            }\n\n            if (j !== last) {\n              // We matched a UNC root with leftovers\n              // Offset by 1 to include the separator after the UNC root to\n              // treat it as a \"normal root\" on top of a (UNC) root\n              rootEnd = offset = j + 1;\n            }\n          }\n        }\n      }\n    }\n  } else if (isPathSeparator(code)) {\n    // `path` contains just a path separator, exit early to avoid\n    // unnecessary work\n    return path;\n  }\n\n  for (var i = len - 1; i >= offset; --i) {\n    if (isPathSeparator(path.charCodeAt(i))) {\n      if (!matchedSlash) {\n        end = i;\n        break;\n      }\n    } else {\n      // We saw the first non-path separator\n      matchedSlash = false;\n    }\n  }\n\n  if (end === -1) {\n    if (rootEnd === -1) {\n      return '.';\n    } else {\n      end = rootEnd;\n    }\n  }\n\n  return path.slice(0, end);\n}\n\nfunction join(initialSegment) {\n  var pathname = initialSegment;\n\n  for (var i = 0; i < (arguments.length <= 1 ? 0 : arguments.length - 1); i++) {\n    var segment = i + 1 < 1 || arguments.length <= i + 1 ? undefined : arguments[i + 1];\n\n    if (segment.startsWith('/')) {\n      segment = segment.slice(1);\n    }\n\n    if (pathname.endsWith('/')) {\n      pathname += segment;\n    } else {\n      pathname += \"/\".concat(segment);\n    }\n  }\n\n  return pathname;\n}\n\nfunction resolve() {\n  var resolvedPath = '';\n  var resolvedAbsolute = false;\n\n  for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n    var path = void 0;\n\n    if (i >= 0) {\n      path = i < 0 || arguments.length <= i ? undefined : arguments[i];\n    } else {\n      break;\n    }\n\n    validateString(path, 'path'); // Skip empty entries\n\n    if (path.length === 0) {\n      continue;\n    }\n\n    resolvedPath = path + '/' + resolvedPath;\n    resolvedAbsolute = path.charCodeAt(0) === CHAR_FORWARD_SLASH;\n  } // At this point the path should be resolved to a full absolute path, but\n  // handle relative paths to be safe (might happen when process.cwd() fails)\n  // Normalize the path\n\n\n  resolvedPath = normalizeString(resolvedPath, !resolvedAbsolute, '/', isPathSeparator);\n\n  if (resolvedAbsolute) {\n    if (resolvedPath.length > 0) {\n      return '/' + resolvedPath;\n    } else {\n      return '/';\n    }\n  } else if (resolvedPath.length > 0) {\n    return resolvedPath;\n  } else {\n    return '.';\n  }\n}\n\nfunction isPathSeparator(code) {\n  return code === CHAR_FORWARD_SLASH;\n}\n\nfunction normalizeString(path, allowAboveRoot, separator, isPathSeparator) {\n  var res = '';\n  var lastSegmentLength = 0;\n  var lastSlash = -1;\n  var dots = 0;\n  var code = -1;\n\n  for (var i = 0; i <= path.length; ++i) {\n    if (i < path.length) {\n      code = path.charCodeAt(i);\n    } else if (isPathSeparator(code)) {\n      break;\n    } else {\n      code = CHAR_FORWARD_SLASH;\n    }\n\n    if (isPathSeparator(code)) {\n      if (lastSlash === i - 1 || dots === 1) ;else if (lastSlash !== i - 1 && dots === 2) {\n        if (res.length < 2 || lastSegmentLength !== 2 || res.charCodeAt(res.length - 1) !== CHAR_DOT || res.charCodeAt(res.length - 2) !== CHAR_DOT) {\n          if (res.length > 2) {\n            var lastSlashIndex = res.lastIndexOf(separator);\n\n            if (lastSlashIndex === -1) {\n              res = '';\n              lastSegmentLength = 0;\n            } else {\n              res = res.slice(0, lastSlashIndex);\n              lastSegmentLength = res.length - 1 - res.lastIndexOf(separator);\n            }\n\n            lastSlash = i;\n            dots = 0;\n            continue;\n          } else if (res.length === 2 || res.length === 1) {\n            res = '';\n            lastSegmentLength = 0;\n            lastSlash = i;\n            dots = 0;\n            continue;\n          }\n        }\n\n        if (allowAboveRoot) {\n          if (res.length > 0) {\n            res += \"\".concat(separator, \"..\");\n          } else {\n            res = '..';\n          }\n\n          lastSegmentLength = 2;\n        }\n      } else {\n        if (res.length > 0) {\n          res += separator + path.slice(lastSlash + 1, i);\n        } else {\n          res = path.slice(lastSlash + 1, i);\n        }\n\n        lastSegmentLength = i - lastSlash - 1;\n      }\n      lastSlash = i;\n      dots = 0;\n    } else if (code === CHAR_DOT && dots !== -1) {\n      ++dots;\n    } else {\n      dots = -1;\n    }\n  }\n\n  return res;\n}\n\nvar util =\n/*#__PURE__*/\nObject.freeze({\n  __proto__: null,\n  ensureTrailingSlash: ensureTrailingSlash,\n  parseBufferAsPackageJson: parseBufferAsPackageJson,\n  getFirstPathSegmentAfterPrefix: getFirstPathSegmentAfterPrefix,\n  basename: basename,\n  extname: extname,\n  dirname: dirname,\n  join: join,\n  resolve: resolve\n});\n\nvar Decoder =\n/*#__PURE__*/\nfunction () {\n  function Decoder() {\n    _classCallCheck(this, Decoder);\n\n    if (typeof TextDecoder !== 'undefined') {\n      this.decoder = new TextDecoder();\n    }\n  }\n\n  _createClass(Decoder, [{\n    key: \"decode\",\n    value: function decode(buf) {\n      var str = this.decoder ? this.decoder.decode(buf) : Buffer.from(buf).toString('utf-8');\n      return str.charCodeAt(0) === 0xfeff ? str.slice(1) : str;\n    }\n  }]);\n\n  return Decoder;\n}();\n\nvar ExtendableError =\n/*#__PURE__*/\nfunction (_Error) {\n  _inherits(ExtendableError, _Error);\n\n  function ExtendableError(message) {\n    var _this;\n\n    _classCallCheck(this, ExtendableError);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ExtendableError).call(this, message));\n    _this.name = _this.constructor.name;\n\n    if (typeof Error.captureStackTrace === 'function') {\n      Error.captureStackTrace(_assertThisInitialized(_this), _this.constructor);\n    } else {\n      _this.stack = new Error(message).stack;\n    }\n\n    return _this;\n  }\n\n  return ExtendableError;\n}(_wrapNativeSuper(Error));\n\nvar EntryNotFoundError =\n/*#__PURE__*/\nfunction (_ExtendableError) {\n  _inherits(EntryNotFoundError, _ExtendableError);\n\n  function EntryNotFoundError(url) {\n    var _this2;\n\n    _classCallCheck(this, EntryNotFoundError);\n\n    _this2 = _possibleConstructorReturn(this, _getPrototypeOf(EntryNotFoundError).call(this, \"Not found \".concat(url.href)));\n    _this2.url = url;\n    return _this2;\n  }\n\n  return EntryNotFoundError;\n}(ExtendableError);\n\nvar AbstractResolverHost =\n/*#__PURE__*/\nfunction () {\n  function AbstractResolverHost() {\n    _classCallCheck(this, AbstractResolverHost);\n  }\n\n  _createClass(AbstractResolverHost, [{\n    key: \"getCanonicalUrl\",\n    value: function getCanonicalUrl(_resolver, url) {\n      return Promise.resolve(url);\n    }\n  }]);\n\n  return AbstractResolverHost;\n}();\n\nvar TRAILING_SLASH_RX$1 = /\\/?$/;\n\nvar Resolver =\n/*#__PURE__*/\nfunction () {\n  function Resolver(host) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Resolver);\n\n    this.host = host;\n    this.decoder = new Decoder();\n    this.extensions = Array.from(options.extensions || Resolver.defaultExtensions);\n    this.packageMain = options.packageMain || ['main'];\n  }\n\n  _createClass(Resolver, [{\n    key: \"resolve\",\n    value: function () {\n      var _resolve = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(url) {\n        var options,\n            token,\n            tokenSource,\n            optionsWithDefaults,\n            canonicalUrlPromise,\n            _ref,\n            _ref2,\n            canonicalUrl,\n            rootUrl,\n            rootHref,\n            rootHrefWithoutTrailingSlash,\n            canonicalHref,\n            resolvedUrl,\n            _args = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                options = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};\n\n                if (url instanceof URL) {\n                  _context.next = 9;\n                  break;\n                }\n\n                _context.prev = 2;\n                url = new URL(url);\n                _context.next = 9;\n                break;\n\n              case 6:\n                _context.prev = 6;\n                _context.t0 = _context[\"catch\"](2);\n                throw new Error(\"Invalid URL: \".concat(url, \": \").concat(_context.t0.message));\n\n              case 9:\n                token = options.token;\n\n                if (!token) {\n                  tokenSource = new CancellationTokenSource();\n                  token = tokenSource.token;\n                }\n\n                optionsWithDefaults = {\n                  extensions: options.extensions || this.extensions,\n                  ignoreBrowserOverrides: typeof options.ignoreBrowserOverrides === 'undefined' ? false : options.ignoreBrowserOverrides,\n                  packageMain: options.packageMain || this.packageMain,\n                  token: token\n                };\n                canonicalUrlPromise = this.host.getCanonicalUrl ? this.host.getCanonicalUrl(this, url, {\n                  token: token\n                }) : Promise.resolve(url);\n\n                if (!token.isCancellationRequested) {\n                  _context.next = 15;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 15:\n                _context.next = 17;\n                return Promise.all([canonicalUrlPromise, this.host.getResolveRoot(this, url, {\n                  token: token\n                })]);\n\n              case 17:\n                _ref = _context.sent;\n                _ref2 = _slicedToArray(_ref, 2);\n                canonicalUrl = _ref2[0];\n                rootUrl = _ref2[1];\n\n                if (!token.isCancellationRequested) {\n                  _context.next = 23;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 23:\n                rootHref = rootUrl.href;\n                rootHrefWithoutTrailingSlash = rootHref.replace(TRAILING_SLASH_RX$1, '');\n                canonicalHref = canonicalUrl.href;\n\n                if (canonicalHref.startsWith(rootHrefWithoutTrailingSlash)) {\n                  _context.next = 28;\n                  break;\n                }\n\n                throw new Error(\"Unable to resolve a module whose path \".concat(canonicalHref, \" is above the host's root \").concat(rootHref));\n\n              case 28:\n                if (!(rootHrefWithoutTrailingSlash === canonicalHref || rootHref == canonicalHref)) {\n                  _context.next = 34;\n                  break;\n                }\n\n                _context.next = 31;\n                return this.resolveAsDirectory(canonicalUrl, optionsWithDefaults);\n\n              case 31:\n                _context.t1 = _context.sent;\n                _context.next = 37;\n                break;\n\n              case 34:\n                _context.next = 36;\n                return this.resolveAsFile(canonicalUrl, optionsWithDefaults);\n\n              case 36:\n                _context.t1 = _context.sent;\n\n              case 37:\n                resolvedUrl = _context.t1;\n\n                if (!token.isCancellationRequested) {\n                  _context.next = 40;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 40:\n                return _context.abrupt(\"return\", {\n                  ignored: resolvedUrl === false,\n                  resolvedUrl: resolvedUrl || undefined,\n                  rootUrl: rootUrl\n                });\n\n              case 41:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[2, 6]]);\n      }));\n\n      function resolve(_x) {\n        return _resolve.apply(this, arguments);\n      }\n\n      return resolve;\n    }()\n    /**\r\n     * Resolve a reference treating it as a directory\r\n     *\r\n     * 1. If there is a `package.json` file and this has a `main` entry, use that\r\n     * 2. Assume `index` if no main file is found in the `package.json` manifest\r\n     *\r\n     * The outcome of this process will then be resolved as if it were a file.\r\n     */\n\n  }, {\n    key: \"resolveAsDirectory\",\n    value: function () {\n      var _resolveAsDirectory = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(url, options) {\n        var _ref3, _ref4, rootUrl, entries, mainPathname, packageJsonEntry, packageJsonContent, packageJson, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, packageMain, pathname, mainUrl;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return Promise.all([this.host.getResolveRoot(this, url, {\n                  token: options.token\n                }), this.host.listEntries(this, url, {\n                  token: options.token\n                })]);\n\n              case 2:\n                _ref3 = _context2.sent;\n                _ref4 = _slicedToArray(_ref3, 2);\n                rootUrl = _ref4[0];\n                entries = _ref4[1];\n\n                if (!options.token.isCancellationRequested) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 8:\n                mainPathname = 'index'; // Step 1: Look for a package.json with an main field\n\n                packageJsonEntry = entries.find(function (entry) {\n                  return basename(entry.url.pathname) === 'package.json';\n                });\n\n                if (!packageJsonEntry) {\n                  _context2.next = 45;\n                  break;\n                }\n\n                _context2.next = 13;\n                return this.host.readFileContent(this, packageJsonEntry.url, {\n                  token: options.token\n                });\n\n              case 13:\n                packageJsonContent = _context2.sent;\n\n                if (!options.token.isCancellationRequested) {\n                  _context2.next = 16;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 16:\n                packageJson = parseBufferAsPackageJson(this.decoder, packageJsonContent, url.href);\n                _iteratorNormalCompletion = true;\n                _didIteratorError = false;\n                _iteratorError = undefined;\n                _context2.prev = 20;\n                _iterator = this.packageMain[Symbol.iterator]();\n\n              case 22:\n                if (_iteratorNormalCompletion = (_step = _iterator.next()).done) {\n                  _context2.next = 31;\n                  break;\n                }\n\n                packageMain = _step.value;\n                pathname = packageJson[packageMain];\n\n                if (!(typeof pathname === 'string')) {\n                  _context2.next = 28;\n                  break;\n                }\n\n                mainPathname = pathname;\n                return _context2.abrupt(\"break\", 31);\n\n              case 28:\n                _iteratorNormalCompletion = true;\n                _context2.next = 22;\n                break;\n\n              case 31:\n                _context2.next = 37;\n                break;\n\n              case 33:\n                _context2.prev = 33;\n                _context2.t0 = _context2[\"catch\"](20);\n                _didIteratorError = true;\n                _iteratorError = _context2.t0;\n\n              case 37:\n                _context2.prev = 37;\n                _context2.prev = 38;\n\n                if (!_iteratorNormalCompletion && _iterator.return != null) {\n                  _iterator.return();\n                }\n\n              case 40:\n                _context2.prev = 40;\n\n                if (!_didIteratorError) {\n                  _context2.next = 43;\n                  break;\n                }\n\n                throw _iteratorError;\n\n              case 43:\n                return _context2.finish(40);\n\n              case 44:\n                return _context2.finish(37);\n\n              case 45:\n                mainUrl = new URL(resolve(url.pathname, mainPathname), rootUrl);\n                return _context2.abrupt(\"return\", this.resolveAsFile(mainUrl, options));\n\n              case 47:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[20, 33, 37, 45], [38,, 40, 44]]);\n      }));\n\n      function resolveAsDirectory(_x2, _x3) {\n        return _resolveAsDirectory.apply(this, arguments);\n      }\n\n      return resolveAsDirectory;\n    }()\n    /**\r\n     * Resolve a reference treating it as a file\r\n     *\r\n     * 1. List entries in the containing directory\r\n     * 2. Look for an exact file match or a file match with one of the supplied extensions\r\n     * 3. Look for a matching child directory and attempt to resolve that as a directory\r\n     */\n\n  }, {\n    key: \"resolveAsFile\",\n    value: function () {\n      var _resolveAsFile = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(url, options) {\n        var rootUrl, parentPackageJson, browserOverrides, browserMap, packageJsonDir, entry, impliedUrl, targetSpec, target, containingUrl, filename, entries, entryDirectoryMap, entryFileMap, _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, _entry, childFilename, _childFilename, _iteratorNormalCompletion3, _didIteratorError3, _iteratorError3, _iterator3, _step3, ext, mapping, _match, match;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(url.pathname === '' || url.pathname === '/')) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                throw new TypeError(\"Unable to resolve the root as a file: \".concat(url.href));\n\n              case 2:\n                _context3.next = 4;\n                return this.host.getResolveRoot(this, url, {\n                  token: options.token\n                });\n\n              case 4:\n                rootUrl = _context3.sent;\n\n                if (!options.token.isCancellationRequested) {\n                  _context3.next = 7;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 7:\n                if (!(this.packageMain.includes('browser') && !options.ignoreBrowserOverrides)) {\n                  _context3.next = 13;\n                  break;\n                }\n\n                _context3.next = 10;\n                return this.readParentPackageJson(url, {\n                  token: options.token\n                });\n\n              case 10:\n                _context3.t0 = _context3.sent;\n                _context3.next = 14;\n                break;\n\n              case 13:\n                _context3.t0 = undefined;\n\n              case 14:\n                parentPackageJson = _context3.t0;\n\n                if (!options.token.isCancellationRequested) {\n                  _context3.next = 17;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 17:\n                browserOverrides = new Map();\n\n                if (!(parentPackageJson && typeof parentPackageJson.packageJson.browser === 'object')) {\n                  _context3.next = 34;\n                  break;\n                }\n\n                browserMap = parentPackageJson.packageJson.browser;\n                packageJsonDir = dirname(parentPackageJson.url.pathname);\n                _context3.t1 = _regeneratorRuntime.keys(browserMap);\n\n              case 22:\n                if ((_context3.t2 = _context3.t1()).done) {\n                  _context3.next = 34;\n                  break;\n                }\n\n                entry = _context3.t2.value;\n                impliedUrl = new URL(resolve(packageJsonDir, entry), parentPackageJson.url);\n                targetSpec = browserMap[entry];\n                target = targetSpec === false ? false : new URL(resolve(packageJsonDir, targetSpec), parentPackageJson.url);\n\n                if (!(impliedUrl.href === url.href)) {\n                  _context3.next = 31;\n                  break;\n                }\n\n                if (!(target === false)) {\n                  _context3.next = 30;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", false);\n\n              case 30:\n                return _context3.abrupt(\"return\", this.resolveAsFile(target, _objectSpread({}, options, {\n                  ignoreBrowserOverrides: true\n                })));\n\n              case 31:\n                browserOverrides.set(impliedUrl.href, target);\n                _context3.next = 22;\n                break;\n\n              case 34:\n                containingUrl = new URL(ensureTrailingSlash(dirname(url.pathname)), rootUrl);\n                filename = basename(url.pathname);\n                _context3.next = 38;\n                return this.host.listEntries(this, containingUrl, {\n                  token: options.token\n                });\n\n              case 38:\n                entries = _context3.sent;\n\n                if (!options.token.isCancellationRequested) {\n                  _context3.next = 41;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 41:\n                entryDirectoryMap = new Map();\n                entryFileMap = new Map();\n                _iteratorNormalCompletion2 = true;\n                _didIteratorError2 = false;\n                _iteratorError2 = undefined;\n                _context3.prev = 46;\n                _iterator2 = entries[Symbol.iterator]();\n\n              case 48:\n                if (_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done) {\n                  _context3.next = 56;\n                  break;\n                }\n\n                _entry = _step2.value;\n\n                if (!(_entry.url.href === url.href && _entry.type == ResolvedEntryKind.File)) {\n                  _context3.next = 52;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", _entry.url);\n\n              case 52:\n                if (_entry.type === ResolvedEntryKind.Directory) {\n                  childFilename = getFirstPathSegmentAfterPrefix(_entry.url, containingUrl);\n                  entryDirectoryMap.set(childFilename, _entry);\n                } else if (_entry.type === ResolvedEntryKind.File) {\n                  _childFilename = basename(_entry.url.pathname);\n                  entryFileMap.set(_childFilename, _entry);\n                }\n\n              case 53:\n                _iteratorNormalCompletion2 = true;\n                _context3.next = 48;\n                break;\n\n              case 56:\n                _context3.next = 62;\n                break;\n\n              case 58:\n                _context3.prev = 58;\n                _context3.t3 = _context3[\"catch\"](46);\n                _didIteratorError2 = true;\n                _iteratorError2 = _context3.t3;\n\n              case 62:\n                _context3.prev = 62;\n                _context3.prev = 63;\n\n                if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n                  _iterator2.return();\n                }\n\n              case 65:\n                _context3.prev = 65;\n\n                if (!_didIteratorError2) {\n                  _context3.next = 68;\n                  break;\n                }\n\n                throw _iteratorError2;\n\n              case 68:\n                return _context3.finish(65);\n\n              case 69:\n                return _context3.finish(62);\n\n              case 70:\n                // Look for browser overrides\n                _iteratorNormalCompletion3 = true;\n                _didIteratorError3 = false;\n                _iteratorError3 = undefined;\n                _context3.prev = 73;\n                _iterator3 = options.extensions[Symbol.iterator]();\n\n              case 75:\n                if (_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done) {\n                  _context3.next = 92;\n                  break;\n                }\n\n                ext = _step3.value;\n                mapping = browserOverrides.get(\"\".concat(url.href).concat(ext));\n\n                if (!(mapping === false)) {\n                  _context3.next = 82;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", false);\n\n              case 82:\n                if (!mapping) {\n                  _context3.next = 84;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", this.resolveAsFile(mapping, _objectSpread({}, options, {\n                  ignoreBrowserOverrides: true\n                })));\n\n              case 84:\n                _match = entryFileMap.get(\"\".concat(filename).concat(ext));\n\n                if (!_match) {\n                  _context3.next = 89;\n                  break;\n                }\n\n                if (!(_match.type !== ResolvedEntryKind.File)) {\n                  _context3.next = 88;\n                  break;\n                }\n\n                return _context3.abrupt(\"continue\", 89);\n\n              case 88:\n                return _context3.abrupt(\"return\", _match.url);\n\n              case 89:\n                _iteratorNormalCompletion3 = true;\n                _context3.next = 75;\n                break;\n\n              case 92:\n                _context3.next = 98;\n                break;\n\n              case 94:\n                _context3.prev = 94;\n                _context3.t4 = _context3[\"catch\"](73);\n                _didIteratorError3 = true;\n                _iteratorError3 = _context3.t4;\n\n              case 98:\n                _context3.prev = 98;\n                _context3.prev = 99;\n\n                if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n                  _iterator3.return();\n                }\n\n              case 101:\n                _context3.prev = 101;\n\n                if (!_didIteratorError3) {\n                  _context3.next = 104;\n                  break;\n                }\n\n                throw _iteratorError3;\n\n              case 104:\n                return _context3.finish(101);\n\n              case 105:\n                return _context3.finish(98);\n\n              case 106:\n                // First, attempt to find a matching file or directory\n                match = entryDirectoryMap.get(filename);\n\n                if (!match) {\n                  _context3.next = 111;\n                  break;\n                }\n\n                if (!(match.type !== ResolvedEntryKind.Directory)) {\n                  _context3.next = 110;\n                  break;\n                }\n\n                throw new Error(\"Invariant violation \".concat(match.type, \" is unexpected\"));\n\n              case 110:\n                return _context3.abrupt(\"return\", this.resolveAsDirectory(match.url, options));\n\n              case 111:\n                throw new EntryNotFoundError(url);\n\n              case 112:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[46, 58, 62, 70], [63,, 65, 69], [73, 94, 98, 106], [99,, 101, 105]]);\n      }));\n\n      function resolveAsFile(_x4, _x5) {\n        return _resolveAsFile.apply(this, arguments);\n      }\n\n      return resolveAsFile;\n    }()\n  }, {\n    key: \"readParentPackageJson\",\n    value: function () {\n      var _readParentPackageJson = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee5(url) {\n        var _this3 = this;\n\n        var options,\n            hostRootUrl,\n            hostRootHref,\n            containingDirUrl,\n            readPackageJsonOrRecurse,\n            _args5 = arguments;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                options = _args5.length > 1 && _args5[1] !== undefined ? _args5[1] : {};\n                _context5.next = 3;\n                return this.host.getCanonicalUrl(this, url, {\n                  token: options.token\n                });\n\n              case 3:\n                url = _context5.sent;\n\n                if (!(options.token && options.token.isCancellationRequested)) {\n                  _context5.next = 6;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 6:\n                _context5.next = 8;\n                return this.host.getResolveRoot(this, url, {\n                  token: options.token\n                });\n\n              case 8:\n                hostRootUrl = _context5.sent;\n\n                if (!(options.token && options.token.isCancellationRequested)) {\n                  _context5.next = 11;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 11:\n                hostRootHref = ensureTrailingSlash(hostRootUrl.href);\n                containingDirUrl = new URL(ensureTrailingSlash(dirname(url.pathname)), url);\n\n                readPackageJsonOrRecurse =\n                /*#__PURE__*/\n                function () {\n                  var _ref5 = _asyncToGenerator(\n                  /*#__PURE__*/\n                  _regeneratorRuntime.mark(function _callee4(dir) {\n                    var entries, packageJsonEntry, parentPackageJsonContent, packageJson, parentDir;\n                    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            if (dir.href.startsWith(hostRootHref)) {\n                              _context4.next = 2;\n                              break;\n                            }\n\n                            return _context4.abrupt(\"return\", undefined);\n\n                          case 2:\n                            _context4.next = 4;\n                            return _this3.host.listEntries(_this3, dir, {\n                              token: options.token\n                            });\n\n                          case 4:\n                            entries = _context4.sent;\n\n                            if (!(options.token && options.token.isCancellationRequested)) {\n                              _context4.next = 7;\n                              break;\n                            }\n\n                            throw new CanceledError('Canceled');\n\n                          case 7:\n                            packageJsonEntry = entries.find(function (entry) {\n                              return entry.type === ResolvedEntryKind.File && entry.url.pathname.endsWith('/package.json');\n                            });\n\n                            if (!packageJsonEntry) {\n                              _context4.next = 24;\n                              break;\n                            }\n\n                            _context4.prev = 9;\n                            _context4.next = 12;\n                            return _this3.host.readFileContent(_this3, packageJsonEntry.url, {\n                              token: options.token\n                            });\n\n                          case 12:\n                            parentPackageJsonContent = _context4.sent;\n\n                            if (!(options.token && options.token.isCancellationRequested)) {\n                              _context4.next = 15;\n                              break;\n                            }\n\n                            throw new CanceledError('Canceled');\n\n                          case 15:\n                            packageJson = parseBufferAsPackageJson(_this3.decoder, parentPackageJsonContent, packageJsonEntry.url.href);\n                            return _context4.abrupt(\"return\", {\n                              packageJson: packageJson,\n                              url: packageJsonEntry.url\n                            });\n\n                          case 19:\n                            _context4.prev = 19;\n                            _context4.t0 = _context4[\"catch\"](9);\n\n                            if (!(_context4.t0 instanceof CanceledError || _context4.t0 && _context4.t0.name === 'CanceledError')) {\n                              _context4.next = 23;\n                              break;\n                            }\n\n                            throw _context4.t0;\n\n                          case 23:\n                            console.warn(\"Error reading the parent package manifest for \".concat(url.href, \" from \").concat(packageJsonEntry.url.href, \": \").concat(_context4.t0.message));\n\n                          case 24:\n                            // Not found here, let's try one up\n                            parentDir = new URL(ensureTrailingSlash(dirname(dir.pathname)), dir); // Skip infinite recursion\n\n                            if (!(parentDir.href === dir.href)) {\n                              _context4.next = 27;\n                              break;\n                            }\n\n                            return _context4.abrupt(\"return\", undefined);\n\n                          case 27:\n                            return _context4.abrupt(\"return\", readPackageJsonOrRecurse(parentDir));\n\n                          case 28:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _callee4, null, [[9, 19]]);\n                  }));\n\n                  return function readPackageJsonOrRecurse(_x7) {\n                    return _ref5.apply(this, arguments);\n                  };\n                }();\n\n                return _context5.abrupt(\"return\", readPackageJsonOrRecurse(containingDirUrl));\n\n              case 15:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function readParentPackageJson(_x6) {\n        return _readParentPackageJson.apply(this, arguments);\n      }\n\n      return readParentPackageJson;\n    }()\n  }]);\n\n  return Resolver;\n}();\n\nResolver.defaultExtensions = ['.js', '.jsx', '.es6', '.es', '.mjs', '.ts', '.tsx', '.json'];\nResolver.path = {\n  basename: basename,\n  dirname: dirname,\n  extname: extname,\n  resolve: resolve\n};\nexport { AbstractResolverHost, Decoder, EntryNotFoundError, ResolvedEntryKind, Resolver, isValidPackageJson, util };"],"sourceRoot":""}
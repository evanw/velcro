{"version":3,"sources":["lib/typeAcquisition.ts","../../bundler/dist/dist-module/index.js","../../resolver-host-compound/dist/dist-module/index.js","lib/error.ts","lib/ResolverHostMonaco.ts","../../resolver-host-unpkg/dist/dist-module/index.js","lib/ResolverHostWithCache.ts","lib/EditorManager.ts","components/Editor.tsx","components/Preview.tsx","lib/hooks.ts","components/Sidebar.tsx","components/App.tsx","serviceWorker.ts","index.tsx","../../resolver/dist/dist-module/index.js"],"names":["PackageEntryKind","HAS_D_TS_EXTENSION","getTypingsModuleSpec","pkgJson","typingsName","name","charAt","slice","replace","typingsRange","version","major","split","range","TypeAcquirer","resolver","resolveBareModule","_onTypeFile","Emitter","typingsFiles","parentPath","moduleRoot","util","join","this","_listFiles","then","files","imported","promises","normalizedMain","resolve","main","pathname","test","push","host","readFileContent","nameSpec","spec","buf","contents","decoder","decode","filePath","fire","content","e","console","warn","length","Promise","all","undefined","typingsModuleSpec","_import","dependencies","getCanonicalUrl","unresolvedUrl","resolvedUrl","entries","queue","next","shift","listEntries","entriesAtPath","entry","type","ResolvedEntryKind","Directory","url","path","href","File","pkgJsonPathname","bareModuleUrl","readParentPackageJson","resolvedPkgJson","Error","pkgJsonText","JSON","stringify","packageJson","resolvedName","_importAdjacentTypings","indexOf","_importTypingsFromDefinitelyTyped","error","specs","Object","keys","map","importTypesForSpec","importResults","reduce","result","event","object","enumerableOnly","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","apply","target","i","arguments","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","RELATE_PATH_RX","SPEC_RX","Deferred","_this","internalState","promise","promiseResolve","promiseReject","value","reason","get","isBareModuleSpecifier","parseBareModuleSpec","parsed","matches","match","maybeParseBareModuleSpec","concat","getSourceMappingUrl","str","re","lastMatch","exec","traverse","ast","ctx","_ref","visit","node","parent","enter","leave","prop","index","_shouldSkip","shouldSkip","call","context","skipped","childKeys","Array","isArray","j","skip","isArrowFunctionExpression","isFunctionDeclaration","isFunctionExpression","isIdentifier","isMemberExpression","isNodeWithStartAndEnd","start","end","isStringLiteral","isLiteral","parseFile","uri","magicString","code","options","unboundSymbols","Map","locals","nodeEnv","replacements","requires","requireResolves","Set","original","onComment","_isBlock","_test","remove","onToken","token","addSourcemapLocation","allowReturnOutsideFunction","sourceType","scopingAndRequiresVisitor","collectGlobalsVisitor","err","message","requireDependencies","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","done","callee","return","requireResolveDependencies","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_node","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","_ref4","_ref3","symbolName","symbolNodes","set","has","_parent","isVariableDeclaration","nextParent","kind","isScope","isBlockScope","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","declarations","declarePattern","id","_parent2","_nextParent2","_locals","declareFunction","isFunction","_locals2","isClassDeclaration","_parent3","_nextParent3","_locals3","isTryStatement","handler","_locals4","param","visitAndCaptureScoping","isIfStatement","isBinaryExpression","l","r","operator","left","right","memberExpressionMatches","replacement","alternate","add","consequent","visitAndSkipBranches","isCallExpression","firstArg","property","_firstArg","visitRequires","isPropertyOfMemberExpression","isProperty","isKeyOfProperty","isBindingIdentifier","foundBinding","declaresArguments","isThisExpression","_foundBinding","_nextParent","declaresThis","_unboundSymbols","params","isObjectPattern","properties","isArrayPattern","elements","isRestElement","argument","isAssignmentPattern","isProgram","isBlockStatement","pattern","memberParts","DependencyKind","Asset","rootHref","unresolvedDependencies","deps","filename","indentExclusionRanges","sourceMappingUrl","asset","endsWith","parse","_href","cssCode","BACKSLASH","charCodeAt","SINGLE_QUOTE","NL","CR","escaped","char","prependRight","prepend","append","document","createElement","textContent","getParserForAsset","json","_asset$dependencies","setCode","NODE_CORE_SHIMS","shims","coreLibName","assign","resolveBareModuleToUnpkgWithDetails","_ref5","mark","_callee","parentHref","_ref6","parsedSpec","details","resolvedSpecRoot","unresolvedHref","parentUrl","parentPackageInfo","consolidatedDependencies","builtIn","parsedBuiltInSpec","stableUrl","stableRootUrl","resolveResult","packageInfo","_args","wrap","_context","prev","bareModule","URL","t0","sent","peerDependencies","devDependencies","versionSpec","isBuiltIn","ignored","rootUrl","abrupt","stop","_x","_x2","_x3","createRuntime","Velcro","aliasesSymbol","for","modulesSymbol","registrySymbol","rootSymbol","Runtime","create","toStringTag","self","configurable","root","Module","runtime","exports","dependents","prototype","alias","import","reject","require","register","factory","module","seen","removalQueue","moduleToRemove","dirname","basename","bind","ResolveDetailsKind","Bundler","_Error","ExtendableError","_this2","constructor","captureStackTrace","stack","_ExtendableError","InvariantViolation","_ExtendableError2","ResolveError","fromHref","_this3","EMPTY_MODULE_URL","DEFAULT_SHIM_GLOBALS","Buffer","export","global","process","assetsByHref","pendingResolves","onAssetAddedEmitter","onAssetRemovedEmitter","dispose","clear","resolveDetails","resolvedHref","_generateBundleCode","_callee3","entrypoints","tokenSource","disposable","pendingOperations","assets","dfd","dependenciesToAliases","entrypointsToAssets","enqueueUnresolvedAsset","_loop4","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_loop5","_iterator8","_step8","bundle","_iteratorNormalCompletion9","_didIteratorError9","_iteratorError9","_iterator9","_step9","_asset","_iteratorNormalCompletion12","_didIteratorError12","_iteratorError12","_iterator12","_step12","dependency","_iteratorNormalCompletion10","_didIteratorError10","_iteratorError10","_iterator10","_step10","_ref12","_ref11","_name","_asset2","_iteratorNormalCompletion11","_didIteratorError11","_iteratorError11","_iterator11","_step11","bundleCode","sourceMapSuffix","sourceMap","combinedMap","_this4","_args3","_context3","onCancellationRequested","cancel","_ref7","_callee2","fromSpec","resolvedSpec","_asset$dependencies2","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_loop","_iterator5","_step5","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_loop2","_iterator6","_step6","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_loop3","_iterator7","_step7","_ref9","_context2","onEnqueueAsset","resolveWithDetails","getOrCreateAsset","readCode","dependencyAsset","Require","finish","RequireResolve","t1","_ref8","references","shim","InjectedGlobal","exportName","t2","splice","onCompleteAsset","t3","_x5","_x6","_","entrypoint","separator","clone","trim","overwrite","addSource","toString","t4","requireEntrypoints","values","t5","setTimeout","isCancellationRequested","generateMap","includeContent","hires","file","remapping","encode","_x4","_invalidate","_callee4","_ref13","combinedUri","_args4","_context4","removeAsset","_x7","delete","_readCode","_callee5","_ref14","_context5","_x8","_x9","_resolveWithDetails","_callee6","fromUri","_ref15","resolved","bareModuleResolveResult","resolvedUri","_resolvedHref","_context6","BareModule","stableHref","stableRootHref","Relative","_x10","_x11","_x12","freeze","base64","CancellationToken","CancellationTokenSource","CanceledError","globalThis","_AbstractResolverHost","ResolverHostCompound","hosts","prefix","_ref2","child","startsWith","getResolveRoot","InvariantError","TimeoutError","TranspileError","diagnostics","ResolverHostMonaco","rootUri","Monaco","_resolver","getModels","model","modelHref","seenDirs","nestedPath","nextDirIdx","getModel","encoder","TextEncoder","getTranspiledValue","output","getModeId","tryLoadFromWorker","a","typescript","getTypeScriptWorker","workerFactory","workerClient","getEmitOutput","getSyntacticDiagnostics","emitOutput","syntacticDiagnostics","emitSkipped","fsPath","diagnostic","startPosition","getPositionAt","endPosition","flattenDiagnosticMessageText","messageText","lineNumber","column","outputFiles","text","attempt","timeoutMs","race","timeout","Math","pow","getValue","AbstractResolverHost","diag","newLine","indent","EntryNotFoundError","isValidEntry","isValidDirectory","isValidFile","every","UNPKG_SPEC_RX","parseUnpkgUrl","signalFromCancellationToken","AbortControllerConstructor","abortController","abort","signal","ResolverHostUnpkg","contentCache","byteLength","max","inflightContentRequests","packageLock","packageEntriesCache","packageJsonCache","fetch","TypeError","AbortController","input","init","_getCanonicalUrl","unresolvedSpec","protocol","hostname","readPackageJsonWithCache","_getResolveRoot","_args2","_listEntries","parentEntry","traversalSegments","readPackageEntriesWithCache","Boolean","segment","find","_readFileContent","cached","inflight","redirect","res","ok","status","arrayBuffer","catch","_readPackageEntriesWithCache","lockKey","lock","packageEntriesCacheForModule","exactMatch","_packageEntries","packageEntries","_args5","readPackageEntries","_readPackageJsonWithCache","packageJsonCacheForModule","_packageJson","_args6","readPackageJson","_readPackageJson","_callee7","manifest","_args7","_context7","parseBufferAsPackageJson","_x13","_readPackageEntries","_callee8","_args8","_context8","_x14","ResolverHostWithCache","idbTimeout","hostTimeout","idbPromise","openDB","schemaVersion","upgrade","db","oldVersion","newVersion","transaction","log","createObjectStore","objectStore","inflightGetCanonicalUrl","inflightGetResolveRoot","inflightListEntries","inflightReadFileContent","getCanonicalUrlCache","getResolveRootCache","listEntriesCache","readFileContentCache","loadFn","cache","inflightMap","storeName","serialize","deserialize","withTimeout","idb","put","withCache","duration","EditorManager","bundler","Resolver","extensions","packageMain","editor","disposableStore","DisposableStore","initialPath","typeAcquirer","viewState","WeakMap","onWillFocusModelEmitter","onDidChangeEmitter","typescriptDefaults","setEagerModelSync","setMaximumWorkerIdleTime","setCompilerOptions","allowJs","allowNonTsExtensions","allowSyntheticDefaultImports","baseUrl","checkJs","esModuleInterop","experimentalDecorators","inlineSourceMap","inlineSources","isolatedModules","jsx","JsxEmit","React","lib","ModuleKind","CommonJS","moduleResolution","ModuleResolutionKind","NodeJs","noEmit","outDir","resolveJsonModule","rootDir","ScriptTarget","ES2015","typeRoots","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","createModel","onDidCreateModel","onDidChangePackageJson","typescriptVersion","importTypesForSpecs","throttler","ThrottledDelayer","trigger","onDidChangeContent","onTypeFile","addExtraLib","language","inferLanguage","focusModel","setModel","revealLineInCenter","ScrollType","Smooth","focus","el","automaticLayout","showUnused","scrollBeyondLastLine","theme","wordWrap","wrappingIndent","onDidDispose","onDidChangeModel","newModelUrl","restoreViewState","onDidBlurEditorText","saveViewState","focusPath","EditorManagerContext","createContext","Editor","className","useRef","editorManager","useContext","useEffect","current","mount","ref","PreviewProgress","props","total","round","completed","PreviewIframeWrap","PreviewWrap","PreviewMessageError","PreviewMessageErrorText","isInternal","PreviewMessages","PreviewMessageLine","line","PreviewMessage","lines","Preview","invalidations","previewWrapRef","previewIframeRef","useState","messages","setMessages","buildProgress","setBuildProgress","delayer","Delayer","Throttler","queueRefreshPreview","uris","refreshPreview","toInvalidate","from","building","invalidate","unresolvedEntrypointHref","resolvedEntrypoint","resolvedEntrypointHref","generateBundleCode","errorOverlayBundle","errorWatcher","createBundleRuntime","bundleFile","markup","createObjectURL","htmlUrl","iframe","style","display","src","appendChild","onload","onerror","onWillDisposeModel","onMessage","data","payload","focusHref","fileName","window","addEventListener","removeEventListener","idx","ReactErrorOverlay","setEditorHandler","postMessage","startReportingRuntimeErrors","onError","EntryKind","Entry","modelFocused","color","cursor","backgroundColor","CreateEntry","SidebarFileDelete","Button","StyledTooltip","SidebarFile","activeModel","workbench","setActiveModel","trackEditor","onDidFocusEditorText","hasTextFocus","onDidCreateEditor","useActiveModel","tooltip","useTooltipState","gutter","onClick","TooltipReference","as","role","aria-label","Tooltip","Sidebar","sortEntries","models","sort","b","initialEntries","modelUri","setEntries","findIndex","useDirectory","prompt","onClickCreate","App","project","Provider","isLocalhost","location","registerValidSW","swUrl","config","navigator","serviceWorker","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","onUpdate","onSuccess","react","AppWrap","ReactDOM","render","getElementById","origin","headers","response","contentType","ready","unregister","reload","checkValidServiceWorker","ownKeys","_objectSpread","hasInvalidOptionalStringField","field","hasInvalidDependenciesField","CHAR_DOT","CHAR_FORWARD_SLASH","TRAILING_SLASH_RX","ensureTrailingSlash","browser","hasInvalidBrowserField","isValidPackageJson","parseTextAsPackageJson","getFirstPathSegmentAfterPrefix","childHref","parentOffset","validateString","ext","matchedSlash","extIdx","firstNonSlashEnd","isPathSeparator","extname","startDot","startPart","preDotState","len","rootEnd","offset","last","resolvedPath","resolvedAbsolute","allowAboveRoot","lastSegmentLength","lastSlash","dots","lastSlashIndex","lastIndexOf","normalizeString","__proto__","initialSegment","Decoder","TextDecoder","TRAILING_SLASH_RX$1","defaultExtensions","_resolve","optionsWithDefaults","canonicalUrlPromise","canonicalUrl","rootHrefWithoutTrailingSlash","canonicalHref","ignoreBrowserOverrides","resolveAsDirectory","resolveAsFile","_resolveAsDirectory","mainPathname","packageJsonEntry","packageJsonContent","mainUrl","_resolveAsFile","parentPackageJson","browserOverrides","browserMap","packageJsonDir","impliedUrl","targetSpec","containingUrl","entryDirectoryMap","entryFileMap","_entry","childFilename","_childFilename","mapping","_match","includes","_readParentPackageJson","hostRootUrl","hostRootHref","containingDirUrl","readPackageJsonOrRecurse","dir","parentPackageJsonContent","parentDir"],"mappings":"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","file":"static/js/main.3a4bcf7d.chunk.js","sourcesContent":["import { util, Resolver, PackageJson, ResolvedEntryKind, ResolverHost } from '@velcro/resolver';\n\nimport { Emitter, Event } from 'ts-primitives';\nimport { BareModuleSpec } from '@velcro/resolver-host-unpkg';\n\nconst HAS_D_TS_EXTENSION = /\\.d\\.ts$/;\n\nenum PackageEntryKind {\n  Directory = 'directory',\n  File = 'file',\n}\n\ninterface PackageDirectoryEntry {\n  type: PackageEntryKind.Directory;\n  path: string;\n  files: PackageEntry[];\n}\n\ninterface PackageFileEntry {\n  type: PackageEntryKind.File;\n  path: string;\n}\n\ninterface TypingsFiles {\n  [fileName: string]: string;\n}\n\ntype PackageEntry = PackageDirectoryEntry | PackageFileEntry;\n\nfunction getTypingsModuleSpec(pkgJson: { name: string; version?: string }): { name: string; range: string } {\n  const typingsName = pkgJson.name.charAt(0) === '@' ? pkgJson.name.slice(1).replace('/', '__') : pkgJson.name;\n\n  let typingsRange = '*';\n\n  if (pkgJson.version) {\n    const major = pkgJson.version.split('.')[0];\n    typingsRange = `${major}.x`;\n  }\n\n  return {\n    name: `@types/${typingsName}`,\n    range: typingsRange,\n  };\n}\n\ninterface TypeFile {\n  pathname: string;\n  content: string;\n}\n\nexport class TypeAcquirer {\n  private _onTypeFile = new Emitter<TypeFile>();\n\n  constructor(\n    private readonly resolver: Resolver,\n    private readonly resolveBareModule: (resolver: ResolverHost, spec: BareModuleSpec) => URL\n  ) {}\n\n  private _importAdjacentTypings(\n    typingsFiles: TypingsFiles,\n    pkgJson: PackageJson,\n    parentPath: string\n  ): Promise<boolean> {\n    // console.log('_importAdjacentTypings', pkgJson.name, pkgJson.version, parentPath);\n    const moduleRoot = util.join(parentPath, `node_modules/${pkgJson.name}/`);\n\n    if (!pkgJson.name) {\n      return Promise.resolve(false);\n    }\n\n    return this._listFiles(pkgJson.name, pkgJson.version).then(files => {\n      let imported = false;\n      const promises: Promise<void>[] = [];\n      const normalizedMain = util.resolve('/', pkgJson.main || 'index.js');\n\n      for (const pathname in files) {\n        if (!(normalizedMain === pathname || HAS_D_TS_EXTENSION.test(pathname))) {\n          continue;\n        }\n\n        promises.push(\n          this.resolver.host\n            .readFileContent(\n              this.resolver,\n              this.resolveBareModule(this.resolver.host, {\n                name: pkgJson.name!,\n                nameSpec: `${pkgJson.name}@${pkgJson.version}`,\n                pathname,\n                spec: pkgJson.version!,\n              })\n            )\n            .then(\n              // eslint-disable-next-line no-loop-func\n              buf => {\n                const contents = this.resolver.decoder.decode(buf);\n                const filePath = util.join(moduleRoot, pathname);\n                typingsFiles[filePath] = contents;\n\n                this._onTypeFile.fire({\n                  pathname: filePath,\n                  content: contents,\n                });\n\n                if (normalizedMain !== pathname) {\n                  imported = true;\n                }\n              },\n              e => {\n                console.warn(e);\n              }\n            )\n        );\n      }\n\n      if (!promises.length) {\n        return imported;\n      }\n\n      return Promise.all(promises).then(() => imported);\n    });\n  }\n\n  // private async _importEmbeddedTypings(\n  //   typingsFiles: TypingsFiles,\n  //   pkgJson: PackageJsonWithTypings,\n  //   parentPath: string\n  // ) {\n  //   let filesPromise: Promise<{ [fileName: string]: PackageFileEntry }> | undefined;\n  //   const readFiles = () => {\n  //     if (!filesPromise) {\n  //       filesPromise = this._listFiles(pkgJson.name, pkgJson.version);\n  //     }\n  //     return filesPromise;\n  //   };\n  //   const visitTypingsFile = async (fileName: string) => {\n  //     if (seen.has(fileName)) return;\n  //     seen.add(fileName);\n  //     console.log('visiting', fileName);\n  //     // Load the contents and add it to the known models\n  //     const sourceText = await this._readUnpkgFile(pkgJson.name, pkgJson.version, pkgJson.typings);\n  //     console.log('addExtraLib', sourceText, fileName);\n  //     typingsFiles[join(parentPath, fileName)] = sourceText;\n  //     const sourceFile = typescript.createSourceFile(fileName, sourceText, typescript.ScriptTarget.Latest, true);\n  //     const children: string[] = [];\n  //     typescript.forEachChild(sourceFile, child => {\n  //       if (typescript.isImportDeclaration(child) && typescript.isStringLiteral(child.moduleSpecifier)) {\n  //         children.push(child.moduleSpecifier.text);\n  //       } else if (\n  //         typescript.isExportDeclaration(child) &&\n  //         child.moduleSpecifier &&\n  //         child.moduleSpecifier &&\n  //         typescript.isStringLiteral(child.moduleSpecifier)\n  //       ) {\n  //         children.push(child.moduleSpecifier.text);\n  //       }\n  //     });\n  //     // We will figure out dependencies outside this module by building the optimized npm\n  //     // dependency tree\n  //     const relativeChildren = children.filter(ref => ref.charAt(0) === '.');\n  //     if (relativeChildren.length) {\n  //       const currentDir = dirname(fileName);\n  //       const files = await readFiles();\n  //       await Promise.all(\n  //         relativeChildren.map(ref => {\n  //           const childPathReference = resolve(currentDir, ref);\n  //           const childPath = resolveImportPath(files, childPathReference);\n  //           if (childPath) {\n  //             return visitTypingsFile(childPath);\n  //           }\n  //         })\n  //       );\n  //     }\n  //   };\n  //   const seen = new Set<string>();\n  //   const typescript = await import('typescript');\n  //   await visitTypingsFile(pkgJson.typings);\n  // }\n\n  private async _importTypingsFromDefinitelyTyped(\n    files: TypingsFiles,\n    pkgJson: PackageJson,\n    parentPath: string\n  ): Promise<void> {\n    // console.log('_importTypingsFromDefinitelyTyped', pkgJson.name, pkgJson.version, parentPath);\n    if (!pkgJson.name) {\n      return undefined;\n    }\n\n    const typingsModuleSpec = getTypingsModuleSpec({ name: pkgJson.name, version: pkgJson.version });\n\n    try {\n      const pkgJson = await this._import(files, typingsModuleSpec.name, typingsModuleSpec.range, parentPath);\n\n      if (pkgJson.dependencies) {\n        for (const name in pkgJson.dependencies) {\n          await this._import(files, name, pkgJson.dependencies[name], parentPath);\n        }\n      }\n    } catch (e) {\n      return undefined;\n    }\n  }\n\n  private async _listFiles(\n    name: string,\n    version: string = 'latest'\n  ): Promise<{ [pathname: string]: PackageFileEntry }> {\n    const unresolvedUrl = await this.resolver.host.getCanonicalUrl(\n      this.resolver,\n      this.resolveBareModule(this.resolver.host, {\n        name,\n        spec: version,\n        nameSpec: `${name}@${version}`,\n        pathname: '/',\n      })\n    );\n    const resolvedUrl = await this.resolver.host.getCanonicalUrl(this.resolver, unresolvedUrl);\n    const entries: { [pathname: string]: PackageFileEntry } = {};\n    const queue = [resolvedUrl];\n\n    while (queue.length) {\n      const next = queue.shift()!;\n      const entriesAtPath = await this.resolver.host.listEntries(this.resolver, next);\n\n      for (const entry of entriesAtPath) {\n        if (entry.type === ResolvedEntryKind.Directory) {\n          queue.push(entry.url);\n        } else {\n          const path = entry.url.href.slice(resolvedUrl.href.length - 1);\n          entries[path] = { type: PackageEntryKind.File, path };\n        }\n      }\n    }\n\n    return entries;\n  }\n\n  private async _import(\n    files: TypingsFiles,\n    name: string,\n    range: string,\n    parentPath: string = ''\n  ): Promise<PackageJson> {\n    // console.log('_import', name, range, parentPath);\n\n    const pkgJsonPathname = util.join(parentPath, 'node_modules', name, 'package.json');\n    const bareModuleUrl = this.resolveBareModule(this.resolver.host, {\n      name,\n      spec: range,\n      nameSpec: `${name}@${range}`,\n      pathname: '/package.json',\n    });\n    const resolvedPkgJson = await this.resolver.readParentPackageJson(bareModuleUrl);\n\n    if (!resolvedPkgJson) {\n      throw new Error(`Unable to load package.json for ${name}@${range}`);\n    }\n\n    const pkgJsonText = JSON.stringify(resolvedPkgJson.packageJson);\n    const resolvedName = resolvedPkgJson.packageJson.name || name;\n\n    files[pkgJsonPathname] = pkgJsonText;\n\n    this._onTypeFile.fire({\n      pathname: pkgJsonPathname,\n      content: pkgJsonText,\n    });\n\n    // if (isPackageJsonWithTypings(pkgJson)) {\n    //   await this._importEmbeddedTypings(files, pkgJson, parentPath);\n    // } else {\n    try {\n      const hasAdjacentTypings = await this._importAdjacentTypings(files, resolvedPkgJson.packageJson!, parentPath);\n\n      // console.log('hasAdjacentTypings', hasAdjacentTypings);\n\n      if (!hasAdjacentTypings && resolvedName.indexOf('@types/') !== 0) {\n        await this._importTypingsFromDefinitelyTyped(files, resolvedPkgJson.packageJson, parentPath);\n      }\n    } catch (err) {\n      console.error('error', err);\n    }\n    // }\n\n    return resolvedPkgJson.packageJson;\n  }\n\n  get onTypeFile(): Event<TypeFile> {\n    return this._onTypeFile.event;\n  }\n\n  async importTypesForSpec(name: string, range: string = 'latest', parentPath: string = ''): Promise<TypingsFiles> {\n    const files: TypingsFiles = {};\n\n    try {\n      await this._import(files, name, range, parentPath);\n    } catch (err) {\n      console.warn(err, `Type acquisition failed for ${name}@${range}`);\n    }\n\n    return files;\n  }\n\n  async importTypesForSpecs(specs: { [name: string]: string }, parentPath: string = ''): Promise<TypingsFiles> {\n    const promises = Object.keys(specs).map(name => this.importTypesForSpec(name, specs[name], parentPath));\n    const importResults = promises.length ? await Promise.all(promises) : [];\n\n    return importResults.reduce((files, result) => ({ ...files, ...result }), {} as TypingsFiles);\n  }\n}\n","import _possibleConstructorReturn from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _wrapNativeSuper from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper\";\nimport _regeneratorRuntime from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Emitter, CanceledError, CancellationToken, CancellationTokenSource as CancellationTokenSource$1 } from 'ts-primitives';\nexport { CanceledError, CancellationToken, CancellationTokenSource } from 'ts-primitives';\nimport MagicString, { Bundle } from 'magic-string';\nimport { parse as parse$1 } from 'acorn';\nimport remapping from '@ampproject/remapping';\nimport { CancellationTokenSource, EntryNotFoundError } from '@velcro/resolver';\nimport { Base64 } from 'js-base64';\nvar RELATE_PATH_RX = /^[./]|^[a-z_-]+:/;\nvar SPEC_RX = /^((@[^/]+\\/[^/@]+|[^./@][^/@]*)(?:@([^/]+))?)(.*)?$/;\n\nvar Deferred =\n/*#__PURE__*/\nfunction () {\n  function Deferred() {\n    var _this = this;\n\n    _classCallCheck(this, Deferred);\n\n    this.internalState = 'pending';\n    this.promise = new Promise(function (promiseResolve, promiseReject) {\n      _this.promiseResolve = promiseResolve;\n      _this.promiseReject = promiseReject;\n    });\n  }\n\n  _createClass(Deferred, [{\n    key: \"resolve\",\n    value: function resolve(value) {\n      this.internalState = 'resolved';\n      this.promiseResolve(value);\n    }\n  }, {\n    key: \"reject\",\n    value: function reject(reason) {\n      this.internalState = 'rejected';\n      this.promiseReject(reason);\n    }\n  }, {\n    key: \"isSettled\",\n    get: function get() {\n      return this.internalState !== 'pending';\n    }\n  }, {\n    key: \"state\",\n    get: function get() {\n      return this.internalState;\n    }\n  }]);\n\n  return Deferred;\n}();\n\nfunction isBareModuleSpecifier(spec) {\n  return !RELATE_PATH_RX.test(spec);\n}\n\nfunction maybeParseBareModuleSpec(spec) {\n  /**\r\n   * 1: scope + name + version\r\n   * 2: scope + name\r\n   * 3: version?\r\n   * 4: pathname\r\n   */\n  var matches = spec.match(SPEC_RX);\n\n  if (!matches) {\n    return undefined;\n  }\n\n  return {\n    nameSpec: matches[1],\n    name: matches[2],\n    spec: matches[3] || '',\n    pathname: matches[4] || ''\n  };\n}\n\nfunction parseBareModuleSpec(spec) {\n  var parsed = maybeParseBareModuleSpec(spec);\n\n  if (!parsed) {\n    throw new Error(\"Unable to parse unexpected unpkg url: '\".concat(spec, \"'\"));\n  }\n\n  return parsed;\n} // this looks ridiculous, but it prevents sourcemap tooling from mistaking\n// this for an actual sourceMappingURL\n\n\nfunction getSourceMappingUrl(str) {\n  var re = /(?:\\/\\/[@#][\\s]*(?:source)MappingURL=([^\\s'\"]+)[\\s]*$)|(?:\\/\\*[@#][\\s]*(?:source)MappingURL=([^\\s*'\"]+)[\\s]*(?:\\*\\/)[\\s]*$)/gm; // Keep executing the search to find the *last* sourceMappingURL to avoid\n  // picking up sourceMappingURLs from comments, strings, etc.\n\n  var lastMatch = null;\n  var match;\n\n  while (match = re.exec(str)) {\n    lastMatch = match;\n  }\n\n  if (!lastMatch) return undefined;\n  return lastMatch[1];\n}\n\nfunction traverse(ast, ctx, _ref) {\n  var enter = _ref.enter,\n      leave = _ref.leave;\n  visit(ast, null, ctx, enter, leave);\n}\n\nvar shouldSkip = false;\nvar context = {\n  skip: function skip() {\n    return shouldSkip = true;\n  }\n};\nvar childKeys = {};\n\nfunction visit(node, parent, ctx, enter, leave, prop, index) {\n  if (!node) return;\n  node.parent = parent;\n\n  if (enter) {\n    var _shouldSkip = shouldSkip;\n    shouldSkip = false;\n    enter.call(context, node, parent, ctx, prop, index);\n    var skipped = shouldSkip;\n    shouldSkip = _shouldSkip;\n    if (skipped) return;\n  }\n\n  var keys = childKeys[node.type] || (childKeys[node.type] = Object.keys(node).filter(function (key) {\n    return key !== 'parent' && typeof node[key] === 'object';\n  }));\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = node[key];\n\n    if (Array.isArray(value)) {\n      for (var j = 0; j < value.length; j++) {\n        visit(value[j], node, ctx, enter, leave, key, j);\n      }\n    } else if (value && value.type) {\n      visit(value, node, ctx, enter, leave, key);\n    }\n  }\n\n  if (leave) {\n    leave(node, parent, ctx, prop, index);\n  }\n}\n\nfunction isArrowFunctionExpression(node) {\n  return node.type === 'ArrowFunctionExpression';\n}\n\nfunction isArrayPattern(node) {\n  return node.type === 'ArrayPattern';\n}\n\nfunction isAssignmentPattern(node) {\n  return node.type === 'AssignmentPattern';\n}\n\nfunction isBinaryExpression(node) {\n  return node.type === 'BinaryExpression';\n}\n\nfunction isBlockStatement(node) {\n  return node.type === 'BlockStatement';\n}\n\nfunction isCallExpression(node) {\n  return node.type === 'CallExpression';\n}\n\nfunction isClassDeclaration(node) {\n  return node.type === 'ClassDeclaration';\n}\n\nfunction isFunctionDeclaration(node) {\n  return node.type === 'FunctionDeclaration';\n}\n\nfunction isFunctionExpression(node) {\n  return node.type === 'FunctionExpression';\n}\n\nfunction isIdentifier(node) {\n  return node.type === 'Identifier';\n}\n\nfunction isIfStatement(node) {\n  return node.type === 'IfStatement';\n}\n\nfunction isLiteral(node) {\n  return node.type === 'Literal';\n}\n\nfunction isMemberExpression(node) {\n  return node.type === 'MemberExpression';\n}\n\nfunction isNodeWithStartAndEnd(node) {\n  return typeof node.start === 'number' && typeof node.end === 'number';\n}\n\nfunction isObjectPattern(node) {\n  return node.type === 'ObjectPattern';\n}\n\nfunction isProperty(node) {\n  return node.type === 'Property';\n}\n\nfunction isRestElement(node) {\n  return node.type === 'RestElement';\n}\n\nfunction isProgram(node) {\n  return node.type === 'Program';\n}\n\nfunction isThisExpression(node) {\n  return node.type === 'ThisExpression';\n}\n\nfunction isTryStatement(node) {\n  return node.type === 'TryStatement';\n}\n\nfunction isVariableDeclaration(node) {\n  return node.type === 'VariableDeclaration';\n} // Refinements or groups\n\n\nfunction isFunction(node) {\n  return isFunctionDeclaration(node) || isFunctionExpression(node) || isArrowFunctionExpression(node);\n}\n\nfunction isStringLiteral(node) {\n  return isLiteral(node) && typeof node.value === 'string';\n}\n\nfunction parse(code, options) {\n  return parse$1(code, _objectSpread({}, options, {\n    allowReturnOutsideFunction: true,\n    sourceType: 'script'\n  }));\n}\n\nfunction parseFile(uri, magicString) {\n  var ctx = {\n    unboundSymbols: new Map(),\n    locals: new Map(),\n    nodeEnv: 'development',\n    replacements: [],\n    requires: [],\n    requireResolves: [],\n    skip: new Set()\n  };\n\n  try {\n    // let lastToken: acorn.Token | undefined = undefined;\n    var ast = parse(magicString.original, {\n      onComment: function onComment(_isBlock, _test, start, end) {\n        magicString.remove(start, end);\n      },\n      onToken: function onToken(token) {\n        magicString.addSourcemapLocation(token.start); // const wsStart = lastToken ? lastToken.end : 0;\n        // if (wsStart < token.start - 1) {\n        //   const between = magicString.original.substring(wsStart, token.start);\n        //   if (whitespaceRx.test(between)) {\n        //     magicString.overwrite(wsStart, token.start - 1, ' ');\n        //   }\n        // }\n        // lastToken = token;\n      }\n    });\n    traverse(ast, ctx, scopingAndRequiresVisitor);\n    traverse(ast, ctx, collectGlobalsVisitor);\n  } catch (err) {\n    throw new Error(\"Error parsing \".concat(uri, \": \").concat(err.message));\n  }\n\n  var requireDependencies = [];\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    for (var _iterator = ctx.requires[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      var node = _step.value;\n      requireDependencies.push({\n        callee: _objectSpread({}, node.callee),\n        spec: _objectSpread({}, node.spec)\n      });\n    }\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator.return != null) {\n        _iterator.return();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n\n  var requireResolveDependencies = [];\n  var _iteratorNormalCompletion2 = true;\n  var _didIteratorError2 = false;\n  var _iteratorError2 = undefined;\n\n  try {\n    for (var _iterator2 = ctx.requireResolves[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n      var _node = _step2.value;\n      requireResolveDependencies.push({\n        callee: _objectSpread({}, _node.callee),\n        spec: _objectSpread({}, _node.spec)\n      });\n    }\n  } catch (err) {\n    _didIteratorError2 = true;\n    _iteratorError2 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n        _iterator2.return();\n      }\n    } finally {\n      if (_didIteratorError2) {\n        throw _iteratorError2;\n      }\n    }\n  }\n\n  var unboundSymbols = new Map();\n  var _iteratorNormalCompletion3 = true;\n  var _didIteratorError3 = false;\n  var _iteratorError3 = undefined;\n\n  try {\n    for (var _iterator3 = ctx.unboundSymbols[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n      var _ref4 = _step3.value;\n\n      var _ref3 = _slicedToArray(_ref4, 2);\n\n      var symbolName = _ref3[0];\n      var symbolNodes = _ref3[1];\n      unboundSymbols.set(symbolName, symbolNodes.map(function (node) {\n        return {\n          start: node.start,\n          end: node.end\n        };\n      }));\n    }\n  } catch (err) {\n    _didIteratorError3 = true;\n    _iteratorError3 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n        _iterator3.return();\n      }\n    } finally {\n      if (_didIteratorError3) {\n        throw _iteratorError3;\n      }\n    }\n  }\n\n  return {\n    requireDependencies: requireDependencies,\n    requireResolveDependencies: requireResolveDependencies,\n    unboundSymbols: unboundSymbols\n  };\n}\n\nvar scopingAndRequiresVisitor = {\n  enter: function enter(node, parent, ctx) {\n    if (ctx.skip.has(node)) {\n      return this.skip();\n    }\n\n    visitAndCaptureScoping(node, parent, ctx);\n    visitAndSkipBranches(node, parent, ctx);\n    visitRequires(node, parent, ctx);\n  }\n};\nvar collectGlobalsVisitor = {\n  enter: function enter(node, _parent, ctx) {\n    if (isBindingIdentifier(node) && isIdentifier(node)) {\n      var name = node.name;\n      if (name === 'undefined') return;\n      var foundBinding = false;\n      var nextParent = node.parent;\n\n      while (nextParent) {\n        if (name === 'arguments' && declaresArguments(nextParent)) {\n          foundBinding = true;\n          break;\n        }\n\n        var locals = ctx.locals.get(nextParent);\n\n        if (locals && locals[name]) {\n          foundBinding = true;\n          break;\n        }\n\n        nextParent = nextParent.parent;\n      }\n\n      if (!foundBinding && isNodeWithStartAndEnd(node)) {\n        var unboundSymbols = ctx.unboundSymbols.get(name);\n\n        if (!unboundSymbols) {\n          unboundSymbols = [];\n          ctx.unboundSymbols.set(name, unboundSymbols);\n        }\n\n        unboundSymbols.push(node);\n      }\n    } else if (isThisExpression(node)) {\n      var _foundBinding = false;\n      var _nextParent = node.parent;\n\n      while (_nextParent) {\n        if (declaresThis(_nextParent)) {\n          _foundBinding = true;\n          break;\n        }\n\n        _nextParent = _nextParent.parent;\n      }\n\n      if (!_foundBinding && isNodeWithStartAndEnd(node)) {\n        var _unboundSymbols = ctx.unboundSymbols.get('this');\n\n        if (!_unboundSymbols) {\n          _unboundSymbols = [];\n          ctx.unboundSymbols.set('this', _unboundSymbols);\n        }\n\n        _unboundSymbols.push(node);\n      }\n    }\n  }\n};\n\nfunction visitAndCaptureScoping(node, _parent, ctx) {\n  if (isVariableDeclaration(node)) {\n    var parent;\n    var nextParent = node.parent;\n\n    while (nextParent) {\n      if (node.kind === 'var' ? isScope(nextParent) : isBlockScope(nextParent)) {\n        parent = nextParent;\n        break;\n      }\n\n      nextParent = nextParent.parent;\n    }\n\n    if (!parent) {\n      throw new Error(\"Invariant violation: Failed to find a parent\");\n    }\n\n    var locals = ctx.locals.get(parent);\n\n    if (!locals) {\n      locals = {};\n      ctx.locals.set(parent, locals);\n    }\n\n    var _iteratorNormalCompletion4 = true;\n    var _didIteratorError4 = false;\n    var _iteratorError4 = undefined;\n\n    try {\n      for (var _iterator4 = node.declarations[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n        var declaration = _step4.value;\n        declarePattern(declaration.id, locals);\n      }\n    } catch (err) {\n      _didIteratorError4 = true;\n      _iteratorError4 = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion4 && _iterator4.return != null) {\n          _iterator4.return();\n        }\n      } finally {\n        if (_didIteratorError4) {\n          throw _iteratorError4;\n        }\n      }\n    }\n  } else if (isFunctionDeclaration(node)) {\n    var _parent2;\n\n    var _nextParent2 = node.parent;\n\n    if (_nextParent2 && _nextParent2.parent) {\n      _nextParent2 = _nextParent2.parent;\n    }\n\n    while (_nextParent2) {\n      if (isScope(_nextParent2)) {\n        _parent2 = _nextParent2;\n        break;\n      }\n\n      _nextParent2 = _nextParent2.parent;\n    }\n\n    if (!_parent2) {\n      throw new Error(\"Invariant violation: Failed to find a parent\");\n    }\n\n    var _locals = ctx.locals.get(_parent2);\n\n    if (!_locals) {\n      _locals = {};\n      ctx.locals.set(_parent2, _locals);\n    }\n\n    declareFunction(node, _locals);\n  } else if (isFunction(node)) {\n    var _locals2 = ctx.locals.get(node);\n\n    if (!_locals2) {\n      _locals2 = {};\n      ctx.locals.set(node, _locals2);\n    }\n\n    declareFunction(node, _locals2);\n  } else if (isClassDeclaration(node) && node.id) {\n    var _parent3;\n\n    var _nextParent3 = node.parent;\n\n    if (_nextParent3 && _nextParent3.parent) {\n      _nextParent3 = _nextParent3.parent;\n    }\n\n    while (_nextParent3) {\n      if (isScope(_nextParent3)) {\n        _parent3 = _nextParent3;\n        break;\n      }\n\n      _nextParent3 = _nextParent3.parent;\n    }\n\n    if (!_parent3) {\n      throw new Error(\"Invariant violation: Failed to find a parent\");\n    }\n\n    var _locals3 = ctx.locals.get(_parent3);\n\n    if (!_locals3) {\n      _locals3 = {};\n      ctx.locals.set(_parent3, _locals3);\n    }\n\n    _locals3[node.id.name] = true;\n  } else if (isTryStatement(node)) {\n    if (node.handler) {\n      var _locals4 = ctx.locals.get(node.handler);\n\n      if (!_locals4) {\n        _locals4 = {};\n        ctx.locals.set(node.handler, _locals4);\n      }\n\n      declarePattern(node.handler.param, _locals4);\n    }\n  }\n}\n\nfunction visitAndSkipBranches(node, _parent, ctx) {\n  if (isIfStatement(node) && isBinaryExpression(node.test)) {\n    var tests = {\n      '!=': function _(l, r) {\n        return l != r;\n      },\n      '!==': function _(l, r) {\n        return l !== r;\n      },\n      '==': function _(l, r) {\n        return l == r;\n      },\n      '===': function _(l, r) {\n        return l === r;\n      }\n    };\n    var test = tests[node.test.operator];\n\n    if (test) {\n      if (isStringLiteral(node.test.left) && isMemberExpression(node.test.right) && memberExpressionMatches(node.test.right, 'process.env.NODE_ENV')) {\n        // if ('development' === process.env.NODE_ENV) {}\n        ctx.replacements.push({\n          start: node.test.right.start,\n          end: node.test.right.end,\n          replacement: JSON.stringify(ctx.nodeEnv)\n        });\n\n        if (!test(node.test.left.value, ctx.nodeEnv)) {\n          ctx.skip.add(node.consequent);\n        } else if (node.alternate) {\n          ctx.skip.add(node.alternate);\n        }\n      } else if (isStringLiteral(node.test.right) && isMemberExpression(node.test.left) && memberExpressionMatches(node.test.left, 'process.env.NODE_ENV')) {\n        // if (process.env.NODE_ENV === 'development') {}\n        ctx.replacements.push({\n          start: node.test.left.start,\n          end: node.test.left.end,\n          replacement: JSON.stringify(ctx.nodeEnv)\n        });\n\n        if (!test(node.test.right.value, ctx.nodeEnv)) {\n          ctx.skip.add(node.consequent);\n        } else if (node.alternate) {\n          ctx.skip.add(node.alternate);\n        }\n      }\n    }\n  }\n}\n\nfunction visitRequires(node, _parent, ctx) {\n  if (isCallExpression(node) && isNodeWithStartAndEnd(node.callee)) {\n    var callee = node.callee;\n\n    if (isIdentifier(callee) && isNodeWithStartAndEnd(callee) && callee.name === 'require') {\n      var firstArg = node.arguments[0];\n\n      if (isStringLiteral(firstArg) && isNodeWithStartAndEnd(firstArg)) {\n        ctx.requires.push({\n          spec: {\n            start: firstArg.start,\n            end: firstArg.end,\n            value: firstArg.value\n          },\n          callee: {\n            start: callee.start,\n            end: callee.end\n          }\n        });\n      } else {\n        console.warn('Non string-literal first arg to require', firstArg);\n      }\n    } else if (isMemberExpression(callee) && isIdentifier(callee.object) && callee.object.name === 'require' && isIdentifier(callee.property) && callee.property.name === 'resolve') {\n      var _firstArg = node.arguments[0];\n\n      if (isStringLiteral(_firstArg) && isNodeWithStartAndEnd(_firstArg)) {\n        ctx.requireResolves.push({\n          spec: {\n            start: _firstArg.start,\n            end: _firstArg.end,\n            value: _firstArg.value\n          },\n          callee: {\n            start: callee.start,\n            end: callee.end\n          }\n        });\n      } else {\n        console.warn('Non string-literal first arg to require.resolve', _firstArg);\n      }\n    }\n  }\n}\n\nfunction declareFunction(node, locals) {\n  node.params.forEach(function (node) {\n    declarePattern(node, locals);\n  });\n\n  if (node.id) {\n    locals[node.id.name] = true;\n  }\n}\n\nfunction declarePattern(node, locals) {\n  if (isIdentifier(node)) {\n    locals[node.name] = true;\n  } else if (isObjectPattern(node)) {\n    node.properties.forEach(function (node) {\n      return declarePattern(node.value, locals);\n    });\n  } else if (isArrayPattern(node)) {\n    node.elements.forEach(function (node) {\n      return node && declarePattern(node, locals);\n    });\n  } else if (isRestElement(node)) {\n    declarePattern(node.argument, locals);\n  } else if (isAssignmentPattern(node)) {\n    declarePattern(node.left, locals);\n  } else {\n    throw new Error(\"Invariant violation: Unexpected pattern type: \".concat(node.type));\n  }\n}\n\nfunction isBindingIdentifier(node) {\n  return isIdentifier(node) && !isPropertyOfMemberExpression(node) && !isKeyOfProperty(node);\n}\n\nfunction isKeyOfProperty(node) {\n  return node.parent && isProperty(node.parent) && node.parent.key === node;\n}\n\nfunction isPropertyOfMemberExpression(node) {\n  return node.parent && isMemberExpression(node.parent) && node.parent.object !== node;\n}\n\nfunction isScope(node) {\n  return isFunctionDeclaration(node) || isFunctionExpression(node) || isArrowFunctionExpression(node) || isProgram(node);\n}\n\nfunction isBlockScope(node) {\n  return isBlockStatement(node) || isScope(node);\n}\n\nfunction declaresArguments(node) {\n  return isFunctionDeclaration(node) || isFunctionExpression(node);\n}\n\nfunction declaresThis(node) {\n  return isFunctionDeclaration(node) || isFunctionExpression(node);\n}\n\nfunction memberExpressionMatches(node, pattern) {\n  var memberParts = pattern.split('.');\n\n  if (memberParts.length < 2) {\n    return false;\n  }\n\n  var object = memberParts.shift();\n  var property = memberParts.shift();\n\n  for (var i = memberParts.length - 1; i >= 0; i--) {\n    if (!isIdentifier(node.property) || node.property.name !== memberParts[i]) {\n      return false;\n    }\n\n    if (!isMemberExpression(node.object)) {\n      return false;\n    }\n\n    node = node.object;\n  }\n\n  if (!isIdentifier(node.object) || !isIdentifier(node.property)) {\n    return false;\n  }\n\n  return node.object.name === object && node.property.name === property;\n}\n\nvar Asset =\n/*#__PURE__*/\nfunction () {\n  function Asset(href, rootHref) {\n    _classCallCheck(this, Asset);\n\n    this.href = href;\n    this.rootHref = rootHref;\n    this.dependencies = [];\n    this.unresolvedDependencies = {};\n    this.deps = new Map();\n  }\n\n  _createClass(Asset, [{\n    key: \"setCode\",\n    value: function setCode(code) {\n      this.magicString = new MagicString(code, {\n        filename: this.href,\n        indentExclusionRanges: []\n      });\n      this.sourceMappingUrl = getSourceMappingUrl(code);\n      var parser = getParserForAsset(this);\n      var dependencies = parser.parse(this.href, this.magicString);\n      this.unresolvedDependencies.requireDependencies = dependencies.requireDependencies;\n      this.unresolvedDependencies.requireResolveDependencies = dependencies.requireResolveDependencies;\n      this.unresolvedDependencies.unboundSymbols = dependencies.unboundSymbols;\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        href: this.href,\n        rootHref: this.rootHref,\n        dependencies: this.dependencies,\n        sourceMappingUrl: this.sourceMappingUrl,\n        code: this.magicString ? this.magicString.original : ''\n      };\n    }\n  }], [{\n    key: \"fromJSON\",\n    value: function fromJSON(json) {\n      var _asset$dependencies;\n\n      var asset = new Asset(json.href, json.rootHref);\n\n      (_asset$dependencies = asset.dependencies).push.apply(_asset$dependencies, _toConsumableArray(json.dependencies));\n\n      asset.sourceMappingUrl = json.sourceMappingUrl;\n      asset.setCode(json.code);\n      return asset;\n    }\n  }]);\n\n  return Asset;\n}();\n\n(function (Asset) {\n  var DependencyKind;\n\n  (function (DependencyKind) {\n    DependencyKind[\"Require\"] = \"require\";\n    DependencyKind[\"RequireResolve\"] = \"require.resolve\";\n    DependencyKind[\"InjectedGlobal\"] = \"injected_global\";\n  })(DependencyKind = Asset.DependencyKind || (Asset.DependencyKind = {}));\n})(Asset || (Asset = {}));\n\nfunction getParserForAsset(asset) {\n  if (asset.href.endsWith('.css')) {\n    return {\n      parse: function parse(_href, magicString) {\n        var cssCode = magicString.original;\n        var BACKSLASH = '\\\\'.charCodeAt(0);\n        var SINGLE_QUOTE = \"'\".charCodeAt(0);\n        var NL = '\\n'.charCodeAt(0);\n        var CR = '\\r'.charCodeAt(0);\n        var escaped = false;\n\n        for (var i = 0; i < cssCode.length; i++) {\n          var char = cssCode.charCodeAt(i);\n\n          if (char === BACKSLASH) {\n            escaped = !escaped;\n            continue;\n          }\n\n          if (!escaped) {\n            // Escape certain characters (if not already escaped)\n            switch (char) {\n              case CR:\n              case NL:\n              case SINGLE_QUOTE:\n                magicString.prependRight(i, '\\\\');\n                break;\n            }\n          }\n\n          escaped = false;\n        }\n\n        magicString.prepend('var styleTag = document.createElement(\"style\");styleTag.type = \"text/css\";styleTag.innerHTML = \\'');\n        magicString.append('\\';document.getElementsByTagName(\"head\")[0].appendChild(styleTag);');\n        var styleTag = document.createElement('style');\n        styleTag.textContent;\n        return {\n          requireDependencies: [],\n          requireResolveDependencies: [],\n          unboundSymbols: new Map()\n        };\n      }\n    };\n  }\n\n  if (asset.href.endsWith('.json')) {\n    return {\n      parse: function parse(_href, magicString) {\n        magicString.prepend('module.exports = ');\n        return {\n          requireDependencies: [],\n          requireResolveDependencies: [],\n          unboundSymbols: new Map()\n        };\n      }\n    };\n  }\n\n  return {\n    parse: parseFile\n  };\n}\n\nvar version = \"0.20.0\";\nvar BARE_MODULE_PREFIX = 'https://unpkg.com/'; // const DEFAULT_SHIM_GLOBALS: { [key: string]: { spec: string; export?: string } } = {\n//   Buffer: {\n//     spec: `@velcro/node-libs@${nodeLibsVersion}/lib/buffer.js`,\n//     export: 'Buffer',\n//   },\n//   global: {\n//     spec: `@velcro/node-libs@${nodeLibsVersion}/lib/global.js`,\n//   },\n//   process: {\n//     spec: `@velcro/node-libs@${nodeLibsVersion}/lib/process.js`,\n//   },\n// };\n\nvar NODE_CORE_SHIMS = ['assert', 'buffer', 'constants', 'crypto', 'events', 'fs', 'http', 'https', 'net', 'os', 'path', 'process', 'querystring', 'stream', 'tls', 'url', 'util', 'vm', 'zlib'].reduce(function (shims, coreLibName) {\n  return Object.assign(shims, _defineProperty({}, coreLibName, \"@velcro/node-libs@\".concat(version, \"/lib/\").concat(coreLibName, \".js\")));\n}, {});\nNODE_CORE_SHIMS['string_decoder'] = 'string_decoder@1.2.0';\nNODE_CORE_SHIMS['punycode'] = 'punycode@2.1.1';\n\nvar resolveBareModuleToUnpkgWithDetails =\n/*#__PURE__*/\nfunction () {\n  var _ref5 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(resolver, href, parentHref) {\n    var _ref6,\n        token,\n        parsedSpec,\n        details,\n        resolvedSpecRoot,\n        unresolvedHref,\n        parentUrl,\n        parentPackageInfo,\n        consolidatedDependencies,\n        builtIn,\n        parsedBuiltInSpec,\n        stableUrl,\n        stableRootUrl,\n        resolveResult,\n        packageInfo,\n        _args = arguments;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _ref6 = _args.length > 3 && _args[3] !== undefined ? _args[3] : {}, token = _ref6.token;\n            parsedSpec = parseBareModuleSpec(href);\n            details = {\n              bareModule: {},\n              resolvedUrl: undefined\n            }; // let resolvedSpec: string | undefined = undefined;\n\n            resolvedSpecRoot = undefined;\n            unresolvedHref = undefined;\n\n            if (!parsedSpec.spec) {\n              _context.next = 9;\n              break;\n            }\n\n            // A manually-specified spec means we should use that instead of looking for a parent package.json\n            resolvedSpecRoot = parsedSpec.nameSpec;\n            _context.next = 21;\n            break;\n\n          case 9:\n            if (!parentHref) {\n              _context.next = 21;\n              break;\n            }\n\n            _context.prev = 10;\n            parentUrl = new URL(parentHref);\n            _context.next = 17;\n            break;\n\n          case 14:\n            _context.prev = 14;\n            _context.t0 = _context[\"catch\"](10);\n            throw new Error(\"Error loading bare module \".concat(href, \" because the parent module \").concat(parentHref, \" could not be resolved to a URL\"));\n\n          case 17:\n            _context.next = 19;\n            return resolver.readParentPackageJson(parentUrl, {\n              token: token\n            });\n\n          case 19:\n            parentPackageInfo = _context.sent;\n\n            if (parentPackageInfo) {\n              consolidatedDependencies = _objectSpread({}, parentPackageInfo.packageJson.peerDependencies || {}, {}, parentPackageInfo.packageJson.devDependencies || {}, {}, parentPackageInfo.packageJson.dependencies || {});\n              details.bareModule.versionSpec = consolidatedDependencies[parsedSpec.name];\n\n              if (details.bareModule.versionSpec) {\n                resolvedSpecRoot = \"\".concat(parsedSpec.name, \"@\").concat(details.bareModule.versionSpec);\n              }\n            }\n\n          case 21:\n            if (resolvedSpecRoot) {\n              // The name + spec was hard-coded or could be derived from a parent package.json. We just\n              // need to prepend the staic prefix and then append the requested pathname.\n              resolvedSpecRoot = \"\".concat(BARE_MODULE_PREFIX).concat(resolvedSpecRoot);\n              unresolvedHref = \"\".concat(resolvedSpecRoot).concat(parsedSpec.pathname);\n            } else {\n              if (!parentHref) {\n                // There was no parent href from which to derive version constraints so we will take\n                // the provided 'namespec' and prefix it with the static prefix. That will be the root\n                // and the href can be determined by adding the requested pathname.\n                resolvedSpecRoot = \"\".concat(BARE_MODULE_PREFIX).concat(parsedSpec.nameSpec);\n                unresolvedHref = \"\".concat(resolvedSpecRoot).concat(parsedSpec.pathname);\n              } else {\n                builtIn = NODE_CORE_SHIMS[href];\n\n                if (builtIn) {\n                  parsedBuiltInSpec = parseBareModuleSpec(builtIn);\n                  resolvedSpecRoot = \"\".concat(BARE_MODULE_PREFIX).concat(parsedBuiltInSpec.nameSpec);\n                  unresolvedHref = \"\".concat(resolvedSpecRoot).concat(parsedBuiltInSpec.pathname);\n                  details.bareModule.isBuiltIn = true;\n                }\n              }\n            }\n\n            if (!(unresolvedHref && resolvedSpecRoot)) {\n              _context.next = 33;\n              break;\n            }\n\n            stableUrl = new URL(unresolvedHref);\n            stableRootUrl = new URL(resolvedSpecRoot);\n            _context.next = 27;\n            return resolver.resolve(stableUrl, {\n              token: token\n            });\n\n          case 27:\n            resolveResult = _context.sent;\n            details.ignored = resolveResult.ignored;\n            details.stableRootUrl = stableRootUrl;\n            details.stableUrl = stableUrl;\n\n            if (resolveResult.resolvedUrl) {\n              details.resolvedUrl = resolveResult.resolvedUrl;\n            }\n\n            details.rootUrl = resolveResult.rootUrl;\n\n          case 33:\n            if (!details.resolvedUrl) {\n              _context.next = 38;\n              break;\n            }\n\n            _context.next = 36;\n            return resolver.readParentPackageJson(details.resolvedUrl, {\n              token: token\n            });\n\n          case 36:\n            packageInfo = _context.sent;\n\n            if (packageInfo) {\n              details.bareModule.version = packageInfo.packageJson.version;\n            }\n\n          case 38:\n            return _context.abrupt(\"return\", details);\n\n          case 39:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[10, 14]]);\n  }));\n\n  return function resolveBareModuleToUnpkgWithDetails(_x, _x2, _x3) {\n    return _ref5.apply(this, arguments);\n  };\n}();\n/**\n *\n * @param {typeof import('.')} Velcro\n * @returns {import('./runtime').IRuntime}\n */\n\n\nfunction createRuntime(Velcro) {\n  var aliasesSymbol = Symbol.for('velcro.aliases');\n  var modulesSymbol = Symbol.for('velcro.modules');\n  var registrySymbol = Symbol.for('velcro.registry');\n  var rootSymbol = Symbol.for('velcro.root');\n\n  function Runtime() {\n    this[aliasesSymbol] = Object.create(null);\n    this[modulesSymbol] = Object.create(null);\n    this[registrySymbol] = Object.create(null);\n    this[Symbol.toStringTag] = 'Module';\n    var self = this;\n    Object.defineProperty(this, 'root', {\n      configurable: false,\n      enumerable: true,\n      get: function get() {\n        var root = self[rootSymbol];\n\n        if (!root) {\n          root = new Module('velcro://root', self);\n          self[rootSymbol] = root;\n        }\n\n        return root;\n      }\n    });\n  }\n\n  Runtime.prototype.alias = function (name, id) {\n    this[aliasesSymbol][name] = id;\n  };\n\n  Runtime.prototype.import = function (name) {\n    return new Promise(function (resolve, reject) {\n      try {\n        return resolve(Velcro.runtime.require(name));\n      } catch (err) {\n        return reject(err);\n      }\n    });\n  };\n  /**\n   * @param {string} id\n   * @param {ModuleFactory} factory\n   */\n\n\n  Runtime.prototype.register = function (id, factory) {\n    if (!this[registrySymbol][id]) {\n      this[registrySymbol][id] = factory;\n    }\n  };\n\n  Runtime.prototype.remove = function (id) {\n    id = this[aliasesSymbol][id] || id;\n    var module = this[modulesSymbol][id];\n\n    if (!module) {\n      return false;\n    }\n\n    var seen = new Set();\n    var removalQueue = [module];\n\n    while (removalQueue.length) {\n      var moduleToRemove = removalQueue.shift();\n\n      if (seen.has(moduleToRemove)) {\n        continue;\n      }\n\n      seen.add(moduleToRemove);\n      removalQueue.push.apply(removalQueue, _toConsumableArray(moduleToRemove.dependents));\n      delete this[modulesSymbol][moduleToRemove.id];\n    }\n\n    return true;\n  };\n\n  Runtime.prototype.require = function (id) {\n    return this.root.require(this[aliasesSymbol][id] || id);\n  };\n\n  function Module(id, runtime) {\n    this.exports = {};\n    this.dependents = new Set();\n    this.id = id;\n    this.runtime = runtime;\n  }\n\n  Module.prototype.require = function (id) {\n    id = this.runtime[aliasesSymbol][id] || id;\n    var module = this.runtime[modulesSymbol][id];\n\n    if (!module) {\n      var factory = this.runtime[registrySymbol][id];\n\n      if (!factory) {\n        console.error();\n        throw new Error(\"Factory missing for \".concat(id));\n      }\n\n      module = new Module(id, this.runtime);\n      this.runtime[modulesSymbol][id] = module;\n      var dirname = id;\n      var filename = id;\n      var util = Velcro.util;\n\n      if (util && util.dirname) {\n        dirname = util.dirname(id);\n      }\n\n      if (util && util.basename) {\n        filename = util.basename(id);\n      }\n\n      factory.call(module.exports, module, module.exports, module.require.bind(module), dirname, filename);\n    }\n\n    module.dependents.add(this);\n    return module.exports;\n  };\n\n  var runtime = Velcro.runtime;\n\n  if (!runtime) {\n    runtime = new Runtime();\n    Velcro.runtime = runtime;\n  }\n\n  return Runtime;\n}\n\nvar ExtendableError =\n/*#__PURE__*/\nfunction (_Error) {\n  _inherits(ExtendableError, _Error);\n\n  function ExtendableError(message) {\n    var _this2;\n\n    _classCallCheck(this, ExtendableError);\n\n    _this2 = _possibleConstructorReturn(this, _getPrototypeOf(ExtendableError).call(this, message));\n    _this2.name = _this2.constructor.name;\n\n    if (typeof Error.captureStackTrace === 'function') {\n      Error.captureStackTrace(_assertThisInitialized(_this2), _this2.constructor);\n    } else {\n      _this2.stack = new Error(message).stack;\n    }\n\n    return _this2;\n  }\n\n  return ExtendableError;\n}(_wrapNativeSuper(Error));\n\nvar InvariantViolation =\n/*#__PURE__*/\nfunction (_ExtendableError) {\n  _inherits(InvariantViolation, _ExtendableError);\n\n  function InvariantViolation() {\n    _classCallCheck(this, InvariantViolation);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(InvariantViolation).apply(this, arguments));\n  }\n\n  return InvariantViolation;\n}(ExtendableError);\n\nvar ResolveError =\n/*#__PURE__*/\nfunction (_ExtendableError2) {\n  _inherits(ResolveError, _ExtendableError2);\n\n  function ResolveError(href, fromHref) {\n    var _this3;\n\n    _classCallCheck(this, ResolveError);\n\n    _this3 = _possibleConstructorReturn(this, _getPrototypeOf(ResolveError).call(this, \"Unable to resolve '\".concat(href, \"'\").concat(fromHref ? \" from '\".concat(fromHref, \"'\") : '')));\n    _this3.href = href;\n    _this3.fromHref = fromHref;\n    return _this3;\n  }\n\n  return ResolveError;\n}(ExtendableError);\n\nvar EMPTY_MODULE_URL = new URL('velcro://@empty');\nvar EMPTY_MODULE_CODE = 'module.exports = function(){};';\nvar DEFAULT_SHIM_GLOBALS = {\n  Buffer: {\n    spec: \"@velcro/node-libs@\".concat(version, \"/lib/buffer.js\"),\n    export: 'Buffer'\n  },\n  global: {\n    spec: \"@velcro/node-libs@\".concat(version, \"/lib/global.js\")\n  },\n  process: {\n    spec: \"@velcro/node-libs@\".concat(version, \"/lib/process.js\")\n  }\n};\n\nvar Bundler =\n/*#__PURE__*/\nfunction () {\n  function Bundler(options) {\n    _classCallCheck(this, Bundler);\n\n    this.assetsByHref = new Map(); // private readonly assetsByRootHref = new Map<string, Set<Asset>>();\n\n    this.pendingResolves = new Map();\n    this.onAssetAddedEmitter = new Emitter();\n    this.onAssetRemovedEmitter = new Emitter();\n    this.resolver = options.resolver;\n  }\n\n  _createClass(Bundler, [{\n    key: \"dispose\",\n    value: function dispose() {\n      this.onAssetAddedEmitter.dispose();\n      this.onAssetRemovedEmitter.dispose();\n      this.assetsByHref.clear(); // this.assetsByRootHref.clear();\n\n      this.pendingResolves.clear();\n    }\n  }, {\n    key: \"getOrCreateAsset\",\n    value: function getOrCreateAsset(resolveDetails) {\n      var asset = this.assetsByHref.get(resolveDetails.resolvedHref);\n\n      if (!asset) {\n        asset = new Asset(resolveDetails.resolvedHref, resolveDetails.rootHref);\n        this.assetsByHref.set(resolveDetails.resolvedHref, asset);\n        this.onAssetAddedEmitter.fire(asset);\n      }\n\n      return asset;\n    }\n  }, {\n    key: \"generateBundleCode\",\n    value: function () {\n      var _generateBundleCode = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(entrypoints) {\n        var _this4 = this;\n\n        var options,\n            tokenSource,\n            token,\n            disposable,\n            pendingOperations,\n            assets,\n            dfd,\n            dependenciesToAliases,\n            entrypointsToAssets,\n            enqueueUnresolvedAsset,\n            _loop4,\n            name,\n            _iteratorNormalCompletion8,\n            _didIteratorError8,\n            _iteratorError8,\n            _loop5,\n            _iterator8,\n            _step8,\n            bundle,\n            _iteratorNormalCompletion9,\n            _didIteratorError9,\n            _iteratorError9,\n            _iterator9,\n            _step9,\n            _asset,\n            magicString,\n            _iteratorNormalCompletion12,\n            _didIteratorError12,\n            _iteratorError12,\n            _iterator12,\n            _step12,\n            dependency,\n            _iteratorNormalCompletion10,\n            _didIteratorError10,\n            _iteratorError10,\n            _iterator10,\n            _step10,\n            _ref12,\n            _ref11,\n            _name,\n            _asset2,\n            _iteratorNormalCompletion11,\n            _didIteratorError11,\n            _iteratorError11,\n            _iterator11,\n            _step11,\n            asset,\n            bundleCode,\n            sourceMapSuffix,\n            sourceMap,\n            seen,\n            combinedMap,\n            _args3 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                options = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : {};\n\n                if (Array.isArray(entrypoints)) {\n                  _context3.next = 3;\n                  break;\n                }\n\n                throw new Error('Generating a bundle requires passing in an array of entrypoints');\n\n              case 3:\n                tokenSource = new CancellationTokenSource();\n                token = tokenSource.token;\n\n                if (options.token) {\n                  disposable = options.token.onCancellationRequested(function () {\n                    tokenSource.cancel();\n                    disposable.dispose();\n                  });\n                }\n\n                pendingOperations = 0;\n                assets = new Set();\n                dfd = new Deferred();\n                dependenciesToAliases = new Map();\n                entrypointsToAssets = new Map();\n\n                enqueueUnresolvedAsset =\n                /*#__PURE__*/\n                function () {\n                  var _ref7 = _asyncToGenerator(\n                  /*#__PURE__*/\n                  _regeneratorRuntime.mark(function _callee2(spec, fromSpec) {\n                    var resolvedSpec, href, asset, _asset$dependencies2, code, promises, _iteratorNormalCompletion5, _didIteratorError5, _iteratorError5, _loop, _iterator5, _step5, _iteratorNormalCompletion6, _didIteratorError6, _iteratorError6, _loop2, _iterator6, _step6, _iteratorNormalCompletion7, _didIteratorError7, _iteratorError7, _loop3, _iterator7, _step7, _ref9, dependencies;\n\n                    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                      while (1) {\n                        switch (_context2.prev = _context2.next) {\n                          case 0:\n                            _context2.prev = 0;\n                            pendingOperations++;\n\n                            if (options.onEnqueueAsset) {\n                              options.onEnqueueAsset();\n                            }\n\n                            _context2.next = 5;\n                            return _this4.resolveWithDetails(spec, fromSpec, {\n                              token: token\n                            });\n\n                          case 5:\n                            resolvedSpec = _context2.sent;\n                            href = resolvedSpec.resolvedHref;\n                            asset = _this4.getOrCreateAsset(resolvedSpec); // No need to re-process the same asset during the same operation\n\n                            if (assets.has(asset)) {\n                              _context2.next = 80;\n                              break;\n                            }\n\n                            assets.add(asset);\n\n                            if (asset.magicString) {\n                              _context2.next = 15;\n                              break;\n                            }\n\n                            _context2.next = 13;\n                            return _this4.readCode(asset, {\n                              token: token\n                            });\n\n                          case 13:\n                            code = _context2.sent;\n                            asset.setCode(code);\n\n                          case 15:\n                            promises = [];\n                            _iteratorNormalCompletion5 = true;\n                            _didIteratorError5 = false;\n                            _iteratorError5 = undefined;\n                            _context2.prev = 19;\n\n                            _loop = function _loop() {\n                              var dependency = _step5.value;\n                              promises.push(enqueueUnresolvedAsset(dependency.spec.value, href).then(function (dependencyAsset) {\n                                return {\n                                  type: Asset.DependencyKind.Require,\n                                  href: dependencyAsset.href,\n                                  rootHref: dependencyAsset.rootHref,\n                                  callee: dependency.callee,\n                                  spec: dependency.spec,\n                                  value: dependency.spec.value\n                                };\n                              }));\n                            };\n\n                            for (_iterator5 = asset.unresolvedDependencies.requireDependencies[Symbol.iterator](); !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n                              _loop();\n                            }\n\n                            _context2.next = 28;\n                            break;\n\n                          case 24:\n                            _context2.prev = 24;\n                            _context2.t0 = _context2[\"catch\"](19);\n                            _didIteratorError5 = true;\n                            _iteratorError5 = _context2.t0;\n\n                          case 28:\n                            _context2.prev = 28;\n                            _context2.prev = 29;\n\n                            if (!_iteratorNormalCompletion5 && _iterator5.return != null) {\n                              _iterator5.return();\n                            }\n\n                          case 31:\n                            _context2.prev = 31;\n\n                            if (!_didIteratorError5) {\n                              _context2.next = 34;\n                              break;\n                            }\n\n                            throw _iteratorError5;\n\n                          case 34:\n                            return _context2.finish(31);\n\n                          case 35:\n                            return _context2.finish(28);\n\n                          case 36:\n                            _iteratorNormalCompletion6 = true;\n                            _didIteratorError6 = false;\n                            _iteratorError6 = undefined;\n                            _context2.prev = 39;\n\n                            _loop2 = function _loop2() {\n                              var dependency = _step6.value;\n                              promises.push(enqueueUnresolvedAsset(dependency.spec.value, href).then(function (dependencyAsset) {\n                                return {\n                                  type: Asset.DependencyKind.RequireResolve,\n                                  href: dependencyAsset.href,\n                                  rootHref: dependencyAsset.rootHref,\n                                  callee: dependency.callee,\n                                  spec: dependency.spec,\n                                  value: dependency.spec.value\n                                };\n                              }));\n                            };\n\n                            for (_iterator6 = asset.unresolvedDependencies.requireResolveDependencies[Symbol.iterator](); !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {\n                              _loop2();\n                            }\n\n                            _context2.next = 48;\n                            break;\n\n                          case 44:\n                            _context2.prev = 44;\n                            _context2.t1 = _context2[\"catch\"](39);\n                            _didIteratorError6 = true;\n                            _iteratorError6 = _context2.t1;\n\n                          case 48:\n                            _context2.prev = 48;\n                            _context2.prev = 49;\n\n                            if (!_iteratorNormalCompletion6 && _iterator6.return != null) {\n                              _iterator6.return();\n                            }\n\n                          case 51:\n                            _context2.prev = 51;\n\n                            if (!_didIteratorError6) {\n                              _context2.next = 54;\n                              break;\n                            }\n\n                            throw _iteratorError6;\n\n                          case 54:\n                            return _context2.finish(51);\n\n                          case 55:\n                            return _context2.finish(48);\n\n                          case 56:\n                            _iteratorNormalCompletion7 = true;\n                            _didIteratorError7 = false;\n                            _iteratorError7 = undefined;\n                            _context2.prev = 59;\n\n                            _loop3 = function _loop3() {\n                              var _ref8 = _step7.value;\n                              _ref9 = _slicedToArray(_ref8, 2);\n                              var symbolName = _ref9[0];\n                              var references = _ref9[1];\n                              var shim = DEFAULT_SHIM_GLOBALS[symbolName];\n\n                              if (shim) {\n                                promises.push(enqueueUnresolvedAsset(shim.spec, href).then(function (dependencyAsset) {\n                                  return {\n                                    type: Asset.DependencyKind.InjectedGlobal,\n                                    href: dependencyAsset.href,\n                                    rootHref: dependencyAsset.rootHref,\n                                    references: references,\n                                    exportName: shim.export,\n                                    symbolName: symbolName,\n                                    value: \"\".concat(shim.spec).concat(shim.export ? \"[\".concat(JSON.stringify(shim.export), \"]\") : '')\n                                  };\n                                }));\n                              }\n                            };\n\n                            for (_iterator7 = asset.unresolvedDependencies.unboundSymbols[Symbol.iterator](); !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {\n                              _loop3();\n                            }\n\n                            _context2.next = 68;\n                            break;\n\n                          case 64:\n                            _context2.prev = 64;\n                            _context2.t2 = _context2[\"catch\"](59);\n                            _didIteratorError7 = true;\n                            _iteratorError7 = _context2.t2;\n\n                          case 68:\n                            _context2.prev = 68;\n                            _context2.prev = 69;\n\n                            if (!_iteratorNormalCompletion7 && _iterator7.return != null) {\n                              _iterator7.return();\n                            }\n\n                          case 71:\n                            _context2.prev = 71;\n\n                            if (!_didIteratorError7) {\n                              _context2.next = 74;\n                              break;\n                            }\n\n                            throw _iteratorError7;\n\n                          case 74:\n                            return _context2.finish(71);\n\n                          case 75:\n                            return _context2.finish(68);\n\n                          case 76:\n                            _context2.next = 78;\n                            return Promise.all(promises);\n\n                          case 78:\n                            dependencies = _context2.sent;\n\n                            (_asset$dependencies2 = asset.dependencies).splice.apply(_asset$dependencies2, [0, asset.dependencies.length].concat(_toConsumableArray(dependencies)));\n\n                          case 80:\n                            pendingOperations--;\n\n                            if (options.onCompleteAsset) {\n                              options.onCompleteAsset();\n                            }\n\n                            if (!(pendingOperations < 0)) {\n                              _context2.next = 84;\n                              break;\n                            }\n\n                            throw new InvariantViolation('Pending operations fell below zero');\n\n                          case 84:\n                            if (pendingOperations === 0) {\n                              // Let's make sure this happens 'later'.\n                              Promise.resolve().then(function () {\n                                return dfd.resolve();\n                              });\n                            }\n\n                            return _context2.abrupt(\"return\", asset);\n\n                          case 88:\n                            _context2.prev = 88;\n                            _context2.t3 = _context2[\"catch\"](0);\n\n                            if (options.onCompleteAsset) {\n                              options.onCompleteAsset();\n                            } // Let's make sure this happens 'later'.\n\n\n                            Promise.resolve().then(function () {\n                              return dfd.reject(_context2.t3);\n                            });\n                            throw _context2.t3;\n\n                          case 93:\n                          case \"end\":\n                            return _context2.stop();\n                        }\n                      }\n                    }, _callee2, null, [[0, 88], [19, 24, 28, 36], [29,, 31, 35], [39, 44, 48, 56], [49,, 51, 55], [59, 64, 68, 76], [69,, 71, 75]]);\n                  }));\n\n                  return function enqueueUnresolvedAsset(_x5, _x6) {\n                    return _ref7.apply(this, arguments);\n                  };\n                }();\n\n                if (options.dependencies) {\n                  _loop4 = function _loop4(name) {\n                    enqueueUnresolvedAsset(\"\".concat(name, \"@\").concat(options.dependencies[name])).then(function (asset) {\n                      return dependenciesToAliases.set(name, asset);\n                    }, function (_) {\n                      return undefined;\n                    });\n                  };\n\n                  for (name in options.dependencies) {\n                    _loop4(name);\n                  }\n                }\n\n                _iteratorNormalCompletion8 = true;\n                _didIteratorError8 = false;\n                _iteratorError8 = undefined;\n                _context3.prev = 16;\n\n                _loop5 = function _loop5() {\n                  var entrypoint = _step8.value;\n                  // We need to add a catch handler because we might not catch all thrown exceptions,\n                  // only the first, via the dfd.promise.\n                  enqueueUnresolvedAsset(entrypoint).then(function (asset) {\n                    return entrypointsToAssets.set(entrypoint, asset);\n                  }, function (_) {\n                    return undefined;\n                  });\n                };\n\n                for (_iterator8 = entrypoints[Symbol.iterator](); !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {\n                  _loop5();\n                }\n\n                _context3.next = 25;\n                break;\n\n              case 21:\n                _context3.prev = 21;\n                _context3.t0 = _context3[\"catch\"](16);\n                _didIteratorError8 = true;\n                _iteratorError8 = _context3.t0;\n\n              case 25:\n                _context3.prev = 25;\n                _context3.prev = 26;\n\n                if (!_iteratorNormalCompletion8 && _iterator8.return != null) {\n                  _iterator8.return();\n                }\n\n              case 28:\n                _context3.prev = 28;\n\n                if (!_didIteratorError8) {\n                  _context3.next = 31;\n                  break;\n                }\n\n                throw _iteratorError8;\n\n              case 31:\n                return _context3.finish(28);\n\n              case 32:\n                return _context3.finish(25);\n\n              case 33:\n                _context3.next = 35;\n                return dfd.promise;\n\n              case 35:\n                // Now all assets should be fully loaded\n                bundle = new Bundle({\n                  separator: '\\n'\n                });\n                _iteratorNormalCompletion9 = true;\n                _didIteratorError9 = false;\n                _iteratorError9 = undefined;\n                _context3.prev = 39;\n                _iterator9 = assets[Symbol.iterator]();\n\n              case 41:\n                if (_iteratorNormalCompletion9 = (_step9 = _iterator9.next()).done) {\n                  _context3.next = 88;\n                  break;\n                }\n\n                _asset = _step9.value;\n\n                if (_asset.magicString) {\n                  _context3.next = 45;\n                  break;\n                }\n\n                throw new Error(\"Invariant violation: asset is not loaded '\".concat(_asset.href, \"'\"));\n\n              case 45:\n                magicString = _asset.magicString.clone();\n                magicString.trim(); // We'll replace each dependency string with the resolved stable href. The stable href doesn't require any\n                // information about where it is being resolved from, so it is useful as a long-term pointer whose target\n                // can change over time\n\n                _iteratorNormalCompletion12 = true;\n                _didIteratorError12 = false;\n                _iteratorError12 = undefined;\n                _context3.prev = 50;\n                _iterator12 = _asset.dependencies[Symbol.iterator]();\n\n              case 52:\n                if (_iteratorNormalCompletion12 = (_step12 = _iterator12.next()).done) {\n                  _context3.next = 67;\n                  break;\n                }\n\n                dependency = _step12.value;\n                _context3.t1 = dependency.type;\n                _context3.next = _context3.t1 === Asset.DependencyKind.Require ? 57 : _context3.t1 === Asset.DependencyKind.RequireResolve ? 59 : _context3.t1 === Asset.DependencyKind.InjectedGlobal ? 61 : 63;\n                break;\n\n              case 57:\n                magicString.overwrite(dependency.spec.start, dependency.spec.end, JSON.stringify(dependency.href)); // magicString.overwrite(dependency.callee.start, dependency.callee.end, '__velcro_require');\n\n                return _context3.abrupt(\"break\", 64);\n\n              case 59:\n                magicString.overwrite(dependency.spec.start, dependency.spec.end, JSON.stringify(dependency.href)); // magicString.overwrite(dependency.callee.start, dependency.callee.end, '__velcro_require_resolve');\n\n                return _context3.abrupt(\"break\", 64);\n\n              case 61:\n                magicString.prepend(\"const \".concat(dependency.symbolName, \" = require(\").concat(JSON.stringify(dependency.href), \")\").concat(dependency.exportName ? \".\".concat(dependency.exportName) : '', \";\\n\"));\n                return _context3.abrupt(\"break\", 64);\n\n              case 63:\n                throw new Error(\"Invariant violation: Encountered unexpected dependency kind '\".concat(dependency.type, \"'\"));\n\n              case 64:\n                _iteratorNormalCompletion12 = true;\n                _context3.next = 52;\n                break;\n\n              case 67:\n                _context3.next = 73;\n                break;\n\n              case 69:\n                _context3.prev = 69;\n                _context3.t2 = _context3[\"catch\"](50);\n                _didIteratorError12 = true;\n                _iteratorError12 = _context3.t2;\n\n              case 73:\n                _context3.prev = 73;\n                _context3.prev = 74;\n\n                if (!_iteratorNormalCompletion12 && _iterator12.return != null) {\n                  _iterator12.return();\n                }\n\n              case 76:\n                _context3.prev = 76;\n\n                if (!_didIteratorError12) {\n                  _context3.next = 79;\n                  break;\n                }\n\n                throw _iteratorError12;\n\n              case 79:\n                return _context3.finish(76);\n\n              case 80:\n                return _context3.finish(73);\n\n              case 81:\n                magicString.trim();\n                magicString.prepend(\"Velcro.runtime.register(\".concat(JSON.stringify(_asset.href), \", function(module, exports, require, __dirname, __filename){\\n\"));\n                magicString.append('\\n});');\n                bundle.addSource(magicString);\n\n              case 85:\n                _iteratorNormalCompletion9 = true;\n                _context3.next = 41;\n                break;\n\n              case 88:\n                _context3.next = 94;\n                break;\n\n              case 90:\n                _context3.prev = 90;\n                _context3.t3 = _context3[\"catch\"](39);\n                _didIteratorError9 = true;\n                _iteratorError9 = _context3.t3;\n\n              case 94:\n                _context3.prev = 94;\n                _context3.prev = 95;\n\n                if (!_iteratorNormalCompletion9 && _iterator9.return != null) {\n                  _iterator9.return();\n                }\n\n              case 97:\n                _context3.prev = 97;\n\n                if (!_didIteratorError9) {\n                  _context3.next = 100;\n                  break;\n                }\n\n                throw _iteratorError9;\n\n              case 100:\n                return _context3.finish(97);\n\n              case 101:\n                return _context3.finish(94);\n\n              case 102:\n                bundle.prepend(\"(\".concat(createRuntime.toString(), \")(typeof globalThis === 'object' ? (globalThis.Velcro || (globalThis.Velcro = {})) : (this.Velcro || (this.Velcro = {})));\\n\"));\n                _iteratorNormalCompletion10 = true;\n                _didIteratorError10 = false;\n                _iteratorError10 = undefined;\n                _context3.prev = 106;\n\n                for (_iterator10 = dependenciesToAliases[Symbol.iterator](); !(_iteratorNormalCompletion10 = (_step10 = _iterator10.next()).done); _iteratorNormalCompletion10 = true) {\n                  _ref12 = _step10.value;\n                  _ref11 = _slicedToArray(_ref12, 2);\n                  _name = _ref11[0];\n                  _asset2 = _ref11[1];\n                  bundle.append(\"Velcro.runtime.alias(\".concat(JSON.stringify(_name), \", \").concat(JSON.stringify(_asset2.href), \");\\n\"));\n                }\n\n                _context3.next = 114;\n                break;\n\n              case 110:\n                _context3.prev = 110;\n                _context3.t4 = _context3[\"catch\"](106);\n                _didIteratorError10 = true;\n                _iteratorError10 = _context3.t4;\n\n              case 114:\n                _context3.prev = 114;\n                _context3.prev = 115;\n\n                if (!_iteratorNormalCompletion10 && _iterator10.return != null) {\n                  _iterator10.return();\n                }\n\n              case 117:\n                _context3.prev = 117;\n\n                if (!_didIteratorError10) {\n                  _context3.next = 120;\n                  break;\n                }\n\n                throw _iteratorError10;\n\n              case 120:\n                return _context3.finish(117);\n\n              case 121:\n                return _context3.finish(114);\n\n              case 122:\n                if (!options.requireEntrypoints) {\n                  _context3.next = 142;\n                  break;\n                }\n\n                _iteratorNormalCompletion11 = true;\n                _didIteratorError11 = false;\n                _iteratorError11 = undefined;\n                _context3.prev = 126;\n\n                for (_iterator11 = entrypointsToAssets.values()[Symbol.iterator](); !(_iteratorNormalCompletion11 = (_step11 = _iterator11.next()).done); _iteratorNormalCompletion11 = true) {\n                  asset = _step11.value;\n                  bundle.append(\"Velcro.runtime.require(\".concat(JSON.stringify(asset.href), \");\\n\"));\n                }\n\n                _context3.next = 134;\n                break;\n\n              case 130:\n                _context3.prev = 130;\n                _context3.t5 = _context3[\"catch\"](126);\n                _didIteratorError11 = true;\n                _iteratorError11 = _context3.t5;\n\n              case 134:\n                _context3.prev = 134;\n                _context3.prev = 135;\n\n                if (!_iteratorNormalCompletion11 && _iterator11.return != null) {\n                  _iterator11.return();\n                }\n\n              case 137:\n                _context3.prev = 137;\n\n                if (!_didIteratorError11) {\n                  _context3.next = 140;\n                  break;\n                }\n\n                throw _iteratorError11;\n\n              case 140:\n                return _context3.finish(137);\n\n              case 141:\n                return _context3.finish(134);\n\n              case 142:\n                _context3.next = 144;\n                return new Promise(function (resolve) {\n                  return setTimeout(resolve, 0);\n                });\n\n              case 144:\n                if (!token.isCancellationRequested) {\n                  _context3.next = 146;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 146:\n                bundleCode = bundle.toString();\n                sourceMapSuffix = '';\n\n                if (!options.sourceMap) {\n                  _context3.next = 158;\n                  break;\n                }\n\n                sourceMap = bundle.generateMap({\n                  includeContent: true,\n                  hires: false\n                });\n                sourceMap.file = \"velcro://bundle.js\"; // Yield to event loop\n\n                _context3.next = 153;\n                return new Promise(function (resolve) {\n                  return setTimeout(resolve, 0);\n                });\n\n              case 153:\n                if (!token.isCancellationRequested) {\n                  _context3.next = 155;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 155:\n                // In case a source map seems to be self-referential, avoid crashing\n                seen = new Set();\n                combinedMap = remapping(sourceMap.toString(), function (uri) {\n                  var asset = _this4.assetsByHref.get(uri);\n\n                  if (asset && asset.sourceMappingUrl) {\n                    if (seen.has(asset)) {\n                      return null;\n                    }\n\n                    seen.add(asset);\n                    var match = asset.sourceMappingUrl.match(/^data:application\\/json;(?:charset=([^;]+);)?base64,(.*)$/);\n\n                    if (match) {\n                      if (match[1] && match[1] !== 'utf-8') {\n                        return null;\n                      }\n\n                      try {\n                        var decoded = JSON.parse(Base64.decode(match[2]));\n                        return decoded;\n                      } catch (err) {\n                        return null;\n                      }\n                    }\n                  }\n\n                  return null;\n                }, false);\n                sourceMapSuffix = \"\\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(Base64.encode(JSON.stringify(combinedMap)));\n\n              case 158:\n                return _context3.abrupt(\"return\", \"\".concat(bundleCode).concat(sourceMapSuffix));\n\n              case 159:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[16, 21, 25, 33], [26,, 28, 32], [39, 90, 94, 102], [50, 69, 73, 81], [74,, 76, 80], [95,, 97, 101], [106, 110, 114, 122], [115,, 117, 121], [126, 130, 134, 142], [135,, 137, 141]]);\n      }));\n\n      function generateBundleCode(_x4) {\n        return _generateBundleCode.apply(this, arguments);\n      }\n\n      return generateBundleCode;\n    }()\n  }, {\n    key: \"invalidate\",\n    value: function () {\n      var _invalidate = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(spec) {\n        var _ref13,\n            token,\n            asset,\n            resolveResult,\n            combinedUri,\n            _args4 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _ref13 = _args4.length > 1 && _args4[1] !== undefined ? _args4[1] : {}, token = _ref13.token;\n                asset = this.assetsByHref.get(spec);\n\n                if (asset) {\n                  _context4.next = 25;\n                  break;\n                }\n\n                // We can't use Bundler::resolveWithDetails() because that will throw\n                // when a module isn't found. We just want to attempt to resolve and\n                // return true / false accordingly.\n                resolveResult = undefined;\n                _context4.prev = 4;\n\n                if (!isBareModuleSpecifier(spec)) {\n                  _context4.next = 11;\n                  break;\n                }\n\n                _context4.next = 8;\n                return resolveBareModuleToUnpkgWithDetails(this.resolver, spec, undefined, {\n                  token: token\n                });\n\n              case 8:\n                resolveResult = _context4.sent;\n                _context4.next = 15;\n                break;\n\n              case 11:\n                combinedUri = new URL(spec);\n                _context4.next = 14;\n                return this.resolver.resolve(combinedUri, {\n                  token: token\n                });\n\n              case 14:\n                resolveResult = _context4.sent;\n\n              case 15:\n                _context4.next = 22;\n                break;\n\n              case 17:\n                _context4.prev = 17;\n                _context4.t0 = _context4[\"catch\"](4);\n\n                if (!(_context4.t0 instanceof EntryNotFoundError)) {\n                  _context4.next = 21;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\", false);\n\n              case 21:\n                throw _context4.t0;\n\n              case 22:\n                if (!(!resolveResult || !resolveResult.resolvedUrl)) {\n                  _context4.next = 24;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\", false);\n\n              case 24:\n                asset = this.assetsByHref.get(resolveResult.resolvedUrl.href);\n\n              case 25:\n                if (!asset) {\n                  _context4.next = 28;\n                  break;\n                }\n\n                this.removeAsset(asset);\n                return _context4.abrupt(\"return\", true);\n\n              case 28:\n                return _context4.abrupt(\"return\", false);\n\n              case 29:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[4, 17]]);\n      }));\n\n      function invalidate(_x7) {\n        return _invalidate.apply(this, arguments);\n      }\n\n      return invalidate;\n    }()\n  }, {\n    key: \"removeAsset\",\n    value: function removeAsset(asset) {\n      var hadAsset = this.assetsByHref.delete(asset.href);\n\n      if (hadAsset) {\n        this.onAssetRemovedEmitter.fire(asset);\n      }\n    }\n  }, {\n    key: \"readCode\",\n    value: function () {\n      var _readCode = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee5(asset, _ref14) {\n        var token, buf, code;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                token = _ref14.token;\n\n                if (!(asset.href === EMPTY_MODULE_URL.href)) {\n                  _context5.next = 3;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\", EMPTY_MODULE_CODE);\n\n              case 3:\n                _context5.next = 5;\n                return this.resolver.host.readFileContent(this.resolver, new URL(asset.href), {\n                  token: token\n                });\n\n              case 5:\n                buf = _context5.sent;\n                code = this.resolver.decoder.decode(buf);\n                return _context5.abrupt(\"return\", code);\n\n              case 8:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function readCode(_x8, _x9) {\n        return _readCode.apply(this, arguments);\n      }\n\n      return readCode;\n    }()\n  }, {\n    key: \"resolveWithDetails\",\n    value: function () {\n      var _resolveWithDetails = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee6(uri, fromUri, _ref15) {\n        var token, resolved, bareModuleResolveResult, resolvedHref, combinedUri, resolveResult, resolvedUri, _resolvedHref, rootHref;\n\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                token = _ref15.token;\n\n                if (!isBareModuleSpecifier(uri)) {\n                  _context6.next = 13;\n                  break;\n                }\n\n                _context6.next = 4;\n                return resolveBareModuleToUnpkgWithDetails(this.resolver, uri, fromUri, {\n                  token: token\n                });\n\n              case 4:\n                bareModuleResolveResult = _context6.sent;\n\n                if (bareModuleResolveResult.stableUrl) {\n                  _context6.next = 7;\n                  break;\n                }\n\n                throw new Error(\"Failed to resolve bare module '\".concat(uri, \"' from '\").concat(fromUri || '@root', \"' to a stable url\"));\n\n              case 7:\n                if (bareModuleResolveResult.stableRootUrl) {\n                  _context6.next = 9;\n                  break;\n                }\n\n                throw new Error(\"Failed to resolve bare module '\".concat(uri, \"' from '\").concat(fromUri || '@root', \"' to a stable root url\"));\n\n              case 9:\n                resolvedHref = bareModuleResolveResult.resolvedUrl ? bareModuleResolveResult.resolvedUrl.href : EMPTY_MODULE_URL.href;\n                resolved = {\n                  type: Bundler.ResolveDetailsKind.BareModule,\n                  bareModule: {\n                    isBuiltIn: bareModuleResolveResult.bareModule.isBuiltIn,\n                    version: bareModuleResolveResult.bareModule.version,\n                    versionSpec: bareModuleResolveResult.bareModule.versionSpec\n                  },\n                  ignored: bareModuleResolveResult.ignored,\n                  resolvedHref: resolvedHref,\n                  rootHref: bareModuleResolveResult.rootUrl.href,\n                  stableHref: bareModuleResolveResult.stableUrl.href,\n                  stableRootHref: bareModuleResolveResult.stableRootUrl.href\n                };\n                _context6.next = 21;\n                break;\n\n              case 13:\n                combinedUri = new URL(uri, fromUri);\n                _context6.next = 16;\n                return this.resolver.resolve(combinedUri);\n\n              case 16:\n                resolveResult = _context6.sent;\n\n                if (!resolveResult.resolvedUrl) {\n                  resolvedUri = EMPTY_MODULE_URL;\n                } else {\n                  resolvedUri = resolveResult.resolvedUrl;\n                }\n\n                _resolvedHref = resolvedUri.href;\n                rootHref = resolveResult.rootUrl.href;\n                resolved = {\n                  type: Bundler.ResolveDetailsKind.Relative,\n                  ignored: resolveResult.ignored,\n                  resolvedHref: _resolvedHref,\n                  rootHref: rootHref,\n                  stableHref: _resolvedHref,\n                  stableRootHref: rootHref\n                };\n\n              case 21:\n                return _context6.abrupt(\"return\", resolved);\n\n              case 22:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function resolveWithDetails(_x10, _x11, _x12) {\n        return _resolveWithDetails.apply(this, arguments);\n      }\n\n      return resolveWithDetails;\n    }()\n  }, {\n    key: \"onAssetAdded\",\n    get: function get() {\n      return this.onAssetAddedEmitter.event;\n    }\n  }, {\n    key: \"onAssetRemoved\",\n    get: function get() {\n      return this.onAssetRemovedEmitter.event;\n    }\n  }]);\n\n  return Bundler;\n}();\n\n(function (Bundler) {\n  var ResolveDetailsKind;\n\n  (function (ResolveDetailsKind) {\n    ResolveDetailsKind[\"BareModule\"] = \"bare_module\";\n    ResolveDetailsKind[\"Relative\"] = \"relative\";\n  })(ResolveDetailsKind = Bundler.ResolveDetailsKind || (Bundler.ResolveDetailsKind = {}));\n})(Bundler || (Bundler = {})); // export * from '@velcro/resolver';\n\n\nvar base64 = {\n  decode: Base64.decode,\n  encode: Base64.encode\n};\nvar Velcro =\n/*#__PURE__*/\nObject.freeze({\n  base64: base64,\n  CancellationToken: CancellationToken,\n  CancellationTokenSource: CancellationTokenSource$1,\n  getSourceMappingUrl: getSourceMappingUrl,\n\n  get Asset() {\n    return Asset;\n  },\n\n  get Bundler() {\n    return Bundler;\n  },\n\n  InvariantViolation: InvariantViolation,\n  ResolveError: ResolveError,\n  CanceledError: CanceledError\n});\nvar Runtime = createRuntime(globalThis['Velcro'] || (globalThis['Velcro'] = _objectSpread({}, Velcro)));\nvar runtime = new Runtime();\nexport { Asset, Bundler, InvariantViolation, ResolveError, base64, getSourceMappingUrl, runtime };","import _slicedToArray from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _classCallCheck from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport { AbstractResolverHost } from '@velcro/resolver';\n\nvar ResolverHostCompound =\n/*#__PURE__*/\nfunction (_AbstractResolverHost) {\n  _inherits(ResolverHostCompound, _AbstractResolverHost);\n\n  function ResolverHostCompound(hosts) {\n    var _this;\n\n    _classCallCheck(this, ResolverHostCompound);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ResolverHostCompound).call(this));\n    _this.hosts = new Map();\n\n    for (var prefix in hosts) {\n      _this.hosts.set(prefix, hosts[prefix]);\n    }\n\n    return _this;\n  }\n\n  _createClass(ResolverHostCompound, [{\n    key: \"getCanonicalUrl\",\n    value: function getCanonicalUrl(resolver, url) {\n      var href = url.href; // TODO: Decide whether a more efficient solution is needed\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.hosts[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var _ref3 = _step.value;\n\n          var _ref2 = _slicedToArray(_ref3, 2);\n\n          var prefix = _ref2[0];\n          var child = _ref2[1];\n\n          if (href.startsWith(prefix)) {\n            if (typeof child.getCanonicalUrl === 'function') {\n              // console.error(`getCanonicalUrl(%s): %s`, url.href, prefix);\n              return child.getCanonicalUrl(resolver, url);\n            }\n\n            break;\n          }\n        } // If the resolved child doesn't have this method, treat it as an identity function\n\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return Promise.resolve(url);\n    }\n  }, {\n    key: \"getResolveRoot\",\n    value: function getResolveRoot(resolver, url) {\n      var href = url.href; // TODO: Decide whether a more efficient solution is needed\n\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = this.hosts[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var _ref6 = _step2.value;\n\n          var _ref5 = _slicedToArray(_ref6, 2);\n\n          var prefix = _ref5[0];\n          var child = _ref5[1];\n\n          if (href.startsWith(prefix)) {\n            // console.error(`getResolveRoot(%s): %s`, url.href, prefix);\n            return child.getResolveRoot(resolver, url);\n          }\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      return Promise.reject(new Error(\"No suitable host found for url \".concat(href)));\n    }\n  }, {\n    key: \"listEntries\",\n    value: function listEntries(resolver, url) {\n      var href = url.href; // TODO: Decide whether a more efficient solution is needed\n\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = this.hosts[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var _ref9 = _step3.value;\n\n          var _ref8 = _slicedToArray(_ref9, 2);\n\n          var prefix = _ref8[0];\n          var child = _ref8[1];\n\n          if (href.startsWith(prefix)) {\n            // console.error(`listEntries(%s): %s`, url.href, prefix);\n            return child.listEntries(resolver, url);\n          }\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n\n      return Promise.reject(new Error(\"No suitable host found for url \".concat(href)));\n    }\n  }, {\n    key: \"readFileContent\",\n    value: function readFileContent(resolver, url) {\n      var href = url.href; // TODO: Decide whether a more efficient solution is needed\n\n      var _iteratorNormalCompletion4 = true;\n      var _didIteratorError4 = false;\n      var _iteratorError4 = undefined;\n\n      try {\n        for (var _iterator4 = this.hosts[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n          var _ref12 = _step4.value;\n\n          var _ref11 = _slicedToArray(_ref12, 2);\n\n          var prefix = _ref11[0];\n          var child = _ref11[1];\n\n          if (href.startsWith(prefix)) {\n            // console.error(`readFileContent(%s): %s`, url.href, prefix);\n            return child.readFileContent(resolver, url);\n          }\n        }\n      } catch (err) {\n        _didIteratorError4 = true;\n        _iteratorError4 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion4 && _iterator4.return != null) {\n            _iterator4.return();\n          }\n        } finally {\n          if (_didIteratorError4) {\n            throw _iteratorError4;\n          }\n        }\n      }\n\n      return Promise.reject(new Error(\"No suitable host found for url \".concat(href)));\n    }\n  }]);\n\n  return ResolverHostCompound;\n}(AbstractResolverHost);\n\nexport { ResolverHostCompound };","export interface Diagnostic {\n  message: string;\n  start?: { lineNumber: number; column: number };\n  end?: { lineNumber: number; column: number };\n  href?: string;\n}\n\nexport class ExtendableError extends Error {\n  constructor(message?: string) {\n    super(message);\n\n    this.name = this.constructor.name;\n  }\n}\n\nexport class InvariantError extends ExtendableError {}\n\nexport class TimeoutError extends ExtendableError {}\n\nexport class TranspileError extends ExtendableError {\n  constructor(message: string, readonly diagnostics: Diagnostic[]) {\n    super(message);\n  }\n}\n","import { Resolver, ResolvedEntryKind, AbstractResolverHost, ResolvedEntry } from '@velcro/resolver';\nimport * as Monaco from 'monaco-editor';\nimport { timeout } from 'ts-primitives';\n\nimport { InvariantError, TimeoutError, TranspileError, Diagnostic } from './error';\n\nconst LANGUAGE_TYPESCRIPT = 'typescript';\nconst MAX_TRANSPILE_ATTEMPTS = 3;\nconst TRANSPILE_TIMEOUT = 2000;\nconst TRANSPILE_TIMEOUT_BACKOFF = 500;\n\ntype Model = Monaco.editor.ITextModel;\n\nexport class ResolverHostMonaco extends AbstractResolverHost {\n  constructor(private readonly rootUri: Monaco.Uri = Monaco.Uri.file('/')) {\n    super();\n  }\n\n  get rootHref() {\n    return this.rootUri.toString(true);\n  }\n\n  async getResolveRoot() {\n    return new URL(this.rootUri.toString(true));\n  }\n\n  async listEntries(_resolver: Resolver, url: URL) {\n    const href = url.href.replace(/\\/?$/, '/');\n    const rootHref = this.rootUri.toString(true);\n\n    if (!href.startsWith(rootHref)) {\n      return [];\n    }\n\n    return Monaco.editor.getModels().reduce(\n      (entries, model) => {\n        const modelHref = model.uri.toString(true);\n        const seenDirs = new Set<string>();\n\n        if (modelHref.startsWith(href)) {\n          const nestedPath = modelHref.slice(href.length);\n          const nextDirIdx = nestedPath.indexOf('/');\n\n          if (nextDirIdx === 0) {\n            throw new Error('Invariant error: WAT?');\n          }\n\n          if (nextDirIdx > 0) {\n            // This is an intermediate directory\n            const url = new URL(nestedPath.slice(0, nextDirIdx + 1), href);\n\n            if (!seenDirs.has(url.href)) {\n              entries.push({\n                type: ResolvedEntryKind.Directory,\n                url,\n              });\n            }\n          } else {\n            entries.push({\n              type: ResolvedEntryKind.File,\n              url: new URL(modelHref),\n            });\n          }\n        }\n\n        return entries;\n      },\n      [] as ResolvedEntry[]\n    );\n  }\n\n  async readFileContent(_resolver: Resolver, url: URL) {\n    const href = url.href;\n\n    if (!href.startsWith(this.rootHref)) {\n      throw new InvariantError(\n        `Attempting to read file content for a model at '${href}' outside of this host's root '${this.rootHref}'`\n      );\n    }\n\n    const pathname = href.slice(this.rootHref.length);\n    const model = Monaco.editor.getModel(Monaco.Uri.file(pathname));\n\n    if (!model) {\n      throw new InvariantError(`Attempting to read file content for a model that doesn't exist at '${href}'`);\n    }\n\n    const encoder = new TextEncoder();\n    const output = await this.getTranspiledValue(model);\n\n    return encoder.encode(output);\n  }\n\n  private async getTranspiledValue(model: Monaco.editor.ITextModel) {\n    if (model.getModeId() === LANGUAGE_TYPESCRIPT) {\n      const href = model.uri.toString(true);\n      const tryLoadFromWorker = async () => {\n        const workerFactory = await Monaco.languages.typescript.getTypeScriptWorker();\n        const workerClient = await workerFactory(model.uri);\n        const [emitOutput, syntacticDiagnostics] = (await Promise.all([\n          workerClient.getEmitOutput(href),\n          workerClient.getSyntacticDiagnostics(href),\n        ])) as [import('typescript').EmitOutput, import('typescript').Diagnostic[]];\n\n        if (emitOutput.emitSkipped) {\n          throw new InvariantError(`Emit skipped when trying to read '${model.uri.fsPath}'`);\n        }\n\n        if (syntacticDiagnostics.length) {\n          const diagnostics: Diagnostic[] = syntacticDiagnostics.map(diagnostic => {\n            const startPosition =\n              typeof diagnostic.start === 'number' ? model.getPositionAt(diagnostic.start) : undefined;\n            const endPosition =\n              typeof diagnostic.start === 'number' && typeof diagnostic.length === 'number'\n                ? model.getPositionAt(diagnostic.start + diagnostic.length)\n                : undefined;\n\n            return {\n              message: flattenDiagnosticMessageText(diagnostic.messageText),\n              start: startPosition ? { lineNumber: startPosition.lineNumber, column: startPosition.column } : undefined,\n              end: endPosition ? { lineNumber: endPosition.lineNumber, column: endPosition.column } : undefined,\n              href: diagnostic.source,\n            };\n          });\n          throw new TranspileError(`${syntacticDiagnostics[0].messageText} at ${model.uri.fsPath}`, diagnostics);\n        }\n\n        return emitOutput.outputFiles[0].text;\n      };\n\n      let attempt = 0;\n\n      while (attempt++ < MAX_TRANSPILE_ATTEMPTS) {\n        try {\n          const code = await raceTimeout(tryLoadFromWorker(), TRANSPILE_TIMEOUT);\n\n          return code;\n        } catch (err) {\n          if (err instanceof TimeoutError) {\n            await timeout(TRANSPILE_TIMEOUT_BACKOFF * Math.pow(2, attempt));\n            continue;\n          }\n\n          throw err;\n        }\n      }\n\n      throw new TimeoutError(`Timed out while trying to transpile '${href}'`);\n    }\n\n    return model.getValue();\n  }\n}\n\nexport function flattenDiagnosticMessageText(\n  diag: string | import('typescript').DiagnosticMessageChain | undefined,\n  newLine: string = '\\n',\n  indent = 0\n): string {\n  if (typeof diag === 'string') {\n    return diag;\n  } else if (diag === undefined) {\n    return '';\n  }\n  let result = '';\n  if (indent) {\n    result += newLine;\n\n    for (let i = 0; i < indent; i++) {\n      result += '  ';\n    }\n  }\n  result += diag.messageText;\n  indent++;\n  if (diag.next) {\n    for (const kid of diag.next) {\n      result += flattenDiagnosticMessageText(kid, newLine, indent);\n    }\n  }\n  return result;\n}\n\nfunction raceTimeout<T>(promise: Promise<T>, timeoutMs: number): Promise<T> {\n  return Promise.race([\n    promise,\n    timeout(timeoutMs).then(() => {\n      return Promise.reject(new TimeoutError());\n    }),\n  ]);\n}\n","import _slicedToArray from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _createClass from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _classCallCheck from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _wrapNativeSuper from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper\";\nimport { ResolvedEntryKind, AbstractResolverHost, CanceledError, Resolver, util } from '@velcro/resolver';\nimport LRU from 'lru-cache';\nimport { validRange, satisfies } from 'semver';\n\nvar ExtendableError =\n/*#__PURE__*/\nfunction (_Error) {\n  _inherits(ExtendableError, _Error);\n\n  function ExtendableError(message) {\n    var _this;\n\n    _classCallCheck(this, ExtendableError);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ExtendableError).call(this, message));\n    _this.name = _this.constructor.name;\n\n    if (typeof Error.captureStackTrace === 'function') {\n      Error.captureStackTrace(_assertThisInitialized(_this), _this.constructor);\n    } else {\n      _this.stack = new Error(message).stack;\n    }\n\n    return _this;\n  }\n\n  return ExtendableError;\n}(_wrapNativeSuper(Error));\n\nvar EntryNotFoundError =\n/*#__PURE__*/\nfunction (_ExtendableError) {\n  _inherits(EntryNotFoundError, _ExtendableError);\n\n  function EntryNotFoundError(url) {\n    _classCallCheck(this, EntryNotFoundError);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(EntryNotFoundError).call(this, \"Not found \".concat(url.href)));\n  }\n\n  return EntryNotFoundError;\n}(ExtendableError);\n\nfunction isValidEntry(entry) {\n  if (!entry || typeof entry !== 'object') return false;\n  if (entry.type === ResolvedEntryKind.Directory) return isValidDirectory(entry);\n  if (entry.type === ResolvedEntryKind.File) return isValidFile(entry);\n  return false;\n}\n\nfunction isValidDirectory(entry) {\n  return typeof entry === 'object' && entry && entry.type === ResolvedEntryKind.Directory && typeof entry.path === 'string' && entry.path && (typeof entry.files === 'undefined' || Array.isArray(entry.files) && entry.files.every(isValidEntry));\n}\n\nfunction isValidFile(entry) {\n  return typeof entry === 'object' && entry && entry.type === ResolvedEntryKind.File && typeof entry.path === 'string' && entry.path;\n}\n\nvar UNPKG_SPEC_RX = /^\\/((@[^/]+\\/[^/@]+|[^/@]+)(?:@([^/]+))?)(.*)?$/;\n\nfunction parseUnpkgUrl(url) {\n  if (url instanceof URL) {\n    url = url.pathname;\n  }\n  /**\r\n   * 1: scope + name + version\r\n   * 2: scope + name\r\n   * 3: version?\r\n   * 4: pathname\r\n   */\n\n\n  var matches = url.match(UNPKG_SPEC_RX);\n\n  if (!matches) {\n    throw new Error(\"Unable to parse unexpected unpkg url: \".concat(url));\n  }\n\n  return {\n    spec: matches[1],\n    name: matches[2],\n    version: matches[3] || '',\n    pathname: matches[4] || ''\n  };\n}\n\nfunction signalFromCancellationToken(token, AbortControllerConstructor) {\n  if (!token || !AbortControllerConstructor) {\n    return;\n  }\n\n  var abortController = new AbortControllerConstructor();\n\n  if (token.isCancellationRequested) {\n    abortController.abort();\n  } else {\n    token.onCancellationRequested(function () {\n      return abortController.abort();\n    });\n  }\n\n  return abortController.signal;\n}\n\nvar UNPKG_PROTOCOL = 'https:';\nvar UNPKG_HOST = 'unpkg.com';\n\nvar ResolverHostUnpkg =\n/*#__PURE__*/\nfunction (_AbstractResolverHost) {\n  _inherits(ResolverHostUnpkg, _AbstractResolverHost);\n\n  function ResolverHostUnpkg() {\n    var _this2;\n\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, ResolverHostUnpkg);\n\n    _this2 = _possibleConstructorReturn(this, _getPrototypeOf(ResolverHostUnpkg).call(this));\n    _this2.contentCache = new LRU({\n      length: function length(buf) {\n        return buf.byteLength;\n      },\n      max: 1024 * 1024 * 5\n    });\n    _this2.inflightContentRequests = new Map();\n    _this2.packageLock = new Map();\n    _this2.packageEntriesCache = new Map();\n    _this2.packageJsonCache = new Map();\n\n    if (!options.fetch && typeof fetch !== 'function') {\n      throw new TypeError(\"A fetch function must be provided to the \".concat(_this2.constructor.name, \" if the environment doesn't provide one\"));\n    }\n\n    _this2.AbortController = options.AbortController;\n\n    _this2.fetch = options.fetch || function (input, init) {\n      return fetch(input, init);\n    };\n\n    return _this2;\n  }\n\n  _createClass(ResolverHostUnpkg, [{\n    key: \"getCanonicalUrl\",\n    value: function () {\n      var _getCanonicalUrl = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(resolver, url) {\n        var _ref,\n            token,\n            unresolvedSpec,\n            packageJson,\n            _args = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _ref = _args.length > 2 && _args[2] !== undefined ? _args[2] : {}, token = _ref.token;\n\n                if (!(url.protocol !== UNPKG_PROTOCOL || url.hostname !== UNPKG_HOST)) {\n                  _context.next = 3;\n                  break;\n                }\n\n                throw new Error(\"Unable to list non-unpkg entries for \".concat(url.href));\n\n              case 3:\n                unresolvedSpec = parseUnpkgUrl(url);\n                _context.next = 6;\n                return this.readPackageJsonWithCache(resolver, unresolvedSpec, {\n                  token: token\n                });\n\n              case 6:\n                packageJson = _context.sent;\n                return _context.abrupt(\"return\", new URL(\"\".concat(UNPKG_PROTOCOL, \"//\").concat(UNPKG_HOST, \"/\").concat(packageJson.name, \"@\").concat(packageJson.version).concat(unresolvedSpec.pathname)));\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getCanonicalUrl(_x, _x2) {\n        return _getCanonicalUrl.apply(this, arguments);\n      }\n\n      return getCanonicalUrl;\n    }()\n  }, {\n    key: \"getResolveRoot\",\n    value: function () {\n      var _getResolveRoot = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(resolver, url) {\n        var _ref2,\n            token,\n            unresolvedSpec,\n            packageJson,\n            _args2 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _ref2 = _args2.length > 2 && _args2[2] !== undefined ? _args2[2] : {}, token = _ref2.token;\n\n                if (!(url.protocol !== UNPKG_PROTOCOL || url.hostname !== UNPKG_HOST)) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                throw new Error(\"Unable to list non-unpkg entries for \".concat(url.href));\n\n              case 3:\n                unresolvedSpec = parseUnpkgUrl(url);\n                _context2.next = 6;\n                return this.readPackageJsonWithCache(resolver, unresolvedSpec, {\n                  token: token\n                });\n\n              case 6:\n                packageJson = _context2.sent;\n                return _context2.abrupt(\"return\", new URL(\"\".concat(UNPKG_PROTOCOL, \"//\").concat(UNPKG_HOST, \"/\").concat(packageJson.name, \"@\").concat(packageJson.version, \"/\")));\n\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getResolveRoot(_x3, _x4) {\n        return _getResolveRoot.apply(this, arguments);\n      }\n\n      return getResolveRoot;\n    }()\n  }, {\n    key: \"listEntries\",\n    value: function () {\n      var _listEntries = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(resolver, url) {\n        var _ref3,\n            token,\n            rootUrl,\n            unresolvedSpec,\n            packageJson,\n            parentEntry,\n            traversalSegments,\n            _loop,\n            _args3 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _ref3 = _args3.length > 2 && _args3[2] !== undefined ? _args3[2] : {}, token = _ref3.token;\n\n                if (!(url.protocol !== UNPKG_PROTOCOL || url.hostname !== UNPKG_HOST)) {\n                  _context3.next = 3;\n                  break;\n                }\n\n                throw new Error(\"Unable to list non-unpkg entries for \".concat(url.href));\n\n              case 3:\n                _context3.next = 5;\n                return resolver.host.getResolveRoot(resolver, url, {\n                  token: token\n                });\n\n              case 5:\n                rootUrl = _context3.sent;\n                unresolvedSpec = parseUnpkgUrl(url);\n                _context3.next = 9;\n                return this.readPackageJsonWithCache(resolver, unresolvedSpec, {\n                  token: token\n                });\n\n              case 9:\n                packageJson = _context3.sent;\n                url.pathname = \"/\".concat(packageJson.name, \"@\").concat(packageJson.version).concat(unresolvedSpec.pathname);\n                _context3.next = 13;\n                return this.readPackageEntriesWithCache(parseUnpkgUrl(url), {\n                  token: token\n                });\n\n              case 13:\n                parentEntry = _context3.sent;\n\n                if (!(token && token.isCancellationRequested)) {\n                  _context3.next = 16;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 16:\n                traversalSegments = unresolvedSpec.pathname.split('/').filter(Boolean);\n\n                _loop = function _loop() {\n                  var segment = traversalSegments.shift();\n\n                  if (parentEntry.type !== ResolvedEntryKind.Directory || !parentEntry.files) {\n                    throw new EntryNotFoundError(url);\n                  }\n\n                  parentEntry = parentEntry.files.find(function (file) {\n                    return file.type === ResolvedEntryKind.Directory && Resolver.path.basename(file.path) === segment;\n                  });\n                };\n\n                while (parentEntry && traversalSegments.length) {\n                  _loop();\n                }\n\n                if (parentEntry) {\n                  _context3.next = 21;\n                  break;\n                }\n\n                throw new EntryNotFoundError(url);\n\n              case 21:\n                if (parentEntry.files) {\n                  _context3.next = 23;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", []);\n\n              case 23:\n                return _context3.abrupt(\"return\", parentEntry.files.map(function (entry) {\n                  return {\n                    type: entry.type,\n                    url: new URL(\".\".concat(entry.path), rootUrl)\n                  };\n                }));\n\n              case 24:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function listEntries(_x5, _x6) {\n        return _listEntries.apply(this, arguments);\n      }\n\n      return listEntries;\n    }()\n  }, {\n    key: \"readFileContent\",\n    value: function () {\n      var _readFileContent = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(_, url) {\n        var _ref4,\n            token,\n            href,\n            cached,\n            inflight,\n            signal,\n            fetch,\n            promise,\n            buf,\n            _args4 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _ref4 = _args4.length > 2 && _args4[2] !== undefined ? _args4[2] : {}, token = _ref4.token;\n\n                if (!(url.protocol !== UNPKG_PROTOCOL || url.hostname !== UNPKG_HOST)) {\n                  _context4.next = 3;\n                  break;\n                }\n\n                throw new Error(\"Unable to read file contents for non-unpkg entries for \".concat(url.href));\n\n              case 3:\n                href = url.href;\n                cached = this.contentCache.get(href);\n\n                if (!cached) {\n                  _context4.next = 7;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\", cached);\n\n              case 7:\n                inflight = this.inflightContentRequests.get(href);\n\n                if (!inflight) {\n                  _context4.next = 10;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\", inflight);\n\n              case 10:\n                // console.log('[MISS] readFileContent(%s)', href);\n                signal = signalFromCancellationToken(token, this.AbortController);\n                fetch = this.fetch;\n                promise = fetch(href, {\n                  redirect: 'follow',\n                  signal: signal\n                }).then(function (res) {\n                  if (!res.ok) {\n                    throw new Error(\"Error reading file content for \".concat(href, \": \").concat(res.status));\n                  }\n\n                  return res.arrayBuffer();\n                }).catch(function (err) {\n                  if (err.name === 'AbortError') {\n                    throw new CanceledError('Canceled');\n                  }\n\n                  throw err;\n                });\n                this.inflightContentRequests.set(href, promise);\n                _context4.prev = 14;\n                _context4.next = 17;\n                return promise;\n\n              case 17:\n                buf = _context4.sent;\n                this.contentCache.set(href, buf);\n                return _context4.abrupt(\"return\", buf);\n\n              case 20:\n                _context4.prev = 20;\n                this.inflightContentRequests.delete(href);\n                return _context4.finish(20);\n\n              case 23:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[14,, 20, 23]]);\n      }));\n\n      function readFileContent(_x7, _x8) {\n        return _readFileContent.apply(this, arguments);\n      }\n\n      return readFileContent;\n    }()\n  }, {\n    key: \"readPackageEntriesWithCache\",\n    value: function () {\n      var _readPackageEntriesWithCache = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee5(spec) {\n        var _ref5,\n            token,\n            lockKey,\n            lock,\n            range,\n            packageEntriesCacheForModule,\n            exactMatch,\n            _iteratorNormalCompletion,\n            _didIteratorError,\n            _iteratorError,\n            _iterator,\n            _step,\n            _ref8,\n            _ref7,\n            version,\n            _packageEntries,\n            promise,\n            packageEntries,\n            _args5 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _ref5 = _args5.length > 1 && _args5[1] !== undefined ? _args5[1] : {}, token = _ref5.token;\n                lockKey = \"entries:\".concat(spec.name);\n                lock = this.packageLock.get(lockKey);\n\n                if (!lock) {\n                  _context5.next = 6;\n                  break;\n                }\n\n                _context5.next = 6;\n                return lock;\n\n              case 6:\n                range = validRange(spec.version);\n\n                if (range) {\n                  _context5.next = 9;\n                  break;\n                }\n\n                throw new Error(\"Invalid SemVer range for spec \".concat(spec.spec));\n\n              case 9:\n                packageEntriesCacheForModule = this.packageEntriesCache.get(spec.name);\n\n                if (!packageEntriesCacheForModule) {\n                  _context5.next = 45;\n                  break;\n                }\n\n                exactMatch = packageEntriesCacheForModule.get(spec.version);\n\n                if (!exactMatch) {\n                  _context5.next = 14;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\", exactMatch);\n\n              case 14:\n                _iteratorNormalCompletion = true;\n                _didIteratorError = false;\n                _iteratorError = undefined;\n                _context5.prev = 17;\n                _iterator = packageEntriesCacheForModule[Symbol.iterator]();\n\n              case 19:\n                if (_iteratorNormalCompletion = (_step = _iterator.next()).done) {\n                  _context5.next = 29;\n                  break;\n                }\n\n                _ref8 = _step.value;\n                _ref7 = _slicedToArray(_ref8, 2);\n                version = _ref7[0];\n                _packageEntries = _ref7[1];\n\n                if (!satisfies(version, range)) {\n                  _context5.next = 26;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\", _packageEntries);\n\n              case 26:\n                _iteratorNormalCompletion = true;\n                _context5.next = 19;\n                break;\n\n              case 29:\n                _context5.next = 35;\n                break;\n\n              case 31:\n                _context5.prev = 31;\n                _context5.t0 = _context5[\"catch\"](17);\n                _didIteratorError = true;\n                _iteratorError = _context5.t0;\n\n              case 35:\n                _context5.prev = 35;\n                _context5.prev = 36;\n\n                if (!_iteratorNormalCompletion && _iterator.return != null) {\n                  _iterator.return();\n                }\n\n              case 38:\n                _context5.prev = 38;\n\n                if (!_didIteratorError) {\n                  _context5.next = 41;\n                  break;\n                }\n\n                throw _iteratorError;\n\n              case 41:\n                return _context5.finish(38);\n\n              case 42:\n                return _context5.finish(35);\n\n              case 43:\n                _context5.next = 47;\n                break;\n\n              case 45:\n                packageEntriesCacheForModule = new Map();\n                this.packageEntriesCache.set(spec.name, packageEntriesCacheForModule);\n\n              case 47:\n                // console.log('[MISS] readPackageEntriesWithCache(%s)', spec.spec);\n                promise = this.readPackageEntries(spec.spec, {\n                  token: token\n                });\n                this.packageLock.set(lockKey, promise);\n                _context5.next = 51;\n                return promise;\n\n              case 51:\n                packageEntries = _context5.sent;\n                this.packageLock.delete(lockKey);\n                packageEntriesCacheForModule.set(spec.version, packageEntries);\n                return _context5.abrupt(\"return\", packageEntries);\n\n              case 55:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this, [[17, 31, 35, 43], [36,, 38, 42]]);\n      }));\n\n      function readPackageEntriesWithCache(_x9) {\n        return _readPackageEntriesWithCache.apply(this, arguments);\n      }\n\n      return readPackageEntriesWithCache;\n    }()\n  }, {\n    key: \"readPackageJsonWithCache\",\n    value: function () {\n      var _readPackageJsonWithCache = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee6(resolver, spec) {\n        var _ref9,\n            token,\n            lockKey,\n            lock,\n            packageJsonCacheForModule,\n            exactMatch,\n            range,\n            _iteratorNormalCompletion2,\n            _didIteratorError2,\n            _iteratorError2,\n            _iterator2,\n            _step2,\n            _ref12,\n            _ref11,\n            version,\n            _packageJson,\n            promise,\n            packageJson,\n            _args6 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _ref9 = _args6.length > 2 && _args6[2] !== undefined ? _args6[2] : {}, token = _ref9.token;\n                lockKey = \"packageJson:\".concat(spec.spec);\n                lock = this.packageLock.get(lockKey);\n\n                if (!lock) {\n                  _context6.next = 6;\n                  break;\n                }\n\n                _context6.next = 6;\n                return lock;\n\n              case 6:\n                packageJsonCacheForModule = this.packageJsonCache.get(spec.name);\n\n                if (!packageJsonCacheForModule) {\n                  _context6.next = 44;\n                  break;\n                }\n\n                exactMatch = packageJsonCacheForModule.get(spec.version);\n\n                if (!exactMatch) {\n                  _context6.next = 11;\n                  break;\n                }\n\n                return _context6.abrupt(\"return\", exactMatch);\n\n              case 11:\n                range = validRange(spec.version);\n\n                if (!range) {\n                  _context6.next = 42;\n                  break;\n                }\n\n                _iteratorNormalCompletion2 = true;\n                _didIteratorError2 = false;\n                _iteratorError2 = undefined;\n                _context6.prev = 16;\n                _iterator2 = packageJsonCacheForModule[Symbol.iterator]();\n\n              case 18:\n                if (_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done) {\n                  _context6.next = 28;\n                  break;\n                }\n\n                _ref12 = _step2.value;\n                _ref11 = _slicedToArray(_ref12, 2);\n                version = _ref11[0];\n                _packageJson = _ref11[1];\n\n                if (!satisfies(version, range)) {\n                  _context6.next = 25;\n                  break;\n                }\n\n                return _context6.abrupt(\"return\", _packageJson);\n\n              case 25:\n                _iteratorNormalCompletion2 = true;\n                _context6.next = 18;\n                break;\n\n              case 28:\n                _context6.next = 34;\n                break;\n\n              case 30:\n                _context6.prev = 30;\n                _context6.t0 = _context6[\"catch\"](16);\n                _didIteratorError2 = true;\n                _iteratorError2 = _context6.t0;\n\n              case 34:\n                _context6.prev = 34;\n                _context6.prev = 35;\n\n                if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n                  _iterator2.return();\n                }\n\n              case 37:\n                _context6.prev = 37;\n\n                if (!_didIteratorError2) {\n                  _context6.next = 40;\n                  break;\n                }\n\n                throw _iteratorError2;\n\n              case 40:\n                return _context6.finish(37);\n\n              case 41:\n                return _context6.finish(34);\n\n              case 42:\n                _context6.next = 46;\n                break;\n\n              case 44:\n                packageJsonCacheForModule = new Map();\n                this.packageJsonCache.set(spec.name, packageJsonCacheForModule);\n\n              case 46:\n                // console.log('[MISS] readPackageJsonWithCache(%s)', spec.spec);\n                promise = this.readPackageJson(resolver, spec.spec, {\n                  token: token\n                });\n                this.packageLock.set(lockKey, promise);\n                _context6.next = 50;\n                return promise;\n\n              case 50:\n                packageJson = _context6.sent;\n                this.packageLock.delete(lockKey);\n\n                if (packageJson.version) {\n                  _context6.next = 54;\n                  break;\n                }\n\n                throw new Error(\"Manifest missing a version identifier for \".concat(spec));\n\n              case 54:\n                packageJsonCacheForModule.set(packageJson.version, packageJson);\n                return _context6.abrupt(\"return\", packageJson);\n\n              case 56:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[16, 30, 34, 42], [35,, 37, 41]]);\n      }));\n\n      function readPackageJsonWithCache(_x10, _x11) {\n        return _readPackageJsonWithCache.apply(this, arguments);\n      }\n\n      return readPackageJsonWithCache;\n    }()\n  }, {\n    key: \"readPackageJson\",\n    value: function () {\n      var _readPackageJson = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee7(resolver, spec) {\n        var _ref13,\n            token,\n            href,\n            content,\n            manifest,\n            _args7 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _ref13 = _args7.length > 2 && _args7[2] !== undefined ? _args7[2] : {}, token = _ref13.token;\n                // console.log('readPackageJson(%s)', spec);\n                href = \"\".concat(UNPKG_PROTOCOL, \"//\").concat(UNPKG_HOST, \"/\").concat(spec, \"/package.json\");\n                _context7.next = 4;\n                return this.readFileContent(resolver, new URL(href), {\n                  token: token\n                });\n\n              case 4:\n                content = _context7.sent;\n                _context7.prev = 5;\n                manifest = util.parseBufferAsPackageJson(resolver.decoder, content, spec);\n                _context7.next = 12;\n                break;\n\n              case 9:\n                _context7.prev = 9;\n                _context7.t0 = _context7[\"catch\"](5);\n                throw new Error(\"Error parsing manifest as json for package \".concat(spec, \": \").concat(_context7.t0.message));\n\n              case 12:\n                return _context7.abrupt(\"return\", manifest);\n\n              case 13:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this, [[5, 9]]);\n      }));\n\n      function readPackageJson(_x12, _x13) {\n        return _readPackageJson.apply(this, arguments);\n      }\n\n      return readPackageJson;\n    }()\n  }, {\n    key: \"readPackageEntries\",\n    value: function () {\n      var _readPackageEntries = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee8(spec) {\n        var _ref14,\n            token,\n            href,\n            signal,\n            fetch,\n            res,\n            json,\n            _args8 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _ref14 = _args8.length > 1 && _args8[1] !== undefined ? _args8[1] : {}, token = _ref14.token;\n                // console.log('readPackageEntries(%s)', spec);\n                href = \"\".concat(UNPKG_PROTOCOL, \"//\").concat(UNPKG_HOST, \"/\").concat(spec, \"/?meta\");\n                signal = signalFromCancellationToken(token, this.AbortController);\n                fetch = this.fetch;\n                _context8.next = 6;\n                return fetch(href, {\n                  signal: signal\n                }).catch(function (err) {\n                  if (err.name === 'AbortError') {\n                    throw new CanceledError('Canceled');\n                  }\n\n                  throw err;\n                });\n\n              case 6:\n                res = _context8.sent;\n\n                if (res.ok) {\n                  _context8.next = 9;\n                  break;\n                }\n\n                throw new Error(\"Error listing package contents for \".concat(spec, \": \").concat(res.status));\n\n              case 9:\n                _context8.next = 11;\n                return res.json();\n\n              case 11:\n                json = _context8.sent;\n\n                if (isValidDirectory(json)) {\n                  _context8.next = 14;\n                  break;\n                }\n\n                throw new Error(\"Unexpected response payload while listing package contents for \".concat(spec));\n\n              case 14:\n                return _context8.abrupt(\"return\", json);\n\n              case 15:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function readPackageEntries(_x14) {\n        return _readPackageEntries.apply(this, arguments);\n      }\n\n      return readPackageEntries;\n    }()\n  }], [{\n    key: \"resolveBareModule\",\n    value: function resolveBareModule(_, spec) {\n      return new URL(\"\".concat(UNPKG_PROTOCOL, \"//\").concat(UNPKG_HOST, \"/\").concat(spec.name, \"@\").concat(spec.spec).concat(spec.pathname));\n    }\n  }]);\n\n  return ResolverHostUnpkg;\n}(AbstractResolverHost);\n\nexport { ResolverHostUnpkg, isValidDirectory, isValidEntry, isValidFile };","import { Bundler } from '@velcro/bundler';\nimport { Resolver, AbstractResolverHost, ResolverHost } from '@velcro/resolver';\nimport { openDB } from 'idb';\nimport { timeout } from 'ts-primitives';\nimport { TimeoutError } from './error';\n\ntype ThenArg<T> = T extends Promise<infer U> ? U : T;\n\nexport class ResolverHostWithCache extends AbstractResolverHost {\n  private readonly idbPromise = openDB('velcro', Bundler.schemaVersion, {\n    async upgrade(db, oldVersion, newVersion, transaction) {\n      console.log('Upgrading cache from version %s to %s', oldVersion, newVersion);\n\n      if (!oldVersion) {\n        db.createObjectStore('getCanonicalUrl');\n        db.createObjectStore('getResolveRoot');\n        db.createObjectStore('listEntries');\n        db.createObjectStore('readFileContent');\n      }\n\n      await transaction.objectStore('getCanonicalUrl').clear();\n      await transaction.objectStore('getResolveRoot').clear();\n      await transaction.objectStore('listEntries').clear();\n      await transaction.objectStore('readFileContent').clear();\n    },\n  }).catch(err => {\n    console.error(err, 'error opening IndexedDB');\n\n    return null;\n  });\n\n  private readonly hostTimeout: number;\n  private readonly idbTimeout: number;\n\n  private readonly inflightGetCanonicalUrl = new Map<string, ReturnType<ResolverHost['getCanonicalUrl']>>();\n  private readonly inflightGetResolveRoot = new Map<string, ReturnType<ResolverHost['getResolveRoot']>>();\n  private readonly inflightListEntries = new Map<string, ReturnType<ResolverHost['listEntries']>>();\n  private readonly inflightReadFileContent = new Map<string, ReturnType<ResolverHost['readFileContent']>>();\n\n  private readonly getCanonicalUrlCache = new Map<string, ThenArg<ReturnType<ResolverHost['getCanonicalUrl']>>>();\n  private readonly getResolveRootCache = new Map<string, ThenArg<ReturnType<ResolverHost['getResolveRoot']>>>();\n  private readonly listEntriesCache = new Map<string, ThenArg<ReturnType<ResolverHost['listEntries']>>>();\n  private readonly readFileContentCache = new Map<string, ThenArg<ReturnType<ResolverHost['readFileContent']>>>();\n\n  constructor(readonly host: ResolverHost, { idbTimeout = 1000, hostTimeout = 10000 } = {}) {\n    super();\n\n    this.hostTimeout = hostTimeout;\n    this.idbTimeout = idbTimeout;\n  }\n\n  private async withCache<T, C = unknown>(\n    href: string,\n    loadFn: () => Promise<T>,\n    cache: Map<string, T>,\n    inflightMap: Map<string, Promise<T>>,\n    storeName: string,\n    serialize?: (result: T) => C,\n    deserialize?: (cached: C) => T\n  ): Promise<T> {\n    if (cache.has(href)) {\n      return cache.get(href)!;\n    }\n\n    const idb = await withTimeout(this.idbTimeout, this.idbPromise, `this.idbPromise`).catch(_ => undefined);\n\n    if (idb) {\n      const cached = await withTimeout(\n        this.idbTimeout,\n        idb.get(storeName, href),\n        `idb.get(${storeName}, ${href})`\n      ).catch(_ => undefined);\n\n      if (cached) {\n        const result = (deserialize ? deserialize(cached as any) : cached) as T;\n\n        cache.set(href, result);\n\n        return result;\n      }\n    }\n\n    let inflight = inflightMap.get(href);\n\n    if (!inflight) {\n      inflight = withTimeout(this.hostTimeout, loadFn(), `Timed out on operation '${storeName}' for '${href}'`);\n      inflightMap.set(href, inflight);\n\n      // Make sure we don't get an uncaught rejection\n      inflight\n        .then(result => {\n          cache.set(href, result);\n\n          if (idb) {\n            idb.put(storeName, serialize ? serialize(result) : result, href).catch(_ => undefined);\n          }\n        })\n        .catch(_ => undefined)\n        .then(() => {\n          inflightMap.delete(href);\n        });\n    }\n\n    return inflight;\n  }\n\n  async getCanonicalUrl(resolver: Resolver, url: URL) {\n    const result = await this.withCache(\n      url.href,\n      () => this.host.getCanonicalUrl(resolver, url),\n      this.getCanonicalUrlCache,\n      this.inflightGetCanonicalUrl,\n      'getCanonicalUrl',\n      url => url.href,\n      href => new URL(href)\n    );\n\n    return result;\n  }\n\n  async getResolveRoot(resolver: Resolver, url: URL) {\n    const result = await this.withCache(\n      url.href,\n      () => this.host.getResolveRoot(resolver, url),\n      this.getResolveRootCache,\n      this.inflightGetResolveRoot,\n      'getResolveRoot',\n      url => url.href,\n      href => new URL(href)\n    );\n\n    return result;\n  }\n\n  async listEntries(resolver: Resolver, url: URL) {\n    const result = await this.withCache(\n      url.href,\n      () => this.host.listEntries(resolver, url),\n      this.listEntriesCache,\n      this.inflightListEntries,\n      'listEntries',\n      entries =>\n        entries.map(entry => ({\n          type: entry.type,\n          href: entry.url.href,\n        })),\n      cached =>\n        cached.map(entry => ({\n          type: entry.type,\n          url: new URL(entry.href),\n        }))\n    );\n\n    return result;\n  }\n\n  async readFileContent(resolver: Resolver, url: URL) {\n    try {\n      const result = await this.withCache(\n        url.href,\n        () => this.host.readFileContent(resolver, url),\n        this.readFileContentCache,\n        this.inflightReadFileContent,\n        'readFileContent'\n      );\n\n      return result;\n    } catch (err) {\n      throw err;\n    }\n  }\n}\n\nfunction withTimeout<T>(duration: number, promise: Promise<T>, message: string) {\n  return Promise.race([\n    promise,\n    timeout(duration).then(() => {\n      return Promise.reject(new TimeoutError(message));\n    }),\n  ]);\n}\n","import * as Monaco from 'monaco-editor';\nimport { Emitter, IDisposable, DisposableStore, ThrottledDelayer } from 'ts-primitives';\nimport { useState, useEffect, useContext, createContext } from 'react';\nimport { TypeAcquirer } from './typeAcquisition';\nimport { Bundler } from '@velcro/bundler';\nimport { Resolver } from '@velcro/resolver';\nimport { ResolverHostCompound } from '@velcro/resolver-host-compound';\nimport { ResolverHostMonaco } from '../lib/ResolverHostMonaco';\nimport { ResolverHostUnpkg } from '@velcro/resolver-host-unpkg';\nimport { ResolverHostWithCache } from '../lib/ResolverHostWithCache';\n\nconst rootUri = Monaco.Uri.file('/');\n\nexport class EditorManager implements IDisposable {\n  readonly bundler = new Bundler({\n    resolver: new Resolver(\n      new ResolverHostCompound({\n        'https://unpkg.com/': new ResolverHostWithCache(new ResolverHostUnpkg()),\n        [rootUri.toString(true)]: new ResolverHostMonaco(rootUri),\n      }),\n      {\n        extensions: ['.js', '.jsx', '.ts', '.tsx'],\n        packageMain: ['browser', 'main'],\n      }\n    ),\n  });\n\n  editor: Monaco.editor.IStandaloneCodeEditor | null = null;\n\n  private readonly disposableStore = new DisposableStore();\n  private readonly initialPath: string | undefined;\n\n  private readonly typeAcquirer = new TypeAcquirer(this.bundler.resolver, ResolverHostUnpkg.resolveBareModule);\n  private readonly viewState = new WeakMap<Monaco.editor.ITextModel, Monaco.editor.ICodeEditorViewState>();\n\n  private readonly onWillFocusModelEmitter = new Emitter<Monaco.editor.ITextModel>();\n  private readonly onDidChangeEmitter = new Emitter<{ model: Monaco.editor.ITextModel }>();\n\n  constructor(options: { files?: Record<string, string>; initialPath?: string } = {}) {\n    this.disposableStore.add(this.onWillFocusModelEmitter);\n    this.disposableStore.add(this.onDidChangeEmitter);\n\n    Monaco.languages.typescript.typescriptDefaults.setEagerModelSync(true);\n    Monaco.languages.typescript.typescriptDefaults.setMaximumWorkerIdleTime(0);\n\n    Monaco.languages.typescript.typescriptDefaults.setCompilerOptions({\n      allowJs: true,\n      allowNonTsExtensions: true,\n      allowSyntheticDefaultImports: true,\n      baseUrl: '.',\n      checkJs: true,\n      esModuleInterop: true,\n      experimentalDecorators: true,\n      inlineSourceMap: true,\n      inlineSources: true,\n      isolatedModules: false,\n      jsx: Monaco.languages.typescript.JsxEmit.React,\n      lib: ['dom'],\n      module: Monaco.languages.typescript.ModuleKind.CommonJS,\n      moduleResolution: Monaco.languages.typescript.ModuleResolutionKind.NodeJs,\n      noEmit: false,\n      outDir: `dist`,\n      resolveJsonModule: true,\n      rootDir: '/',\n      sourceMap: true,\n      target: Monaco.languages.typescript.ScriptTarget.ES2015,\n      typeRoots: ['node_modules/@types'],\n    });\n\n    Monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({\n      noSemanticValidation: true,\n      noSyntaxValidation: false,\n    });\n\n    if (options.files) {\n      for (const pathname in options.files) {\n        const content = options.files[pathname];\n\n        this.createModel(pathname, content);\n      }\n    }\n\n    Monaco.editor.onDidCreateModel(model => {\n      const onDidChangePackageJson = async () => {\n        const value = model.getValue();\n\n        let dependencies = {\n          typescript: Monaco.languages.typescript.typescriptVersion,\n        };\n\n        try {\n          const pkgJson = JSON.parse(value);\n\n          if (pkgJson.dependencies) {\n            dependencies = { ...dependencies, ...pkgJson.dependencies };\n          }\n        } catch (_) {\n          // Ignore\n        }\n\n        Monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({ noSemanticValidation: true });\n        await this.typeAcquirer.importTypesForSpecs(dependencies);\n        Monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({ noSemanticValidation: false });\n      };\n\n      if (model.uri.toString(true) === `${rootUri.toString(true)}package.json`) {\n        const throttler = new ThrottledDelayer(1500);\n        throttler.trigger(onDidChangePackageJson);\n\n        this.disposableStore.add(model.onDidChangeContent(() => throttler.trigger(onDidChangePackageJson)));\n        this.disposableStore.add(throttler);\n      }\n    });\n\n    this.disposableStore.add(\n      this.typeAcquirer.onTypeFile(file => {\n        this.disposableStore.add(\n          Monaco.languages.typescript.typescriptDefaults.addExtraLib(\n            file.content,\n            Monaco.Uri.file(file.pathname).toString(true)\n          )\n        );\n      })\n    );\n\n    this.initialPath = options.initialPath;\n  }\n\n  get dispose() {\n    console.log('EditorManager::dispose()');\n    return this.disposableStore.dispose;\n  }\n\n  get onDidChange() {\n    return this.onDidChangeEmitter.event;\n  }\n\n  get onWillFocusModel() {\n    return this.onWillFocusModelEmitter.event;\n  }\n\n  createModel(pathname: string, content = '') {\n    const language = this.inferLanguage(pathname);\n\n    let uri: Monaco.Uri;\n\n    try {\n      uri = Monaco.Uri.file(pathname);\n    } catch (err) {\n      throw new Error(`Invalid path '${pathname}': ${err && err.message}`);\n    }\n\n    if (Monaco.editor.getModel(uri)) {\n      throw new Error(`Cannot create file because it exists '${pathname}'`);\n    }\n\n    return Monaco.editor.createModel(content, language, uri);\n  }\n\n  focusHref(href: string, options: { lineNumber?: number } = {}) {\n    const model = Monaco.editor.getModel(Monaco.Uri.parse(href));\n\n    if (model) {\n      this.focusModel(model, options);\n    }\n  }\n\n  focusModel(model: Monaco.editor.ITextModel, options: { lineNumber?: number } = {}) {\n    if (this.editor) {\n      this.editor.setModel(model);\n      if (options.lineNumber) {\n        this.editor.revealLineInCenter(options.lineNumber, Monaco.editor.ScrollType.Smooth);\n      }\n      this.editor.focus();\n    }\n  }\n\n  focusPath(path: string, options: { lineNumber?: number } = {}) {\n    const model = Monaco.editor.getModel(Monaco.Uri.file(path));\n\n    if (model) {\n      this.focusModel(model, options);\n    }\n  }\n\n  mount(el: HTMLElement) {\n    if (this.editor) {\n      throw new Error('Invariant violation: Editor already mounted');\n    }\n\n    this.editor = Monaco.editor.create(el, {\n      model: null,\n      automaticLayout: true,\n      showUnused: true,\n      scrollBeyondLastLine: false,\n      theme: 'vs',\n      wordWrap: 'bounded',\n      wrappingIndent: 'same',\n    });\n\n    this.editor.onDidDispose(() => {\n      this.editor = null;\n    });\n\n    this.editor.onDidChangeModel(e => {\n      if (e.newModelUrl && this.editor) {\n        const model = Monaco.editor.getModel(e.newModelUrl)!;\n        const viewState = this.viewState.get(model);\n\n        if (viewState) {\n          this.editor.restoreViewState(viewState);\n        }\n      }\n    });\n\n    this.editor.onDidBlurEditorText(() => {\n      if (this.editor) {\n        const model = this.editor.getModel();\n        const viewState = this.editor.saveViewState();\n\n        if (model && viewState) {\n          this.viewState.set(model, viewState);\n        }\n      }\n    });\n\n    this.disposableStore.add(this.editor);\n\n    if (this.initialPath) {\n      this.focusPath(this.initialPath);\n    }\n\n    return this.editor;\n  }\n\n  inferLanguage(pathname: string) {\n    return pathname.match(/\\.(?:tsx?|jsx?)$/) ? 'typescript' : undefined;\n  }\n}\n\nexport const EditorManagerContext = createContext(new EditorManager());\n\nexport function useActiveModel() {\n  const workbench = useContext(EditorManagerContext);\n  const [activeModel, setActiveModel] = useState<Monaco.editor.ITextModel | null>(\n    workbench.editor ? workbench.editor.getModel() : null\n  );\n\n  useEffect(() => {\n    const disposable = new DisposableStore();\n\n    const trackEditor = (editor: Monaco.editor.ICodeEditor) => {\n      editor.onDidChangeModel(e => {\n        const model = e.newModelUrl ? Monaco.editor.getModel(e.newModelUrl) : null;\n\n        setActiveModel(model);\n      });\n\n      disposable.add(\n        editor.onDidBlurEditorText(() => {\n          setActiveModel(null);\n        })\n      );\n\n      disposable.add(\n        editor.onDidFocusEditorText(() => {\n          setActiveModel(editor.getModel());\n        })\n      );\n\n      if (editor.hasTextFocus()) {\n        setActiveModel(editor.getModel());\n      }\n    };\n\n    disposable.add(Monaco.editor.onDidCreateEditor(trackEditor));\n    if (workbench.editor) {\n      trackEditor(workbench.editor);\n    }\n\n    return () => disposable.dispose();\n  }, [workbench.editor, activeModel]);\n\n  return activeModel;\n}\n","import styled from '@emotion/styled/macro';\nimport React, { useRef, useEffect, useContext } from 'react';\nimport { EditorManagerContext } from '../lib/EditorManager';\n\nconst Editor: React.FC<{\n  className?: string;\n}> = ({ className }) => {\n  const el = useRef<HTMLDivElement | null>(null);\n  const editorManager = useContext(EditorManagerContext);\n\n  useEffect(() => {\n    if (!el.current) {\n      return;\n    }\n\n    const editor = editorManager.mount(el.current);\n\n    return () => {\n      editor.dispose();\n    };\n  }, [editorManager, el]);\n\n  return (\n    <div className={className} ref={el}>\n      <div></div>\n    </div>\n  );\n};\n\nexport default styled(Editor)``;\n","import styled from '@emotion/styled/macro';\nimport { runtime, CanceledError } from '@velcro/bundler';\nimport * as Monaco from 'monaco-editor';\nimport React, { useEffect, useRef, useContext, useState } from 'react';\nimport { Delayer, Throttler, DisposableStore, CancellationTokenSource } from 'ts-primitives';\nimport { EditorManagerContext } from '../lib/EditorManager';\n\ninterface MessageLine {\n  isInternal: boolean;\n  text: string;\n}\ninterface Message {\n  lines: MessageLine[];\n}\n\nconst PreviewProgress = styled.div<{ completed: number; total: number }>`\n  z-index: 1;\n  position: absolute;\n  top: 0;\n  width: ${props => (props.total ? `${Math.round((100 * props.completed) / props.total)}%` : 0)};\n  left: 0;\n  height: ${props => (props.total ? '2px' : '0')};\n  background-color: #008cba;\n  transition: width 0.5s 0s cubic-bezier(0.455, 0.03, 0.515, 0.955);\n`;\nconst PreviewIframeWrap = styled.div`\n  position: relative;\n  overflow: hidden;\n\n  & > iframe {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    border: none;\n    width: 100%;\n    height: 100%;\n  }\n`;\nconst PreviewWrap = styled.div`\n  position: relative;\n  ${PreviewIframeWrap} {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n  }\n`;\nconst PreviewMessageError = styled.ul`\n  margin: 0;\n  padding: 1em 2em;\n  font-family: monospace;\n  font-size: 16px;\n  background-color: rgba(255, 0, 0, 0.5);\n  backdrop-filter: brightness(50%);\n  color: white;\n  list-style: none;\n`;\nconst PreviewMessageErrorText = styled.li<{ isInternal: boolean }>`\n  white-space: pre-wrap;\n  opacity: ${props => (props.isInternal ? 0.7 : 1.0)};\n`;\nconst PreviewMessages = styled.div`\n  z-index: 1;\n  position: absolute;\n  bottom: 0;\n  right: 0;\n  left: 0;\n  display: flex;\n  flex-direction: column-reverse;\n`;\nconst PreviewMessageLine: React.FC<{ line: MessageLine }> = ({ line }) => {\n  return <PreviewMessageErrorText isInternal={line.isInternal}>{line.text}</PreviewMessageErrorText>;\n};\nconst PreviewMessage: React.FC<{ message: Message }> = ({ message }) => {\n  return message.lines.length ? (\n    <PreviewMessageError>\n      {message.lines.map((line, i) => (\n        <PreviewMessageLine key={i} line={line}></PreviewMessageLine>\n      ))}\n    </PreviewMessageError>\n  ) : null;\n};\n\nconst Preview: React.FC<{ className?: string }> = props => {\n  const invalidations = useRef(new Set<string>());\n  const previewWrapRef = useRef<HTMLDivElement | null>(null);\n  const previewIframeRef = useRef<HTMLIFrameElement | null>(null);\n  const editorManager = useContext(EditorManagerContext);\n  const [messages, setMessages] = useState([] as Message[]);\n  const [buildProgress, setBuildProgress] = useState({ completed: 0, total: 0 });\n\n  useEffect(() => {\n    const disposable = new DisposableStore();\n    const delayer = new Delayer(500);\n    const throttler = new Throttler();\n\n    let tokenSource = new CancellationTokenSource();\n\n    const queueRefreshPreview = (uris: string[]) => {\n      tokenSource.cancel();\n      tokenSource.dispose();\n\n      tokenSource = new CancellationTokenSource();\n\n      for (const uri of uris) {\n        invalidations.current.add(uri);\n      }\n\n      delayer.trigger(() => throttler.queue(() => refreshPreview(tokenSource.token)));\n    };\n\n    const refreshPreview = async (token: Monaco.CancellationToken) => {\n      const toInvalidate = Array.from(invalidations.current);\n\n      setMessages([]);\n\n      invalidations.current.clear();\n\n      setBuildProgress({ completed: 0, total: 0 });\n\n      let building = true;\n\n      try {\n        await Promise.all(\n          toInvalidate.map(spec => {\n            return editorManager.bundler.invalidate(spec, { token });\n          })\n        );\n\n        const unresolvedEntrypointHref = Monaco.Uri.file('/').toString(true);\n        const resolvedEntrypoint = await editorManager.bundler.resolver.resolve(unresolvedEntrypointHref);\n\n        if (!resolvedEntrypoint.resolvedUrl) {\n          throw new Error(`Unable to determine the entrypoing to your code`);\n        }\n\n        const resolvedEntrypointHref = resolvedEntrypoint.resolvedUrl.href;\n        const errorOverlayBundle = await editorManager.bundler.generateBundleCode([], {\n          dependencies: {\n            'react-error-overlay': '^6.0.3',\n          },\n          onCompleteAsset: () => {\n            if (building) {\n              setBuildProgress(buildProgress => {\n                return {\n                  completed: buildProgress.completed + 1,\n                  total: buildProgress.total,\n                };\n              });\n            }\n          },\n          onEnqueueAsset: () => {\n            if (building) {\n              setBuildProgress(buildProgress => {\n                return {\n                  completed: buildProgress.completed,\n                  total: buildProgress.total + 1,\n                };\n              });\n            }\n          },\n          sourceMap: true,\n          token,\n        });\n\n        const bundle = await editorManager.bundler.generateBundleCode([resolvedEntrypointHref], {\n          onCompleteAsset: () => {\n            if (building) {\n              setBuildProgress(buildProgress => {\n                return {\n                  completed: buildProgress.completed + 1,\n                  total: buildProgress.total,\n                };\n              });\n            }\n          },\n          onEnqueueAsset: () => {\n            if (building) {\n              setBuildProgress(buildProgress => {\n                return {\n                  completed: buildProgress.completed,\n                  total: buildProgress.total + 1,\n                };\n              });\n            }\n          },\n          sourceMap: true,\n          requireEntrypoints: true,\n          token,\n        });\n\n        const errorWatcher = new File([`${errorOverlayBundle}\\n(${createBundleRuntime.toString()})();`], 'watcher.js', {\n          type: 'text/javascript',\n        });\n        const bundleFile = new File([bundle], resolvedEntrypointHref, {\n          type: 'text/javascript',\n        });\n        const markup = new File(\n          [\n            `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n<title>Document</title>\n<script src=\"${URL.createObjectURL(errorWatcher)}\"></script>\n</head>\n<body>\n<div id=\"root\"></div>\n<script src=\"${URL.createObjectURL(bundleFile)}\"></script>\n</body>\n</html>`,\n          ],\n          Monaco.Uri.file('/index.html').toString(true),\n          {\n            type: 'text/html',\n          }\n        );\n        const htmlUrl = URL.createObjectURL(markup);\n        const iframe = document.createElement('iframe');\n        iframe.style.display = 'none';\n        iframe.src = htmlUrl;\n\n        if (previewWrapRef.current) {\n          previewWrapRef.current.appendChild(iframe);\n        }\n\n        try {\n          await new Promise((resolve, reject) => {\n            iframe.onload = () => resolve();\n            iframe.onerror = reject;\n          });\n\n          if (previewIframeRef.current) {\n            previewIframeRef.current.remove();\n          }\n\n          iframe.style.display = '';\n\n          previewIframeRef.current = iframe;\n        } catch (err) {\n          iframe.remove();\n\n          throw err;\n        }\n      } catch (err) {\n        if (!(err instanceof CanceledError) && (err && err.name !== 'CanceledError')) {\n          setMessages(messages => [...messages, { lines: [{ isInternal: false, text: err.message }] }]);\n        }\n      } finally {\n        if (tokenSource) {\n          tokenSource.cancel();\n          tokenSource.dispose();\n        }\n\n        building = false;\n\n        setBuildProgress({ completed: 0, total: 0 });\n      }\n    };\n\n    disposable.add(delayer);\n\n    for (const model of Monaco.editor.getModels()) {\n      disposable.add(\n        model.onDidChangeContent(() => {\n          queueRefreshPreview([model.uri.toString(true)]);\n        })\n      );\n    }\n\n    disposable.add(\n      Monaco.editor.onDidCreateModel(model => {\n        queueRefreshPreview([model.uri.toString(true)]);\n\n        disposable.add(\n          model.onDidChangeContent(() => {\n            queueRefreshPreview([model.uri.toString(true)]);\n          })\n        );\n      })\n    );\n\n    disposable.add(\n      Monaco.editor.onWillDisposeModel(model => {\n        queueRefreshPreview([model.uri.toString(true)]);\n      })\n    );\n\n    disposable.add(\n      (() => {\n        const onMessage = async (e: MessageEvent) => {\n          if (!e.data || typeof e.data.type !== 'string' || !e.data.payload) {\n            return;\n          }\n\n          switch (e.data.type) {\n            case 'error_open': {\n              debugger;\n              if (!editorManager.editor) {\n                return;\n              }\n\n              editorManager.focusHref(e.data.payload.fileName, {\n                lineNumber: e.data.payload.lineNumber ? e.data.payload.lineNumber - 1 : undefined,\n              });\n              break;\n            }\n          }\n\n          // console.log('message event', e.data);\n          // if (e.data && e.data.type === 'error' && e.data.payload) {\n          //   const readCache = new Map<string, { code: string; sourceMap?: any }>();\n\n          //   const read = async (href: string): Promise<string> => {\n          //     let code: string;\n\n          //     if (href.startsWith('blob:')) {\n          //       code = await fetch(href).then(res => res.text());\n          //     } else if (href.startsWith('data:')) {\n          //       const match = href.match(/^data:[^;]+;(?:charset=([^;]+);)?(?:(base64),)?(.*)$/);\n\n          //       if (!match) {\n          //         throw new Error(`Unexpected data URI: '${href}'`);\n          //       }\n\n          //       code = match[3];\n\n          //       if (match[2].toLowerCase() === 'base64') {\n          //         code = base64.decode(code);\n          //       }\n          //     } else {\n          //       const buf = await editorManager.bundler.resolver.host.readFileContent(\n          //         editorManager.bundler.resolver,\n          //         new URL(href)\n          //       );\n          //       code = editorManager.bundler.resolver.decoder.decode(buf);\n          //     }\n\n          //     return code;\n          //   };\n\n          //   const readSource = async (href: string): Promise<{ code: string; sourceMap?: MappedSourceMap }> => {\n          //     if (readCache.has(href)) {\n          //       return readCache.get(href) as { code: string; sourceMap?: MappedSourceMap };\n          //     }\n\n          //     const code = await read(href);\n          //     const sourceMappingUrl = getSourceMappingUrl(code);\n          //     let sourceMap: any = undefined;\n\n          //     if (sourceMappingUrl) {\n          //       const sourceMapText = await read(sourceMappingUrl);\n          //       sourceMap = JSON.parse(sourceMapText);\n\n          //       if (sourceMap.mappings) {\n          //         sourceMap.mappings = decode(sourceMap.mappings);\n          //       }\n          //     }\n\n          //     const result = { code, sourceMap };\n\n          //     readCache.set(href, result);\n\n          //     return result;\n          //   };\n\n          //   let frames = [] as CallSite[];\n\n          //   if (Array.isArray(e.data.payload.frames)) {\n          //     try {\n          //       frames = await Promise.all(\n          //         e.data.payload.frames.map(async (frameOptions: CallSiteOptions) => {\n          //           let frame = new CallSite(frameOptions);\n          //           const href = frame.getFileName();\n          //           const line = frame.getLineNumber();\n          //           const column = frame.getColumnNumber();\n\n          //           if (href && line && Number.isInteger(line) && column && Number.isInteger(column)) {\n          //             const result = await readSource(href);\n\n          //             if (!result.sourceMap) {\n          //               return frame.with({\n          //                 isInternal: true,\n          //               });\n          //             }\n\n          //             const mappings = result.sourceMap.mappings[line - 1];\n\n          //             if (!mappings || !mappings.length) {\n          //               return frame.with({\n          //                 isInternal: true,\n          //               });\n          //             }\n\n          //             let mapping = mappings[0];\n\n          //             for (let i = 1; i < mappings.length; i++) {\n          //               const sourceColumn = mappings[i][0];\n\n          //               if (sourceColumn > column) {\n          //                 break;\n          //               }\n\n          //               mapping = mappings[i];\n          //             }\n\n          //             // We should now have the 'right' mapping\n\n          //             // [ generatedCodeColumn, sourceIndex, sourceCodeLine, sourceCodeColumn, nameIndex ]\n          //             const sourceFileIndex = mapping[1];\n          //             const sourceFile =\n          //               sourceFileIndex !== undefined ? result.sourceMap.sources[sourceFileIndex] : undefined;\n          //             const sourceLine = mapping[2];\n          //             const sourceColumn = mapping[3];\n\n          //             if (sourceLine === undefined || sourceFile === undefined) {\n          //               return frame.with({\n          //                 isInternal: true,\n          //               });\n          //             }\n\n          //             return frame.with({\n          //               isInternal: false,\n          //               columnNumber: sourceColumn,\n          //               lineNumber: sourceLine + 1, // the mappings are 0-indexed\n          //               fileName: sourceFile.replace(/^file:\\/\\/\\//, ''),\n          //             });\n          //           }\n\n          //           return frame;\n          //         })\n          //       );\n          //     } catch (err) {\n          //       console.warn({ err, trace: e.data.payload.frames }, 'Error resolving source locations for stack trace');\n          //     }\n\n          //     console.log('frames', frames);\n          //     console.log('stack', frames.map(frame => frame.toString()).join('\\n'));\n          //   }\n\n          //   setMessages(messages => [...messages, { lines: CallSite.prepareStackTrace(e.data.payload, frames) }]);\n          // }\n        };\n\n        window.addEventListener('message', onMessage);\n        return {\n          dispose() {\n            window.removeEventListener('message', onMessage);\n          },\n        };\n      })()\n    );\n\n    queueRefreshPreview([]);\n\n    return () => disposable.dispose();\n  }, [editorManager.bundler, editorManager, invalidations]);\n\n  return (\n    <PreviewWrap className={props.className}>\n      <PreviewProgress completed={buildProgress.completed} total={buildProgress.total}></PreviewProgress>\n      {previewIframeRef.current ? null : 'Building the preview...'}\n      <PreviewIframeWrap ref={previewWrapRef}></PreviewIframeWrap>\n      <PreviewMessages>\n        {messages.map((message, idx) => (\n          <PreviewMessage key={idx} message={message}></PreviewMessage>\n        ))}\n      </PreviewMessages>\n    </PreviewWrap>\n  );\n};\n\nexport default styled(Preview)``;\n\ndeclare var Velcro: { runtime: typeof runtime };\n\nfunction createBundleRuntime(filename?: string) {\n  const ReactErrorOverlay = Velcro.runtime.require('react-error-overlay') as typeof import('react-error-overlay');\n\n  ReactErrorOverlay.setEditorHandler(err => {\n    window.parent.postMessage({ type: 'error_open', payload: err }, '*');\n  });\n  ReactErrorOverlay.startReportingRuntimeErrors({\n    onError: () => console.log('onError?'),\n    filename,\n  });\n}\n","import * as Monaco from 'monaco-editor';\nimport { useEffect, useState } from 'react';\nimport { DisposableStore } from 'ts-primitives';\n\n// import { EditorContext } from './context';\n\nexport enum EntryKind {\n  Directory = 'directory',\n  File = 'file',\n}\n\nexport interface IDirectory {\n  type: EntryKind.Directory;\n  uri: Monaco.Uri;\n}\nexport interface IFile {\n  type: EntryKind.File;\n  uri: Monaco.Uri;\n  model: Monaco.editor.ITextModel;\n}\n\nexport type DirectoryEntry = IDirectory | IFile;\n\nexport function useDirectory(uri: Monaco.Uri) {\n  // Make sure the URI always ends with a trailing slash\n  const prefix = uri.toString(true).replace(/\\/?$/, '/');\n  const sortEntries = (models: (DirectoryEntry)[]) => {\n    return [...models].sort((a, b) => (a.uri.fsPath > b.uri.fsPath ? 1 : -1));\n  };\n\n  const initialEntries = sortEntries(\n    Monaco.editor.getModels().reduce(\n      (entries, model) => {\n        const modelUri = model.uri.toString(true);\n\n        if (modelUri.startsWith(prefix)) {\n          const nestedPath = modelUri.slice(prefix.length);\n          const nextDirIdx = nestedPath.indexOf('/');\n\n          if (nextDirIdx === 0) {\n            throw new Error('Invariant error: WAT?');\n          }\n\n          if (nextDirIdx > 0) {\n            // This is an intermediate directory\n            const uri = Monaco.Uri.parse(`${prefix}${nestedPath.slice(0, nextDirIdx + 1)}`);\n\n            entries.push({\n              type: EntryKind.Directory,\n              uri,\n            });\n          } else {\n            entries.push({\n              type: EntryKind.File,\n              uri: model.uri,\n              model,\n            });\n          }\n        }\n\n        return entries;\n      },\n      [] as DirectoryEntry[]\n    )\n  );\n  const [entries, setEntries] = useState(initialEntries);\n\n  useEffect(() => {\n    const disposable = new DisposableStore();\n    const prefix = uri.toString(true).replace(/\\/?$/, '/');\n\n    disposable.add(\n      Monaco.editor.onDidCreateModel((model: Monaco.editor.ITextModel) => {\n        const modelUri = model.uri.toString(true);\n\n        if (modelUri.startsWith(prefix)) {\n          const nestedPath = modelUri.slice(prefix.length);\n          const nextDirIdx = nestedPath.indexOf('/');\n\n          if (nextDirIdx === 0) {\n            throw new Error('Invariant error: WAT?');\n          }\n\n          if (nextDirIdx > 0) {\n            // This is an intermediate directory\n            const uri = Monaco.Uri.parse(`${prefix}${nestedPath.slice(0, nextDirIdx)}`);\n\n            // It is possible that we already have this directory\n            const entry = entries.find(entry => entry.uri.toString(true) === uri.toString(true));\n\n            if (entry) {\n              if (entry.type !== EntryKind.Directory) {\n                throw new Error(\n                  `Invariant violation: A file in '${prefix}' conflicts with the path of the new file '${modelUri}'`\n                );\n              }\n\n              return;\n            }\n\n            entries.push({ type: EntryKind.Directory, uri });\n\n            return setEntries(sortEntries(entries));\n          }\n\n          if (\n            !entries.find(\n              entry => entry.type === EntryKind.File && entry.uri.toString(true) === model.uri.toString(true)\n            )\n          ) {\n            entries.push({ type: EntryKind.File, uri: model.uri, model });\n\n            setEntries(sortEntries(entries));\n          }\n        }\n      })\n    );\n\n    disposable.add(\n      Monaco.editor.onWillDisposeModel(model => {\n        const idx = entries.findIndex(entry => entry.type === EntryKind.File && entry.model === model);\n\n        if (idx === -1) {\n          throw new Error(`Invariant violation: Removing an untracked model: '${model.uri.fsPath}'`);\n        }\n\n        entries.splice(idx, 1);\n\n        setEntries(sortEntries(entries));\n      })\n    );\n\n    return () => disposable.dispose();\n  }, [entries, uri]);\n\n  return entries;\n}\n","import styled from '@emotion/styled/macro';\nimport * as Monaco from 'monaco-editor';\nimport React, { useContext, useRef } from 'react';\nimport { Button } from 'reakit/Button';\nimport { Tooltip, TooltipReference, useTooltipState } from 'reakit/Tooltip';\nimport { useDirectory, EntryKind } from '../lib/hooks';\nimport { useActiveModel, EditorManagerContext } from '../lib/EditorManager';\n\nconst Entry = styled.div<{ modelFocused: boolean }>`\n  background-color: ${props => (props.modelFocused ? '#008cba' : 'inherit')};\n  text-decoration: none;\n  color: ${props => (props.modelFocused ? '#fff' : '#262626')};\n\n  height: 25px;\n  padding: 0 0 0 8px;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n\n  & > span {\n    flex: 1;\n  }\n\n  & > button {\n    display: none;\n  }\n\n  &:hover > button {\n    display: block;\n  }\n\n  ${props =>\n    props.modelFocused\n      ? {\n          ':hover': {\n            color: '#f5f5f5',\n            cursor: 'pointer',\n          },\n        }\n      : {\n          ':hover': {\n            backgroundColor: '#eee',\n            color: '#262626',\n            cursor: 'pointer',\n          },\n        }}\n`;\n\nconst CreateEntry = styled.div`\n  text-decoration: none;\n  color: '#262626';\n\n  height: 25px;\n  padding: 0 0 0 8px;\n  display: flex;\n  align-items: center;\n\n  :hover {\n    background-color: #eee;\n    cursor: pointer;\n  }\n`;\n\nconst SidebarFileDelete = styled(Button)`\n  border: none;\n  background: none;\n\n  :hover {\n    cursor: pointer;\n  }\n`;\n\nconst StyledTooltip = styled.div`\n  font-family: Open Sans, Helvetica Neue, Helvetica, Arial, sans-serif;\n  font-size: 14px;\n  line-height: 1.4;\n  background-color: #333;\n  color: #fff;\n  border-radius: 4px;\n  opacity: 0.9;\n  padding: 0.2em 0.4em;\n`;\n\nconst SidebarFile: React.FC<{ className?: string; model: Monaco.editor.ITextModel }> = ({ className, model }) => {\n  const activeModel = useActiveModel();\n  const editorManager = useContext(EditorManagerContext);\n  const tooltip = useTooltipState({ gutter: 0 });\n\n  const onClickDelete = () => {\n    model.dispose();\n  };\n\n  return (\n    <Entry className={className} modelFocused={model === activeModel}>\n      <span onClick={() => editorManager.focusModel(model)}>{model.uri.fsPath.slice(1)}</span>\n      <TooltipReference {...tooltip} as={SidebarFileDelete} onClick={() => onClickDelete()}>\n        <span role=\"img\" aria-label=\"Delete file\">\n          ❌\n        </span>\n      </TooltipReference>\n      <Tooltip {...tooltip} as={StyledTooltip}>\n        Delete file\n      </Tooltip>\n    </Entry>\n  );\n};\n\nconst Sidebar: React.FC<{ className?: string }> = props => {\n  const rootDir = useRef(Monaco.Uri.file('/'));\n  const entries = useDirectory(rootDir.current);\n  const editorManager = useContext(EditorManagerContext);\n\n  const onClickCreate = () => {\n    const filename = prompt('Filename?');\n\n    if (filename) {\n      editorManager.createModel(filename);\n    }\n  };\n\n  return (\n    <div className={props.className}>\n      {entries.map(entry =>\n        entry.type === EntryKind.Directory ? (\n          <div>{entry.uri.fsPath.slice(1)}</div>\n        ) : (\n          <SidebarFile key={entry.uri.toString(true)} model={entry.model}></SidebarFile>\n        )\n      )}\n      <CreateEntry onClick={() => onClickCreate()}>Create...</CreateEntry>\n    </div>\n  );\n};\n\nexport default styled(Sidebar)`\n  display: flex;\n  flex-direction: column;\n`;\n","import styled from '@emotion/styled/macro';\nimport React from 'react';\n\nimport Editor from './Editor';\nimport Preview from './Preview';\nimport Sidebar from './Sidebar';\nimport { EditorManager, EditorManagerContext } from '../lib/EditorManager';\n\nconst App: React.FC<{ className?: string; initialPath: string; project: Record<string, string> }> = ({\n  className,\n  initialPath,\n  project,\n}) => {\n  const editorManager = new EditorManager({ files: project, initialPath: initialPath });\n\n  return (\n    <div className={className}>\n      <EditorManagerContext.Provider value={editorManager}>\n        <Sidebar></Sidebar>\n        <Editor></Editor>\n        <Preview></Preview>\n      </EditorManagerContext.Provider>\n    </div>\n  );\n};\n\nexport default styled(App)`\n  display: flex;\n  flex-direction: row;\n\n  font-family: Open Sans, Helvetica Neue, Helvetica, Arial, sans-serif;\n  font-size: 14px;\n  line-height: 1.4;\n  color: #222;\n\n  ${Sidebar} {\n    flex: 1 1 200px;\n    min-width: 150px;\n    max-width: 400px;\n    border-right: 1px solid #ccc;\n  }\n\n  ${Editor} {\n    border-right: 1px solid #ccc;\n  }\n\n  ${Editor}, ${Preview} {\n    flex: 10;\n  }\n`;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (response.status === 404 || (contentType != null && contentType.indexOf('javascript') === -1)) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log('No internet connection found. App is running in offline mode.');\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n// import 'modern-css-reset';\n\nimport App from './components/App';\nimport * as serviceWorker from './serviceWorker';\nimport styled from '@emotion/styled';\n\nconst project = {\n  'package.json':\n    JSON.stringify(\n      {\n        dependencies: {\n          '@emotion/core': '^10.0.17',\n          '@emotion/styled': '^10.0.17',\n          'github-markdown-css': '^3.0.1',\n          react: '^16.9.0',\n          'react-dom': '^16.9.0',\n        },\n      },\n      null,\n      2\n    ) + '\\n',\n  'explanation.jsx':\n    `\nimport React from 'react';\n\nexport const Explanation = () => <>\n  <section>\n    <h2>What is this?</h2>\n    <p>\n      This is a demo of bundling and serving a browser-based sandbox fully from the browser. <strong>There are <em>no</em> servers involved</strong> except the static server hosting this demo and <a href=\"https://unpkg.com\" target=\"_blank\" rel=\"noopener\">unpkg.com</a>. All module resolution, transpilation and bundling is happening in the browser.\n    </p>\n    <p>\n      Try it. Go offline, and reload...\n    </p>\n    <p>\n      <strong>I dare you.</strong>\n    </p>\n  </section>\n  <section>\n    <h2>Features</h2>\n    <ul>\n      <li>Full offline support. Once your cache is seeded, you can cut the cord.</li>\n      <li>Fully browser-based bundling.</li>\n      <li>Add (almost) any node module and no server is involved.</li>\n      <li>If you want to add another module, make sure to add it to <code>package.json</code> first.</li>\n      <li>Automatic type acquisition for full typings support in the browser, in JavaScript!</li>\n      <li>Resolve source locations in stack traces</li>\n    </ul>\n  </section>\n</>;\n    `.trim() + '\\n',\n  'index.jsx':\n    `\nimport React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\n\nimport 'github-markdown-css';\nimport './style.css';\n\nimport { Explanation } from './explanation';\nimport { name } from './name';\n\nclass Hello extends Component {\n  render() {\n    return <div className=\"markdown-body\">\n      <h1>Hello {this.props.toWhat}</h1>\n      <blockquote>There is no <strike>spoon</strike> server</blockquote>\n      <Explanation/>\n    </div>;\n  }\n}\n  \nReactDOM.render(\n  <Hello toWhat={ name } />,\n  document.getElementById('root')\n);\n      `.trim() + '\\n',\n  'name.js':\n    `\nexport const name = 'Velcro';\n    `.trim() + '\\n',\n  'style.css':\n    `\n.markdown-body {\n  box-sizing: border-box;\n  min-width: 200px;\n  max-width: 980px;\n  margin: 0 auto;\n  padding: 45px;\n}\n\n@media (max-width: 767px) {\n  .markdown-body {\n    padding: 15px;\n  }\n}\n    `.trim() + '\\n',\n};\n\nconst AppWrap = styled.div`\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n\n  background: #333;\n\n  ${App} {\n    flex: 0 0 80vh;\n    width: 80vw;\n    background: white;\n    box-shadow: 0 19px 38px rgba(0, 0, 0, 0.3), 0 15px 12px rgba(0, 0, 0, 0.22);\n    max-height: 90vh;\n  }\n`;\n\nReactDOM.render(\n  <AppWrap>\n    <App initialPath=\"index.jsx\" project={project} />\n  </AppWrap>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n","import _defineProperty from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _slicedToArray from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _asyncToGenerator from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _possibleConstructorReturn from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _wrapNativeSuper from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper\";\nimport _classCallCheck from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/ggoodman/Projects/velcro/packages/playground/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { CancellationTokenSource, CanceledError } from 'ts-primitives';\nexport { CanceledError, CancellationToken, CancellationTokenSource } from 'ts-primitives';\nvar ResolvedEntryKind;\n\n(function (ResolvedEntryKind) {\n  ResolvedEntryKind[\"Directory\"] = \"directory\";\n  ResolvedEntryKind[\"File\"] = \"file\";\n})(ResolvedEntryKind || (ResolvedEntryKind = {}));\n\nfunction isValidPackageJson(json) {\n  return typeof json === 'object' && json !== null && !hasInvalidOptionalStringField(json, 'name') && !hasInvalidOptionalStringField(json, 'version') && !hasInvalidBrowserField(json) && !hasInvalidOptionalStringField(json, 'main') && !hasInvalidOptionalStringField(json, 'module') && !hasInvalidOptionalStringField(json, 'jsnext:main') && !hasInvalidOptionalStringField(json, 'unpkg') && !hasInvalidDependenciesField(json, 'dependencies') && !hasInvalidDependenciesField(json, 'devDependencies') && !hasInvalidDependenciesField(json, 'peerDependencies');\n}\n\nfunction hasInvalidBrowserField(json) {\n  var error = '';\n  var browser = json.browser;\n\n  if (browser) {\n    if (typeof browser === 'object') {\n      for (var key in browser) {\n        if (typeof key !== 'string') {\n          error = \"The key \".concat(key, \" of .browser must be a string\");\n          break;\n        }\n\n        if (typeof browser[key] !== 'string' && browser[key] !== false) {\n          error = \"The value \".concat(key, \" of .browser must be a string or false\");\n          break;\n        }\n      }\n    }\n  }\n\n  return error;\n}\n\nfunction hasInvalidOptionalStringField(json, field) {\n  return json[field] !== undefined && typeof json[field] !== 'string';\n}\n\nfunction hasInvalidDependenciesField(json, field) {\n  return json[field] !== undefined && typeof json[field] === 'object' && json[field] !== null && !Object.keys(json[field]).every(function (key) {\n    return typeof key === 'string' && typeof json[field][key] === 'string';\n  });\n}\n\nvar CHAR_DOT = 46;\n/* . */\n\nvar CHAR_FORWARD_SLASH = 47;\n/* / */\n\nvar TRAILING_SLASH_RX = /\\/?$/;\n\nfunction ensureTrailingSlash(pathname) {\n  return pathname.replace(TRAILING_SLASH_RX, '/');\n}\n\nfunction parseBufferAsPackageJson(decoder, content, spec) {\n  try {\n    var text = decoder.decode(content);\n    return parseTextAsPackageJson(text, spec);\n  } catch (err) {\n    throw new Error(\"Error decoding manifest buffer for package \".concat(spec, \": \").concat(err.message));\n  }\n}\n\nfunction parseTextAsPackageJson(text, spec) {\n  var json;\n\n  try {\n    json = JSON.parse(text);\n  } catch (err) {\n    throw new Error(\"Error parsing manifest as json for package \".concat(spec, \": \").concat(err.message));\n  }\n\n  if (!isValidPackageJson(json)) {\n    throw new Error(\"Invalid manifest for the package \".concat(spec));\n  }\n\n  return json;\n}\n\nfunction getFirstPathSegmentAfterPrefix(child, parent) {\n  var childHref = child.pathname;\n  var parentHref = parent.pathname;\n  var parentOffset = parentHref.charAt(parentHref.length - 1) === '/' ? -1 : 0;\n\n  for (var i = 0; i <= childHref.length; i++) {\n    if (i < parentHref.length) {\n      if (childHref.charAt(i) !== parentHref.charAt(i)) {\n        throw new Error(\"The child entry \".concat(child.href, \" does not have the pathname of \").concat(parent.href, \" as a prefix\"));\n      }\n    } else if (i === parentHref.length + parentOffset) {\n      if (childHref.charAt(i) !== '/') {\n        throw new Error(\"The child entry \".concat(child.href, \" does not have the pathname of \").concat(parent.href, \" as a prefix\"));\n      }\n    } else if (childHref.charAt(i) === '/') {\n      return childHref.slice(parentHref.length + 1 + parentOffset, i);\n    }\n  }\n\n  return childHref.slice(parentHref.length + 1 + parentOffset);\n}\n\nfunction validateString(value, name) {\n  if (typeof value !== 'string') {\n    throw new TypeError(\"The '\".concat(name, \"' argument must be of type string but got \").concat(typeof value));\n  }\n}\n\nfunction basename(path, ext) {\n  if (ext !== undefined) {\n    validateString(ext, 'ext');\n  }\n\n  validateString(path, 'path');\n  var start = 0;\n  var end = -1;\n  var matchedSlash = true;\n  var i;\n\n  if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {\n    if (ext.length === path.length && ext === path) {\n      return '';\n    }\n\n    var extIdx = ext.length - 1;\n    var firstNonSlashEnd = -1;\n\n    for (i = path.length - 1; i >= start; --i) {\n      var code = path.charCodeAt(i);\n\n      if (isPathSeparator(code)) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          start = i + 1;\n          break;\n        }\n      } else {\n        if (firstNonSlashEnd === -1) {\n          // We saw the first non-path separator, remember this index in case\n          // we need it if the extension ends up not matching\n          matchedSlash = false;\n          firstNonSlashEnd = i + 1;\n        }\n\n        if (extIdx >= 0) {\n          // Try to match the explicit extension\n          if (code === ext.charCodeAt(extIdx)) {\n            if (--extIdx === -1) {\n              // We matched the extension, so mark this as the end of our path\n              // component\n              end = i;\n            }\n          } else {\n            // Extension does not match, so our result is the entire path\n            // component\n            extIdx = -1;\n            end = firstNonSlashEnd;\n          }\n        }\n      }\n    }\n\n    if (start === end) {\n      end = firstNonSlashEnd;\n    } else if (end === -1) {\n      end = path.length;\n    }\n\n    return path.slice(start, end);\n  } else {\n    for (i = path.length - 1; i >= start; --i) {\n      if (isPathSeparator(path.charCodeAt(i))) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          start = i + 1;\n          break;\n        }\n      } else if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // path component\n        matchedSlash = false;\n        end = i + 1;\n      }\n    }\n\n    if (end === -1) {\n      return '';\n    }\n\n    return path.slice(start, end);\n  }\n}\n\nfunction extname(path) {\n  validateString(path, 'path');\n  var start = 0;\n  var startDot = -1;\n  var startPart = 0;\n  var end = -1;\n  var matchedSlash = true; // Track the state of characters (if any) we see before our first dot and\n  // after any path separator we find\n\n  var preDotState = 0;\n\n  for (var i = path.length - 1; i >= start; --i) {\n    var code = path.charCodeAt(i);\n\n    if (isPathSeparator(code)) {\n      // If we reached a path separator that was not part of a set of path\n      // separators at the end of the string, stop now\n      if (!matchedSlash) {\n        startPart = i + 1;\n        break;\n      }\n\n      continue;\n    }\n\n    if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // extension\n      matchedSlash = false;\n      end = i + 1;\n    }\n\n    if (code === CHAR_DOT) {\n      // If this is our first dot, mark it as the start of our extension\n      if (startDot === -1) {\n        startDot = i;\n      } else if (preDotState !== 1) {\n        preDotState = 1;\n      }\n    } else if (startDot !== -1) {\n      // We saw a non-dot and non-path separator before our dot, so we should\n      // have a good chance at having a non-empty extension\n      preDotState = -1;\n    }\n  }\n\n  if (startDot === -1 || end === -1 || // We saw a non-dot character immediately before the dot\n  preDotState === 0 || // The (right-most) trimmed path component is exactly '..'\n  preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {\n    return '';\n  }\n\n  return path.slice(startDot, end);\n}\n\nfunction dirname(path) {\n  validateString(path, 'path');\n  var len = path.length;\n\n  if (len === 0) {\n    return '.';\n  }\n\n  var rootEnd = -1;\n  var end = -1;\n  var matchedSlash = true;\n  var offset = 0;\n  var code = path.charCodeAt(0); // Try to match a root\n\n  if (len > 1) {\n    if (isPathSeparator(code)) {\n      // Possible UNC root\n      rootEnd = offset = 1;\n\n      if (isPathSeparator(path.charCodeAt(1))) {\n        // Matched double path separator at beginning\n        var j = 2;\n        var last = j; // Match 1 or more non-path separators\n\n        for (; j < len; ++j) {\n          if (isPathSeparator(path.charCodeAt(j))) {\n            break;\n          }\n        }\n\n        if (j < len && j !== last) {\n          // Matched!\n          last = j; // Match 1 or more path separators\n\n          for (; j < len; ++j) {\n            if (!isPathSeparator(path.charCodeAt(j))) {\n              break;\n            }\n          }\n\n          if (j < len && j !== last) {\n            // Matched!\n            last = j; // Match 1 or more non-path separators\n\n            for (; j < len; ++j) {\n              if (isPathSeparator(path.charCodeAt(j))) {\n                break;\n              }\n            }\n\n            if (j === len) {\n              // We matched a UNC root only\n              return path;\n            }\n\n            if (j !== last) {\n              // We matched a UNC root with leftovers\n              // Offset by 1 to include the separator after the UNC root to\n              // treat it as a \"normal root\" on top of a (UNC) root\n              rootEnd = offset = j + 1;\n            }\n          }\n        }\n      }\n    }\n  } else if (isPathSeparator(code)) {\n    // `path` contains just a path separator, exit early to avoid\n    // unnecessary work\n    return path;\n  }\n\n  for (var i = len - 1; i >= offset; --i) {\n    if (isPathSeparator(path.charCodeAt(i))) {\n      if (!matchedSlash) {\n        end = i;\n        break;\n      }\n    } else {\n      // We saw the first non-path separator\n      matchedSlash = false;\n    }\n  }\n\n  if (end === -1) {\n    if (rootEnd === -1) {\n      return '.';\n    } else {\n      end = rootEnd;\n    }\n  }\n\n  return path.slice(0, end);\n}\n\nfunction join(initialSegment) {\n  var pathname = initialSegment;\n\n  for (var i = 0; i < (arguments.length <= 1 ? 0 : arguments.length - 1); i++) {\n    var segment = i + 1 < 1 || arguments.length <= i + 1 ? undefined : arguments[i + 1];\n\n    if (segment.startsWith('/')) {\n      segment = segment.slice(1);\n    }\n\n    if (pathname.endsWith('/')) {\n      pathname += segment;\n    } else {\n      pathname += \"/\".concat(segment);\n    }\n  }\n\n  return pathname;\n}\n\nfunction resolve() {\n  var resolvedPath = '';\n  var resolvedAbsolute = false;\n\n  for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n    var path = void 0;\n\n    if (i >= 0) {\n      path = i < 0 || arguments.length <= i ? undefined : arguments[i];\n    } else {\n      break;\n    }\n\n    validateString(path, 'path'); // Skip empty entries\n\n    if (path.length === 0) {\n      continue;\n    }\n\n    resolvedPath = path + '/' + resolvedPath;\n    resolvedAbsolute = path.charCodeAt(0) === CHAR_FORWARD_SLASH;\n  } // At this point the path should be resolved to a full absolute path, but\n  // handle relative paths to be safe (might happen when process.cwd() fails)\n  // Normalize the path\n\n\n  resolvedPath = normalizeString(resolvedPath, !resolvedAbsolute, '/', isPathSeparator);\n\n  if (resolvedAbsolute) {\n    if (resolvedPath.length > 0) {\n      return '/' + resolvedPath;\n    } else {\n      return '/';\n    }\n  } else if (resolvedPath.length > 0) {\n    return resolvedPath;\n  } else {\n    return '.';\n  }\n}\n\nfunction isPathSeparator(code) {\n  return code === CHAR_FORWARD_SLASH;\n}\n\nfunction normalizeString(path, allowAboveRoot, separator, isPathSeparator) {\n  var res = '';\n  var lastSegmentLength = 0;\n  var lastSlash = -1;\n  var dots = 0;\n  var code = -1;\n\n  for (var i = 0; i <= path.length; ++i) {\n    if (i < path.length) {\n      code = path.charCodeAt(i);\n    } else if (isPathSeparator(code)) {\n      break;\n    } else {\n      code = CHAR_FORWARD_SLASH;\n    }\n\n    if (isPathSeparator(code)) {\n      if (lastSlash === i - 1 || dots === 1) ;else if (lastSlash !== i - 1 && dots === 2) {\n        if (res.length < 2 || lastSegmentLength !== 2 || res.charCodeAt(res.length - 1) !== CHAR_DOT || res.charCodeAt(res.length - 2) !== CHAR_DOT) {\n          if (res.length > 2) {\n            var lastSlashIndex = res.lastIndexOf(separator);\n\n            if (lastSlashIndex === -1) {\n              res = '';\n              lastSegmentLength = 0;\n            } else {\n              res = res.slice(0, lastSlashIndex);\n              lastSegmentLength = res.length - 1 - res.lastIndexOf(separator);\n            }\n\n            lastSlash = i;\n            dots = 0;\n            continue;\n          } else if (res.length === 2 || res.length === 1) {\n            res = '';\n            lastSegmentLength = 0;\n            lastSlash = i;\n            dots = 0;\n            continue;\n          }\n        }\n\n        if (allowAboveRoot) {\n          if (res.length > 0) {\n            res += \"\".concat(separator, \"..\");\n          } else {\n            res = '..';\n          }\n\n          lastSegmentLength = 2;\n        }\n      } else {\n        if (res.length > 0) {\n          res += separator + path.slice(lastSlash + 1, i);\n        } else {\n          res = path.slice(lastSlash + 1, i);\n        }\n\n        lastSegmentLength = i - lastSlash - 1;\n      }\n      lastSlash = i;\n      dots = 0;\n    } else if (code === CHAR_DOT && dots !== -1) {\n      ++dots;\n    } else {\n      dots = -1;\n    }\n  }\n\n  return res;\n}\n\nvar util =\n/*#__PURE__*/\nObject.freeze({\n  __proto__: null,\n  ensureTrailingSlash: ensureTrailingSlash,\n  parseBufferAsPackageJson: parseBufferAsPackageJson,\n  getFirstPathSegmentAfterPrefix: getFirstPathSegmentAfterPrefix,\n  basename: basename,\n  extname: extname,\n  dirname: dirname,\n  join: join,\n  resolve: resolve\n});\n\nvar Decoder =\n/*#__PURE__*/\nfunction () {\n  function Decoder() {\n    _classCallCheck(this, Decoder);\n\n    if (typeof TextDecoder !== 'undefined') {\n      this.decoder = new TextDecoder();\n    }\n  }\n\n  _createClass(Decoder, [{\n    key: \"decode\",\n    value: function decode(buf) {\n      var str = this.decoder ? this.decoder.decode(buf) : Buffer.from(buf).toString('utf-8');\n      return str.charCodeAt(0) === 0xfeff ? str.slice(1) : str;\n    }\n  }]);\n\n  return Decoder;\n}();\n\nvar ExtendableError =\n/*#__PURE__*/\nfunction (_Error) {\n  _inherits(ExtendableError, _Error);\n\n  function ExtendableError(message) {\n    var _this;\n\n    _classCallCheck(this, ExtendableError);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ExtendableError).call(this, message));\n    _this.name = _this.constructor.name;\n\n    if (typeof Error.captureStackTrace === 'function') {\n      Error.captureStackTrace(_assertThisInitialized(_this), _this.constructor);\n    } else {\n      _this.stack = new Error(message).stack;\n    }\n\n    return _this;\n  }\n\n  return ExtendableError;\n}(_wrapNativeSuper(Error));\n\nvar EntryNotFoundError =\n/*#__PURE__*/\nfunction (_ExtendableError) {\n  _inherits(EntryNotFoundError, _ExtendableError);\n\n  function EntryNotFoundError(url) {\n    var _this2;\n\n    _classCallCheck(this, EntryNotFoundError);\n\n    _this2 = _possibleConstructorReturn(this, _getPrototypeOf(EntryNotFoundError).call(this, \"Not found \".concat(url.href)));\n    _this2.url = url;\n    return _this2;\n  }\n\n  return EntryNotFoundError;\n}(ExtendableError);\n\nvar AbstractResolverHost =\n/*#__PURE__*/\nfunction () {\n  function AbstractResolverHost() {\n    _classCallCheck(this, AbstractResolverHost);\n  }\n\n  _createClass(AbstractResolverHost, [{\n    key: \"getCanonicalUrl\",\n    value: function getCanonicalUrl(_resolver, url) {\n      return Promise.resolve(url);\n    }\n  }]);\n\n  return AbstractResolverHost;\n}();\n\nvar TRAILING_SLASH_RX$1 = /\\/?$/;\n\nvar Resolver =\n/*#__PURE__*/\nfunction () {\n  function Resolver(host) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Resolver);\n\n    this.host = host;\n    this.decoder = new Decoder();\n    this.extensions = Array.from(options.extensions || Resolver.defaultExtensions);\n    this.packageMain = options.packageMain || ['main'];\n  }\n\n  _createClass(Resolver, [{\n    key: \"resolve\",\n    value: function () {\n      var _resolve = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(url) {\n        var options,\n            token,\n            tokenSource,\n            optionsWithDefaults,\n            canonicalUrlPromise,\n            _ref,\n            _ref2,\n            canonicalUrl,\n            rootUrl,\n            rootHref,\n            rootHrefWithoutTrailingSlash,\n            canonicalHref,\n            resolvedUrl,\n            _args = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                options = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};\n\n                if (url instanceof URL) {\n                  _context.next = 9;\n                  break;\n                }\n\n                _context.prev = 2;\n                url = new URL(url);\n                _context.next = 9;\n                break;\n\n              case 6:\n                _context.prev = 6;\n                _context.t0 = _context[\"catch\"](2);\n                throw new Error(\"Invalid URL: \".concat(url, \": \").concat(_context.t0.message));\n\n              case 9:\n                token = options.token;\n\n                if (!token) {\n                  tokenSource = new CancellationTokenSource();\n                  token = tokenSource.token;\n                }\n\n                optionsWithDefaults = {\n                  extensions: options.extensions || this.extensions,\n                  ignoreBrowserOverrides: typeof options.ignoreBrowserOverrides === 'undefined' ? false : options.ignoreBrowserOverrides,\n                  packageMain: options.packageMain || this.packageMain,\n                  token: token\n                };\n                canonicalUrlPromise = this.host.getCanonicalUrl ? this.host.getCanonicalUrl(this, url, {\n                  token: token\n                }) : Promise.resolve(url);\n\n                if (!token.isCancellationRequested) {\n                  _context.next = 15;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 15:\n                _context.next = 17;\n                return Promise.all([canonicalUrlPromise, this.host.getResolveRoot(this, url, {\n                  token: token\n                })]);\n\n              case 17:\n                _ref = _context.sent;\n                _ref2 = _slicedToArray(_ref, 2);\n                canonicalUrl = _ref2[0];\n                rootUrl = _ref2[1];\n\n                if (!token.isCancellationRequested) {\n                  _context.next = 23;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 23:\n                rootHref = rootUrl.href;\n                rootHrefWithoutTrailingSlash = rootHref.replace(TRAILING_SLASH_RX$1, '');\n                canonicalHref = canonicalUrl.href;\n\n                if (canonicalHref.startsWith(rootHrefWithoutTrailingSlash)) {\n                  _context.next = 28;\n                  break;\n                }\n\n                throw new Error(\"Unable to resolve a module whose path \".concat(canonicalHref, \" is above the host's root \").concat(rootHref));\n\n              case 28:\n                if (!(rootHrefWithoutTrailingSlash === canonicalHref || rootHref == canonicalHref)) {\n                  _context.next = 34;\n                  break;\n                }\n\n                _context.next = 31;\n                return this.resolveAsDirectory(canonicalUrl, optionsWithDefaults);\n\n              case 31:\n                _context.t1 = _context.sent;\n                _context.next = 37;\n                break;\n\n              case 34:\n                _context.next = 36;\n                return this.resolveAsFile(canonicalUrl, optionsWithDefaults);\n\n              case 36:\n                _context.t1 = _context.sent;\n\n              case 37:\n                resolvedUrl = _context.t1;\n\n                if (!token.isCancellationRequested) {\n                  _context.next = 40;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 40:\n                return _context.abrupt(\"return\", {\n                  ignored: resolvedUrl === false,\n                  resolvedUrl: resolvedUrl || undefined,\n                  rootUrl: rootUrl\n                });\n\n              case 41:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[2, 6]]);\n      }));\n\n      function resolve(_x) {\n        return _resolve.apply(this, arguments);\n      }\n\n      return resolve;\n    }()\n    /**\r\n     * Resolve a reference treating it as a directory\r\n     *\r\n     * 1. If there is a `package.json` file and this has a `main` entry, use that\r\n     * 2. Assume `index` if no main file is found in the `package.json` manifest\r\n     *\r\n     * The outcome of this process will then be resolved as if it were a file.\r\n     */\n\n  }, {\n    key: \"resolveAsDirectory\",\n    value: function () {\n      var _resolveAsDirectory = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(url, options) {\n        var _ref3, _ref4, rootUrl, entries, mainPathname, packageJsonEntry, packageJsonContent, packageJson, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, packageMain, pathname, mainUrl;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return Promise.all([this.host.getResolveRoot(this, url, {\n                  token: options.token\n                }), this.host.listEntries(this, url, {\n                  token: options.token\n                })]);\n\n              case 2:\n                _ref3 = _context2.sent;\n                _ref4 = _slicedToArray(_ref3, 2);\n                rootUrl = _ref4[0];\n                entries = _ref4[1];\n\n                if (!options.token.isCancellationRequested) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 8:\n                mainPathname = 'index'; // Step 1: Look for a package.json with an main field\n\n                packageJsonEntry = entries.find(function (entry) {\n                  return basename(entry.url.pathname) === 'package.json';\n                });\n\n                if (!packageJsonEntry) {\n                  _context2.next = 45;\n                  break;\n                }\n\n                _context2.next = 13;\n                return this.host.readFileContent(this, packageJsonEntry.url, {\n                  token: options.token\n                });\n\n              case 13:\n                packageJsonContent = _context2.sent;\n\n                if (!options.token.isCancellationRequested) {\n                  _context2.next = 16;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 16:\n                packageJson = parseBufferAsPackageJson(this.decoder, packageJsonContent, url.href);\n                _iteratorNormalCompletion = true;\n                _didIteratorError = false;\n                _iteratorError = undefined;\n                _context2.prev = 20;\n                _iterator = this.packageMain[Symbol.iterator]();\n\n              case 22:\n                if (_iteratorNormalCompletion = (_step = _iterator.next()).done) {\n                  _context2.next = 31;\n                  break;\n                }\n\n                packageMain = _step.value;\n                pathname = packageJson[packageMain];\n\n                if (!(typeof pathname === 'string')) {\n                  _context2.next = 28;\n                  break;\n                }\n\n                mainPathname = pathname;\n                return _context2.abrupt(\"break\", 31);\n\n              case 28:\n                _iteratorNormalCompletion = true;\n                _context2.next = 22;\n                break;\n\n              case 31:\n                _context2.next = 37;\n                break;\n\n              case 33:\n                _context2.prev = 33;\n                _context2.t0 = _context2[\"catch\"](20);\n                _didIteratorError = true;\n                _iteratorError = _context2.t0;\n\n              case 37:\n                _context2.prev = 37;\n                _context2.prev = 38;\n\n                if (!_iteratorNormalCompletion && _iterator.return != null) {\n                  _iterator.return();\n                }\n\n              case 40:\n                _context2.prev = 40;\n\n                if (!_didIteratorError) {\n                  _context2.next = 43;\n                  break;\n                }\n\n                throw _iteratorError;\n\n              case 43:\n                return _context2.finish(40);\n\n              case 44:\n                return _context2.finish(37);\n\n              case 45:\n                mainUrl = new URL(resolve(url.pathname, mainPathname), rootUrl);\n                return _context2.abrupt(\"return\", this.resolveAsFile(mainUrl, options));\n\n              case 47:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[20, 33, 37, 45], [38,, 40, 44]]);\n      }));\n\n      function resolveAsDirectory(_x2, _x3) {\n        return _resolveAsDirectory.apply(this, arguments);\n      }\n\n      return resolveAsDirectory;\n    }()\n    /**\r\n     * Resolve a reference treating it as a file\r\n     *\r\n     * 1. List entries in the containing directory\r\n     * 2. Look for an exact file match or a file match with one of the supplied extensions\r\n     * 3. Look for a matching child directory and attempt to resolve that as a directory\r\n     */\n\n  }, {\n    key: \"resolveAsFile\",\n    value: function () {\n      var _resolveAsFile = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(url, options) {\n        var rootUrl, parentPackageJson, browserOverrides, browserMap, packageJsonDir, entry, impliedUrl, targetSpec, target, containingUrl, filename, entries, entryDirectoryMap, entryFileMap, _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, _entry, childFilename, _childFilename, _iteratorNormalCompletion3, _didIteratorError3, _iteratorError3, _iterator3, _step3, ext, mapping, _match, match;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(url.pathname === '' || url.pathname === '/')) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                throw new TypeError(\"Unable to resolve the root as a file: \".concat(url.href));\n\n              case 2:\n                _context3.next = 4;\n                return this.host.getResolveRoot(this, url, {\n                  token: options.token\n                });\n\n              case 4:\n                rootUrl = _context3.sent;\n\n                if (!options.token.isCancellationRequested) {\n                  _context3.next = 7;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 7:\n                if (!(this.packageMain.includes('browser') && !options.ignoreBrowserOverrides)) {\n                  _context3.next = 13;\n                  break;\n                }\n\n                _context3.next = 10;\n                return this.readParentPackageJson(url, {\n                  token: options.token\n                });\n\n              case 10:\n                _context3.t0 = _context3.sent;\n                _context3.next = 14;\n                break;\n\n              case 13:\n                _context3.t0 = undefined;\n\n              case 14:\n                parentPackageJson = _context3.t0;\n\n                if (!options.token.isCancellationRequested) {\n                  _context3.next = 17;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 17:\n                browserOverrides = new Map();\n\n                if (!(parentPackageJson && typeof parentPackageJson.packageJson.browser === 'object')) {\n                  _context3.next = 34;\n                  break;\n                }\n\n                browserMap = parentPackageJson.packageJson.browser;\n                packageJsonDir = dirname(parentPackageJson.url.pathname);\n                _context3.t1 = _regeneratorRuntime.keys(browserMap);\n\n              case 22:\n                if ((_context3.t2 = _context3.t1()).done) {\n                  _context3.next = 34;\n                  break;\n                }\n\n                entry = _context3.t2.value;\n                impliedUrl = new URL(resolve(packageJsonDir, entry), parentPackageJson.url);\n                targetSpec = browserMap[entry];\n                target = targetSpec === false ? false : new URL(resolve(packageJsonDir, targetSpec), parentPackageJson.url);\n\n                if (!(impliedUrl.href === url.href)) {\n                  _context3.next = 31;\n                  break;\n                }\n\n                if (!(target === false)) {\n                  _context3.next = 30;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", false);\n\n              case 30:\n                return _context3.abrupt(\"return\", this.resolveAsFile(target, _objectSpread({}, options, {\n                  ignoreBrowserOverrides: true\n                })));\n\n              case 31:\n                browserOverrides.set(impliedUrl.href, target);\n                _context3.next = 22;\n                break;\n\n              case 34:\n                containingUrl = new URL(ensureTrailingSlash(dirname(url.pathname)), rootUrl);\n                filename = basename(url.pathname);\n                _context3.next = 38;\n                return this.host.listEntries(this, containingUrl, {\n                  token: options.token\n                });\n\n              case 38:\n                entries = _context3.sent;\n\n                if (!options.token.isCancellationRequested) {\n                  _context3.next = 41;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 41:\n                entryDirectoryMap = new Map();\n                entryFileMap = new Map();\n                _iteratorNormalCompletion2 = true;\n                _didIteratorError2 = false;\n                _iteratorError2 = undefined;\n                _context3.prev = 46;\n                _iterator2 = entries[Symbol.iterator]();\n\n              case 48:\n                if (_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done) {\n                  _context3.next = 56;\n                  break;\n                }\n\n                _entry = _step2.value;\n\n                if (!(_entry.url.href === url.href && _entry.type == ResolvedEntryKind.File)) {\n                  _context3.next = 52;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", _entry.url);\n\n              case 52:\n                if (_entry.type === ResolvedEntryKind.Directory) {\n                  childFilename = getFirstPathSegmentAfterPrefix(_entry.url, containingUrl);\n                  entryDirectoryMap.set(childFilename, _entry);\n                } else if (_entry.type === ResolvedEntryKind.File) {\n                  _childFilename = basename(_entry.url.pathname);\n                  entryFileMap.set(_childFilename, _entry);\n                }\n\n              case 53:\n                _iteratorNormalCompletion2 = true;\n                _context3.next = 48;\n                break;\n\n              case 56:\n                _context3.next = 62;\n                break;\n\n              case 58:\n                _context3.prev = 58;\n                _context3.t3 = _context3[\"catch\"](46);\n                _didIteratorError2 = true;\n                _iteratorError2 = _context3.t3;\n\n              case 62:\n                _context3.prev = 62;\n                _context3.prev = 63;\n\n                if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n                  _iterator2.return();\n                }\n\n              case 65:\n                _context3.prev = 65;\n\n                if (!_didIteratorError2) {\n                  _context3.next = 68;\n                  break;\n                }\n\n                throw _iteratorError2;\n\n              case 68:\n                return _context3.finish(65);\n\n              case 69:\n                return _context3.finish(62);\n\n              case 70:\n                // Look for browser overrides\n                _iteratorNormalCompletion3 = true;\n                _didIteratorError3 = false;\n                _iteratorError3 = undefined;\n                _context3.prev = 73;\n                _iterator3 = options.extensions[Symbol.iterator]();\n\n              case 75:\n                if (_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done) {\n                  _context3.next = 92;\n                  break;\n                }\n\n                ext = _step3.value;\n                mapping = browserOverrides.get(\"\".concat(url.href).concat(ext));\n\n                if (!(mapping === false)) {\n                  _context3.next = 82;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", false);\n\n              case 82:\n                if (!mapping) {\n                  _context3.next = 84;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\", this.resolveAsFile(mapping, _objectSpread({}, options, {\n                  ignoreBrowserOverrides: true\n                })));\n\n              case 84:\n                _match = entryFileMap.get(\"\".concat(filename).concat(ext));\n\n                if (!_match) {\n                  _context3.next = 89;\n                  break;\n                }\n\n                if (!(_match.type !== ResolvedEntryKind.File)) {\n                  _context3.next = 88;\n                  break;\n                }\n\n                return _context3.abrupt(\"continue\", 89);\n\n              case 88:\n                return _context3.abrupt(\"return\", _match.url);\n\n              case 89:\n                _iteratorNormalCompletion3 = true;\n                _context3.next = 75;\n                break;\n\n              case 92:\n                _context3.next = 98;\n                break;\n\n              case 94:\n                _context3.prev = 94;\n                _context3.t4 = _context3[\"catch\"](73);\n                _didIteratorError3 = true;\n                _iteratorError3 = _context3.t4;\n\n              case 98:\n                _context3.prev = 98;\n                _context3.prev = 99;\n\n                if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n                  _iterator3.return();\n                }\n\n              case 101:\n                _context3.prev = 101;\n\n                if (!_didIteratorError3) {\n                  _context3.next = 104;\n                  break;\n                }\n\n                throw _iteratorError3;\n\n              case 104:\n                return _context3.finish(101);\n\n              case 105:\n                return _context3.finish(98);\n\n              case 106:\n                // First, attempt to find a matching file or directory\n                match = entryDirectoryMap.get(filename);\n\n                if (!match) {\n                  _context3.next = 111;\n                  break;\n                }\n\n                if (!(match.type !== ResolvedEntryKind.Directory)) {\n                  _context3.next = 110;\n                  break;\n                }\n\n                throw new Error(\"Invariant violation \".concat(match.type, \" is unexpected\"));\n\n              case 110:\n                return _context3.abrupt(\"return\", this.resolveAsDirectory(match.url, options));\n\n              case 111:\n                throw new EntryNotFoundError(url);\n\n              case 112:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[46, 58, 62, 70], [63,, 65, 69], [73, 94, 98, 106], [99,, 101, 105]]);\n      }));\n\n      function resolveAsFile(_x4, _x5) {\n        return _resolveAsFile.apply(this, arguments);\n      }\n\n      return resolveAsFile;\n    }()\n  }, {\n    key: \"readParentPackageJson\",\n    value: function () {\n      var _readParentPackageJson = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee5(url) {\n        var _this3 = this;\n\n        var options,\n            hostRootUrl,\n            hostRootHref,\n            containingDirUrl,\n            readPackageJsonOrRecurse,\n            _args5 = arguments;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                options = _args5.length > 1 && _args5[1] !== undefined ? _args5[1] : {};\n                _context5.next = 3;\n                return this.host.getCanonicalUrl(this, url, {\n                  token: options.token\n                });\n\n              case 3:\n                url = _context5.sent;\n\n                if (!(options.token && options.token.isCancellationRequested)) {\n                  _context5.next = 6;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 6:\n                _context5.next = 8;\n                return this.host.getResolveRoot(this, url, {\n                  token: options.token\n                });\n\n              case 8:\n                hostRootUrl = _context5.sent;\n\n                if (!(options.token && options.token.isCancellationRequested)) {\n                  _context5.next = 11;\n                  break;\n                }\n\n                throw new CanceledError('Canceled');\n\n              case 11:\n                hostRootHref = ensureTrailingSlash(hostRootUrl.href);\n                containingDirUrl = new URL(ensureTrailingSlash(dirname(url.pathname)), url);\n\n                readPackageJsonOrRecurse =\n                /*#__PURE__*/\n                function () {\n                  var _ref5 = _asyncToGenerator(\n                  /*#__PURE__*/\n                  _regeneratorRuntime.mark(function _callee4(dir) {\n                    var entries, packageJsonEntry, parentPackageJsonContent, packageJson, parentDir;\n                    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            if (dir.href.startsWith(hostRootHref)) {\n                              _context4.next = 2;\n                              break;\n                            }\n\n                            return _context4.abrupt(\"return\", undefined);\n\n                          case 2:\n                            _context4.next = 4;\n                            return _this3.host.listEntries(_this3, dir, {\n                              token: options.token\n                            });\n\n                          case 4:\n                            entries = _context4.sent;\n\n                            if (!(options.token && options.token.isCancellationRequested)) {\n                              _context4.next = 7;\n                              break;\n                            }\n\n                            throw new CanceledError('Canceled');\n\n                          case 7:\n                            packageJsonEntry = entries.find(function (entry) {\n                              return entry.type === ResolvedEntryKind.File && entry.url.pathname.endsWith('/package.json');\n                            });\n\n                            if (!packageJsonEntry) {\n                              _context4.next = 24;\n                              break;\n                            }\n\n                            _context4.prev = 9;\n                            _context4.next = 12;\n                            return _this3.host.readFileContent(_this3, packageJsonEntry.url, {\n                              token: options.token\n                            });\n\n                          case 12:\n                            parentPackageJsonContent = _context4.sent;\n\n                            if (!(options.token && options.token.isCancellationRequested)) {\n                              _context4.next = 15;\n                              break;\n                            }\n\n                            throw new CanceledError('Canceled');\n\n                          case 15:\n                            packageJson = parseBufferAsPackageJson(_this3.decoder, parentPackageJsonContent, packageJsonEntry.url.href);\n                            return _context4.abrupt(\"return\", {\n                              packageJson: packageJson,\n                              url: packageJsonEntry.url\n                            });\n\n                          case 19:\n                            _context4.prev = 19;\n                            _context4.t0 = _context4[\"catch\"](9);\n\n                            if (!(_context4.t0 instanceof CanceledError || _context4.t0 && _context4.t0.name === 'CanceledError')) {\n                              _context4.next = 23;\n                              break;\n                            }\n\n                            throw _context4.t0;\n\n                          case 23:\n                            console.warn(\"Error reading the parent package manifest for \".concat(url.href, \" from \").concat(packageJsonEntry.url.href, \": \").concat(_context4.t0.message));\n\n                          case 24:\n                            // Not found here, let's try one up\n                            parentDir = new URL(ensureTrailingSlash(dirname(dir.pathname)), dir); // Skip infinite recursion\n\n                            if (!(parentDir.href === dir.href)) {\n                              _context4.next = 27;\n                              break;\n                            }\n\n                            return _context4.abrupt(\"return\", undefined);\n\n                          case 27:\n                            return _context4.abrupt(\"return\", readPackageJsonOrRecurse(parentDir));\n\n                          case 28:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _callee4, null, [[9, 19]]);\n                  }));\n\n                  return function readPackageJsonOrRecurse(_x7) {\n                    return _ref5.apply(this, arguments);\n                  };\n                }();\n\n                return _context5.abrupt(\"return\", readPackageJsonOrRecurse(containingDirUrl));\n\n              case 15:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function readParentPackageJson(_x6) {\n        return _readParentPackageJson.apply(this, arguments);\n      }\n\n      return readParentPackageJson;\n    }()\n  }]);\n\n  return Resolver;\n}();\n\nResolver.defaultExtensions = ['.js', '.jsx', '.es6', '.es', '.mjs', '.ts', '.tsx', '.json'];\nResolver.path = {\n  basename: basename,\n  dirname: dirname,\n  extname: extname,\n  resolve: resolve\n};\nexport { AbstractResolverHost, Decoder, EntryNotFoundError, ResolvedEntryKind, Resolver, isValidPackageJson, util };"],"sourceRoot":""}